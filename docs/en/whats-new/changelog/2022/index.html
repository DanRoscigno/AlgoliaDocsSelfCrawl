<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-en/whats-new/changelog/2022">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">2022 Changelog | ClickHouse Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/img/logo.png"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2022"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2022 Changelog | ClickHouse Docs"><meta data-rh="true" name="description" content="ClickHouse release 22.12, 2022-12-15"><meta data-rh="true" property="og:description" content="ClickHouse release 22.12, 2022-12-15"><link data-rh="true" rel="icon" href="/AlgoliaDocsSelfCrawl/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2022"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2022" hreflang="en"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2022" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://62VCH2MD74-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF1LLRTQ5Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KF1LLRTQ5Q",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ClickHouse Docs" href="/AlgoliaDocsSelfCrawl/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/docs/js/analytics.js"></script><link rel="stylesheet" href="/AlgoliaDocsSelfCrawl/assets/css/styles.1fe1f09b.css">
<link rel="preload" href="/AlgoliaDocsSelfCrawl/assets/js/runtime~main.be802059.js" as="script">
<link rel="preload" href="/AlgoliaDocsSelfCrawl/assets/js/main.b00bfaaf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--light_HNdA"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ClickHouse</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Product</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/cloud" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Cloud</a></li><li><a href="https://clickhouse.com/clickhouse" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Open Source</a></li></ul></div><a href="https://clickhouse.com/customer-stories" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Use Cases</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Company</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/blog" target="_blank" rel="noopener noreferrer" class="dropdown__link">Blog</a></li><li><a href="https://clickhouse.com/company/our-story" target="_blank" rel="noopener noreferrer" class="dropdown__link">Our story</a></li><li><a href="https://clickhouse.com/company/careers" target="_blank" rel="noopener noreferrer" class="dropdown__link">Careers</a></li><li><a href="https://clickhouse.com/company/contact" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact us</a></li><li><a href="https://clickhouse.com/company/news-events" target="_blank" rel="noopener noreferrer" class="dropdown__link">News and events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Learn</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/AlgoliaDocsSelfCrawl/en/intro">Docs</a></li><li><a href="https://clickhouse.com/learn" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Academy</a></li></ul></div><a href="https://clickhouse.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Pricing</a></div><div class="navbar__items navbar__items--right"><a href="https://clickhouse.cloud/signUp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-signup-button">Try for Free<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Language</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/en/intro">English</a></li><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/ru">Russian</a></li><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/zh">Chinese</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/AlgoliaDocsSelfCrawl/en/intro">What is ClickHouse?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/AlgoliaDocsSelfCrawl/en/about-us/cloud">About Us</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/cloud">Cloud Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/support">Cloud Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/history">ClickHouse History</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/distinctive-features">Distinctive Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/adopters">Adopters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/about-us/performance">Performance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/AlgoliaDocsSelfCrawl/en/quick-start">Get Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Get Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/quick-start">Cloud Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/get-started/sql-console/opening">SQL console</a><button aria-label="Toggle the collapsible sidebar category &#x27;SQL console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/getting-started/example-datasets/">Tutorials and Datasets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials and Datasets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/integrations/intro">Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/install">Install</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/cloud/overview">Cloud</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/integrations/connect-a-client">Connect a Client</a><button aria-label="Toggle the collapsible sidebar category &#x27;Connect a Client&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/integrations/data-ingestion">Ingest</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ingest&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/integrations/data-visualization">Visualize</a><button aria-label="Toggle the collapsible sidebar category &#x27;Visualize&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/integrations/migration/">Migrate</a><button aria-label="Toggle the collapsible sidebar category &#x27;Migrate&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/optimize">Optimize</a><button aria-label="Toggle the collapsible sidebar category &#x27;Optimize&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/manage">Manage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/analyze">SQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/development">Contribute</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contribute&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/en/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/AlgoliaDocsSelfCrawl/en/whats-new">What&#x27;s New</a><button aria-label="Toggle the collapsible sidebar category &#x27;What&#x27;s New&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/AlgoliaDocsSelfCrawl/category/changelog">Changelog</a><button aria-label="Toggle the collapsible sidebar category &#x27;Changelog&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/cloud">Cloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/">2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2022">2022</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2021">2021</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2020">2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2019">2019</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2018">2018</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2017">2017</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/security-changelog">Security Changelog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/en/whats-new/roadmap">Roadmap</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/AlgoliaDocsSelfCrawl/en/whats-new"><span itemprop="name">What&#x27;s New</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/AlgoliaDocsSelfCrawl/category/changelog"><span itemprop="name">Changelog</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">2022</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2022 Changelog</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-2212-2022-12-15"><a id="2212"></a> ClickHouse release 22.12, 2022-12-15<a href="#-clickhouse-release-2212-2022-12-15" class="hash-link" aria-label="Direct link to -clickhouse-release-2212-2022-12-15" title="Direct link to -clickhouse-release-2212-2022-12-15">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes">Upgrade Notes<a href="#upgrade-notes" class="hash-link" aria-label="Direct link to Upgrade Notes" title="Direct link to Upgrade Notes">​</a></h4><ul><li>Fixed backward incompatibility in (de)serialization of states of <code>min</code>, <code>max</code>, <code>any*</code>, <code>argMin</code>, <code>argMax</code> aggregate functions with <code>String</code> argument. The incompatibility affects 22.9, 22.10 and 22.11 branches (fixed since 22.9.6, 22.10.4 and 22.11.2 correspondingly). Some minor releases of 22.3, 22.7 and 22.8 branches are also affected: 22.3.13...22.3.14 (fixed since 22.3.15), 22.8.6...22.8.9 (fixed since 22.8.10), 22.7.6 and newer (will not be fixed in 22.7, we recommend upgrading from 22.7.* to 22.8.10 or newer). This release note does not concern users that have never used affected versions. Incompatible versions append an extra <code>&#x27;\0&#x27;</code> to strings when reading states of the aggregate functions mentioned above. For example, if an older version saved state of <code>anyState(&#x27;foobar&#x27;)</code> to <code>state_column</code> then the incompatible version will print <code>&#x27;foobar\0&#x27;</code> on <code>anyMerge(state_column)</code>. Also incompatible versions write states of the aggregate functions without trailing <code>&#x27;\0&#x27;</code>. Newer versions (that have the fix) can correctly read data written by all versions including incompatible versions, except one corner case. If an incompatible version saved a state with a string that actually ends with null character, then newer version will trim trailing <code>&#x27;\0&#x27;</code> when reading state of affected aggregate function. For example, if an incompatible version saved state of <code>anyState(&#x27;abrac\0dabra\0&#x27;)</code> to <code>state_column</code> then newer versions will print <code>&#x27;abrac\0dabra&#x27;</code> on <code>anyMerge(state_column)</code>. The issue also affects distributed queries when an incompatible version works in a cluster together with older or newer versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/43038" target="_blank" rel="noopener noreferrer">#43038</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>, <a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>). Note: all the official ClickHouse builds already include the patches. This is not necessarily true for unofficial third-party builds that should be avoided.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature">New Feature<a href="#new-feature" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Add <code>BSONEachRow</code> input/output format. In this format, ClickHouse formats/parses each row as a separate BSON document and each column is formatted/parsed as a single BSON field with the column name as the key. <a href="https://github.com/ClickHouse/ClickHouse/pull/42033" target="_blank" rel="noopener noreferrer">#42033</a> (<a href="https://github.com/mark-polokhov" target="_blank" rel="noopener noreferrer">mark-polokhov</a>).</li><li>Add <code>grace_hash</code> JOIN algorithm, it can be enabled with <code>SET join_algorithm = &#x27;grace_hash&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38191" target="_blank" rel="noopener noreferrer">#38191</a> (<a href="https://github.com/BigRedEye" target="_blank" rel="noopener noreferrer">BigRedEye</a>, <a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Allow configuring password complexity rules and checks for creating and changing users. <a href="https://github.com/ClickHouse/ClickHouse/pull/43719" target="_blank" rel="noopener noreferrer">#43719</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Mask sensitive information in logs; mask secret parts in the output of queries <code>SHOW CREATE TABLE</code> and <code>SELECT FROM system.tables</code>. Also resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/41418" target="_blank" rel="noopener noreferrer">#41418</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43227" target="_blank" rel="noopener noreferrer">#43227</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add <code>GROUP BY ALL</code> syntax: <a href="https://github.com/ClickHouse/ClickHouse/issues/37631" target="_blank" rel="noopener noreferrer">#37631</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42265" target="_blank" rel="noopener noreferrer">#42265</a> (<a href="https://github.com/taofengliu" target="_blank" rel="noopener noreferrer">刘陶峰</a>).</li><li>Add <code>FROM table SELECT column</code> syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/41095" target="_blank" rel="noopener noreferrer">#41095</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Added function <code>concatWithSeparator</code> and <code>concat_ws</code> as an alias for Spark SQL compatibility. A function <code>concatWithSeparatorAssumeInjective</code> added as a variant to enable GROUP BY optimization, similarly to <code>concatAssumeInjective</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43749" target="_blank" rel="noopener noreferrer">#43749</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Added <code>multiplyDecimal</code> and <code>divideDecimal</code> functions for decimal operations with fixed precision. <a href="https://github.com/ClickHouse/ClickHouse/pull/42438" target="_blank" rel="noopener noreferrer">#42438</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Added <code>system.moves</code> table with list of currently moving parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/42660" target="_blank" rel="noopener noreferrer">#42660</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Add support for embedded Prometheus endpoint for ClickHouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/43087" target="_blank" rel="noopener noreferrer">#43087</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Support numeric literals with <code>_</code> as the separator, for example, <code>1_000_000</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43925" target="_blank" rel="noopener noreferrer">#43925</a> (<a href="https://github.com/jh0x" target="_blank" rel="noopener noreferrer">jh0x</a>).</li><li>Added possibility to use an array as a second parameter for <code>cutURLParameter</code> function. It will cut multiple parameters. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/6827" target="_blank" rel="noopener noreferrer">#6827</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43788" target="_blank" rel="noopener noreferrer">#43788</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Add a column with the expression of the index in the <code>system.data_skipping_indices</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/43308" target="_blank" rel="noopener noreferrer">#43308</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>).</li><li>Add column <code>engine_full</code> to system table <code>databases</code> so that users can access the entire engine definition of a database via system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/43468" target="_blank" rel="noopener noreferrer">#43468</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>New hash function <a href="https://github.com/Cyan4973/xxHash" target="_blank" rel="noopener noreferrer">xxh3</a> added. Also, the performance of <code>xxHash32</code> and <code>xxHash64</code> are improved on ARM thanks to a library update. <a href="https://github.com/ClickHouse/ClickHouse/pull/43411" target="_blank" rel="noopener noreferrer">#43411</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Added support to define constraints for merge tree settings. For example you can forbid overriding the <code>storage_policy</code> by users. <a href="https://github.com/ClickHouse/ClickHouse/pull/43903" target="_blank" rel="noopener noreferrer">#43903</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Add a new setting <code>input_format_json_read_objects_as_strings</code> that allows the parsing of nested JSON objects into Strings in all JSON input formats. This setting is disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/44052" target="_blank" rel="noopener noreferrer">#44052</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature">Experimental Feature<a href="#experimental-feature" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Support deduplication for asynchronous inserts. Before this change, async inserts did not support deduplication, because multiple small inserts coexisted in one inserted batch. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38075" target="_blank" rel="noopener noreferrer">#38075</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43304" target="_blank" rel="noopener noreferrer">#43304</a> (<a href="https://github.com/hanfei1991" target="_blank" rel="noopener noreferrer">Han Fei</a>).</li><li>Add support for cosine distance for the experimental Annoy (vector similarity search) index. <a href="https://github.com/ClickHouse/ClickHouse/pull/42778" target="_blank" rel="noopener noreferrer">#42778</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Add <code>CREATE / ALTER / DROP NAMED COLLECTION</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/43252" target="_blank" rel="noopener noreferrer">#43252</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). This feature is under development and the queries are not effective as of version 22.12. This changelog entry is added only to avoid confusion. Restrict default access to named collections to the user defined in config. This requires that <code>show_named_collections = 1</code> is set to be able to see them. <a href="https://github.com/ClickHouse/ClickHouse/pull/43325" target="_blank" rel="noopener noreferrer">#43325</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). The <code>system.named_collections</code> table is introduced <a href="https://github.com/ClickHouse/ClickHouse/pull/43147" target="_blank" rel="noopener noreferrer">#43147</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement">Performance Improvement<a href="#performance-improvement" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Add settings <code>max_streams_for_merge_tree_reading</code> and <code>allow_asynchronous_read_from_io_pool_for_merge_tree</code>. Setting <code>max_streams_for_merge_tree_reading</code> limits the number of reading streams for MergeTree tables. Setting <code>allow_asynchronous_read_from_io_pool_for_merge_tree</code> enables a background I/O pool to read from <code>MergeTree</code> tables. This may increase performance for I/O bound queries if used together with <code>max_streams_to_max_threads_ratio</code> or <code>max_streams_for_merge_tree_reading</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43260" target="_blank" rel="noopener noreferrer">#43260</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>). This improves performance up to 100 times in case of high latency storage, low number of CPU and high number of data parts.</li><li>Settings <code>merge_tree_min_rows_for_concurrent_read_for_remote_filesystem/merge_tree_min_bytes_for_concurrent_read_for_remote_filesystem</code> did not respect adaptive granularity. Fat rows did not decrease the number of read rows (as it was done for <code>merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read</code>, which could lead to high memory usage when using remote filesystems. <a href="https://github.com/ClickHouse/ClickHouse/pull/43965" target="_blank" rel="noopener noreferrer">#43965</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Optimized the number of list requests to ZooKeeper or ClickHouse Keeper when selecting a part to merge. Previously it could produce thousands of requests in some cases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/43647" target="_blank" rel="noopener noreferrer">#43647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43675" target="_blank" rel="noopener noreferrer">#43675</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Optimization is getting skipped now if <code>max_size_to_preallocate_for_aggregation</code> has too small a value. The default value of this setting increased to <code>10^8</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43945" target="_blank" rel="noopener noreferrer">#43945</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Speed-up server shutdown by avoiding cleaning up of old data parts. Because it is unnecessary after <a href="https://github.com/ClickHouse/ClickHouse/pull/41145" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/41145</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43760" target="_blank" rel="noopener noreferrer">#43760</a> (<a href="https://github.com/CheSema" target="_blank" rel="noopener noreferrer">Sema Checherinda</a>).</li><li>Merging on initiator now uses the same memory bound approach as merging of local aggregation results if <code>enable_memory_bound_merging_of_aggregation_results</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/40879" target="_blank" rel="noopener noreferrer">#40879</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Keeper improvement: try syncing logs to disk in parallel with replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/43450" target="_blank" rel="noopener noreferrer">#43450</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Keeper improvement: requests are batched more often. The batching can be controlled with the new setting <code>max_requests_quick_batch_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43686" target="_blank" rel="noopener noreferrer">#43686</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement">Improvement<a href="#improvement" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Implement referential dependencies and use them to create tables in the correct order while restoring from a backup. <a href="https://github.com/ClickHouse/ClickHouse/pull/43834" target="_blank" rel="noopener noreferrer">#43834</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Substitute UDFs in <code>CREATE</code> query to avoid failures during loading at startup. Additionally, UDFs can now be used as <code>DEFAULT</code> expressions for columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/43539" target="_blank" rel="noopener noreferrer">#43539</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Change how the following queries delete parts: TRUNCATE TABLE, ALTER TABLE DROP PART, ALTER TABLE DROP PARTITION. Now, these queries make empty parts which cover the old parts. This makes the TRUNCATE query work without a followedexclusive lock which means concurrent reads aren&#x27;t locked. Also achieved durability in all those queries. If the request succeeds, then no resurrected parts appear later. Note that atomicity is achieved only with transaction scope. <a href="https://github.com/ClickHouse/ClickHouse/pull/41145" target="_blank" rel="noopener noreferrer">#41145</a> (<a href="https://github.com/CheSema" target="_blank" rel="noopener noreferrer">Sema Checherinda</a>).</li><li><code>SET param_x</code> query no longer requires manual string serialization for the value of the parameter. For example, query <code>SET param_a = &#x27;[\&#x27;a\&#x27;, \&#x27;b\&#x27;]&#x27;</code> can now be written like <code>SET param_a = [&#x27;a&#x27;, &#x27;b&#x27;]</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41874" target="_blank" rel="noopener noreferrer">#41874</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Show read rows in the progress indication while reading from STDIN from client. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43423" target="_blank" rel="noopener noreferrer">#43423</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43442" target="_blank" rel="noopener noreferrer">#43442</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Show progress bar while reading from s3 table function / engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/43454" target="_blank" rel="noopener noreferrer">#43454</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Progress bar will show both read and written rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/43496" target="_blank" rel="noopener noreferrer">#43496</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li><code>filesystemAvailable</code> and related functions support one optional argument with disk name, and change <code>filesystemFree</code> to <code>filesystemUnreserved</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35076" target="_blank" rel="noopener noreferrer">#35076</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42064" target="_blank" rel="noopener noreferrer">#42064</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Integration with LDAP: increased the default value of search_limit to 256, and added LDAP server config option to change that to an arbitrary value. Closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/42276" target="_blank" rel="noopener noreferrer">#42276</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42461" target="_blank" rel="noopener noreferrer">#42461</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Allow the removal of sensitive information (see the <code>query_masking_rules</code> in the configuration file) from the exception messages as well. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/41418" target="_blank" rel="noopener noreferrer">#41418</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42940" target="_blank" rel="noopener noreferrer">#42940</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Support queries like <code>SHOW FULL TABLES ...</code> for MySQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/43910" target="_blank" rel="noopener noreferrer">#43910</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Keeper improvement: Add 4lw command <code>rqld</code> which can manually assign a node as leader. <a href="https://github.com/ClickHouse/ClickHouse/pull/43026" target="_blank" rel="noopener noreferrer">#43026</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Apply connection timeout settings for Distributed async INSERT from the query. <a href="https://github.com/ClickHouse/ClickHouse/pull/43156" target="_blank" rel="noopener noreferrer">#43156</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The <code>unhex</code> function now supports <code>FixedString</code> arguments. <a href="https://github.com/ClickHouse/ClickHouse/issues/42369" target="_blank" rel="noopener noreferrer">issue42369</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43207" target="_blank" rel="noopener noreferrer">#43207</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li><li>Priority is given to deleting completely expired parts according to the TTL rules, see <a href="https://github.com/ClickHouse/ClickHouse/issues/42869" target="_blank" rel="noopener noreferrer">#42869</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43222" target="_blank" rel="noopener noreferrer">#43222</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>More precise and reactive CPU load indication in clickhouse-client. <a href="https://github.com/ClickHouse/ClickHouse/pull/43307" target="_blank" rel="noopener noreferrer">#43307</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Support reading of subcolumns of nested types from storage <code>S3</code> and table function <code>s3</code> with formats <code>Parquet</code>, <code>Arrow</code> and <code>ORC</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43329" target="_blank" rel="noopener noreferrer">#43329</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Add <code>table_uuid</code> column to the <code>system.parts</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/43404" target="_blank" rel="noopener noreferrer">#43404</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added client option to display the number of locally processed rows in non-interactive mode (<code>--print-num-processed-rows</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/43407" target="_blank" rel="noopener noreferrer">#43407</a> (<a href="https://github.com/jh0x" target="_blank" rel="noopener noreferrer">jh0x</a>).</li><li>Implement <code>aggregation-in-order</code> optimization on top of a query plan. It is enabled by default (but works only together with <code>optimize_aggregation_in_order</code>, which is disabled by default). Set <code>query_plan_aggregation_in_order = 0</code> to use the previous AST-based version. <a href="https://github.com/ClickHouse/ClickHouse/pull/43592" target="_blank" rel="noopener noreferrer">#43592</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Allow to collect profile events with <code>trace_type = &#x27;ProfileEvent&#x27;</code> to <code>system.trace_log</code> on each increment with current stack, profile event name and value of the increment. It can be enabled by the setting <code>trace_profile_events</code> and used to investigate performance of queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/43639" target="_blank" rel="noopener noreferrer">#43639</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add a new setting <code>input_format_max_binary_string_size</code> to limit string size in RowBinary format. <a href="https://github.com/ClickHouse/ClickHouse/pull/43842" target="_blank" rel="noopener noreferrer">#43842</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>When ClickHouse requests a remote HTTP server, and it returns an error, the numeric HTTP code was not displayed correctly in the exception message. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43919" target="_blank" rel="noopener noreferrer">#43919</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43920" target="_blank" rel="noopener noreferrer">#43920</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Correctly report errors in queries even when multiple JOINs optimization is taking place. <a href="https://github.com/ClickHouse/ClickHouse/pull/43583" target="_blank" rel="noopener noreferrer">#43583</a> (<a href="https://github.com/tbsal" target="_blank" rel="noopener noreferrer">Salvatore</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Systemd integration now correctly notifies systemd that the service is really started and is ready to serve requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/43400" target="_blank" rel="noopener noreferrer">#43400</a> (<a href="https://github.com/socketpair" target="_blank" rel="noopener noreferrer">Коренберг Марк</a>).</li><li>Added the option to build ClickHouse with OpenSSL using the <a href="https://www.openssl.org/docs/man3.0/man7/fips_module.html" target="_blank" rel="noopener noreferrer">OpenSSL FIPS Module</a>. This build type has not been tested to validate security and is not supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/43991" target="_blank" rel="noopener noreferrer">#43991</a> (<a href="https://github.com/bkuschel" target="_blank" rel="noopener noreferrer">Boris Kuschel</a>).</li><li>Upgrade to the new <code>DeflateQpl</code> compression codec which has been implemented in a previous PR (details: <a href="https://github.com/ClickHouse/ClickHouse/pull/39494" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/39494</a>). This patch improves codec on below aspects: 1. QPL v0.2.0 to QPL v0.3.0 <a href="https://github.com/intel/qpl" target="_blank" rel="noopener noreferrer">Intel® Query Processing Library (QPL)</a> 2. Improve CMake file for fixing QPL build issues for QPL v0.3.0. 3. Link the QPL library with libaccel-config at build time instead of runtime loading on QPL v0.2.0 (dlopen) 4. Fixed log print issue in CompressionCodecDeflateQpl.cpp. <a href="https://github.com/ClickHouse/ClickHouse/pull/44024" target="_blank" rel="noopener noreferrer">#44024</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release">Bug Fix (user-visible misbehavior in official stable or prestable release)<a href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)">​</a></h4><ul><li>Fixed bug which could lead to deadlock while using asynchronous inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/43233" target="_blank" rel="noopener noreferrer">#43233</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix some incorrect logic in AST level optimization <code>optimize_normalize_count_variants</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43873" target="_blank" rel="noopener noreferrer">#43873</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fix a case when mutations are not making progress when checksums do not match between replicas (e.g. caused by a change in data format on an upgrade). <a href="https://github.com/ClickHouse/ClickHouse/pull/36877" target="_blank" rel="noopener noreferrer">#36877</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix the <code>skip_unavailable_shards</code> optimization which did not work with the <code>hdfsCluster</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/43236" target="_blank" rel="noopener noreferrer">#43236</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Fix <code>s3</code> support for the <code>?</code> wildcard. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42731" target="_blank" rel="noopener noreferrer">#42731</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43253" target="_blank" rel="noopener noreferrer">#43253</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Fix functions <code>arrayFirstOrNull</code> and <code>arrayLastOrNull</code> or null when the array contains <code>Nullable</code> elements. <a href="https://github.com/ClickHouse/ClickHouse/pull/43274" target="_blank" rel="noopener noreferrer">#43274</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fix incorrect <code>UserTimeMicroseconds</code>/<code>SystemTimeMicroseconds</code> accounting related to Kafka tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/42791" target="_blank" rel="noopener noreferrer">#42791</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not suppress exceptions in <code>web</code> disks. Fix retries for the <code>web</code> disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/42800" target="_blank" rel="noopener noreferrer">#42800</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed (logical) race condition between inserts and dropping materialized views. A race condition happened when a Materialized View was dropped at the same time as an INSERT, where the MVs were present as a dependency of the insert at the begining of the execution, but the table has been dropped by the time the insert chain tries to access it, producing either an <code>UNKNOWN_TABLE</code> or <code>TABLE_IS_DROPPED</code> exception, and stopping the insertion. After this change, we avoid these exceptions and just continue with the insert if the dependency is gone. <a href="https://github.com/ClickHouse/ClickHouse/pull/43161" target="_blank" rel="noopener noreferrer">#43161</a> (<a href="https://github.com/AlfVII" target="_blank" rel="noopener noreferrer">AlfVII</a>).</li><li>Fix undefined behavior in the <code>quantiles</code> function, which might lead to uninitialized memory. Found by fuzzer. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/44066" target="_blank" rel="noopener noreferrer">#44066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/44067" target="_blank" rel="noopener noreferrer">#44067</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Additional check on zero uncompressed size is added to <code>CompressionCodecDelta</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43255" target="_blank" rel="noopener noreferrer">#43255</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Flatten arrays from Parquet to avoid an issue with inconsistent data in arrays. These incorrect files can be generated by Apache Iceberg. <a href="https://github.com/ClickHouse/ClickHouse/pull/43297" target="_blank" rel="noopener noreferrer">#43297</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Fix bad cast from <code>LowCardinality</code> column when using short circuit function execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/43311" target="_blank" rel="noopener noreferrer">#43311</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed queries with <code>SAMPLE BY</code> with prewhere optimization on tables using <code>Merge</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/43315" target="_blank" rel="noopener noreferrer">#43315</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Check and compare the content of the <code>format_version</code> file in <code>MergeTreeData</code> so that tables can be loaded even if the storage policy was changed. <a href="https://github.com/ClickHouse/ClickHouse/pull/43328" target="_blank" rel="noopener noreferrer">#43328</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix possible (very unlikely) &quot;No column to rollback&quot; logical error during INSERT into <code>Buffer</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/43336" target="_blank" rel="noopener noreferrer">#43336</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a bug that allowed the parser to parse an unlimited amount of round brackets into one function if <code>allow_function_parameters</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/43350" target="_blank" rel="noopener noreferrer">#43350</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li><code>MaterializeMySQL</code> (experimental feature) support DDL： <code>drop table t1, t2</code> and compatible with most of MySQL DROP DDL. <a href="https://github.com/ClickHouse/ClickHouse/pull/43366" target="_blank" rel="noopener noreferrer">#43366</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li><code>session_log</code> (experimental feature): Fixed the inability to log in (because of failure to create the session_log entry) in a very rare case of messed up setting profiles. <a href="https://github.com/ClickHouse/ClickHouse/pull/42641" target="_blank" rel="noopener noreferrer">#42641</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix possible <code>Cannot create non-empty column with type Nothing</code> in functions <code>if</code>/<code>multiIf</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43356" target="_blank" rel="noopener noreferrer">#43356</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43368" target="_blank" rel="noopener noreferrer">#43368</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix a bug when a row level filter uses the default value of a column. <a href="https://github.com/ClickHouse/ClickHouse/pull/43387" target="_blank" rel="noopener noreferrer">#43387</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Query with <code>DISTINCT</code> + <code>LIMIT BY</code> + <code>LIMIT</code> can return fewer rows than expected. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/43377" target="_blank" rel="noopener noreferrer">#43377</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43410" target="_blank" rel="noopener noreferrer">#43410</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Fix <code>sumMap</code> for <code>Nullable(Decimal(...))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43414" target="_blank" rel="noopener noreferrer">#43414</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>date_diff</code> for hour/minute on macOS. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/42742" target="_blank" rel="noopener noreferrer">#42742</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43466" target="_blank" rel="noopener noreferrer">#43466</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Fix incorrect memory accounting because of merges/mutations. <a href="https://github.com/ClickHouse/ClickHouse/pull/43516" target="_blank" rel="noopener noreferrer">#43516</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed primary key analysis with conditions involving <code>toString(enum)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43596" target="_blank" rel="noopener noreferrer">#43596</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>). This error has been found by @tisonkun.</li><li>Ensure consistency when <code>clickhouse-copier</code> updates status and <code>attach_is_done</code> in Keeper after partition attach is done. <a href="https://github.com/ClickHouse/ClickHouse/pull/43602" target="_blank" rel="noopener noreferrer">#43602</a> (<a href="https://github.com/lzydmxy" target="_blank" rel="noopener noreferrer">lzydmxy</a>).</li><li>During the recovery of a lost replica of a <code>Replicated</code> database (experimental feature), there could a situation where we need to atomically swap two table names (use EXCHANGE). Previously we tried to use two RENAME queries, which was obviously failing and moreover, failed the whole recovery process of the database replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/43628" target="_blank" rel="noopener noreferrer">#43628</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix the case when the <code>s3Cluster</code> function throws <code>NOT_FOUND_COLUMN_IN_BLOCK</code> error. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43534" target="_blank" rel="noopener noreferrer">#43534</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43629" target="_blank" rel="noopener noreferrer">#43629</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Fix possible logical error <code>Array sizes mismatched</code> while parsing JSON object with arrays with same key names but with different nesting level. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43569" target="_blank" rel="noopener noreferrer">#43569</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43693" target="_blank" rel="noopener noreferrer">#43693</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed possible exception in the case of distributed <code>GROUP BY</code> with an <code>ALIAS</code> column among aggregation keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/43709" target="_blank" rel="noopener noreferrer">#43709</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix bug which can lead to broken projections if zero-copy replication (experimental feature) is enabled and used. <a href="https://github.com/ClickHouse/ClickHouse/pull/43764" target="_blank" rel="noopener noreferrer">#43764</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix using multipart upload for very large S3 objects in AWS S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/43824" target="_blank" rel="noopener noreferrer">#43824</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fixed <code>ALTER ... RESET SETTING</code> with <code>ON CLUSTER</code>. It could have been applied to one replica only. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/43843" target="_blank" rel="noopener noreferrer">#43843</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43848" target="_blank" rel="noopener noreferrer">#43848</a> (<a href="https://github.com/elenatorro" target="_blank" rel="noopener noreferrer">Elena Torró</a>).</li><li>Fix a logical error in JOIN with <code>Join</code> table engine at right hand side, if <code>USING</code> is being used. <a href="https://github.com/ClickHouse/ClickHouse/pull/43963" target="_blank" rel="noopener noreferrer">#43963</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>). Fix a bug with wrong order of keys in <code>Join</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/44012" target="_blank" rel="noopener noreferrer">#44012</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Keeper fix: throw if the interserver port for Raft is already in use. <a href="https://github.com/ClickHouse/ClickHouse/pull/43984" target="_blank" rel="noopener noreferrer">#43984</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix ORDER BY positional argument (example: <code>ORDER BY 1, 2</code>) in case of unneeded columns pruning from subqueries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43964" target="_blank" rel="noopener noreferrer">#43964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43987" target="_blank" rel="noopener noreferrer">#43987</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed exception when a subquery contains HAVING but doesn&#x27;t contain an actual aggregation. <a href="https://github.com/ClickHouse/ClickHouse/pull/44051" target="_blank" rel="noopener noreferrer">#44051</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix race in s3 multipart upload. This race could cause the error <code>Part number must be an integer between 1 and 10000, inclusive. (S3_ERROR)</code> while restoring from a backup. <a href="https://github.com/ClickHouse/ClickHouse/pull/44065" target="_blank" rel="noopener noreferrer">#44065</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-2211-2022-11-17"><a id="2211"></a> ClickHouse release 22.11, 2022-11-17<a href="#-clickhouse-release-2211-2022-11-17" class="hash-link" aria-label="Direct link to -clickhouse-release-2211-2022-11-17" title="Direct link to -clickhouse-release-2211-2022-11-17">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change">Backward Incompatible Change<a href="#backward-incompatible-change" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li><code>JSONExtract</code> family of functions will now attempt to coerce to the requested type. <a href="https://github.com/ClickHouse/ClickHouse/pull/41502" target="_blank" rel="noopener noreferrer">#41502</a> (<a href="https://github.com/marcioapm" target="_blank" rel="noopener noreferrer">Márcio Martins</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-1">New Feature<a href="#new-feature-1" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Adds support for retries during INSERTs into ReplicatedMergeTree when a session with ClickHouse Keeper is lost. Apart from fault tolerance, it aims to provide better user experience, - avoid returning a user an error during insert if keeper is restarted (for example, due to upgrade). <a href="https://github.com/ClickHouse/ClickHouse/pull/42607" target="_blank" rel="noopener noreferrer">#42607</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Add <code>Hudi</code> and <code>DeltaLake</code> table engines, read-only, only for tables on S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/41054" target="_blank" rel="noopener noreferrer">#41054</a> (<a href="https://github.com/rubin-do" target="_blank" rel="noopener noreferrer">Daniil Rubin</a>, <a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add table function <code>hudi</code> and <code>deltaLake</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43080" target="_blank" rel="noopener noreferrer">#43080</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support for composite time intervals. 1. Add, subtract and negate operations are now available on Intervals. In the case where the types of Intervals are different, they will be transformed into the Tuple of those types. 2. A tuple of intervals can be added to or subtracted from a Date/DateTime field. 3. Added parsing of Intervals with different types, for example: <code>INTERVAL &#x27;1 HOUR 1 MINUTE 1 SECOND&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42195" target="_blank" rel="noopener noreferrer">#42195</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Added <code>**</code> glob support for recursive directory traversal of the filesystem and S3. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/36316" target="_blank" rel="noopener noreferrer">#36316</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42376" target="_blank" rel="noopener noreferrer">#42376</a> (<a href="https://github.com/SmitaRKulkarni" target="_blank" rel="noopener noreferrer">SmitaRKulkarni</a>).</li><li>Introduce <code>s3_plain</code> disk type for write-once-read-many operations. Implement <code>ATTACH</code> of <code>MergeTree</code> table for <code>s3_plain</code> disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/42628" target="_blank" rel="noopener noreferrer">#42628</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added applied row-level policies to <code>system.query_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39819" target="_blank" rel="noopener noreferrer">#39819</a> (<a href="https://github.com/quickhouse" target="_blank" rel="noopener noreferrer">Vladimir Chebotaryov</a>).</li><li>Add four-letter command <code>csnp</code> for manually creating snapshots in ClickHouse Keeper. Additionally, <code>lgif</code> was added to get Raft information for a specific node (e.g. index of last created snapshot, last committed log index). <a href="https://github.com/ClickHouse/ClickHouse/pull/41766" target="_blank" rel="noopener noreferrer">#41766</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Add function <code>ascii</code> like in Apache Spark: <a href="https://spark.apache.org/docs/latest/api/sql/#ascii" target="_blank" rel="noopener noreferrer">https://spark.apache.org/docs/latest/api/sql/#ascii</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42670" target="_blank" rel="noopener noreferrer">#42670</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Add function <code>pmod</code> which returns non-negative result based on modulo. <a href="https://github.com/ClickHouse/ClickHouse/pull/42755" target="_blank" rel="noopener noreferrer">#42755</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Add function <code>formatReadableDecimalSize</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42774" target="_blank" rel="noopener noreferrer">#42774</a> (<a href="https://github.com/alexon1234" target="_blank" rel="noopener noreferrer">Alejandro</a>).</li><li>Add function <code>randCanonical</code>, which is similar to the <code>rand</code> function in Apache Spark or Impala. The function generates pseudo random results with independent and identically distributed uniformly distributed values in [0, 1). <a href="https://github.com/ClickHouse/ClickHouse/pull/43124" target="_blank" rel="noopener noreferrer">#43124</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Add function <code>displayName</code>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36770" target="_blank" rel="noopener noreferrer">#36770</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37681" target="_blank" rel="noopener noreferrer">#37681</a> (<a href="https://github.com/xlwh" target="_blank" rel="noopener noreferrer">hongbin</a>).</li><li>Add <code>min_age_to_force_merge_on_partition_only</code> setting to optimize old parts for the entire partition only. <a href="https://github.com/ClickHouse/ClickHouse/pull/42659" target="_blank" rel="noopener noreferrer">#42659</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Add generic implementation for arbitrary structured named collections, access type and <code>system.named_collections</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43147" target="_blank" rel="noopener noreferrer">#43147</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-1">Performance Improvement<a href="#performance-improvement-1" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li><code>match</code> function can use the index if it&#x27;s a condition on string prefix. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37333" target="_blank" rel="noopener noreferrer">#37333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42458" target="_blank" rel="noopener noreferrer">#42458</a> (<a href="https://github.com/Clark0" target="_blank" rel="noopener noreferrer">clarkcaoliu</a>).</li><li>Speed up AND and OR operators when they are sequenced. <a href="https://github.com/ClickHouse/ClickHouse/pull/42214" target="_blank" rel="noopener noreferrer">#42214</a> (<a href="https://github.com/ZhiguoZh" target="_blank" rel="noopener noreferrer">Zhiguo Zhou</a>).</li><li>Support parallel parsing for <code>LineAsString</code> input format. This improves performance just slightly. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42502" target="_blank" rel="noopener noreferrer">#42502</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42780" target="_blank" rel="noopener noreferrer">#42780</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>ClickHouse Keeper performance improvement: improve commit performance for cases when many different nodes have uncommitted states. This should help with cases when a follower node can&#x27;t sync fast enough. <a href="https://github.com/ClickHouse/ClickHouse/pull/42926" target="_blank" rel="noopener noreferrer">#42926</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>A condition like <code>NOT LIKE &#x27;prefix%&#x27;</code> can use the primary index. <a href="https://github.com/ClickHouse/ClickHouse/pull/42209" target="_blank" rel="noopener noreferrer">#42209</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-1">Experimental Feature<a href="#experimental-feature-1" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Support type <code>Object</code> inside other types, e.g. <code>Array(JSON)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36969" target="_blank" rel="noopener noreferrer">#36969</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Ignore MySQL binlog SAVEPOINT event for MaterializedMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/42931" target="_blank" rel="noopener noreferrer">#42931</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>). Handle (ignore) SAVEPOINT queries in MaterializedMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/43086" target="_blank" rel="noopener noreferrer">#43086</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-1">Improvement<a href="#improvement-1" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Trivial queries with small LIMIT will properly determine the number of estimated rows to read, so that the threshold will be checked properly. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7071" target="_blank" rel="noopener noreferrer">#7071</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42580" target="_blank" rel="noopener noreferrer">#42580</a> (<a href="https://github.com/hanfei1991" target="_blank" rel="noopener noreferrer">Han Fei</a>).</li><li>Add support for interactive parameters in INSERT VALUES queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/43077" target="_blank" rel="noopener noreferrer">#43077</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Added new field <code>allow_readonly</code> in <code>system.table_functions</code> to allow using table functions in readonly mode. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/42414" target="_blank" rel="noopener noreferrer">#42414</a> Implementation: <em> Added a new field allow_readonly to table system.table_functions. </em> Updated to use new field allow_readonly to allow using table functions in readonly mode. Testing: <em> Added a test for filesystem tests/queries/0_stateless/02473_functions_in_readonly_mode.sh Documentation: </em> Updated the english documentation for Table Functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/42708" target="_blank" rel="noopener noreferrer">#42708</a> (<a href="https://github.com/SmitaRKulkarni" target="_blank" rel="noopener noreferrer">SmitaRKulkarni</a>).</li><li>The <code>system.asynchronous_metrics</code> gets embedded documentation. This documentation is also exported to Prometheus. Fixed an error with the metrics about <code>cache</code> disks - they were calculated only for one arbitrary cache disk instead all of them. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7644" target="_blank" rel="noopener noreferrer">#7644</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43194" target="_blank" rel="noopener noreferrer">#43194</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Throttling algorithm changed to token bucket. <a href="https://github.com/ClickHouse/ClickHouse/pull/42665" target="_blank" rel="noopener noreferrer">#42665</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Mask passwords and secret keys both in <code>system.query_log</code> and <code>/var/log/clickhouse-server/*.log</code> and also in error messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/42484" target="_blank" rel="noopener noreferrer">#42484</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Remove covered parts for fetched part (to avoid possible replication delay grows). <a href="https://github.com/ClickHouse/ClickHouse/pull/39737" target="_blank" rel="noopener noreferrer">#39737</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>If <code>/dev/tty</code> is available, the progress in clickhouse-client and clickhouse-local will be rendered directly to the terminal, without writing to STDERR. It allows getting progress even if STDERR is redirected to a file, and the file will not be polluted by terminal escape sequences. The progress can be disabled by <code>--progress false</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32238" target="_blank" rel="noopener noreferrer">#32238</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42003" target="_blank" rel="noopener noreferrer">#42003</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add support for <code>FixedString</code> input to base64 coding functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/42285" target="_blank" rel="noopener noreferrer">#42285</a> (<a href="https://github.com/ltrk2" target="_blank" rel="noopener noreferrer">ltrk2</a>).</li><li>Add columns <code>bytes_on_disk</code> and <code>path</code> to <code>system.detached_parts</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42264" target="_blank" rel="noopener noreferrer">#42264</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42303" target="_blank" rel="noopener noreferrer">#42303</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Improve using structure from insertion table in table functions, now setting <code>use_structure_from_insertion_table_in_table_functions</code> has new possible value - <code>2</code> that means that ClickHouse will try to determine if we can use structure from insertion table or not automatically. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40028" target="_blank" rel="noopener noreferrer">#40028</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42320" target="_blank" rel="noopener noreferrer">#42320</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix no progress indication on INSERT FROM INFILE. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42548" target="_blank" rel="noopener noreferrer">#42548</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42634" target="_blank" rel="noopener noreferrer">#42634</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Refactor function <code>tokens</code> to enable max tokens returned for related functions (disabled by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/42673" target="_blank" rel="noopener noreferrer">#42673</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Allow to use <code>Date32</code> arguments for <code>formatDateTime</code> and <code>FROM_UNIXTIME</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/42737" target="_blank" rel="noopener noreferrer">#42737</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Update tzdata to 2022f. Mexico will no longer observe DST except near the US border: <a href="https://www.timeanddate.com/news/time/mexico-abolishes-dst-2022.html" target="_blank" rel="noopener noreferrer">https://www.timeanddate.com/news/time/mexico-abolishes-dst-2022.html</a>. Chihuahua moves to year-round UTC-6 on 2022-10-30. Fiji no longer observes DST. See <a href="https://github.com/google/cctz/pull/235" target="_blank" rel="noopener noreferrer">https://github.com/google/cctz/pull/235</a> and <a href="https://bugs.launchpad.net/ubuntu/+source/tzdata/+bug/1995209" target="_blank" rel="noopener noreferrer">https://bugs.launchpad.net/ubuntu/+source/tzdata/+bug/1995209</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42796" target="_blank" rel="noopener noreferrer">#42796</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add <code>FailedAsyncInsertQuery</code> event metric for async inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/42814" target="_blank" rel="noopener noreferrer">#42814</a> (<a href="https://github.com/kgoralski" target="_blank" rel="noopener noreferrer">Krzysztof Góralski</a>).</li><li>Implement <code>read-in-order</code> optimization on top of query plan. It is enabled by default. Set <code>query_plan_read_in_order = 0</code> to use previous AST-based version. <a href="https://github.com/ClickHouse/ClickHouse/pull/42829" target="_blank" rel="noopener noreferrer">#42829</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Increase the size of upload part exponentially for backup to S3 to avoid errors about max 10 000 parts limit of the multipart upload to s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/42833" target="_blank" rel="noopener noreferrer">#42833</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>When the merge task is continuously busy and the disk space is insufficient, the completely expired parts cannot be selected and dropped, resulting in insufficient disk space. My idea is that when the entire Part expires, there is no need for additional disk space to guarantee, ensure the normal execution of TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/42869" target="_blank" rel="noopener noreferrer">#42869</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>Add <code>oss</code> function and <code>OSS</code> table engine (this is convenient for users). oss is fully compatible with s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/43155" target="_blank" rel="noopener noreferrer">#43155</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Improve error reporting in the collection of OS-related info for the <code>system.asynchronous_metrics</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/43192" target="_blank" rel="noopener noreferrer">#43192</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Modify the <code>INFORMATION_SCHEMA</code> tables in a way so that ClickHouse can connect to itself using the MySQL compatibility protocol. Add columns instead of aliases (related to <a href="https://github.com/ClickHouse/ClickHouse/issues/9769" target="_blank" rel="noopener noreferrer">#9769</a>). It will improve the compatibility with various MySQL clients. <a href="https://github.com/ClickHouse/ClickHouse/pull/43198" target="_blank" rel="noopener noreferrer">#43198</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Add some functions for compatibility with PowerBI, when it connects using MySQL protocol <a href="https://github.com/ClickHouse/ClickHouse/pull/42612" target="_blank" rel="noopener noreferrer">#42612</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Better usability for Dashboard on changes <a href="https://github.com/ClickHouse/ClickHouse/pull/42872" target="_blank" rel="noopener noreferrer">#42872</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-1">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-1" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Run SQLancer for each pull request and commit to master. <a href="https://github.com/sqlancer/sqlancer" target="_blank" rel="noopener noreferrer">SQLancer</a> is an OpenSource fuzzer that focuses on automatic detection of logical bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/42397" target="_blank" rel="noopener noreferrer">#42397</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Update to latest zlib-ng. <a href="https://github.com/ClickHouse/ClickHouse/pull/42463" target="_blank" rel="noopener noreferrer">#42463</a> (<a href="https://github.com/bkuschel" target="_blank" rel="noopener noreferrer">Boris Kuschel</a>).</li><li>Add support for testing ClickHouse server with Jepsen. By the way, we already have support for testing ClickHouse Keeper with Jepsen. This pull request extends it to Replicated tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/42619" target="_blank" rel="noopener noreferrer">#42619</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Use <a href="https://github.com/matus-chochlik/ctcache" target="_blank" rel="noopener noreferrer">https://github.com/matus-chochlik/ctcache</a> for clang-tidy results caching. <a href="https://github.com/ClickHouse/ClickHouse/pull/42913" target="_blank" rel="noopener noreferrer">#42913</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Before the fix, the user-defined config was preserved by RPM in <code>$file.rpmsave</code>. The PR fixes it and won&#x27;t replace the user&#x27;s files from packages. <a href="https://github.com/ClickHouse/ClickHouse/pull/42936" target="_blank" rel="noopener noreferrer">#42936</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Remove some libraries from Ubuntu Docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/42622" target="_blank" rel="noopener noreferrer">#42622</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-1">Bug Fix (user-visible misbehavior in official stable or prestable release)<a href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-1" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)">​</a></h4><ul><li>Updated normaliser to clone the alias ast. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/42452" target="_blank" rel="noopener noreferrer">#42452</a> Implementation: <em> Updated QueryNormalizer to clone alias ast, when its replaced. Previously just assigning the same leads to exception in LogicalExpressinsOptimizer as it would be the same parent being inserted again. </em> This bug is not seen with new analyser (allow_experimental_analyzer), so no changes for it. I added a test for the same. <a href="https://github.com/ClickHouse/ClickHouse/pull/42827" target="_blank" rel="noopener noreferrer">#42827</a> (<a href="https://github.com/SmitaRKulkarni" target="_blank" rel="noopener noreferrer">SmitaRKulkarni</a>).</li><li>Fix race for backup of tables in <code>Lazy</code> databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/43104" target="_blank" rel="noopener noreferrer">#43104</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix for <code>skip_unavailable_shards</code>: it did not work with the <code>s3Cluster</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/43131" target="_blank" rel="noopener noreferrer">#43131</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Fix schema inference in <code>s3Cluster</code> and improvement in <code>hdfsCluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41979" target="_blank" rel="noopener noreferrer">#41979</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix retries while reading from URL table engines / table function. (retriable errors could be retries more times than needed, non-retriable errors resulted in failed assertion in code). <a href="https://github.com/ClickHouse/ClickHouse/pull/42224" target="_blank" rel="noopener noreferrer">#42224</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>A segmentation fault related to DNS &amp; c-ares has been reported and fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/42234" target="_blank" rel="noopener noreferrer">#42234</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Fix <code>LOGICAL_ERROR</code> <code>Arguments of &#x27;plus&#x27; have incorrect data types</code> which may happen in PK analysis (monotonicity check). Fix invalid PK analysis for monotonic binary functions with first constant argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/42410" target="_blank" rel="noopener noreferrer">#42410</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix incorrect key analysis when key types cannot be inside Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/42456" target="_blank" rel="noopener noreferrer">#42456</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42469" target="_blank" rel="noopener noreferrer">#42469</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix typo in a setting name that led to bad usage of schema inference cache while using setting <code>input_format_csv_use_best_effort_in_schema_inference</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41735" target="_blank" rel="noopener noreferrer">#41735</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42536" target="_blank" rel="noopener noreferrer">#42536</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix creating a Set with wrong header when data type is LowCardinality. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42460" target="_blank" rel="noopener noreferrer">#42460</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42579" target="_blank" rel="noopener noreferrer">#42579</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li><code>(U)Int128</code> and <code>(U)Int256</code> values were correctly checked in <code>PREWHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42605" target="_blank" rel="noopener noreferrer">#42605</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix a bug in functions parser that could have led to a segmentation fault. <a href="https://github.com/ClickHouse/ClickHouse/pull/42724" target="_blank" rel="noopener noreferrer">#42724</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix the locking in <code>truncate table</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42728" target="_blank" rel="noopener noreferrer">#42728</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix possible crash in <code>web</code> disks when file does not exist (or <code>OPTIMIZE TABLE FINAL</code>, that also can got the same error eventually). <a href="https://github.com/ClickHouse/ClickHouse/pull/42767" target="_blank" rel="noopener noreferrer">#42767</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>auth_type</code> mapping in <code>system.session_log</code>, by including <code>SSL_CERTIFICATE</code> for the enum values. <a href="https://github.com/ClickHouse/ClickHouse/pull/42782" target="_blank" rel="noopener noreferrer">#42782</a> (<a href="https://github.com/mdonkers" target="_blank" rel="noopener noreferrer">Miel Donkers</a>).</li><li>Fix stack-use-after-return under ASAN build in the Create User query parser. <a href="https://github.com/ClickHouse/ClickHouse/pull/42804" target="_blank" rel="noopener noreferrer">#42804</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix <code>lowerUTF8</code>/<code>upperUTF8</code> in case of symbol was in between 16-byte boundary (very frequent case of you have strings &gt; 16 bytes long). <a href="https://github.com/ClickHouse/ClickHouse/pull/42812" target="_blank" rel="noopener noreferrer">#42812</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Additional bound check was added to LZ4 decompression routine to fix misbehaviour in case of malformed input. <a href="https://github.com/ClickHouse/ClickHouse/pull/42868" target="_blank" rel="noopener noreferrer">#42868</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix rare possible hang on query cancellation. <a href="https://github.com/ClickHouse/ClickHouse/pull/42874" target="_blank" rel="noopener noreferrer">#42874</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect behavior with multiple disjuncts in hash join, close <a href="https://github.com/ClickHouse/ClickHouse/issues/42832" target="_blank" rel="noopener noreferrer">#42832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42876" target="_blank" rel="noopener noreferrer">#42876</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>A null pointer will be generated when select if as from ‘three table join’ , For example, this SQL query: <a href="https://github.com/ClickHouse/ClickHouse/pull/42883" target="_blank" rel="noopener noreferrer">#42883</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Fix memory sanitizer report in Cluster Discovery, close <a href="https://github.com/ClickHouse/ClickHouse/issues/42763" target="_blank" rel="noopener noreferrer">#42763</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42905" target="_blank" rel="noopener noreferrer">#42905</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Improve DateTime schema inference in case of empty string. <a href="https://github.com/ClickHouse/ClickHouse/pull/42911" target="_blank" rel="noopener noreferrer">#42911</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix rare NOT_FOUND_COLUMN_IN_BLOCK error when projection is possible to use but there is no projection available. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/42771" target="_blank" rel="noopener noreferrer">#42771</a> . The bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/25563" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/25563</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42938" target="_blank" rel="noopener noreferrer">#42938</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix ATTACH TABLE in <code>PostgreSQL</code> database engine if the table contains DATETIME data type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42817" target="_blank" rel="noopener noreferrer">#42817</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42960" target="_blank" rel="noopener noreferrer">#42960</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix lambda parsing. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41848" target="_blank" rel="noopener noreferrer">#41848</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42979" target="_blank" rel="noopener noreferrer">#42979</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix incorrect key analysis when nullable keys appear in the middle of a hyperrectangle. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/43111" target="_blank" rel="noopener noreferrer">#43111</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/43133" target="_blank" rel="noopener noreferrer">#43133</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix several buffer over-reads in deserialization of carefully crafted aggregate function states. <a href="https://github.com/ClickHouse/ClickHouse/pull/43159" target="_blank" rel="noopener noreferrer">#43159</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix function <code>if</code> in case of NULL and const Nullable arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43069" target="_blank" rel="noopener noreferrer">#43069</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43178" target="_blank" rel="noopener noreferrer">#43178</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix decimal math overflow in parsing DateTime with the &#x27;best effort&#x27; algorithm. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/43061" target="_blank" rel="noopener noreferrer">#43061</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43180" target="_blank" rel="noopener noreferrer">#43180</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>The <code>indent</code> field produced by the <code>git-import</code> tool was miscalculated. See <a href="https://clickhouse.com/docs/en/getting-started/example-datasets/github/" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/getting-started/example-datasets/github/</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/43191" target="_blank" rel="noopener noreferrer">#43191</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fixed unexpected behaviour of <code>Interval</code> types with subquery and casting. <a href="https://github.com/ClickHouse/ClickHouse/pull/43193" target="_blank" rel="noopener noreferrer">#43193</a> (<a href="https://github.com/jh0x" target="_blank" rel="noopener noreferrer">jh0x</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-2210-2022-10-25"><a id="2210"></a> ClickHouse release 22.10, 2022-10-25<a href="#-clickhouse-release-2210-2022-10-25" class="hash-link" aria-label="Direct link to -clickhouse-release-2210-2022-10-25" title="Direct link to -clickhouse-release-2210-2022-10-25">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-1">Backward Incompatible Change<a href="#backward-incompatible-change-1" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Rename cache commands: <code>show caches</code> -&gt; <code>show filesystem caches</code>, <code>describe cache</code> -&gt; <code>describe filesystem cache</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41508" target="_blank" rel="noopener noreferrer">#41508</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Remove support for the <code>WITH TIMEOUT</code> section for <code>LIVE VIEW</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40557" target="_blank" rel="noopener noreferrer">#40557</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42173" target="_blank" rel="noopener noreferrer">#42173</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Remove support for the <code>{database}</code> macro from the client&#x27;s prompt. It was displayed incorrectly if the database was unspecified and it was not updated on <code>USE</code> statements. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25891" target="_blank" rel="noopener noreferrer">#25891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42508" target="_blank" rel="noopener noreferrer">#42508</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-2">New Feature<a href="#new-feature-2" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Composable protocol configuration is added. Now different protocols can be set up with different listen hosts. Protocol wrappers such as PROXYv1 can be set up over any other protocols (TCP, TCP secure, MySQL, Postgres). <a href="https://github.com/ClickHouse/ClickHouse/pull/41198" target="_blank" rel="noopener noreferrer">#41198</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Add <code>S3</code> as a new type of the destination of backups. Support BACKUP to S3 with as-is path/data structure. <a href="https://github.com/ClickHouse/ClickHouse/pull/42333" target="_blank" rel="noopener noreferrer">#42333</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>), <a href="https://github.com/ClickHouse/ClickHouse/pull/42232" target="_blank" rel="noopener noreferrer">#42232</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added functions (<code>randUniform</code>, <code>randNormal</code>, <code>randLogNormal</code>, <code>randExponential</code>, <code>randChiSquared</code>, <code>randStudentT</code>, <code>randFisherF</code>, <code>randBernoulli</code>, <code>randBinomial</code>, <code>randNegativeBinomial</code>, <code>randPoisson</code>) to generate random values according to the specified distributions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21834" target="_blank" rel="noopener noreferrer">#21834</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42411" target="_blank" rel="noopener noreferrer">#42411</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>An improvement for ClickHouse Keeper: add support for uploading snapshots to S3. S3 information can be defined inside <code>keeper_server.s3_snapshot</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41342" target="_blank" rel="noopener noreferrer">#41342</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Added an aggregate function <code>analysisOfVariance</code> (<code>anova</code>) to perform a statistical test over several groups of normally distributed observations to find out whether all groups have the same mean or not. Original PR <a href="https://github.com/ClickHouse/ClickHouse/issues/37872" target="_blank" rel="noopener noreferrer">#37872</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42131" target="_blank" rel="noopener noreferrer">#42131</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Support limiting of temporary data stored on disk using settings <code>max_temporary_data_on_disk_size_for_user</code>/<code>max_temporary_data_on_disk_size_for_query</code> . <a href="https://github.com/ClickHouse/ClickHouse/pull/40893" target="_blank" rel="noopener noreferrer">#40893</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add setting <code>format_json_object_each_row_column_for_object_name</code> to write/parse object name as column value in JSONObjectEachRow format. <a href="https://github.com/ClickHouse/ClickHouse/pull/41703" target="_blank" rel="noopener noreferrer">#41703</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add BLAKE3 hash-function to SQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/33435" target="_blank" rel="noopener noreferrer">#33435</a> (<a href="https://github.com/BoloniniD" target="_blank" rel="noopener noreferrer">BoloniniD</a>).</li><li>The function <code>javaHash</code> has been extended to integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/41131" target="_blank" rel="noopener noreferrer">#41131</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Add OpenTelemetry support to ON CLUSTER DDL (require <code>distributed_ddl_entry_format_version</code> to be set to 4). <a href="https://github.com/ClickHouse/ClickHouse/pull/41484" target="_blank" rel="noopener noreferrer">#41484</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Added system table <code>asynchronous_insert_log</code>. It contains information about asynchronous inserts (including results of queries in fire-and-forget mode (with <code>wait_for_async_insert=0</code>)) for better introspection. <a href="https://github.com/ClickHouse/ClickHouse/pull/42040" target="_blank" rel="noopener noreferrer">#42040</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add support for methods <code>lz4</code>, <code>bz2</code>, <code>snappy</code> in HTTP&#x27;s <code>Accept-Encoding</code> which is a non-standard extension to HTTP protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/42071" target="_blank" rel="noopener noreferrer">#42071</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Adds Morton Coding (ZCurve) encode/decode functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/41753" target="_blank" rel="noopener noreferrer">#41753</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li>Add support for <code>SET setting_name = DEFAULT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42187" target="_blank" rel="noopener noreferrer">#42187</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-2">Experimental Feature<a href="#experimental-feature-2" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Added new infrastructure for query analysis and planning under the <code>allow_experimental_analyzer</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/31796" target="_blank" rel="noopener noreferrer">#31796</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Initial implementation of Kusto Query Language. Please don&#x27;t use it. <a href="https://github.com/ClickHouse/ClickHouse/pull/37961" target="_blank" rel="noopener noreferrer">#37961</a> (<a href="https://github.com/kashwy" target="_blank" rel="noopener noreferrer">Yong Wang</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-2">Performance Improvement<a href="#performance-improvement-2" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Relax the &quot;Too many parts&quot; threshold. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6551" target="_blank" rel="noopener noreferrer">#6551</a>. Now ClickHouse will allow more parts in a partition if the average part size is large enough (at least 10 GiB). This allows to have up to petabytes of data in a single partition of a single table on a single server, which is possible using disk shelves or object storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/42002" target="_blank" rel="noopener noreferrer">#42002</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Implement operator precedence element parser to make the required stack size smaller. <a href="https://github.com/ClickHouse/ClickHouse/pull/34892" target="_blank" rel="noopener noreferrer">#34892</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>DISTINCT in order optimization leverage sorting properties of data streams. This improvement will enable reading in order for DISTINCT if applicable (before it was necessary to provide ORDER BY for columns in DISTINCT). <a href="https://github.com/ClickHouse/ClickHouse/pull/41014" target="_blank" rel="noopener noreferrer">#41014</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>ColumnVector: optimize UInt8 index with AVX512VBMI. <a href="https://github.com/ClickHouse/ClickHouse/pull/41247" target="_blank" rel="noopener noreferrer">#41247</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>).</li><li>Optimize the lock contentions for <code>ThreadGroupStatus::mutex</code>. The performance experiments of <strong>SSB</strong> (Star Schema Benchmark) on the ICX device (Intel Xeon Platinum 8380 CPU, 80 cores, 160 threads) shows that this change could bring a <strong>2.95x</strong> improvement of the geomean of all subcases&#x27; QPS. <a href="https://github.com/ClickHouse/ClickHouse/pull/41675" target="_blank" rel="noopener noreferrer">#41675</a> (<a href="https://github.com/ZhiguoZh" target="_blank" rel="noopener noreferrer">Zhiguo Zhou</a>).</li><li>Add <code>ldapr</code> capabilities to AArch64 builds. This is supported from Graviton 2+, Azure and GCP instances. Only appeared in clang-15 <a href="https://github.com/llvm/llvm-project/commit/9609b5daffe9fd28d83d83da895abc5113f76c24" target="_blank" rel="noopener noreferrer">not so long ago</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41778" target="_blank" rel="noopener noreferrer">#41778</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Daniel Kutenin</a>).</li><li>Improve performance when comparing strings and one argument is an empty constant string. <a href="https://github.com/ClickHouse/ClickHouse/pull/41870" target="_blank" rel="noopener noreferrer">#41870</a> (<a href="https://github.com/jiebinn" target="_blank" rel="noopener noreferrer">Jiebin Sun</a>).</li><li>Optimize <code>insertFrom</code> of ColumnAggregateFunction to share Aggregate State in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/41960" target="_blank" rel="noopener noreferrer">#41960</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Make writing to <code>azure_blob_storage</code> disks faster (respect <code>max_single_part_upload_size</code> instead of writing a block per each buffer size). Inefficiency mentioned in <a href="https://github.com/ClickHouse/ClickHouse/issues/41754" target="_blank" rel="noopener noreferrer">#41754</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42041" target="_blank" rel="noopener noreferrer">#42041</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Make thread ids in the process list and query_log unique to avoid waste. <a href="https://github.com/ClickHouse/ClickHouse/pull/42180" target="_blank" rel="noopener noreferrer">#42180</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Support skipping cache completely (both download to cache and reading cached data) in case the requested read range exceeds the threshold defined by cache setting <code>bypass_cache_threashold</code>, requires to be enabled with <code>enable_bypass_cache_with_threshold</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/42418" target="_blank" rel="noopener noreferrer">#42418</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>). This helps on slow local disks.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-2">Improvement<a href="#improvement-2" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Add setting <code>allow_implicit_no_password</code>: in combination with <code>allow_no_password</code> it forbids creating a user with no password unless <code>IDENTIFIED WITH no_password</code> is explicitly specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/41341" target="_blank" rel="noopener noreferrer">#41341</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Embedded Keeper will always start in the background allowing ClickHouse to start without achieving quorum. <a href="https://github.com/ClickHouse/ClickHouse/pull/40991" target="_blank" rel="noopener noreferrer">#40991</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Made reestablishing a new connection to ZooKeeper more reactive in case of expiration of the previous one. Previously there was a task which spawns every minute by default and thus a table could be in readonly state for about this time. <a href="https://github.com/ClickHouse/ClickHouse/pull/41092" target="_blank" rel="noopener noreferrer">#41092</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Now projections can be used with zero copy replication (zero-copy replication is a non-production feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/41147" target="_blank" rel="noopener noreferrer">#41147</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Support expression <code>(EXPLAIN SELECT ...)</code> in a subquery. Queries like <code>SELECT * FROM (EXPLAIN PIPELINE SELECT col FROM TABLE ORDER BY col)</code> became valid. <a href="https://github.com/ClickHouse/ClickHouse/pull/40630" target="_blank" rel="noopener noreferrer">#40630</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Allow changing <code>async_insert_max_data_size</code> or <code>async_insert_busy_timeout_ms</code> in scope of query. E.g. user wants to insert data rarely and she doesn&#x27;t have access to the server config to tune default settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/40668" target="_blank" rel="noopener noreferrer">#40668</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Improvements for reading from remote filesystems, made threadpool size for reads/writes configurable. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41070" target="_blank" rel="noopener noreferrer">#41070</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41011" target="_blank" rel="noopener noreferrer">#41011</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support all combinators combination in WindowTransform/arratReduce*/initializeAggregation/aggregate functions versioning. Previously combinators like <code>ForEach/Resample/Map</code> didn&#x27;t work in these places, using them led to exception like<code>State function ... inserts results into non-state column</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41107" target="_blank" rel="noopener noreferrer">#41107</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add function <code>tryDecrypt</code> that returns NULL when decrypt fails (e.g. decrypt with incorrect key) instead of throwing an exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/41206" target="_blank" rel="noopener noreferrer">#41206</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Add the <code>unreserved_space</code> column to the <code>system.disks</code> table to check how much space is not taken by reservations per disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/41254" target="_blank" rel="noopener noreferrer">#41254</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Support s3 authorization headers in table function arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/41261" target="_blank" rel="noopener noreferrer">#41261</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add support for MultiRead in Keeper and internal ZooKeeper client (this is an extension to ZooKeeper protocol, only available in ClickHouse Keeper). <a href="https://github.com/ClickHouse/ClickHouse/pull/41410" target="_blank" rel="noopener noreferrer">#41410</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Add support for decimal type comparing with floating point literal in IN operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/41544" target="_blank" rel="noopener noreferrer">#41544</a> (<a href="https://github.com/lhuang09287750" target="_blank" rel="noopener noreferrer">liang.huang</a>).</li><li>Allow readable size values (like <code>1TB</code>) in cache config. <a href="https://github.com/ClickHouse/ClickHouse/pull/41688" target="_blank" rel="noopener noreferrer">#41688</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>ClickHouse could cache stale DNS entries for some period of time (15 seconds by default) until the cache won&#x27;t be updated asynchronously. During these periods ClickHouse can nevertheless try to establish a connection and produce errors. This behavior is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/41707" target="_blank" rel="noopener noreferrer">#41707</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add interactive history search with fzf-like utility (fzf/sk) for <code>clickhouse-client</code>/<code>clickhouse-local</code> (note you can use <code>FZF_DEFAULT_OPTS</code>/<code>SKIM_DEFAULT_OPTIONS</code> to additionally configure the behavior). <a href="https://github.com/ClickHouse/ClickHouse/pull/41730" target="_blank" rel="noopener noreferrer">#41730</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Only allow clients connecting to a secure server with an invalid certificate only to proceed with the &#x27;--accept-certificate&#x27; flag. <a href="https://github.com/ClickHouse/ClickHouse/pull/41743" target="_blank" rel="noopener noreferrer">#41743</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Add function <code>tryBase58Decode</code>, similar to the existing function <code>tryBase64Decode</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41824" target="_blank" rel="noopener noreferrer">#41824</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Improve feedback when replacing partition with different primary key. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34798" target="_blank" rel="noopener noreferrer">#34798</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41838" target="_blank" rel="noopener noreferrer">#41838</a> (<a href="https://github.com/tbsal" target="_blank" rel="noopener noreferrer">Salvatore</a>).</li><li>Fix parallel parsing: segmentator now checks <code>max_block_size</code>. This fixed memory overallocation in case of parallel parsing and small LIMIT. <a href="https://github.com/ClickHouse/ClickHouse/pull/41852" target="_blank" rel="noopener noreferrer">#41852</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Don&#x27;t add &quot;TABLE_IS_DROPPED&quot; exception to <code>system.errors</code> if it&#x27;s happened during SELECT from a system table and was ignored. <a href="https://github.com/ClickHouse/ClickHouse/pull/41908" target="_blank" rel="noopener noreferrer">#41908</a> (<a href="https://github.com/AlfVII" target="_blank" rel="noopener noreferrer">AlfVII</a>).</li><li>Improve option <code>enable_extended_results_for_datetime_functions</code> to return results of type DateTime64 for functions <code>toStartOfDay</code>, <code>toStartOfHour</code>, <code>toStartOfFifteenMinutes</code>, <code>toStartOfTenMinutes</code>, <code>toStartOfFiveMinutes</code>, <code>toStartOfMinute</code> and <code>timeSlot</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41910" target="_blank" rel="noopener noreferrer">#41910</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Improve <code>DateTime</code> type inference for text formats. Now it respects setting <code>date_time_input_format</code> and doesn&#x27;t try to infer datetimes from numbers as timestamps. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41389" target="_blank" rel="noopener noreferrer">#41389</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42206" target="_blank" rel="noopener noreferrer">#42206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41912" target="_blank" rel="noopener noreferrer">#41912</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Remove confusing warning when inserting with <code>perform_ttl_move_on_insert</code> = false. <a href="https://github.com/ClickHouse/ClickHouse/pull/41980" target="_blank" rel="noopener noreferrer">#41980</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow user to write <code>countState(*)</code> similar to <code>count(*)</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9338" target="_blank" rel="noopener noreferrer">#9338</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41983" target="_blank" rel="noopener noreferrer">#41983</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix <code>rankCorr</code> size overflow. <a href="https://github.com/ClickHouse/ClickHouse/pull/42020" target="_blank" rel="noopener noreferrer">#42020</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Added an option to specify an arbitrary string as an environment name in the Sentry&#x27;s config for more handy reports. <a href="https://github.com/ClickHouse/ClickHouse/pull/42037" target="_blank" rel="noopener noreferrer">#42037</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix parsing out-of-range Date from CSV. <a href="https://github.com/ClickHouse/ClickHouse/pull/42044" target="_blank" rel="noopener noreferrer">#42044</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li><code>parseDataTimeBestEffort</code> now supports comma between date and time. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42038" target="_blank" rel="noopener noreferrer">#42038</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42049" target="_blank" rel="noopener noreferrer">#42049</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Improved stale replica recovery process for <code>ReplicatedMergeTree</code>. If a lost replica has some parts which are absent from a healthy replica, but these parts should appear in the future according to the replication queue of the healthy replica, then the lost replica will keep such parts instead of detaching them. <a href="https://github.com/ClickHouse/ClickHouse/pull/42134" target="_blank" rel="noopener noreferrer">#42134</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Add a possibility to use <code>Date32</code> arguments for date_diff function. Fix issue in date_diff function when using DateTime64 arguments with a start date before Unix epoch and end date after Unix epoch. <a href="https://github.com/ClickHouse/ClickHouse/pull/42308" target="_blank" rel="noopener noreferrer">#42308</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>When uploading big parts to Minio, &#x27;Complete Multipart Upload&#x27; can take a long time. Minio sends heartbeats every 10 seconds (see <a href="https://github.com/minio/minio/pull/7198" target="_blank" rel="noopener noreferrer">https://github.com/minio/minio/pull/7198</a>). But clickhouse times out earlier, because the default send/receive timeout is <a href="https://github.com/ClickHouse/ClickHouse/blob/cc24fcd6d5dfb67f5f66f5483e986bd1010ad9cf/src/IO/S3/PocoHTTPClient.cpp#L123" target="_blank" rel="noopener noreferrer">set</a> to 5 seconds. <a href="https://github.com/ClickHouse/ClickHouse/pull/42321" target="_blank" rel="noopener noreferrer">#42321</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix rarely invalid cast of aggregate state types with complex types such as Decimal. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/42408" target="_blank" rel="noopener noreferrer">#42408</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42417" target="_blank" rel="noopener noreferrer">#42417</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow to use <code>Date32</code> arguments for <code>dateName</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/42554" target="_blank" rel="noopener noreferrer">#42554</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Now filters with NULL literals will be used during index analysis. <a href="https://github.com/ClickHouse/ClickHouse/issues/34063" target="_blank" rel="noopener noreferrer">#34063</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41842" target="_blank" rel="noopener noreferrer">#41842</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Merge parts if every part in the range is older than a certain threshold. The threshold can be set by using <code>min_age_to_force_merge_seconds</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35836" target="_blank" rel="noopener noreferrer">#35836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42423" target="_blank" rel="noopener noreferrer">#42423</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>). This is continuation of <a href="https://github.com/ClickHouse/ClickHouse/pull/39550" target="_blank" rel="noopener noreferrer">#39550i</a> by <a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">@fastio</a> who implemented most of the logic.</li><li>Added new infrastructure for query analysis and planning under <code>allow_experimental_analyzer</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/31796" target="_blank" rel="noopener noreferrer">#31796</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve the time to recover lost keeper connections. <a href="https://github.com/ClickHouse/ClickHouse/pull/42541" target="_blank" rel="noopener noreferrer">#42541</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-2">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-2" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Add fuzzer for table definitions <a href="https://github.com/ClickHouse/ClickHouse/pull/40096" target="_blank" rel="noopener noreferrer">#40096</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>). This represents the biggest advancement for ClickHouse testing in this year so far.</li><li>Beta version of the ClickHouse Cloud service is released: <a href="https://clickhouse.cloud/" target="_blank" rel="noopener noreferrer">https://clickhouse.cloud/</a>. It provides the easiest way to use ClickHouse (even slightly easier than the single-command installation).</li><li>Added support of WHERE clause generation to AST Fuzzer and possibility to add or remove ORDER BY and WHERE clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/38519" target="_blank" rel="noopener noreferrer">#38519</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Aarch64 binaries now require at least ARMv8.2, released in 2016. Most notably, this enables use of ARM LSE, i.e. native atomic operations. Also, CMake build option &quot;NO_ARMV81_OR_HIGHER&quot; has been added to allow compilation of binaries for older ARMv8.0 hardware, e.g. Raspberry Pi 4. <a href="https://github.com/ClickHouse/ClickHouse/pull/41610" target="_blank" rel="noopener noreferrer">#41610</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Allow building ClickHouse with Musl (small changes after it was already supported but broken). <a href="https://github.com/ClickHouse/ClickHouse/pull/41987" target="_blank" rel="noopener noreferrer">#41987</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add the <code>$CLICKHOUSE_CRONFILE</code> file checking to avoid running the <code>sed</code> command to get the file not found error on install. <a href="https://github.com/ClickHouse/ClickHouse/pull/42081" target="_blank" rel="noopener noreferrer">#42081</a> (<a href="https://github.com/peter279k" target="_blank" rel="noopener noreferrer">Chun-Sheng, Li</a>).</li><li>Update cctz to <code>2022e</code> to support the new timezone changes. Palestine transitions are now Saturdays at 02:00. Simplify three Ukraine zones into one. Jordan and Syria switch from +02/+03 with DST to year-round +03. (<a href="https://data.iana.org/time-zones/tzdb/NEWS" target="_blank" rel="noopener noreferrer">https://data.iana.org/time-zones/tzdb/NEWS</a>). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42252" target="_blank" rel="noopener noreferrer">#42252</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42327" target="_blank" rel="noopener noreferrer">#42327</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/42273" target="_blank" rel="noopener noreferrer">#42273</a> (<a href="https://github.com/ddelnano" target="_blank" rel="noopener noreferrer">Dom Del Nano</a>).</li><li>Add Rust code support into ClickHouse with BLAKE3 hash-function library as an example. <a href="https://github.com/ClickHouse/ClickHouse/pull/33435" target="_blank" rel="noopener noreferrer">#33435</a> (<a href="https://github.com/BoloniniD" target="_blank" rel="noopener noreferrer">BoloniniD</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-2">Bug Fix (user-visible misbehavior in official stable or prestable release)<a href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-2" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)">​</a></h4><ul><li>Choose correct aggregation method for <code>LowCardinality</code> with big integer types. <a href="https://github.com/ClickHouse/ClickHouse/pull/42342" target="_blank" rel="noopener noreferrer">#42342</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Several fixes for <code>web</code> disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/41652" target="_blank" rel="noopener noreferrer">#41652</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixes an issue that causes docker run to fail if <code>https_port</code> is not present in config. <a href="https://github.com/ClickHouse/ClickHouse/pull/41693" target="_blank" rel="noopener noreferrer">#41693</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Mutations were not cancelled properly on server shutdown or <code>SYSTEM STOP MERGES</code> query and cancellation might take long time, it&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/41699" target="_blank" rel="noopener noreferrer">#41699</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix wrong result of queries with <code>ORDER BY</code> or <code>GROUP BY</code> by columns from prefix of sorting key, wrapped into monotonic functions, with enable &quot;read in order&quot; optimization (settings <code>optimize_read_in_order</code> and <code>optimize_aggregation_in_order</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/41701" target="_blank" rel="noopener noreferrer">#41701</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible crash in <code>SELECT</code> from <code>Merge</code> table with enabled <code>optimize_monotonous_functions_in_order_by</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41269" target="_blank" rel="noopener noreferrer">#41269</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41740" target="_blank" rel="noopener noreferrer">#41740</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed &quot;Part ... intersects part ...&quot; error that might happen in extremely rare cases if replica was restarted just after detaching some part as broken. <a href="https://github.com/ClickHouse/ClickHouse/pull/41741" target="_blank" rel="noopener noreferrer">#41741</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Don&#x27;t allow to create or alter merge tree tables with column name <code>_row_exists</code>, which is reserved for lightweight delete. Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/41716" target="_blank" rel="noopener noreferrer">#41716</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41763" target="_blank" rel="noopener noreferrer">#41763</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix a bug that CORS headers are missing in some HTTP responses. <a href="https://github.com/ClickHouse/ClickHouse/pull/41792" target="_blank" rel="noopener noreferrer">#41792</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>22.9 might fail to startup <code>ReplicatedMergeTree</code> table if that table was created by 20.3 or older version and was never altered, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41742" target="_blank" rel="noopener noreferrer">#41742</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41796" target="_blank" rel="noopener noreferrer">#41796</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>When the batch sending fails for some reason, it cannot be automatically recovered, and if it is not processed in time, it will lead to accumulation, and the printed error message will become longer and longer, which will cause the http thread to block. <a href="https://github.com/ClickHouse/ClickHouse/pull/41813" target="_blank" rel="noopener noreferrer">#41813</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>Fix compact parts with compressed marks setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41783" target="_blank" rel="noopener noreferrer">#41783</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/41746" target="_blank" rel="noopener noreferrer">#41746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41823" target="_blank" rel="noopener noreferrer">#41823</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Old versions of Replicated database don&#x27;t have a special marker in <!-- -->[Zoo]<!-- -->Keeper. We need to check only whether the node contains come obscure data instead of special mark. <a href="https://github.com/ClickHouse/ClickHouse/pull/41875" target="_blank" rel="noopener noreferrer">#41875</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix possible exception in fs cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/41884" target="_blank" rel="noopener noreferrer">#41884</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix <code>use_environment_credentials</code> for s3 table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/41970" target="_blank" rel="noopener noreferrer">#41970</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed &quot;Directory already exists and is not empty&quot; error on detaching broken part that might prevent <code>ReplicatedMergeTree</code> table from starting replication. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40957" target="_blank" rel="noopener noreferrer">#40957</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41981" target="_blank" rel="noopener noreferrer">#41981</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li><code>toDateTime64</code> now returns the same output with negative integer and float arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/42025" target="_blank" rel="noopener noreferrer">#42025</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Fix write into <code>azure_blob_storage</code>. Partially closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41754" target="_blank" rel="noopener noreferrer">#41754</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42034" target="_blank" rel="noopener noreferrer">#42034</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix the <code>bzip2</code> decoding issue for specific <code>bzip2</code> files. <a href="https://github.com/ClickHouse/ClickHouse/pull/42046" target="_blank" rel="noopener noreferrer">#42046</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix SQL function <code>toLastDayOfMonth</code> with setting &quot;enable_extended_results_for_datetime_functions = 1&quot; at the beginning of the extended range (January 1900). - Fix SQL function &quot;toRelativeWeekNum()&quot; with setting &quot;enable_extended_results_for_datetime_functions = 1&quot; at the end of extended range (December 2299). - Improve the performance of for SQL functions &quot;toISOYear()&quot;, &quot;toFirstDayNumOfISOYearIndex()&quot; and &quot;toYearWeekOfNewyearMode()&quot; by avoiding unnecessary index arithmetics. <a href="https://github.com/ClickHouse/ClickHouse/pull/42084" target="_blank" rel="noopener noreferrer">#42084</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>The maximum size of fetches for each table accidentally was set to 8 while the pool size could be bigger. Now the maximum size of fetches for table is equal to the pool size. <a href="https://github.com/ClickHouse/ClickHouse/pull/42090" target="_blank" rel="noopener noreferrer">#42090</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>A table might be shut down and a dictionary might be detached before checking if can be dropped without breaking dependencies between table, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41982" target="_blank" rel="noopener noreferrer">#41982</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42106" target="_blank" rel="noopener noreferrer">#42106</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix bad inefficiency of <code>remote_filesystem_read_method=read</code> with filesystem cache. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42125" target="_blank" rel="noopener noreferrer">#42125</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42129" target="_blank" rel="noopener noreferrer">#42129</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible timeout exception for distributed queries with use_hedged_requests = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/42130" target="_blank" rel="noopener noreferrer">#42130</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed a minor bug inside function <code>runningDifference</code> in case of using it with <code>Date32</code> type. Previously <code>Date</code> was used and it may cause some logical errors like <code>Bad cast from type DB::ColumnVector&lt;int&gt; to DB::ColumnVector&lt;unsigned short&gt;&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42143" target="_blank" rel="noopener noreferrer">#42143</a> (<a href="https://github.com/sperlingxx" target="_blank" rel="noopener noreferrer">Alfred Xu</a>).</li><li>Fix reusing of files &gt; 4GB from base backup. <a href="https://github.com/ClickHouse/ClickHouse/pull/42146" target="_blank" rel="noopener noreferrer">#42146</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>DISTINCT in order fails with LOGICAL_ERROR if first column in sorting key contains function. <a href="https://github.com/ClickHouse/ClickHouse/pull/42186" target="_blank" rel="noopener noreferrer">#42186</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Fix a bug with projections and the <code>aggregate_functions_null_for_empty</code> setting. This bug is very rare and appears only if you enable the <code>aggregate_functions_null_for_empty</code> setting in the server&#x27;s config. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41647" target="_blank" rel="noopener noreferrer">#41647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42198" target="_blank" rel="noopener noreferrer">#42198</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix read from <code>Buffer</code> tables with read in order desc. <a href="https://github.com/ClickHouse/ClickHouse/pull/42236" target="_blank" rel="noopener noreferrer">#42236</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fix a bug which prevents ClickHouse to start when <code>background_pool_size setting</code> is set on default profile but <code>background_merges_mutations_concurrency_ratio</code> is not. <a href="https://github.com/ClickHouse/ClickHouse/pull/42315" target="_blank" rel="noopener noreferrer">#42315</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li><code>ALTER UPDATE</code> of attached part (with columns different from table schema) could create an invalid <code>columns.txt</code> metadata on disk. Reading from such part could fail with errors or return invalid data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/42161" target="_blank" rel="noopener noreferrer">#42161</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42319" target="_blank" rel="noopener noreferrer">#42319</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Setting <code>additional_table_filters</code> were not applied to <code>Distributed</code> storage. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41692" target="_blank" rel="noopener noreferrer">#41692</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42322" target="_blank" rel="noopener noreferrer">#42322</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a data race in query finish/cancel. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42346" target="_blank" rel="noopener noreferrer">#42346</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42362" target="_blank" rel="noopener noreferrer">#42362</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>This reverts <a href="https://github.com/ClickHouse/ClickHouse/issues/40217" target="_blank" rel="noopener noreferrer">#40217</a> which introduced a regression in date/time functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/42367" target="_blank" rel="noopener noreferrer">#42367</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix assert cast in join on falsy condition, Close <a href="https://github.com/ClickHouse/ClickHouse/issues/42380" target="_blank" rel="noopener noreferrer">#42380</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42407" target="_blank" rel="noopener noreferrer">#42407</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix buffer overflow in the processing of Decimal data types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/42451" target="_blank" rel="noopener noreferrer">#42451</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42465" target="_blank" rel="noopener noreferrer">#42465</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li><code>AggregateFunctionQuantile</code> now correctly works with UInt128 columns. Previously, the quantile state interpreted <code>UInt128</code> columns as <code>Int128</code> which could have led to incorrect results. <a href="https://github.com/ClickHouse/ClickHouse/pull/42473" target="_blank" rel="noopener noreferrer">#42473</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix bad_cast assert during INSERT into <code>Annoy</code> indexes over non-Float32 columns. <code>Annoy</code> indices is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/42485" target="_blank" rel="noopener noreferrer">#42485</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Arithmetic operator with Date or DateTime and 128 or 256-bit integer was referencing uninitialized memory. <a href="https://github.com/ClickHouse/ClickHouse/issues/42453" target="_blank" rel="noopener noreferrer">#42453</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/42573" target="_blank" rel="noopener noreferrer">#42573</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix unexpected table loading error when partition key contains alias function names during server upgrade. <a href="https://github.com/ClickHouse/ClickHouse/pull/36379" target="_blank" rel="noopener noreferrer">#36379</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-229-2022-09-22"><a id="229"></a> ClickHouse release 22.9, 2022-09-22<a href="#-clickhouse-release-229-2022-09-22" class="hash-link" aria-label="Direct link to -clickhouse-release-229-2022-09-22" title="Direct link to -clickhouse-release-229-2022-09-22">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-2">Backward Incompatible Change<a href="#backward-incompatible-change-2" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Upgrade from 20.3 and older to 22.9 and newer should be done through an intermediate version if there are any <code>ReplicatedMergeTree</code> tables, otherwise server with the new version will not start. <a href="https://github.com/ClickHouse/ClickHouse/pull/40641" target="_blank" rel="noopener noreferrer">#40641</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Remove the functions <code>accurate_Cast</code> and <code>accurate_CastOrNull</code> (they are different to <code>accurateCast</code> and <code>accurateCastOrNull</code> by underscore in the name and they are not affected by the value of <code>cast_keep_nullable</code> setting). These functions were undocumented, untested, unused, and unneeded. They appeared to be alive due to code generalization. <a href="https://github.com/ClickHouse/ClickHouse/pull/40682" target="_blank" rel="noopener noreferrer">#40682</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add a test to ensure that every new table function will be documented. See <a href="https://github.com/ClickHouse/ClickHouse/issues/40649" target="_blank" rel="noopener noreferrer">#40649</a>. Rename table function <code>MeiliSearch</code> to <code>meilisearch</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40709" target="_blank" rel="noopener noreferrer">#40709</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add a test to ensure that every new function will be documented. See <a href="https://github.com/ClickHouse/ClickHouse/pull/40649" target="_blank" rel="noopener noreferrer">#40649</a>. The functions <code>lemmatize</code>, <code>synonyms</code>, <code>stem</code> were case-insensitive by mistake. Now they are case-sensitive. <a href="https://github.com/ClickHouse/ClickHouse/pull/40711" target="_blank" rel="noopener noreferrer">#40711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>For security and stability reasons, catboost models are no longer evaluated within the ClickHouse server. Instead, the evaluation is now
done in the clickhouse-library-bridge, a separate process that loads the catboost library and communicates with the server process via
HTTP. <a href="https://github.com/ClickHouse/ClickHouse/pull/40897" target="_blank" rel="noopener noreferrer">#40897</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Make interpretation of YAML configs to be more conventional. <a href="https://github.com/ClickHouse/ClickHouse/pull/41044" target="_blank" rel="noopener noreferrer">#41044</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-3">New Feature<a href="#new-feature-3" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Support <code>insert_quorum = &#x27;auto&#x27;</code> to use majority number. <a href="https://github.com/ClickHouse/ClickHouse/pull/39970" target="_blank" rel="noopener noreferrer">#39970</a> (<a href="https://github.com/SachinSetiya" target="_blank" rel="noopener noreferrer">Sachin</a>).</li><li>Add embedded dashboards to ClickHouse server. This is a demo project about how to achieve 90% results with 1% effort using ClickHouse features. <a href="https://github.com/ClickHouse/ClickHouse/pull/40461" target="_blank" rel="noopener noreferrer">#40461</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Added new settings constraint writability kind <code>changeable_in_readonly</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40631" target="_blank" rel="noopener noreferrer">#40631</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Add support for <code>INTERSECT DISTINCT</code> and <code>EXCEPT DISTINCT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40792" target="_blank" rel="noopener noreferrer">#40792</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Add new input/output format <code>JSONObjectEachRow</code> - Support import for formats <code>JSON/JSONCompact/JSONColumnsWithMetadata</code>. Add new setting <code>input_format_json_validate_types_from_metadata</code> that controls whether we should check if data types from metadata match data types from the header. - Add new setting <code>input_format_json_validate_utf8</code>, when it&#x27;s enabled, all <code>JSON</code> formats will validate UTF-8 sequences. It will be disabled by default. Note that this setting doesn&#x27;t influence output formats <code>JSON/JSONCompact/JSONColumnsWithMetadata</code>, they always validate utf8 sequences (this exception was made because of compatibility reasons). - Add new setting <code>input_format_json_read_numbers_as_strings </code> that allows to parse numbers in String column, the setting is disabled by default. - Add new setting <code>output_format_json_quote_decimals</code> that allows to output decimals in double quotes, disabled by default. - Allow to parse decimals in double quotes during data import. <a href="https://github.com/ClickHouse/ClickHouse/pull/40910" target="_blank" rel="noopener noreferrer">#40910</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Query parameters supported in DESCRIBE TABLE query. <a href="https://github.com/ClickHouse/ClickHouse/pull/40952" target="_blank" rel="noopener noreferrer">#40952</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Add support to Parquet Time32/64 by converting it into DateTime64. Parquet time32/64 represents time elapsed since midnight, while DateTime32/64 represents an actual unix timestamp. Conversion simply offsets from <code>0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41333" target="_blank" rel="noopener noreferrer">#41333</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Implement set operations on Apache Datasketches. <a href="https://github.com/ClickHouse/ClickHouse/pull/39919" target="_blank" rel="noopener noreferrer">#39919</a> (<a href="https://github.com/pzhdfy" target="_blank" rel="noopener noreferrer">Fangyuan Deng</a>). Note: there is no point of using Apache Datasketches, they are inferiour than ClickHouse and only make sense for integration with other systems.</li><li>Allow recording errors to specified file while reading text formats (<code>CSV</code>, <code>TSV</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/40516" target="_blank" rel="noopener noreferrer">#40516</a> (<a href="https://github.com/zjial" target="_blank" rel="noopener noreferrer">zjial</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-3">Experimental Feature<a href="#experimental-feature-3" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Add ANN (approximate nearest neighbor) index based on <code>Annoy</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40818" target="_blank" rel="noopener noreferrer">#40818</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/37215" target="_blank" rel="noopener noreferrer">#37215</a> (<a href="https://github.com/VVMak" target="_blank" rel="noopener noreferrer">VVMak</a>).</li><li>Add new storage engine <code>KeeperMap</code>, that uses ClickHouse Keeper or ZooKeeper as a key-value store. <a href="https://github.com/ClickHouse/ClickHouse/pull/39976" target="_blank" rel="noopener noreferrer">#39976</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>). This storage engine is intended to store a small amount of metadata.</li><li>Improvement for in-memory data parts: remove completely processed WAL files. <a href="https://github.com/ClickHouse/ClickHouse/pull/40592" target="_blank" rel="noopener noreferrer">#40592</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-3">Performance Improvement<a href="#performance-improvement-3" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Implement compression of marks and primary key. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34437" target="_blank" rel="noopener noreferrer">#34437</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37693" target="_blank" rel="noopener noreferrer">#37693</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>Allow to load marks with threadpool in advance. Regulated by setting <code>load_marks_asynchronously</code> (default: 0). <a href="https://github.com/ClickHouse/ClickHouse/pull/40821" target="_blank" rel="noopener noreferrer">#40821</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Virtual filesystem over s3 will use random object names split into multiple path prefixes for better performance on AWS. <a href="https://github.com/ClickHouse/ClickHouse/pull/40968" target="_blank" rel="noopener noreferrer">#40968</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Account <code>max_block_size</code> value while producing single-level aggregation results. Allows to execute following query plan steps using more threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/39138" target="_blank" rel="noopener noreferrer">#39138</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Software prefetching is used in aggregation to speed up operations with hash tables. Controlled by the setting <code>enable_software_prefetch_in_aggregation</code>, enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/39304" target="_blank" rel="noopener noreferrer">#39304</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Better support of <code>optimize_read_in_order</code> in case when some of sorting key columns are always constant after applying <code>WHERE</code> clause. E.g. query like <code>SELECT ... FROM table WHERE a = &#x27;x&#x27; ORDER BY a, b</code>, where <code>table</code> has storage definition: <code>MergeTree ORDER BY (a, b)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38715" target="_blank" rel="noopener noreferrer">#38715</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Filter joined streams for <code>full_sorting_join</code> by each other before sorting. <a href="https://github.com/ClickHouse/ClickHouse/pull/39418" target="_blank" rel="noopener noreferrer">#39418</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>LZ4 decompression optimised by skipping empty literals processing. <a href="https://github.com/ClickHouse/ClickHouse/pull/40142" target="_blank" rel="noopener noreferrer">#40142</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Speedup backup process using native <code>copy</code> when possible instead of copying through <code>clickhouse-server</code> memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/40395" target="_blank" rel="noopener noreferrer">#40395</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Do not obtain storage snapshot for each INSERT block (slightly improves performance). <a href="https://github.com/ClickHouse/ClickHouse/pull/40638" target="_blank" rel="noopener noreferrer">#40638</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implement batch processing for aggregate functions with multiple nullable arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/41058" target="_blank" rel="noopener noreferrer">#41058</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Speed up reading UniquesHashSet (<code>uniqState</code> from disk for example). <a href="https://github.com/ClickHouse/ClickHouse/pull/41089" target="_blank" rel="noopener noreferrer">#41089</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fixed high memory usage while executing mutations of compact parts in tables with huge number of columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/41122" target="_blank" rel="noopener noreferrer">#41122</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Enable the vectorscan library on ARM, this speeds up regexp evaluation. <a href="https://github.com/ClickHouse/ClickHouse/pull/41033" target="_blank" rel="noopener noreferrer">#41033</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Upgrade vectorscan to 5.4.8 which has many performance optimizations to speed up regexp evaluation. <a href="https://github.com/ClickHouse/ClickHouse/pull/41270" target="_blank" rel="noopener noreferrer">#41270</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Fix incorrect fallback to skip the local filesystem cache for VFS (like S3) which happened on very high concurrency level. <a href="https://github.com/ClickHouse/ClickHouse/pull/40420" target="_blank" rel="noopener noreferrer">#40420</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>If row policy filter is always false, return empty result immediately without reading any data. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24012" target="_blank" rel="noopener noreferrer">#24012</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40740" target="_blank" rel="noopener noreferrer">#40740</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Parallel hash JOIN for Float data types might be suboptimal. Make it better. <a href="https://github.com/ClickHouse/ClickHouse/pull/41183" target="_blank" rel="noopener noreferrer">#41183</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-3">Improvement<a href="#improvement-3" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>During startup and ATTACH call, <code>ReplicatedMergeTree</code> tables will be readonly until the ZooKeeper connection is made and the setup is finished. <a href="https://github.com/ClickHouse/ClickHouse/pull/40148" target="_blank" rel="noopener noreferrer">#40148</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Add <code>enable_extended_results_for_datetime_functions</code> option to return results of type Date32 for functions toStartOfYear, toStartOfISOYear, toStartOfQuarter, toStartOfMonth, toStartOfWeek, toMonday and toLastDayOfMonth when argument is Date32 or DateTime64, otherwise results of Date type are returned. For compatibility reasons default value is ‘0’. <a href="https://github.com/ClickHouse/ClickHouse/pull/41214" target="_blank" rel="noopener noreferrer">#41214</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>For security and stability reasons, CatBoost models are no longer evaluated within the ClickHouse server. Instead, the evaluation is now done in the clickhouse-library-bridge, a separate process that loads the catboost library and communicates with the server process via HTTP. Function <code>modelEvaluate()</code> was replaced by <code>catboostEvaluate()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40897" target="_blank" rel="noopener noreferrer">#40897</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39629" target="_blank" rel="noopener noreferrer">#39629</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Add more metrics for on-disk temporary data, close <a href="https://github.com/ClickHouse/ClickHouse/issues/40206" target="_blank" rel="noopener noreferrer">#40206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40239" target="_blank" rel="noopener noreferrer">#40239</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add config option <code>warning_supress_regexp</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/40330" target="_blank" rel="noopener noreferrer">#40330</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40548" target="_blank" rel="noopener noreferrer">#40548</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add setting to disable limit on kafka_num_consumers. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40331" target="_blank" rel="noopener noreferrer">#40331</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40670" target="_blank" rel="noopener noreferrer">#40670</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Support <code>SETTINGS</code> in <code>DELETE ...</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/41533" target="_blank" rel="noopener noreferrer">#41533</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Detailed S3 profile events <code>DiskS3*</code> per S3 API call split for S3 ObjectStorage. <a href="https://github.com/ClickHouse/ClickHouse/pull/41532" target="_blank" rel="noopener noreferrer">#41532</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Two new metrics in <code>system.asynchronous_metrics</code>. <code>NumberOfDetachedParts</code> and <code>NumberOfDetachedByUserParts</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40779" target="_blank" rel="noopener noreferrer">#40779</a> (<a href="https://github.com/CheSema" target="_blank" rel="noopener noreferrer">Sema Checherinda</a>).</li><li>Allow CONSTRAINTs for ODBC and JDBC tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/34551" target="_blank" rel="noopener noreferrer">#34551</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Don&#x27;t print <code>SETTINGS</code> more than once during query formatting if it didn&#x27;t appear multiple times in the original query. <a href="https://github.com/ClickHouse/ClickHouse/pull/38900" target="_blank" rel="noopener noreferrer">#38900</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improve the tracing (OpenTelemetry) context propagation across threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/39010" target="_blank" rel="noopener noreferrer">#39010</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>ClickHouse Keeper: add listeners for <code>interserver_listen_host</code> only in Keeper if specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/39973" target="_blank" rel="noopener noreferrer">#39973</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Improve recovery of Replicated user access storage after errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/39977" target="_blank" rel="noopener noreferrer">#39977</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add support for TTL in <code>EmbeddedRocksDB</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39986" target="_blank" rel="noopener noreferrer">#39986</a> (<a href="https://github.com/Lloyd-Pottiger" target="_blank" rel="noopener noreferrer">Lloyd-Pottiger</a>).</li><li>Add schema inference to <code>clickhouse-obfuscator</code>, so the <code>--structure</code> argument is no longer required. <a href="https://github.com/ClickHouse/ClickHouse/pull/40120" target="_blank" rel="noopener noreferrer">#40120</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Improve and fix dictionaries in <code>Arrow</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/40173" target="_blank" rel="noopener noreferrer">#40173</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>More natural conversion of <code>Date32</code>, <code>DateTime64</code>, <code>Date</code> to narrower types: upper or lower normal value is considered when out of normal range. <a href="https://github.com/ClickHouse/ClickHouse/pull/40217" target="_blank" rel="noopener noreferrer">#40217</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Fix the case when <code>Merge</code> table over <code>View</code> cannot use index. <a href="https://github.com/ClickHouse/ClickHouse/pull/40233" target="_blank" rel="noopener noreferrer">#40233</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Custom key names for JSON server logs. <a href="https://github.com/ClickHouse/ClickHouse/pull/40251" target="_blank" rel="noopener noreferrer">#40251</a> (<a href="https://github.com/SadiHassan" target="_blank" rel="noopener noreferrer">Mallik Hassan</a>).</li><li>It is now possible to set a custom error code for the exception thrown by function <code>throwIf</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40319" target="_blank" rel="noopener noreferrer">#40319</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Improve schema inference cache, respect format settings that can change the schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/40414" target="_blank" rel="noopener noreferrer">#40414</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow parsing <code>Date</code> as <code>DateTime</code> and <code>DateTime64</code>. This implements the enhancement proposed in <a href="https://github.com/ClickHouse/ClickHouse/issues/36949" target="_blank" rel="noopener noreferrer">#36949</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40474" target="_blank" rel="noopener noreferrer">#40474</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Allow conversion from <code>String</code> with <code>DateTime64</code> like <code>2022-08-22 01:02:03.456</code> to <code>Date</code> and <code>Date32</code>. Allow conversion from String with DateTime like <code>2022-08-22 01:02:03</code> to <code>Date32</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39598" target="_blank" rel="noopener noreferrer">#39598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40475" target="_blank" rel="noopener noreferrer">#40475</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Better support for nested data structures in Parquet format <a href="https://github.com/ClickHouse/ClickHouse/pull/40485" target="_blank" rel="noopener noreferrer">#40485</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Support reading Array(Record) into flatten nested table in Avro. <a href="https://github.com/ClickHouse/ClickHouse/pull/40534" target="_blank" rel="noopener noreferrer">#40534</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add read-only support for <code>EmbeddedRocksDB</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40543" target="_blank" rel="noopener noreferrer">#40543</a> (<a href="https://github.com/Lloyd-Pottiger" target="_blank" rel="noopener noreferrer">Lloyd-Pottiger</a>).</li><li>Validate the compression method parameter of URL table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/40600" target="_blank" rel="noopener noreferrer">#40600</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Better format detection for url table function/engine in presence of a query string after a file name. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40315" target="_blank" rel="noopener noreferrer">#40315</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40636" target="_blank" rel="noopener noreferrer">#40636</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Disable projection when grouping set is used. It generated wrong result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40635" target="_blank" rel="noopener noreferrer">#40635</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40726" target="_blank" rel="noopener noreferrer">#40726</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix incorrect format of <code>APPLY</code> column transformer which can break metadata if used in table definition. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37590" target="_blank" rel="noopener noreferrer">#37590</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40727" target="_blank" rel="noopener noreferrer">#40727</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support the <code>%z</code> descriptor for formatting the timezone offset in <code>formatDateTime</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40736" target="_blank" rel="noopener noreferrer">#40736</a> (<a href="https://github.com/LevyCory" target="_blank" rel="noopener noreferrer">Cory Levy</a>).</li><li>The interactive mode in <code>clickhouse-client</code> now interprets <code>.</code> and <code>/</code> as &quot;run the last command&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/40750" target="_blank" rel="noopener noreferrer">#40750</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Fix issue with passing MySQL timeouts for MySQL database engine and MySQL table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34168" target="_blank" rel="noopener noreferrer">#34168</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40751" target="_blank" rel="noopener noreferrer">#40751</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Create status file for filesystem cache directory to make sure that cache directories are not shared between different servers or caches. <a href="https://github.com/ClickHouse/ClickHouse/pull/40820" target="_blank" rel="noopener noreferrer">#40820</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add support for <code>DELETE</code> and <code>UPDATE</code> for <code>EmbeddedRocksDB</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/40853" target="_blank" rel="noopener noreferrer">#40853</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>ClickHouse Keeper: fix shutdown during long commit and increase allowed request size. <a href="https://github.com/ClickHouse/ClickHouse/pull/40941" target="_blank" rel="noopener noreferrer">#40941</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix race in WriteBufferFromS3, add TSA annotations. <a href="https://github.com/ClickHouse/ClickHouse/pull/40950" target="_blank" rel="noopener noreferrer">#40950</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Grouping sets with group_by_use_nulls should only convert key columns to nullable. <a href="https://github.com/ClickHouse/ClickHouse/pull/40997" target="_blank" rel="noopener noreferrer">#40997</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Improve the observability of INSERT on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/41034" target="_blank" rel="noopener noreferrer">#41034</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>More low-level metrics for S3 interaction. <a href="https://github.com/ClickHouse/ClickHouse/pull/41039" target="_blank" rel="noopener noreferrer">#41039</a> (<a href="https://github.com/mateng0915" target="_blank" rel="noopener noreferrer">mateng915</a>).</li><li>Support relative path in Location header after HTTP redirect. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40985" target="_blank" rel="noopener noreferrer">#40985</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41162" target="_blank" rel="noopener noreferrer">#41162</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Apply changes to HTTP handlers on fly without server restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/41177" target="_blank" rel="noopener noreferrer">#41177</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>ClickHouse Keeper: properly close active sessions during shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/41215" target="_blank" rel="noopener noreferrer">#41215</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>). This lowers the period of &quot;table is read-only&quot; errors.</li><li>Add ability to automatically comment SQL queries in clickhouse-client/local (with <code>Alt-#</code>, like in readline). <a href="https://github.com/ClickHouse/ClickHouse/pull/41224" target="_blank" rel="noopener noreferrer">#41224</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incompatibility of cache after switching setting <code>do_no_evict_index_and_mark_files</code> from 1 to 0, 0 to 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/41330" target="_blank" rel="noopener noreferrer">#41330</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add a setting <code>allow_suspicious_fixed_string_types</code> to prevent users from creating columns of type FixedString with size &gt; 256. <a href="https://github.com/ClickHouse/ClickHouse/pull/41495" target="_blank" rel="noopener noreferrer">#41495</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Add <code>has_lightweight_delete</code> to system.parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/41564" target="_blank" rel="noopener noreferrer">#41564</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-3">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-3" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Enforce documentation for every setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/40644" target="_blank" rel="noopener noreferrer">#40644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Enforce documentation for every current metric. <a href="https://github.com/ClickHouse/ClickHouse/pull/40645" target="_blank" rel="noopener noreferrer">#40645</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Enforce documentation for every profile event counter. Write the documentation where it was missing. <a href="https://github.com/ClickHouse/ClickHouse/pull/40646" target="_blank" rel="noopener noreferrer">#40646</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Allow minimal <code>clickhouse-local</code> build by correcting some dependencies. <a href="https://github.com/ClickHouse/ClickHouse/pull/40460" target="_blank" rel="noopener noreferrer">#40460</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>). It is less than 50 MiB.</li><li>Calculate and report SQL function coverage in tests. <a href="https://github.com/ClickHouse/ClickHouse/issues/40593" target="_blank" rel="noopener noreferrer">#40593</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40647" target="_blank" rel="noopener noreferrer">#40647</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Enforce documentation for every MergeTree setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/40648" target="_blank" rel="noopener noreferrer">#40648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>A prototype of embedded reference documentation for high-level uniform server components. <a href="https://github.com/ClickHouse/ClickHouse/pull/40649" target="_blank" rel="noopener noreferrer">#40649</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>We will check all queries from the changed perf tests to ensure that all changed queries were tested. <a href="https://github.com/ClickHouse/ClickHouse/pull/40322" target="_blank" rel="noopener noreferrer">#40322</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix TGZ packages. <a href="https://github.com/ClickHouse/ClickHouse/pull/40681" target="_blank" rel="noopener noreferrer">#40681</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Fix debug symbols. <a href="https://github.com/ClickHouse/ClickHouse/pull/40873" target="_blank" rel="noopener noreferrer">#40873</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Extended the CI configuration to create a x86 SSE2-only build. Useful for old or embedded hardware. <a href="https://github.com/ClickHouse/ClickHouse/pull/40999" target="_blank" rel="noopener noreferrer">#40999</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Switch to llvm/clang 15. <a href="https://github.com/ClickHouse/ClickHouse/pull/41046" target="_blank" rel="noopener noreferrer">#41046</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/40938" target="_blank" rel="noopener noreferrer">#40938</a>. Fix ODR violation for <code>Loggers</code> class. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40398" target="_blank" rel="noopener noreferrer">#40398</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/40937" target="_blank" rel="noopener noreferrer">#40937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41060" target="_blank" rel="noopener noreferrer">#41060</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add macOS binaries to GitHub release assets, it fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37718" target="_blank" rel="noopener noreferrer">#37718</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41088" target="_blank" rel="noopener noreferrer">#41088</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>The c-ares library is now bundled with ClickHouse&#x27;s build system. <a href="https://github.com/ClickHouse/ClickHouse/pull/41239" target="_blank" rel="noopener noreferrer">#41239</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Get rid of <code>dlopen</code> from the main ClickHouse code. It remains in the library-bridge and odbc-bridge. <a href="https://github.com/ClickHouse/ClickHouse/pull/41428" target="_blank" rel="noopener noreferrer">#41428</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Don&#x27;t allow <code>dlopen</code> in the main ClickHouse binary, because it is harmful and insecure. We don&#x27;t use it. But it can be used by some libraries for the implementation of &quot;plugins&quot;. We absolutely discourage the ancient technique of loading 3rd-party uncontrolled dangerous libraries into the process address space, because it is insane. <a href="https://github.com/ClickHouse/ClickHouse/pull/41429" target="_blank" rel="noopener noreferrer">#41429</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add <code>source</code> field to deb packages, update <code>nfpm</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41531" target="_blank" rel="noopener noreferrer">#41531</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Support for DWARF-5 in the in-house DWARF parser. <a href="https://github.com/ClickHouse/ClickHouse/pull/40710" target="_blank" rel="noopener noreferrer">#40710</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add fault injection in ZooKeeper client for testing <a href="https://github.com/ClickHouse/ClickHouse/pull/30498" target="_blank" rel="noopener noreferrer">#30498</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Add stateless tests with s3 storage with debug and tsan <a href="https://github.com/ClickHouse/ClickHouse/pull/35262" target="_blank" rel="noopener noreferrer">#35262</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Trying stress on top of S3 <a href="https://github.com/ClickHouse/ClickHouse/pull/36837" target="_blank" rel="noopener noreferrer">#36837</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Enable <code>concurrency-mt-unsafe</code> in <code>clang-tidy</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/40224" target="_blank" rel="noopener noreferrer">#40224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix">Bug Fix<a href="#bug-fix" class="hash-link" aria-label="Direct link to Bug Fix" title="Direct link to Bug Fix">​</a></h4><ul><li>Fix potential dataloss due to <a href="https://github.com/aws/aws-sdk-cpp/issues/658" target="_blank" rel="noopener noreferrer">a bug in AWS SDK</a>. Bug can be triggered only when clickhouse is used over S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/40506" target="_blank" rel="noopener noreferrer">#40506</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). This bug has been open for 5 years in AWS SDK and is closed after our report.</li><li>Malicious data in Native format might cause a crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/41441" target="_blank" rel="noopener noreferrer">#41441</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>The aggregate function <code>categorialInformationValue</code> was having incorrectly defined properties, which might cause a null pointer dereferencing at runtime. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41443" target="_blank" rel="noopener noreferrer">#41443</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41449" target="_blank" rel="noopener noreferrer">#41449</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Writing data in Apache <code>ORC</code> format might lead to a buffer overrun. <a href="https://github.com/ClickHouse/ClickHouse/pull/41458" target="_blank" rel="noopener noreferrer">#41458</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix memory safety issues with functions <code>encrypt</code> and <code>contingency</code> if Array of Nullable is used as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41004" target="_blank" rel="noopener noreferrer">#41004</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40195" target="_blank" rel="noopener noreferrer">#40195</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix bugs in MergeJoin when &#x27;not_processed&#x27; is not null. <a href="https://github.com/ClickHouse/ClickHouse/pull/40335" target="_blank" rel="noopener noreferrer">#40335</a> (<a href="https://github.com/liql2007" target="_blank" rel="noopener noreferrer">liql2007</a>).</li><li>Fix incorrect result in case of decimal precision loss in IN operator, ref <a href="https://github.com/ClickHouse/ClickHouse/issues/41125" target="_blank" rel="noopener noreferrer">#41125</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41130" target="_blank" rel="noopener noreferrer">#41130</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix filling of missed <code>Nested</code> columns with multiple levels. <a href="https://github.com/ClickHouse/ClickHouse/pull/37152" target="_blank" rel="noopener noreferrer">#37152</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix SYSTEM UNFREEZE query for Ordinary (deprecated) database. Fix for <a href="https://github.com/ClickHouse/ClickHouse/pull/36424" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/36424</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38262" target="_blank" rel="noopener noreferrer">#38262</a> (<a href="https://github.com/PolyProgrammist" target="_blank" rel="noopener noreferrer">Vadim Volodin</a>).</li><li>Fix unused unknown columns introduced by WITH statement. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37812" target="_blank" rel="noopener noreferrer">#37812</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/39131" target="_blank" rel="noopener noreferrer">#39131</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix query analysis for ORDER BY in presence of window functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38741" target="_blank" rel="noopener noreferrer">#38741</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24892" target="_blank" rel="noopener noreferrer">#24892</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39354" target="_blank" rel="noopener noreferrer">#39354</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fixed <code>Unknown identifier (aggregate-function)</code> exception which appears when a user tries to calculate WINDOW ORDER BY/PARTITION BY expressions over aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/39762" target="_blank" rel="noopener noreferrer">#39762</a> (<a href="https://github.com/quickhouse" target="_blank" rel="noopener noreferrer">Vladimir Chebotaryov</a>).</li><li>Limit number of analyze for one query with setting <code>max_analyze_depth</code>. It prevents exponential blow up of analysis time for queries with extraordinarily large number of subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/40334" target="_blank" rel="noopener noreferrer">#40334</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix rare bug with column TTL for MergeTree engines family: In case of repeated vertical merge the error <code>Cannot unlink file ColumnName.bin ... No such file or directory.</code> could happen. <a href="https://github.com/ClickHouse/ClickHouse/pull/40346" target="_blank" rel="noopener noreferrer">#40346</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Use DNS entries for both IPv4 and IPv6 if present. <a href="https://github.com/ClickHouse/ClickHouse/pull/40353" target="_blank" rel="noopener noreferrer">#40353</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow to read snappy compressed files from Hadoop. <a href="https://github.com/ClickHouse/ClickHouse/pull/40482" target="_blank" rel="noopener noreferrer">#40482</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix crash while parsing values of type <code>Object</code> (experimental feature) that contains arrays of variadic dimension. <a href="https://github.com/ClickHouse/ClickHouse/pull/40483" target="_blank" rel="noopener noreferrer">#40483</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fix settings <code>input_format_tsv_skip_first_lines</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40491" target="_blank" rel="noopener noreferrer">#40491</a> (<a href="https://github.com/mini4" target="_blank" rel="noopener noreferrer">mini4</a>).</li><li>Fix bug (race condition) when starting up MaterializedPostgreSQL database/table engine. <a href="https://github.com/ClickHouse/ClickHouse/issues/40262" target="_blank" rel="noopener noreferrer">#40262</a>. Fix error with reaching limit of relcache_callback_list slots. <a href="https://github.com/ClickHouse/ClickHouse/pull/40511" target="_blank" rel="noopener noreferrer">#40511</a> (<a href="https://github.com/maks-buren630501" target="_blank" rel="noopener noreferrer">Maksim Buren</a>).</li><li>Fix possible error &#x27;Decimal math overflow&#x27; while parsing DateTime64. <a href="https://github.com/ClickHouse/ClickHouse/pull/40546" target="_blank" rel="noopener noreferrer">#40546</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix vertical merge of parts with lightweight deleted rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/40559" target="_blank" rel="noopener noreferrer">#40559</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Fix segment fault when writing data to URL table engine if it enables compression. <a href="https://github.com/ClickHouse/ClickHouse/pull/40565" target="_blank" rel="noopener noreferrer">#40565</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix possible logical error <code>&#x27;Invalid Field get from type UInt64 to type String&#x27;</code> in arrayElement function with Map. <a href="https://github.com/ClickHouse/ClickHouse/pull/40572" target="_blank" rel="noopener noreferrer">#40572</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible race in filesystem cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/40586" target="_blank" rel="noopener noreferrer">#40586</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Removed skipping of mutations in unaffected partitions of <code>MergeTree</code> tables, because this feature never worked correctly and might cause resurrection of finished mutations. <a href="https://github.com/ClickHouse/ClickHouse/pull/40589" target="_blank" rel="noopener noreferrer">#40589</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>The clickhouse server will crash if we add a grpc port which has been occupied to the configuration in runtime. <a href="https://github.com/ClickHouse/ClickHouse/pull/40597" target="_blank" rel="noopener noreferrer">#40597</a> (<a href="https://github.com/helifu" target="_blank" rel="noopener noreferrer">何李夫</a>).</li><li>Fix <code>base58Encode / base58Decode</code> handling leading 0 / &#x27;1&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/40620" target="_blank" rel="noopener noreferrer">#40620</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>keeper-fix: fix race in accessing logs while snapshot is being installed. <a href="https://github.com/ClickHouse/ClickHouse/pull/40627" target="_blank" rel="noopener noreferrer">#40627</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix short circuit execution of toFixedString function. Solves (partially) <a href="https://github.com/ClickHouse/ClickHouse/issues/40622" target="_blank" rel="noopener noreferrer">#40622</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40628" target="_blank" rel="noopener noreferrer">#40628</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixes SQLite int8 column conversion to int64 column in ClickHouse. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40639" target="_blank" rel="noopener noreferrer">#40639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40642" target="_blank" rel="noopener noreferrer">#40642</a> (<a href="https://github.com/barumrho" target="_blank" rel="noopener noreferrer">Barum Rho</a>).</li><li>Fix stack overflow in recursive <code>Buffer</code> tables. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40637" target="_blank" rel="noopener noreferrer">#40637</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40643" target="_blank" rel="noopener noreferrer">#40643</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>During insertion of a new query to the <code>ProcessList</code> allocations happen. If we reach the memory limit during these allocations we can not use <code>OvercommitTracker</code>, because <code>ProcessList::mutex</code> is already acquired. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40611" target="_blank" rel="noopener noreferrer">#40611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40677" target="_blank" rel="noopener noreferrer">#40677</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix LOGICAL_ERROR with max_read_buffer_size=0 during reading marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/40705" target="_blank" rel="noopener noreferrer">#40705</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory leak while pushing to MVs w/o query context (from Kafka/...). <a href="https://github.com/ClickHouse/ClickHouse/pull/40732" target="_blank" rel="noopener noreferrer">#40732</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible error Attempt to read after eof in CSV schema inference. <a href="https://github.com/ClickHouse/ClickHouse/pull/40746" target="_blank" rel="noopener noreferrer">#40746</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix logical error in write-through cache &quot;File segment completion can be done only by downloader&quot;. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40748" target="_blank" rel="noopener noreferrer">#40748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40759" target="_blank" rel="noopener noreferrer">#40759</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Make the result of GROUPING function the same as in SQL and other DBMS. <a href="https://github.com/ClickHouse/ClickHouse/pull/40762" target="_blank" rel="noopener noreferrer">#40762</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>In <a href="https://github.com/ClickHouse/ClickHouse/issues/40595" target="_blank" rel="noopener noreferrer">#40595</a> it was reported that the <code>host_regexp</code> functionality was not working properly with a name to address resolution in <code>/etc/hosts</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/40769" target="_blank" rel="noopener noreferrer">#40769</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Fix incremental backups for Log family. <a href="https://github.com/ClickHouse/ClickHouse/pull/40827" target="_blank" rel="noopener noreferrer">#40827</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix extremely rare bug which can lead to potential data loss in zero-copy replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/40844" target="_blank" rel="noopener noreferrer">#40844</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix key condition analyzing crashes when same set expression built from different column(s). <a href="https://github.com/ClickHouse/ClickHouse/pull/40850" target="_blank" rel="noopener noreferrer">#40850</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fix nested JSON Objects schema inference. <a href="https://github.com/ClickHouse/ClickHouse/pull/40851" target="_blank" rel="noopener noreferrer">#40851</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix 3-digit prefix directory for filesystem cache files not being deleted if empty. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40797" target="_blank" rel="noopener noreferrer">#40797</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40867" target="_blank" rel="noopener noreferrer">#40867</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix uncaught DNS_ERROR on failed connection to replicas. <a href="https://github.com/ClickHouse/ClickHouse/pull/40881" target="_blank" rel="noopener noreferrer">#40881</a> (<a href="https://github.com/coelho" target="_blank" rel="noopener noreferrer">Robert Coelho</a>).</li><li>Fix bug when removing unneeded columns in subquery. <a href="https://github.com/ClickHouse/ClickHouse/pull/40884" target="_blank" rel="noopener noreferrer">#40884</a> (<a href="https://github.com/TKaxe" target="_blank" rel="noopener noreferrer">luocongkai</a>).</li><li>Fix extra memory allocation for remote read buffers. <a href="https://github.com/ClickHouse/ClickHouse/pull/40896" target="_blank" rel="noopener noreferrer">#40896</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed a behaviour when user with explicitly revoked grant for dropping databases can still drop it. <a href="https://github.com/ClickHouse/ClickHouse/pull/40906" target="_blank" rel="noopener noreferrer">#40906</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>A fix for ClickHouse Keeper: correctly compare paths in write requests to Keeper internal system node paths. <a href="https://github.com/ClickHouse/ClickHouse/pull/40918" target="_blank" rel="noopener noreferrer">#40918</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix deadlock in WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/40943" target="_blank" rel="noopener noreferrer">#40943</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix access rights for <code>DESCRIBE TABLE url()</code> and some other <code>DESCRIBE TABLE &lt;table_function&gt;()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40975" target="_blank" rel="noopener noreferrer">#40975</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Remove wrong parser logic for <code>WITH GROUPING SETS</code> which may lead to nullptr dereference. <a href="https://github.com/ClickHouse/ClickHouse/pull/41049" target="_blank" rel="noopener noreferrer">#41049</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>A fix for ClickHouse Keeper: fix possible segfault during Keeper shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/41075" target="_blank" rel="noopener noreferrer">#41075</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix possible segfaults, use-heap-after-free and memory leak in aggregate function combinators. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40848" target="_blank" rel="noopener noreferrer">#40848</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41083" target="_blank" rel="noopener noreferrer">#41083</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix query_views_log with Window views. <a href="https://github.com/ClickHouse/ClickHouse/pull/41132" target="_blank" rel="noopener noreferrer">#41132</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Disables optimize_monotonous_functions_in_order_by by default, mitigates: <a href="https://github.com/ClickHouse/ClickHouse/issues/40094" target="_blank" rel="noopener noreferrer">#40094</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41136" target="_blank" rel="noopener noreferrer">#41136</a> (<a href="https://github.com/den-crane" target="_blank" rel="noopener noreferrer">Denny Crane</a>).</li><li>Fixed &quot;possible deadlock avoided&quot; error on automatic conversion of database engine from Ordinary to Atomic. <a href="https://github.com/ClickHouse/ClickHouse/pull/41146" target="_blank" rel="noopener noreferrer">#41146</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix SIGSEGV in SortedBlocksWriter in case of empty block (possible to get with <code>optimize_aggregation_in_order</code> and <code>join_algorithm=auto</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/41154" target="_blank" rel="noopener noreferrer">#41154</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect query result when trivial count optimization is in effect with array join. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39431" target="_blank" rel="noopener noreferrer">#39431</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41158" target="_blank" rel="noopener noreferrer">#41158</a> (<a href="https://github.com/den-crane" target="_blank" rel="noopener noreferrer">Denny Crane</a>).</li><li>Fix stack-use-after-return in GetPriorityForLoadBalancing::getPriorityFunc(). <a href="https://github.com/ClickHouse/ClickHouse/pull/41159" target="_blank" rel="noopener noreferrer">#41159</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix positional arguments exception Positional argument out of bounds. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/40634" target="_blank" rel="noopener noreferrer">#40634</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41189" target="_blank" rel="noopener noreferrer">#41189</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix background clean up of broken detached parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/41190" target="_blank" rel="noopener noreferrer">#41190</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix exponential query rewrite in case of lots of cross joins with where, close <a href="https://github.com/ClickHouse/ClickHouse/issues/21557" target="_blank" rel="noopener noreferrer">#21557</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41223" target="_blank" rel="noopener noreferrer">#41223</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible logical error in write-through cache, which happened because not all types of exception were handled as needed. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/41208" target="_blank" rel="noopener noreferrer">#41208</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41232" target="_blank" rel="noopener noreferrer">#41232</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix String log entry in system.filesystem_cache_log. <a href="https://github.com/ClickHouse/ClickHouse/pull/41233" target="_blank" rel="noopener noreferrer">#41233</a> (<a href="https://github.com/josemimbrero-tinybird" target="_blank" rel="noopener noreferrer">jmimbrero</a>).</li><li>Queries with <code>OFFSET</code> clause in subquery and <code>WHERE</code> clause in outer query might return incorrect result, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40416" target="_blank" rel="noopener noreferrer">#40416</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41280" target="_blank" rel="noopener noreferrer">#41280</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix possible wrong query result with <code>query_plan_optimize_primary_key</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/40599" target="_blank" rel="noopener noreferrer">#40599</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41281" target="_blank" rel="noopener noreferrer">#41281</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Do not allow invalid sequences influence other rows in lowerUTF8/upperUTF8. <a href="https://github.com/ClickHouse/ClickHouse/pull/41286" target="_blank" rel="noopener noreferrer">#41286</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>ALTER &lt;table&gt; ADD COLUMN</code> queries with columns of type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41290" target="_blank" rel="noopener noreferrer">#41290</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed &quot;No node&quot; error when selecting from <code>system.distributed_ddl_queue</code> when there&#x27;s no <code>distributed_ddl.path</code> in config. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41096" target="_blank" rel="noopener noreferrer">#41096</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41296" target="_blank" rel="noopener noreferrer">#41296</a> (<a href="https://github.com/young-scott" target="_blank" rel="noopener noreferrer">young scott</a>).</li><li>Fix incorrect logical error <code>Expected relative path</code> in disk object storage. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/41246" target="_blank" rel="noopener noreferrer">#41246</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41297" target="_blank" rel="noopener noreferrer">#41297</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add column type check before UUID insertion in MsgPack format. <a href="https://github.com/ClickHouse/ClickHouse/pull/41309" target="_blank" rel="noopener noreferrer">#41309</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible crash after inserting asynchronously (with enabled setting <code>async_insert</code>) malformed data to columns of type <code>Object</code>. It could happen, if JSONs in all batches of async inserts were invalid and could not be parsed. <a href="https://github.com/ClickHouse/ClickHouse/pull/41336" target="_blank" rel="noopener noreferrer">#41336</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible deadlock with async_socket_for_remote/use_hedged_requests and parallel KILL. <a href="https://github.com/ClickHouse/ClickHouse/pull/41343" target="_blank" rel="noopener noreferrer">#41343</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disables optimize_rewrite_sum_if_to_count_if by default, mitigates: <a href="https://github.com/ClickHouse/ClickHouse/issues/38605" target="_blank" rel="noopener noreferrer">#38605</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/38683" target="_blank" rel="noopener noreferrer">#38683</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41388" target="_blank" rel="noopener noreferrer">#41388</a> (<a href="https://github.com/den-crane" target="_blank" rel="noopener noreferrer">Denny Crane</a>).</li><li>Since 22.8 <code>ON CLUSTER</code> clause is ignored if database is <code>Replicated</code> and cluster name and database name are the same. Because of this <code>DROP PARTITION ON CLUSTER</code> worked unexpected way with <code>Replicated</code>. It&#x27;s fixed, now <code>ON CLUSTER</code> clause is ignored only for queries that are replicated on database level. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41299" target="_blank" rel="noopener noreferrer">#41299</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41390" target="_blank" rel="noopener noreferrer">#41390</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix possible hung/deadlock on query cancellation (<code>KILL QUERY</code> or server shutdown). <a href="https://github.com/ClickHouse/ClickHouse/pull/41467" target="_blank" rel="noopener noreferrer">#41467</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible server crash when using the JBOD feature. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41365" target="_blank" rel="noopener noreferrer">#41365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41483" target="_blank" rel="noopener noreferrer">#41483</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix conversion from nullable fixed string to string. <a href="https://github.com/ClickHouse/ClickHouse/pull/41541" target="_blank" rel="noopener noreferrer">#41541</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Prevent crash when passing wrong aggregation states to groupBitmap*. <a href="https://github.com/ClickHouse/ClickHouse/pull/41563" target="_blank" rel="noopener noreferrer">#41563</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Queries with <code>ORDER BY</code> and <code>1500 &lt;= LIMIT &lt;= max_block_size</code> could return incorrect result with missing rows from top. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41182" target="_blank" rel="noopener noreferrer">#41182</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41576" target="_blank" rel="noopener noreferrer">#41576</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix read bytes/rows in X-ClickHouse-Summary with materialized views. <a href="https://github.com/ClickHouse/ClickHouse/pull/41586" target="_blank" rel="noopener noreferrer">#41586</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix possible <code>pipeline stuck</code> exception for queries with <code>OFFSET</code>. The error was found with <code>enable_optimize_predicate_expression = 0</code> and always false condition in <code>WHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/41383" target="_blank" rel="noopener noreferrer">#41383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/41588" target="_blank" rel="noopener noreferrer">#41588</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-228-2022-08-18"><a id="228"></a> ClickHouse release 22.8, 2022-08-18<a href="#-clickhouse-release-228-2022-08-18" class="hash-link" aria-label="Direct link to -clickhouse-release-228-2022-08-18" title="Direct link to -clickhouse-release-228-2022-08-18">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-3">Backward Incompatible Change<a href="#backward-incompatible-change-3" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Extended range of <code>Date32</code> and <code>DateTime64</code> to support dates from the year 1900 to 2299. In previous versions, the supported interval was only from the year 1925 to 2283. The implementation is using the proleptic Gregorian calendar (which is conformant with <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">ISO 8601</a>:2004 (clause 3.2.1 The Gregorian calendar)) instead of accounting for historical transitions from the Julian to the Gregorian calendar. This change affects implementation-specific behavior for out-of-range arguments. E.g. if in previous versions the value of <code>1899-01-01</code> was clamped to <code>1925-01-01</code>, in the new version it will be clamped to <code>1900-01-01</code>. It changes the behavior of rounding with <code>toStartOfInterval</code> if you pass <code>INTERVAL 3 QUARTER</code> up to one quarter because the intervals are counted from an implementation-specific point of time. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28216" target="_blank" rel="noopener noreferrer">#28216</a>, improves <a href="https://github.com/ClickHouse/ClickHouse/issues/38393" target="_blank" rel="noopener noreferrer">#38393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39425" target="_blank" rel="noopener noreferrer">#39425</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Now, all relevant dictionary sources respect <code>remote_url_allow_hosts</code> setting. It was already done for HTTP, Cassandra, Redis. Added ClickHouse, MongoDB, MySQL, PostgreSQL. Host is checked only for dictionaries created from DDL. <a href="https://github.com/ClickHouse/ClickHouse/pull/39184" target="_blank" rel="noopener noreferrer">#39184</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Prebuilt ClickHouse x86 binaries now require support for AVX instructions, i.e. a CPU not older than Intel Sandy Bridge / AMD Bulldozer, both released in 2011. <a href="https://github.com/ClickHouse/ClickHouse/pull/39000" target="_blank" rel="noopener noreferrer">#39000</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Make the remote filesystem cache composable, allow not to evict certain files (regarding idx, mrk, ..), delete old cache version. Now it is possible to configure cache over Azure blob storage disk, over Local disk, over StaticWeb disk, etc. This PR is marked backward incompatible because cache configuration changes and in order for cache to work need to update the config file. Old cache will still be used with new configuration. The server will startup fine with the old cache configuration. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36140" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/36140</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37889" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/37889</a>. (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/36171" target="_blank" rel="noopener noreferrer">#36171</a>)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-4">New Feature<a href="#new-feature-4" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Support SQL standard DELETE FROM syntax on merge tree tables and lightweight delete implementation for merge tree families. <a href="https://github.com/ClickHouse/ClickHouse/pull/37893" target="_blank" rel="noopener noreferrer">#37893</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>) (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>). Note: this new feature does not make ClickHouse an HTAP DBMS.</li><li>Query parameters can be set in interactive mode as <code>SET param_abc = &#x27;def&#x27;</code> and transferred via the native protocol as settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/39906" target="_blank" rel="noopener noreferrer">#39906</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Quota key can be set in the native protocol (<a href="https://github.com/ClickHouse/ClickHouse/pull/39874" target="_blank" rel="noopener noreferrer">Yakov Olkhovsky</a>).</li><li>Added a setting <code>exact_rows_before_limit</code> (0/1). When enabled, ClickHouse will provide exact value for <code>rows_before_limit_at_least</code> statistic, but with the cost that the data before limit will have to be read completely. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6613" target="_blank" rel="noopener noreferrer">#6613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25333" target="_blank" rel="noopener noreferrer">#25333</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Added support for parallel distributed insert select with <code>s3Cluster</code> table function into tables with <code>Distributed</code> and <code>Replicated</code> engine <a href="https://github.com/ClickHouse/ClickHouse/issues/34670" target="_blank" rel="noopener noreferrer">#34670</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39107" target="_blank" rel="noopener noreferrer">#39107</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add new settings to control schema inference from text formats: - <code>input_format_try_infer_dates</code> - try infer dates from strings. - <code>input_format_try_infer_datetimes</code> - try infer datetimes from strings. - <code>input_format_try_infer_integers</code> - try infer <code>Int64</code> instead of <code>Float64</code>. - <code>input_format_json_try_infer_numbers_from_strings</code> - try infer numbers from json strings in JSON formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/39186" target="_blank" rel="noopener noreferrer">#39186</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>An option to provide JSON formatted log output. The purpose is to allow easier ingestion and query in log analysis tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/39277" target="_blank" rel="noopener noreferrer">#39277</a> (<a href="https://github.com/SadiHassan" target="_blank" rel="noopener noreferrer">Mallik Hassan</a>).</li><li>Add function <code>nowInBlock</code> which allows getting the current time during long-running and continuous queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39522" target="_blank" rel="noopener noreferrer">#39522</a>. Notes: there are no functions <code>now64InBlock</code> neither <code>todayInBlock</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39533" target="_blank" rel="noopener noreferrer">#39533</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add ability to specify settings for an <code>executable()</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/39681" target="_blank" rel="noopener noreferrer">#39681</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li>Implemented automatic conversion of database engine from <code>Ordinary</code> to <code>Atomic</code>. Create empty <code>convert_ordinary_to_atomic</code> file in <code>flags</code> directory and all <code>Ordinary</code> databases will be converted automatically on next server start. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/39546" target="_blank" rel="noopener noreferrer">#39546</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39933" target="_blank" rel="noopener noreferrer">#39933</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Support <code>SELECT ... INTO OUTFILE &#x27;...&#x27; AND STDOUT</code>. <a href="https://github.com/ClickHouse/ClickHouse/issues/37490" target="_blank" rel="noopener noreferrer">#37490</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39054" target="_blank" rel="noopener noreferrer">#39054</a> (<a href="https://github.com/SmitaRKulkarni" target="_blank" rel="noopener noreferrer">SmitaRKulkarni</a>).</li><li>Add formats <code>PrettyMonoBlock</code>, <code>PrettyNoEscapesMonoBlock</code>, <code>PrettyCompactNoEscapes</code>, <code>PrettyCompactNoEscapesMonoBlock</code>, <code>PrettySpaceNoEscapes</code>, <code>PrettySpaceMonoBlock</code>, <code>PrettySpaceNoEscapesMonoBlock</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39646" target="_blank" rel="noopener noreferrer">#39646</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-4">Performance Improvement<a href="#performance-improvement-4" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Improved memory usage during memory efficient merging of aggregation results. <a href="https://github.com/ClickHouse/ClickHouse/pull/39429" target="_blank" rel="noopener noreferrer">#39429</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Added concurrency control logic to limit total number of concurrent threads created by queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/37558" target="_blank" rel="noopener noreferrer">#37558</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>). Add <code>concurrent_threads_soft_limit parameter</code> to increase performance in case of high QPS by means of limiting total number of threads for all queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/37285" target="_blank" rel="noopener noreferrer">#37285</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li>Add <code>SLRU</code> cache policy for uncompressed cache and marks cache. (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/34651" target="_blank" rel="noopener noreferrer">#34651</a> (<a href="https://github.com/alexX512" target="_blank" rel="noopener noreferrer">alexX512</a>). Decoupling local cache function and cache algorithm <a href="https://github.com/ClickHouse/ClickHouse/pull/38048" target="_blank" rel="noopener noreferrer">#38048</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Intel® In-Memory Analytics Accelerator (Intel® IAA) is a hardware accelerator available in the upcoming generation of Intel® Xeon® Scalable processors (&quot;Sapphire Rapids&quot;). Its goal is to speed up common operations in analytics like data (de)compression and filtering. ClickHouse gained the new &quot;DeflateQpl&quot; compression codec which utilizes the Intel® IAA offloading technology to provide a high-performance DEFLATE implementation. The codec uses the <a href="https://github.com/intel/qpl" target="_blank" rel="noopener noreferrer">Intel® Query Processing Library (QPL)</a> which abstracts access to the hardware accelerator, respectively to a software fallback in case the hardware accelerator is not available. DEFLATE provides in general higher compression rates than ClickHouse&#x27;s LZ4 default codec, and as a result, offers less disk I/O and lower main memory consumption. <a href="https://github.com/ClickHouse/ClickHouse/pull/36654" target="_blank" rel="noopener noreferrer">#36654</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39494" target="_blank" rel="noopener noreferrer">#39494</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li><code>DISTINCT</code> in order with <code>ORDER BY</code>: Deduce way to sort based on input stream sort description. Skip sorting if input stream is already sorted. <a href="https://github.com/ClickHouse/ClickHouse/pull/38719" target="_blank" rel="noopener noreferrer">#38719</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>). Improve memory usage (significantly) and query execution time + use <code>DistinctSortedChunkTransform</code> for final distinct when <code>DISTINCT</code> columns match <code>ORDER BY</code> columns, but rename to <code>DistinctSortedStreamTransform</code> in <code>EXPLAIN PIPELINE</code> → this improves memory usage significantly + remove unnecessary allocations in hot loop in <code>DistinctSortedChunkTransform</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39432" target="_blank" rel="noopener noreferrer">#39432</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>). Use <code>DistinctSortedTransform</code> only when sort description is applicable to DISTINCT columns, otherwise fall back to ordinary DISTINCT implementation + it allows making less checks during <code>DistinctSortedTransform</code> execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/39528" target="_blank" rel="noopener noreferrer">#39528</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>). Fix: <code>DistinctSortedTransform</code> didn&#x27;t take advantage of sorting. It never cleared HashSet since clearing_columns were detected incorrectly (always empty). So, it basically worked as ordinary <code>DISTINCT</code> (<code>DistinctTransform</code>). The fix reduces memory usage significantly. <a href="https://github.com/ClickHouse/ClickHouse/pull/39538" target="_blank" rel="noopener noreferrer">#39538</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Use local node as first priority to get structure of remote table when executing <code>cluster</code> and similar table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/39440" target="_blank" rel="noopener noreferrer">#39440</a> (<a href="https://github.com/liangliangpan" target="_blank" rel="noopener noreferrer">Mingliang Pan</a>).</li><li>Optimize filtering by numeric columns with AVX512VBMI2 compress store. <a href="https://github.com/ClickHouse/ClickHouse/pull/39633" target="_blank" rel="noopener noreferrer">#39633</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>). For systems with AVX512 VBMI2, this PR improves performance by ca. 6% for SSB benchmark queries queries 3.1, 3.2 and 3.3 (SF=100). Tested on Intel Icelake Xeon 8380 * 2 socket. <a href="https://github.com/ClickHouse/ClickHouse/pull/40033" target="_blank" rel="noopener noreferrer">#40033</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Optimize index analysis with functional expressions in multi-thread scenario. <a href="https://github.com/ClickHouse/ClickHouse/pull/39812" target="_blank" rel="noopener noreferrer">#39812</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>).</li><li>Optimizations for complex queries: Don&#x27;t visit the AST for UDFs if none are registered. <a href="https://github.com/ClickHouse/ClickHouse/pull/40069" target="_blank" rel="noopener noreferrer">#40069</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>). Optimize CurrentMemoryTracker alloc and free. <a href="https://github.com/ClickHouse/ClickHouse/pull/40078" target="_blank" rel="noopener noreferrer">#40078</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improved Base58 encoding/decoding. <a href="https://github.com/ClickHouse/ClickHouse/pull/39292" target="_blank" rel="noopener noreferrer">#39292</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Improve bytes to bits mask transform for SSE/AVX/AVX512. <a href="https://github.com/ClickHouse/ClickHouse/pull/39586" target="_blank" rel="noopener noreferrer">#39586</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-4">Improvement<a href="#improvement-4" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Normalize <code>AggregateFunction</code> types and state representations because optimizations like <a href="https://github.com/ClickHouse/ClickHouse/pull/35788" target="_blank" rel="noopener noreferrer">#35788</a> will treat <code>count(not null columns)</code> as <code>count()</code>, which might confuses distributed interpreters with the following error : <code>Conversion from AggregateFunction(count) to AggregateFunction(count, Int64) is not supported</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39420" target="_blank" rel="noopener noreferrer">#39420</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>). The functions with identical states can be used in materialized views interchangeably.</li><li>Rework and simplify the <code>system.backups</code> table, remove the <code>internal</code> column, allow user to set the ID of operation, add columns <code>num_files</code>, <code>uncompressed_size</code>, <code>compressed_size</code>, <code>start_time</code>, <code>end_time</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39503" target="_blank" rel="noopener noreferrer">#39503</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Improved structure of DDL query result table for <code>Replicated</code> database (separate columns with shard and replica name, more clear status) - <code>CREATE TABLE ... ON CLUSTER</code> queries can be normalized on initiator first if <code>distributed_ddl_entry_format_version</code> is set to 3 (default value). It means that <code>ON CLUSTER</code> queries may not work if initiator does not belong to the cluster that specified in query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37318" target="_blank" rel="noopener noreferrer">#37318</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/39500" target="_blank" rel="noopener noreferrer">#39500</a> - Ignore <code>ON CLUSTER</code> clause if database is <code>Replicated</code> and cluster name equals to database name. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/35570" target="_blank" rel="noopener noreferrer">#35570</a> - Miscellaneous minor fixes for <code>Replicated</code> database engine - Check metadata consistency when starting up <code>Replicated</code> database, start replica recovery in case of mismatch of local metadata and metadata in Keeper. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/24880" target="_blank" rel="noopener noreferrer">#24880</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37198" target="_blank" rel="noopener noreferrer">#37198</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Add result_rows and result_bytes to progress reports (<code>X-ClickHouse-Summary</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39567" target="_blank" rel="noopener noreferrer">#39567</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improve primary key analysis for MergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/25563" target="_blank" rel="noopener noreferrer">#25563</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li><code>timeSlots</code> now works with DateTime64; subsecond duration and slot size available when working with DateTime64. <a href="https://github.com/ClickHouse/ClickHouse/pull/37951" target="_blank" rel="noopener noreferrer">#37951</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Added support of <code>LEFT SEMI</code> and <code>LEFT ANTI</code> direct join with <code>EmbeddedRocksDB</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/38956" target="_blank" rel="noopener noreferrer">#38956</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add profile events for fsync operations. <a href="https://github.com/ClickHouse/ClickHouse/pull/39179" target="_blank" rel="noopener noreferrer">#39179</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add the second argument to the ordinary function <code>file(path[, default])</code>, which function returns in the case when a file does not exists. <a href="https://github.com/ClickHouse/ClickHouse/pull/39218" target="_blank" rel="noopener noreferrer">#39218</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Some small fixes for reading via http, allow to retry partial content in case if 200 OK. <a href="https://github.com/ClickHouse/ClickHouse/pull/39244" target="_blank" rel="noopener noreferrer">#39244</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support queries <code>CREATE TEMPORARY TABLE ... (&lt;list of columns&gt;) AS ...</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39462" target="_blank" rel="noopener noreferrer">#39462</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add support of <code>!</code>/<code>*</code> (exclamation/asterisk) in custom TLDs (<code>cutToFirstSignificantSubdomainCustom()</code>/<code>cutToFirstSignificantSubdomainCustomWithWWW()</code>/<code>firstSignificantSubdomainCustom()</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39496" target="_blank" rel="noopener noreferrer">#39496</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add support for TLS connections to NATS. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/39525" target="_blank" rel="noopener noreferrer">#39525</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39527" target="_blank" rel="noopener noreferrer">#39527</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li><code>clickhouse-obfuscator</code> (a tool for database obfuscation for testing and load generation) now has the new <code>--save</code> and <code>--load</code> parameters to work with pre-trained models. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39534" target="_blank" rel="noopener noreferrer">#39534</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39541" target="_blank" rel="noopener noreferrer">#39541</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix incorrect behavior of log rotation during restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/39558" target="_blank" rel="noopener noreferrer">#39558</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix building aggregate projections when external aggregation is on. Mark as improvement because the case is rare and there exists easy workaround to fix it via changing settings. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39667" target="_blank" rel="noopener noreferrer">#39667</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/39671" target="_blank" rel="noopener noreferrer">#39671</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow to execute hash functions with arguments of type <code>Map</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39685" target="_blank" rel="noopener noreferrer">#39685</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add a configuration parameter to hide addresses in stack traces. It may improve security a little but generally, it is harmful and should not be used. <a href="https://github.com/ClickHouse/ClickHouse/pull/39690" target="_blank" rel="noopener noreferrer">#39690</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Change the prefix size of AggregateFunctionDistinct to make sure nested function data memory segment is aligned. <a href="https://github.com/ClickHouse/ClickHouse/pull/39696" target="_blank" rel="noopener noreferrer">#39696</a> (<a href="https://github.com/BiteTheDDDDt" target="_blank" rel="noopener noreferrer">Pxl</a>).</li><li>Properly escape credentials passed to the <code>clickhouse-diagnostic</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/39707" target="_blank" rel="noopener noreferrer">#39707</a> (<a href="https://github.com/gingerwizard" target="_blank" rel="noopener noreferrer">Dale McDiarmid</a>).</li><li>ClickHouse Keeper improvement: create a snapshot on exit. It can be controlled with the config <code>keeper_server.create_snapshot_on_exit</code>, <code>true</code> by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/39755" target="_blank" rel="noopener noreferrer">#39755</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Support primary key analysis for <code>row_policy_filter</code> and <code>additional_filter</code>. It also helps fix issues like <a href="https://github.com/ClickHouse/ClickHouse/issues/37454" target="_blank" rel="noopener noreferrer">#37454</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/39826" target="_blank" rel="noopener noreferrer">#39826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix two usability issues in Play UI: - it was non-pixel-perfect on iPad due to parasitic border radius and margins; - the progress indication did not display after the first query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39957" target="_blank" rel="noopener noreferrer">#39957</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39960" target="_blank" rel="noopener noreferrer">#39960</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39961" target="_blank" rel="noopener noreferrer">#39961</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Play UI: add row numbers; add cell selection on click; add hysteresis for table cells. <a href="https://github.com/ClickHouse/ClickHouse/pull/39962" target="_blank" rel="noopener noreferrer">#39962</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Play UI: recognize tab key in textarea, but at the same time don&#x27;t mess up with tab navigation. <a href="https://github.com/ClickHouse/ClickHouse/pull/40053" target="_blank" rel="noopener noreferrer">#40053</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>The client will show server-side elapsed time. This is important for the performance comparison of ClickHouse services in remote datacenters. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38070" target="_blank" rel="noopener noreferrer">#38070</a>. See also <a href="https://github.com/ClickHouse/ClickBench/blob/main/hardware/benchmark-cloud.sh#L37" target="_blank" rel="noopener noreferrer">this</a> for motivation. <a href="https://github.com/ClickHouse/ClickHouse/pull/39968" target="_blank" rel="noopener noreferrer">#39968</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Adds <code>parseDateTime64BestEffortUS</code>, <code>parseDateTime64BestEffortUSOrNull</code>, <code>parseDateTime64BestEffortUSOrZero</code> functions, closing <a href="https://github.com/ClickHouse/ClickHouse/issues/37492" target="_blank" rel="noopener noreferrer">#37492</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40015" target="_blank" rel="noopener noreferrer">#40015</a> (<a href="https://github.com/tbragin" target="_blank" rel="noopener noreferrer">Tanya Bragin</a>).</li><li>Extend the <code>system.processors_profile_log</code> with more information such as input rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/40121" target="_blank" rel="noopener noreferrer">#40121</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Display server-side time in <code>clickhouse-benchmark</code> by default if it is available (since ClickHouse version 22.8). This is needed to correctly compare the performance of clouds. This behavior can be changed with the new <code>--client-side-time</code> command line option. Change the <code>--randomize</code> command line option from <code>--randomize 1</code> to the form without argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/40193" target="_blank" rel="noopener noreferrer">#40193</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add counters (ProfileEvents) for cases when query complexity limitation has been set and has reached (a separate counter for <code>overflow_mode</code> = <code>break</code> and <code>throw</code>). For example, if you have set up <code>max_rows_to_read</code> with <code>read_overflow_mode = &#x27;break&#x27;</code>, looking at the value of <code>OverflowBreak</code> counter will allow distinguishing incomplete results. <a href="https://github.com/ClickHouse/ClickHouse/pull/40205" target="_blank" rel="noopener noreferrer">#40205</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix memory accounting in case of &quot;Memory limit exceeded&quot; errors (previously <!-- -->[peak]<!-- --> memory usage was takes failed allocations into account). <a href="https://github.com/ClickHouse/ClickHouse/pull/40249" target="_blank" rel="noopener noreferrer">#40249</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add metrics for filesystem cache: <code>FilesystemCacheSize</code> and <code>FilesystemCacheElements</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40260" target="_blank" rel="noopener noreferrer">#40260</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support hadoop secure RPC transfer (hadoop.rpc.protection=privacy and hadoop.rpc.protection=integrity). <a href="https://github.com/ClickHouse/ClickHouse/pull/39411" target="_blank" rel="noopener noreferrer">#39411</a> (<a href="https://github.com/michael1589" target="_blank" rel="noopener noreferrer">michael1589</a>).</li><li>Avoid continuously growing memory consumption of pattern cache when using functions multi(Fuzzy)Match(Any|AllIndices|AnyIndex)(). <a href="https://github.com/ClickHouse/ClickHouse/pull/40264" target="_blank" rel="noopener noreferrer">#40264</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-4">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-4" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li><a href="https://fiddle.clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickFiddle</a>: A new tool for testing ClickHouse versions in read/write mode (<strong>Igor Baliuk</strong>).</li><li>ClickHouse binary is made self-extracting <a href="https://github.com/ClickHouse/ClickHouse/pull/35775" target="_blank" rel="noopener noreferrer">#35775</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy, Arthur Filatenkov</a>).</li><li>Update tzdata to 2022b to support the new timezone changes. See <a href="https://github.com/google/cctz/pull/226" target="_blank" rel="noopener noreferrer">https://github.com/google/cctz/pull/226</a>. Chile&#x27;s 2022 DST start is delayed from September 4 to September 11. Iran plans to stop observing DST permanently, after it falls back on 2022-09-21. There are corrections of the historical time zone of Asia/Tehran in the year 1977: Iran adopted standard time in 1935, not 1946. In 1977 it observed DST from 03-21 23:00 to 10-20 24:00; its 1978 transitions were on 03-24 and 08-05, not 03-20 and 10-20; and its spring 1979 transition was on 05-27, not 03-21 (<a href="https://data.iana.org/time-zones/tzdb/NEWS" target="_blank" rel="noopener noreferrer">https://data.iana.org/time-zones/tzdb/NEWS</a>). (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Former packages used to install systemd.service file to <code>/etc</code>. The files there are marked as <code>conf</code> and are not cleaned out, and not updated automatically. This PR cleans them out. <a href="https://github.com/ClickHouse/ClickHouse/pull/39323" target="_blank" rel="noopener noreferrer">#39323</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Ensure LSan is effective. <a href="https://github.com/ClickHouse/ClickHouse/pull/39430" target="_blank" rel="noopener noreferrer">#39430</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>TSAN has issues with clang-14 (<a href="https://github.com/google/sanitizers/issues/1552" target="_blank" rel="noopener noreferrer">https://github.com/google/sanitizers/issues/1552</a>, <a href="https://github.com/google/sanitizers/issues/1540" target="_blank" rel="noopener noreferrer">https://github.com/google/sanitizers/issues/1540</a>), so here we build the TSAN binaries with clang-15. <a href="https://github.com/ClickHouse/ClickHouse/pull/39450" target="_blank" rel="noopener noreferrer">#39450</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Remove the option to build ClickHouse tools as separate executable programs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37847" target="_blank" rel="noopener noreferrer">#37847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39520" target="_blank" rel="noopener noreferrer">#39520</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Small preparations for build on s390x (which is big-endian). <a href="https://github.com/ClickHouse/ClickHouse/pull/39627" target="_blank" rel="noopener noreferrer">#39627</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39656" target="_blank" rel="noopener noreferrer">#39656</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fixed Endian issue in BitHelpers for s390x. <a href="https://github.com/ClickHouse/ClickHouse/pull/39656" target="_blank" rel="noopener noreferrer">#39656</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Implement a piece of code related to SipHash for s390x architecture (which is not supported by ClickHouse). <a href="https://github.com/ClickHouse/ClickHouse/pull/39732" target="_blank" rel="noopener noreferrer">#39732</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fixed an Endian issue in Coordination snapshot code for s390x architecture (which is not supported by ClickHouse). <a href="https://github.com/ClickHouse/ClickHouse/pull/39931" target="_blank" rel="noopener noreferrer">#39931</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fixed Endian issues in Codec code for s390x architecture (which is not supported by ClickHouse). <a href="https://github.com/ClickHouse/ClickHouse/pull/40008" target="_blank" rel="noopener noreferrer">#40008</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fixed Endian issues in reading/writing BigEndian binary data in ReadHelpers and WriteHelpers code for s390x architecture (which is not supported by ClickHouse). <a href="https://github.com/ClickHouse/ClickHouse/pull/40179" target="_blank" rel="noopener noreferrer">#40179</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>Support build with <code>clang-16</code> (trunk). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39949" target="_blank" rel="noopener noreferrer">#39949</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40181" target="_blank" rel="noopener noreferrer">#40181</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Prepare RISC-V 64 build to run in CI. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/40141" target="_blank" rel="noopener noreferrer">#40141</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40197" target="_blank" rel="noopener noreferrer">#40197</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Simplified function registration macro interface (<code>FUNCTION_REGISTER*</code>) to eliminate the step to add and call an extern function in the registerFunctions.cpp, it also makes incremental builds of a new function faster. <a href="https://github.com/ClickHouse/ClickHouse/pull/38615" target="_blank" rel="noopener noreferrer">#38615</a> (<a href="https://github.com/liyinsg" target="_blank" rel="noopener noreferrer">Li Yin</a>).</li><li>Docker: Now entrypoint.sh in docker image creates and executes chown for all folders it found in config for multidisk setup <a href="https://github.com/ClickHouse/ClickHouse/issues/17717" target="_blank" rel="noopener noreferrer">#17717</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39121" target="_blank" rel="noopener noreferrer">#39121</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-1">Bug Fix<a href="#bug-fix-1" class="hash-link" aria-label="Direct link to Bug Fix" title="Direct link to Bug Fix">​</a></h4><ul><li>Fix possible segfault in <code>CapnProto</code> input format. This bug was found and send through ClickHouse bug-bounty <a href="https://github.com/ClickHouse/ClickHouse/issues/38986" target="_blank" rel="noopener noreferrer">program</a> by <em>kiojj</em>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40241" target="_blank" rel="noopener noreferrer">#40241</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix a very rare case of incorrect behavior of array subscript operator. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28720" target="_blank" rel="noopener noreferrer">#28720</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40185" target="_blank" rel="noopener noreferrer">#40185</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix insufficient argument check for encryption functions (found by query fuzzer). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39987" target="_blank" rel="noopener noreferrer">#39987</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40194" target="_blank" rel="noopener noreferrer">#40194</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix the case when the order of columns can be incorrect if the <code>IN</code> operator is used with a table with <code>ENGINE = Set</code> containing multiple columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13014" target="_blank" rel="noopener noreferrer">#13014</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40225" target="_blank" rel="noopener noreferrer">#40225</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix seeking while reading from encrypted disk. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38381" target="_blank" rel="noopener noreferrer">#38381</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39687" target="_blank" rel="noopener noreferrer">#39687</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix duplicate columns in join plan. Finally, solve <a href="https://github.com/ClickHouse/ClickHouse/issues/26809" target="_blank" rel="noopener noreferrer">#26809</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40009" target="_blank" rel="noopener noreferrer">#40009</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fixed query hanging for SELECT with ORDER BY WITH FILL with different date/time types. <a href="https://github.com/ClickHouse/ClickHouse/pull/37849" target="_blank" rel="noopener noreferrer">#37849</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Fix ORDER BY that matches projections ORDER BY (before it simply returns unsorted result). <a href="https://github.com/ClickHouse/ClickHouse/pull/38725" target="_blank" rel="noopener noreferrer">#38725</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not optimise functions in GROUP BY statements if they shadow one of the table columns or expressions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37032" target="_blank" rel="noopener noreferrer">#37032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39103" target="_blank" rel="noopener noreferrer">#39103</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Fix wrong table name in logs after RENAME TABLE. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38018" target="_blank" rel="noopener noreferrer">#38018</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39227" target="_blank" rel="noopener noreferrer">#39227</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix positional arguments in case of columns pruning when optimising the query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38433" target="_blank" rel="noopener noreferrer">#38433</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39293" target="_blank" rel="noopener noreferrer">#39293</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bug in schema inference in case of empty messages in Protobuf/CapnProto formats that allowed to create column with empty <code>Tuple</code> type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39051" target="_blank" rel="noopener noreferrer">#39051</a> Add 2 new settings <code>input_format_{protobuf/capnproto}_skip_fields_with_unsupported_types_in_schema_inference</code> that allow to skip fields with unsupported types while schema inference for Protobuf and CapnProto formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/39357" target="_blank" rel="noopener noreferrer">#39357</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>(Window View is an experimental feature) Fix segmentation fault on <code>CREATE WINDOW VIEW .. ON CLUSTER ... INNER</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39363" target="_blank" rel="noopener noreferrer">#39363</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39384" target="_blank" rel="noopener noreferrer">#39384</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix WriteBuffer finalize when cancelling insert into function (in previous versions it may leat to std::terminate). <a href="https://github.com/ClickHouse/ClickHouse/pull/39458" target="_blank" rel="noopener noreferrer">#39458</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix storing of columns of type <code>Object</code> in sparse serialization. <a href="https://github.com/ClickHouse/ClickHouse/pull/39464" target="_blank" rel="noopener noreferrer">#39464</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible &quot;Not found column in block&quot; exception when using projections. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39469" target="_blank" rel="noopener noreferrer">#39469</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39470" target="_blank" rel="noopener noreferrer">#39470</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Fix exception on race between DROP and INSERT with materialized views. <a href="https://github.com/ClickHouse/ClickHouse/pull/39477" target="_blank" rel="noopener noreferrer">#39477</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>A bug in Apache Avro library: fix data race and possible heap-buffer-overflow in Avro format. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39094" target="_blank" rel="noopener noreferrer">#39094</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33652" target="_blank" rel="noopener noreferrer">#33652</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39498" target="_blank" rel="noopener noreferrer">#39498</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix rare bug in asynchronous reading (with setting <code>local_filesystem_read_method=&#x27;pread_threadpool&#x27;</code>) with enabled <code>O_DIRECT</code> (enabled by setting <code>min_bytes_to_use_direct_io</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/39506" target="_blank" rel="noopener noreferrer">#39506</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>(only on FreeBSD) Fixes &quot;Code: 49. DB::Exception: FunctionFactory: the function name &#x27;&#x27; is not unique. (LOGICAL_ERROR)&quot; observed on FreeBSD when starting clickhouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/39551" target="_blank" rel="noopener noreferrer">#39551</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Fix bug with the recently introduced &quot;maxsplit&quot; argument for <code>splitByChar</code>, which was not working correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/39552" target="_blank" rel="noopener noreferrer">#39552</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix bug in ASOF JOIN with <code>enable_optimize_predicate_expression</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/37813" target="_blank" rel="noopener noreferrer">#37813</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39556" target="_blank" rel="noopener noreferrer">#39556</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fixed <code>CREATE/DROP INDEX</code> query with <code>ON CLUSTER</code> or <code>Replicated</code> database and <code>ReplicatedMergeTree</code>. It used to be executed on all replicas (causing error or DDL queue stuck). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39511" target="_blank" rel="noopener noreferrer">#39511</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39565" target="_blank" rel="noopener noreferrer">#39565</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix &quot;column not found&quot; error for push down with join, close <a href="https://github.com/ClickHouse/ClickHouse/issues/39505" target="_blank" rel="noopener noreferrer">#39505</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39575" target="_blank" rel="noopener noreferrer">#39575</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix the wrong <code>REGEXP_REPLACE</code> alias. This fixes <a href="https://github.com/ClickHouse/ClickBench/issues/9" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickBench/issues/9</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39592" target="_blank" rel="noopener noreferrer">#39592</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fixed point of origin for exponential decay window functions to the last value in window. Previously, decay was calculated by formula <code>exp((t - curr_row_t) / decay_length)</code>, which is incorrect when right boundary of window is not <code>CURRENT ROW</code>. It was changed to: <code>exp((t - last_row_t) / decay_length)</code>. There is no change in results for windows with <code>ROWS BETWEEN (smth) AND CURRENT ROW</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39593" target="_blank" rel="noopener noreferrer">#39593</a> (<a href="https://github.com/quickhouse" target="_blank" rel="noopener noreferrer">Vladimir Chebotaryov</a>).</li><li>Fix Decimal division overflow, which can be detected based on operands scale. <a href="https://github.com/ClickHouse/ClickHouse/pull/39600" target="_blank" rel="noopener noreferrer">#39600</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Fix settings <code>output_format_arrow_string_as_string</code> and <code>output_format_arrow_low_cardinality_as_dictionary</code> work in combination. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39624" target="_blank" rel="noopener noreferrer">#39624</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39647" target="_blank" rel="noopener noreferrer">#39647</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed a bug in default database resolution in distributed table reads. <a href="https://github.com/ClickHouse/ClickHouse/pull/39674" target="_blank" rel="noopener noreferrer">#39674</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>(Only with the obsolete Ordinary databases) Select might read data of dropped table if cache for mmap IO is used and database engine is Ordinary and new tables was created with the same name as dropped one had. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/39708" target="_blank" rel="noopener noreferrer">#39708</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix possible error <code>Invalid column type for ColumnUnique::insertRangeFrom. Expected String, got ColumnLowCardinality</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38460" target="_blank" rel="noopener noreferrer">#38460</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39716" target="_blank" rel="noopener noreferrer">#39716</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Field names in the <code>meta</code> section of JSON format were erroneously double escaped. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39693" target="_blank" rel="noopener noreferrer">#39693</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39747" target="_blank" rel="noopener noreferrer">#39747</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix wrong index analysis with tuples and operator <code>IN</code>, which could lead to wrong query result. <a href="https://github.com/ClickHouse/ClickHouse/pull/39752" target="_blank" rel="noopener noreferrer">#39752</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix <code>EmbeddedRocksDB</code> tables filtering by key using params. <a href="https://github.com/ClickHouse/ClickHouse/pull/39757" target="_blank" rel="noopener noreferrer">#39757</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix error <code>Invalid number of columns in chunk pushed to OutputPort</code> which was caused by ARRAY JOIN optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39164" target="_blank" rel="noopener noreferrer">#39164</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39799" target="_blank" rel="noopener noreferrer">#39799</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>A workaround for a bug in Linux kernel. Fix <code>CANNOT_READ_ALL_DATA</code> exception with <code>local_filesystem_read_method=pread_threadpool</code>. This bug affected only Linux kernel version 5.9 and 5.10 according to <a href="https://manpages.debian.org/testing/manpages-dev/preadv2.2.en.html#BUGS" target="_blank" rel="noopener noreferrer">man</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39800" target="_blank" rel="noopener noreferrer">#39800</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>(Only on NFS) Fix broken NFS mkdir for root-squashed volumes. <a href="https://github.com/ClickHouse/ClickHouse/pull/39898" target="_blank" rel="noopener noreferrer">#39898</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li>Remove dictionaries from prometheus metrics on DETACH/DROP. <a href="https://github.com/ClickHouse/ClickHouse/pull/39926" target="_blank" rel="noopener noreferrer">#39926</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix read of StorageFile with virtual columns. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39907" target="_blank" rel="noopener noreferrer">#39907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39943" target="_blank" rel="noopener noreferrer">#39943</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix big memory usage during fetches. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39915" target="_blank" rel="noopener noreferrer">#39915</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39990" target="_blank" rel="noopener noreferrer">#39990</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>(experimental feature) Fix <code>hashId</code> crash and salt parameter not being used. <a href="https://github.com/ClickHouse/ClickHouse/pull/40002" target="_blank" rel="noopener noreferrer">#40002</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li><code>EXCEPT</code> and <code>INTERSECT</code> operators may lead to crash if a specific combination of constant and non-constant columns were used. <a href="https://github.com/ClickHouse/ClickHouse/pull/40020" target="_blank" rel="noopener noreferrer">#40020</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li><li>Fixed &quot;Part directory doesn&#x27;t exist&quot; and &quot;<code>tmp_&lt;part_name&gt;</code> ... No such file or directory&quot; errors during too slow INSERT or too long merge/mutation. Also fixed issue that may cause some replication queue entries to stuck without any errors or warnings in logs if previous attempt to fetch part failed, but <code>tmp-fetch_&lt;part_name&gt;</code> directory was not cleaned up. <a href="https://github.com/ClickHouse/ClickHouse/pull/40031" target="_blank" rel="noopener noreferrer">#40031</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Fix rare cases of parsing of arrays of tuples in format <code>Values</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40034" target="_blank" rel="noopener noreferrer">#40034</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixes ArrowColumn format Dictionary(X) &amp; Dictionary(Nullable(X)) conversion to ClickHouse LowCardinality(X) &amp; LowCardinality(Nullable(X)) respectively. <a href="https://github.com/ClickHouse/ClickHouse/pull/40037" target="_blank" rel="noopener noreferrer">#40037</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Fix potential deadlock in writing to S3 during task scheduling failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/40070" target="_blank" rel="noopener noreferrer">#40070</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix bug in collectFilesToSkip() by adding correct file extension (.idx or idx2) for indexes to be recalculated, avoid wrong hard links. Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/39896" target="_blank" rel="noopener noreferrer">#39896</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/40095" target="_blank" rel="noopener noreferrer">#40095</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>A fix for reverse DNS resolution. <a href="https://github.com/ClickHouse/ClickHouse/pull/40134" target="_blank" rel="noopener noreferrer">#40134</a> (<a href="https://github.com/arthurpassos" target="_blank" rel="noopener noreferrer">Arthur Passos</a>).</li><li>Fix unexpected result <code>arrayDifference</code> of `Array(UInt32). <a href="https://github.com/ClickHouse/ClickHouse/pull/40211" target="_blank" rel="noopener noreferrer">#40211</a> (<a href="https://github.com/canhld94" target="_blank" rel="noopener noreferrer">Duc Canh Le</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-227-2022-07-21"><a id="227"></a> ClickHouse release 22.7, 2022-07-21<a href="#-clickhouse-release-227-2022-07-21" class="hash-link" aria-label="Direct link to -clickhouse-release-227-2022-07-21" title="Direct link to -clickhouse-release-227-2022-07-21">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes-1">Upgrade Notes<a href="#upgrade-notes-1" class="hash-link" aria-label="Direct link to Upgrade Notes" title="Direct link to Upgrade Notes">​</a></h4><ul><li>Enable setting <code>enable_positional_arguments</code> by default. It allows queries like <code>SELECT ... ORDER BY 1, 2</code> where 1, 2 are the references to the select clause. If you need to return the old behavior, disable this setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/38204" target="_blank" rel="noopener noreferrer">#38204</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Disable <code>format_csv_allow_single_quotes</code> by default. See <a href="https://github.com/ClickHouse/ClickHouse/issues/37096" target="_blank" rel="noopener noreferrer">#37096</a>. (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>Ordinary</code> database engine and old storage definition syntax for <code>*MergeTree</code> tables are deprecated. By default it&#x27;s not possible to create new databases with <code>Ordinary</code> engine. If <code>system</code> database has <code>Ordinary</code> engine it will be automatically converted to <code>Atomic</code> on server startup. There are settings to keep old behavior (<code>allow_deprecated_database_ordinary</code> and <code>allow_deprecated_syntax_for_merge_tree</code>), but these settings may be removed in future releases. <a href="https://github.com/ClickHouse/ClickHouse/pull/38335" target="_blank" rel="noopener noreferrer">#38335</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Force rewriting comma join to inner by default (set default value <code>cross_to_inner_join_rewrite = 2</code>). To have old behavior set <code>cross_to_inner_join_rewrite = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39326" target="_blank" rel="noopener noreferrer">#39326</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>). If you will face any incompatibilities, you can turn this setting back.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-5">New Feature<a href="#new-feature-5" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Support expressions with window functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19857" target="_blank" rel="noopener noreferrer">#19857</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37848" target="_blank" rel="noopener noreferrer">#37848</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add new <code>direct</code> join algorithm for <code>EmbeddedRocksDB</code> tables, see <a href="https://github.com/ClickHouse/ClickHouse/issues/33582" target="_blank" rel="noopener noreferrer">#33582</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35363" target="_blank" rel="noopener noreferrer">#35363</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Added full sorting merge join algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/35796" target="_blank" rel="noopener noreferrer">#35796</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Implement NATS table engine, which allows to pub/sub to NATS. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32388" target="_blank" rel="noopener noreferrer">#32388</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37171" target="_blank" rel="noopener noreferrer">#37171</a> (<a href="https://github.com/tchepavel" target="_blank" rel="noopener noreferrer">tchepavel</a>). (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>)</li><li>Implement table function <code>mongodb</code>. Allow writes into <code>MongoDB</code> storage / table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/37213" target="_blank" rel="noopener noreferrer">#37213</a> (<a href="https://github.com/aaapetrenko" target="_blank" rel="noopener noreferrer">aaapetrenko</a>). (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>)</li><li>Add <code>SQLInsert</code> output format. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38441" target="_blank" rel="noopener noreferrer">#38441</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38477" target="_blank" rel="noopener noreferrer">#38477</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Introduced settings <code>additional_table_filters</code>. Using this setting, you can specify additional filtering condition for a table which will be applied directly after reading. Example: <code>select number, x, y from (select number from system.numbers limit 5) f any left join (select x, y from table_1) s on f.number = s.x settings additional_table_filters={&#x27;system.numbers : &#x27;number != 3&#x27;, &#x27;table_1&#x27; : &#x27;x != 2&#x27;}</code>. Introduced setting <code>additional_result_filter</code> which specifies additional filtering condition for query result. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37918" target="_blank" rel="noopener noreferrer">#37918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38475" target="_blank" rel="noopener noreferrer">#38475</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add <code>compatibility</code> setting and <code>system.settings_changes</code> system table that contains information about changes in settings through ClickHouse versions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35972" target="_blank" rel="noopener noreferrer">#35972</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38957" target="_blank" rel="noopener noreferrer">#38957</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add functions <code>translate(string, from_string, to_string)</code> and <code>translateUTF8(string, from_string, to_string)</code>. It translates some characters to another. <a href="https://github.com/ClickHouse/ClickHouse/pull/38935" target="_blank" rel="noopener noreferrer">#38935</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Support <code>parseTimeDelta</code> function. It can be used like <code> ;-+,:</code> can be used as separators, eg. <code>1yr-2mo</code>, <code>2m:6s</code>: <code>SELECT parseTimeDelta(&#x27;1yr-2mo-4w + 12 days, 3 hours : 1 minute ; 33 seconds&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39071" target="_blank" rel="noopener noreferrer">#39071</a> (<a href="https://github.com/jiahui-97" target="_blank" rel="noopener noreferrer">jiahui-97</a>).</li><li>Added <code>CREATE TABLE ... EMPTY AS SELECT</code> query. It automatically deduces table structure from the SELECT query, but does not fill the table after creation. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/38049" target="_blank" rel="noopener noreferrer">#38049</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38272" target="_blank" rel="noopener noreferrer">#38272</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Added options to limit IO operations with remote storage: <code>max_remote_read_network_bandwidth_for_server</code> and <code>max_remote_write_network_bandwidth_for_server</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39095" target="_blank" rel="noopener noreferrer">#39095</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Add <code>group_by_use_nulls</code> setting to make aggregation key columns nullable in the case of ROLLUP, CUBE and GROUPING SETS. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37359" target="_blank" rel="noopener noreferrer">#37359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38642" target="_blank" rel="noopener noreferrer">#38642</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add the ability to specify compression level during data export. <a href="https://github.com/ClickHouse/ClickHouse/pull/38907" target="_blank" rel="noopener noreferrer">#38907</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Add an option to require explicit grants to SELECT from the <code>system</code> database. Details: <a href="https://github.com/ClickHouse/ClickHouse/pull/38970" target="_blank" rel="noopener noreferrer">#38970</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Functions <code>multiMatchAny</code>, <code>multiMatchAnyIndex</code>, <code>multiMatchAllIndices</code> and their fuzzy variants now accept non-const pattern array argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/38485" target="_blank" rel="noopener noreferrer">#38485</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>). SQL function <code>multiSearchAllPositions</code> now accepts non-const needle arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/39167" target="_blank" rel="noopener noreferrer">#39167</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Add a setting <code>zstd_window_log_max</code> to configure max memory usage on zstd decoding when importing external files. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35693" target="_blank" rel="noopener noreferrer">#35693</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37015" target="_blank" rel="noopener noreferrer">#37015</a> (<a href="https://github.com/wuxiaobai24" target="_blank" rel="noopener noreferrer">wuxiaobai24</a>).</li><li>Add <code>send_logs_source_regexp</code> setting. Send server text logs with specified regexp to match log source name. Empty means all sources. <a href="https://github.com/ClickHouse/ClickHouse/pull/39161" target="_blank" rel="noopener noreferrer">#39161</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support <code>ALTER</code> for <code>Hive</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/38214" target="_blank" rel="noopener noreferrer">#38214</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Support <code>isNullable</code> function. This function checks whether it&#x27;s argument is nullable and return 1 or 0. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38611" target="_blank" rel="noopener noreferrer">#38611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38841" target="_blank" rel="noopener noreferrer">#38841</a> (<a href="https://github.com/lokax" target="_blank" rel="noopener noreferrer">lokax</a>).</li><li>Added functions for base58 encoding/decoding. <a href="https://github.com/ClickHouse/ClickHouse/pull/38159" target="_blank" rel="noopener noreferrer">#38159</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Add chart visualization to Play UI. <a href="https://github.com/ClickHouse/ClickHouse/pull/38197" target="_blank" rel="noopener noreferrer">#38197</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Added L2 Squared distance and norm functions for both arrays and tuples. <a href="https://github.com/ClickHouse/ClickHouse/pull/38545" target="_blank" rel="noopener noreferrer">#38545</a> (<a href="https://github.com/israelg99" target="_blank" rel="noopener noreferrer">Julian Gilyadov</a>).</li><li>Add ability to pass HTTP headers to the <code>url</code> table function / storage via SQL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37897" target="_blank" rel="noopener noreferrer">#37897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38176" target="_blank" rel="noopener noreferrer">#38176</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>clickhouse-diagnostics</code> binary to the packages. <a href="https://github.com/ClickHouse/ClickHouse/pull/38647" target="_blank" rel="noopener noreferrer">#38647</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-4">Experimental Feature<a href="#experimental-feature-4" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Adds new setting <code>implicit_transaction</code> to run standalone queries inside a transaction. It handles both creation and closing (via COMMIT if the query succeeded or ROLLBACK if it didn&#x27;t) of the transaction automatically. <a href="https://github.com/ClickHouse/ClickHouse/pull/38344" target="_blank" rel="noopener noreferrer">#38344</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-5">Performance Improvement<a href="#performance-improvement-5" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Distinct optimization for sorted columns. Use specialized distinct transformation in case input stream is sorted by column(s) in distinct. Optimization can be applied to pre-distinct, final distinct, or both. Initial implementation by @dimarub2000. <a href="https://github.com/ClickHouse/ClickHouse/pull/37803" target="_blank" rel="noopener noreferrer">#37803</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Improve performance of <code>ORDER BY</code>, <code>MergeTree</code> merges, window functions using batch version of <code>BinaryHeap</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38022" target="_blank" rel="noopener noreferrer">#38022</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>More parallel execution for queries with <code>FINAL</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/36396" target="_blank" rel="noopener noreferrer">#36396</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix significant join performance regression which was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/35616" target="_blank" rel="noopener noreferrer">#35616</a>. It&#x27;s interesting that common join queries such as ssb queries have been 10 times slower for almost 3 months while no one complains. <a href="https://github.com/ClickHouse/ClickHouse/pull/38052" target="_blank" rel="noopener noreferrer">#38052</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Migrate from the Intel hyperscan library to vectorscan, this speeds up many string matching on non-x86 platforms. <a href="https://github.com/ClickHouse/ClickHouse/pull/38171" target="_blank" rel="noopener noreferrer">#38171</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Increased parallelism of query plan steps executed after aggregation. <a href="https://github.com/ClickHouse/ClickHouse/pull/38295" target="_blank" rel="noopener noreferrer">#38295</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Improve performance of insertion to columns of type <code>JSON</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38320" target="_blank" rel="noopener noreferrer">#38320</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Optimized insertion and lookups in the HashTable. <a href="https://github.com/ClickHouse/ClickHouse/pull/38413" target="_blank" rel="noopener noreferrer">#38413</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix performance degradation from <a href="https://github.com/ClickHouse/ClickHouse/issues/32493" target="_blank" rel="noopener noreferrer">#32493</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38417" target="_blank" rel="noopener noreferrer">#38417</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Improve performance of joining with numeric columns using SIMD instructions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37235" target="_blank" rel="noopener noreferrer">#37235</a> (<a href="https://github.com/zzachimed" target="_blank" rel="noopener noreferrer">zzachimed</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/38565" target="_blank" rel="noopener noreferrer">#38565</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Norm and Distance functions for arrays speed up 1.2-2 times. <a href="https://github.com/ClickHouse/ClickHouse/pull/38740" target="_blank" rel="noopener noreferrer">#38740</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Add AVX-512 VBMI optimized <code>copyOverlap32Shuffle</code> for LZ4 decompression. In other words, LZ4 decompression performance is improved. <a href="https://github.com/ClickHouse/ClickHouse/pull/37891" target="_blank" rel="noopener noreferrer">#37891</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>).</li><li><code>ORDER BY (a, b)</code> will use all the same benefits as <code>ORDER BY a, b</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38873" target="_blank" rel="noopener noreferrer">#38873</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Align branches within a 32B boundary to make benchmark more stable. <a href="https://github.com/ClickHouse/ClickHouse/pull/38988" target="_blank" rel="noopener noreferrer">#38988</a> (<a href="https://github.com/guowangy" target="_blank" rel="noopener noreferrer">Guo Wangyang</a>). It improves performance 1..2% on average for Intel.</li><li>Executable UDF, executable dictionaries, and Executable tables will avoid wasting one second during wait for subprocess termination. <a href="https://github.com/ClickHouse/ClickHouse/pull/38929" target="_blank" rel="noopener noreferrer">#38929</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li>Optimize accesses to <code>system.stack_trace</code> table if not all columns are selected. <a href="https://github.com/ClickHouse/ClickHouse/pull/39177" target="_blank" rel="noopener noreferrer">#39177</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve isNullable/isConstant/isNull/isNotNull performance for LowCardinality argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/39192" target="_blank" rel="noopener noreferrer">#39192</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Optimized processing of ORDER BY in window functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/34632" target="_blank" rel="noopener noreferrer">#34632</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>The table <code>system.asynchronous_metric_log</code> is further optimized for storage space. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38134" target="_blank" rel="noopener noreferrer">#38134</a>. See the <a href="https://www.youtube.com/watch?v=0fSp9SF8N8A" target="_blank" rel="noopener noreferrer">YouTube video</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38428" target="_blank" rel="noopener noreferrer">#38428</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-5">Improvement<a href="#improvement-5" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Support SQL standard CREATE INDEX and DROP INDEX syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/35166" target="_blank" rel="noopener noreferrer">#35166</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Send profile events for INSERT queries (previously only SELECT was supported). <a href="https://github.com/ClickHouse/ClickHouse/pull/37391" target="_blank" rel="noopener noreferrer">#37391</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implement in order aggregation (<code>optimize_aggregation_in_order</code>) for fully materialized projections. <a href="https://github.com/ClickHouse/ClickHouse/pull/37469" target="_blank" rel="noopener noreferrer">#37469</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Remove subprocess run for kerberos initialization. Added new integration test. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27651" target="_blank" rel="noopener noreferrer">#27651</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38105" target="_blank" rel="noopener noreferrer">#38105</a> (<a href="https://github.com/rvasin" target="_blank" rel="noopener noreferrer">Roman Vasin</a>).</li><li><ul><li>Add setting <code>multiple_joins_try_to_keep_original_names</code> to not rewrite identifier name on multiple JOINs rewrite, close <a href="https://github.com/ClickHouse/ClickHouse/issues/34697" target="_blank" rel="noopener noreferrer">#34697</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38149" target="_blank" rel="noopener noreferrer">#38149</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li></ul></li><li>Improved trace-visualizer UX. <a href="https://github.com/ClickHouse/ClickHouse/pull/38169" target="_blank" rel="noopener noreferrer">#38169</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Enable stack trace collection and query profiler for AArch64. <a href="https://github.com/ClickHouse/ClickHouse/pull/38181" target="_blank" rel="noopener noreferrer">#38181</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Do not skip symlinks in <code>user_defined</code> directory during SQL user defined functions loading. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38042" target="_blank" rel="noopener noreferrer">#38042</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38184" target="_blank" rel="noopener noreferrer">#38184</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added background cleanup of subdirectories in <code>store/</code>. In some cases clickhouse-server might left garbage subdirectories in <code>store/</code> (for example, on unsuccessful table creation) and those dirs were never been removed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33710" target="_blank" rel="noopener noreferrer">#33710</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38265" target="_blank" rel="noopener noreferrer">#38265</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">Alexander Tokmakov</a>).</li><li>Add <code>DESCRIBE CACHE</code> query to show cache settings from config. Add <code>SHOW CACHES</code> query to show available filesystem caches list. <a href="https://github.com/ClickHouse/ClickHouse/pull/38279" target="_blank" rel="noopener noreferrer">#38279</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add access check for <code>system drop filesystem cache</code>. Support ON CLUSTER. <a href="https://github.com/ClickHouse/ClickHouse/pull/38319" target="_blank" rel="noopener noreferrer">#38319</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix PostgreSQL database engine incompatibility on upgrade from 21.3 to 22.3. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36659" target="_blank" rel="noopener noreferrer">#36659</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38369" target="_blank" rel="noopener noreferrer">#38369</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li><code>filesystemAvailable</code> and similar functions now work in <code>clickhouse-local</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38423" target="_blank" rel="noopener noreferrer">#38423</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38424" target="_blank" rel="noopener noreferrer">#38424</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add <code>revision</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/38555" target="_blank" rel="noopener noreferrer">#38555</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix GCS via proxy tunnel usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/38726" target="_blank" rel="noopener noreferrer">#38726</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support <code>\i file</code> in clickhouse client / local (similar to psql \i). <a href="https://github.com/ClickHouse/ClickHouse/pull/38813" target="_blank" rel="noopener noreferrer">#38813</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>New option <code>optimize = 1</code> in <code>EXPLAIN AST</code>. If enabled, it shows AST after it&#x27;s rewritten, otherwise AST of original query. Disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/38910" target="_blank" rel="noopener noreferrer">#38910</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Allow trailing comma in columns list. closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38425" target="_blank" rel="noopener noreferrer">#38425</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38440" target="_blank" rel="noopener noreferrer">#38440</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Bugfixes and performance improvements for <code>parallel_hash</code> JOIN method. <a href="https://github.com/ClickHouse/ClickHouse/pull/37648" target="_blank" rel="noopener noreferrer">#37648</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Support hadoop secure RPC transfer (hadoop.rpc.protection=privacy and hadoop.rpc.protection=integrity). <a href="https://github.com/ClickHouse/ClickHouse/pull/37852" target="_blank" rel="noopener noreferrer">#37852</a> (<a href="https://github.com/michael1589" target="_blank" rel="noopener noreferrer">Peng Liu</a>).</li><li>Add struct type support in <code>StorageHive</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38118" target="_blank" rel="noopener noreferrer">#38118</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>S3 single objects are now removed with <code>RemoveObjectRequest</code>. Implement compatibility with  GCP which did not allow to use <code>removeFileIfExists</code> effectively breaking approximately half of <code>remove</code> functionality. Automatic detection for <code>DeleteObjects</code> S3 API, that is not supported by GCS. This will allow to use GCS without explicit <code>support_batch_delete=0</code> in configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/37882" target="_blank" rel="noopener noreferrer">#37882</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Expose basic ClickHouse Keeper related monitoring data (via ProfileEvents and CurrentMetrics). <a href="https://github.com/ClickHouse/ClickHouse/pull/38072" target="_blank" rel="noopener noreferrer">#38072</a> (<a href="https://github.com/lingpeng0314" target="_blank" rel="noopener noreferrer">lingpeng0314</a>).</li><li>Support <code>auto_close</code> option for PostgreSQL engine connection. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31486" target="_blank" rel="noopener noreferrer">#31486</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38363" target="_blank" rel="noopener noreferrer">#38363</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allow <code>NULL</code> modifier in columns declaration for table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/38816" target="_blank" rel="noopener noreferrer">#38816</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Deactivate <code>mutations_finalizing_task</code> before shutdown to avoid benign <code>TABLE_IS_READ_ONLY</code> errors during shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/38851" target="_blank" rel="noopener noreferrer">#38851</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Eliminate unnecessary waiting of SELECT queries after ALTER queries in presence of INSERT queries if you use deprecated Ordinary databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/38864" target="_blank" rel="noopener noreferrer">#38864</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>New option <code>rewrite</code> in <code>EXPLAIN AST</code>. If enabled, it shows AST after it&#x27;s rewritten, otherwise AST of original query. Disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/38910" target="_blank" rel="noopener noreferrer">#38910</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Stop reporting Zookeeper &quot;Node exists&quot; exceptions in system.errors when they are expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/38961" target="_blank" rel="noopener noreferrer">#38961</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li><code>clickhouse-keeper</code>: add support for real-time digest calculation and verification. It is disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/37555" target="_blank" rel="noopener noreferrer">#37555</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Allow to specify globs <code>* or {expr1, expr2, expr3}</code> inside a key for <code>clickhouse-extract-from-config</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/38966" target="_blank" rel="noopener noreferrer">#38966</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>clearOldLogs: Don&#x27;t report KEEPER_EXCEPTION on concurrent deletes. <a href="https://github.com/ClickHouse/ClickHouse/pull/39016" target="_blank" rel="noopener noreferrer">#39016</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>clickhouse-keeper improvement: persist meta-information about keeper servers to disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/39069" target="_blank" rel="noopener noreferrer">#39069</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>). This will make it easier to operate if you shutdown or restart all keeper nodes at the same time.</li><li>Continue without exception when running out of disk space when using filesystem cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/39106" target="_blank" rel="noopener noreferrer">#39106</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Handling SIGTERM signals from k8s. <a href="https://github.com/ClickHouse/ClickHouse/pull/39130" target="_blank" rel="noopener noreferrer">#39130</a> (<a href="https://github.com/tsolodov" target="_blank" rel="noopener noreferrer">Timur Solodovnikov</a>).</li><li>Add <code>merge_algorithm</code> column (Undecided, Horizontal, Vertical) to system.part_log. <a href="https://github.com/ClickHouse/ClickHouse/pull/39181" target="_blank" rel="noopener noreferrer">#39181</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Don&#x27;t increment a counter in <code>system.errors</code> when the disk is not rotational. <a href="https://github.com/ClickHouse/ClickHouse/pull/39216" target="_blank" rel="noopener noreferrer">#39216</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>The metric <code>result_bytes</code> for <code>INSERT</code> queries in <code>system.query_log</code> shows number of bytes inserted. Previously value was incorrect and stored the same value as <code>result_rows</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39225" target="_blank" rel="noopener noreferrer">#39225</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>The CPU usage metric in clickhouse-client will be displayed in a better way. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38756" target="_blank" rel="noopener noreferrer">#38756</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39280" target="_blank" rel="noopener noreferrer">#39280</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Rethrow exception on filesystem cache initialization on server startup, better error message. <a href="https://github.com/ClickHouse/ClickHouse/pull/39386" target="_blank" rel="noopener noreferrer">#39386</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>OpenTelemetry now collects traces without Processors spans by default (there are too many). To enable Processors spans collection <code>opentelemetry_trace_processors</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/39170" target="_blank" rel="noopener noreferrer">#39170</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Functions <code>multiMatch[Fuzzy](AllIndices/Any/AnyIndex)</code> - don&#x27;t throw a logical error if the needle argument is empty. <a href="https://github.com/ClickHouse/ClickHouse/pull/39012" target="_blank" rel="noopener noreferrer">#39012</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Allow to declare <code>RabbitMQ</code> queue without default arguments <code>x-max-length</code> and <code>x-overflow</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39259" target="_blank" rel="noopener noreferrer">#39259</a> (<a href="https://github.com/rnbondarenko" target="_blank" rel="noopener noreferrer">rnbondarenko</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-5">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-5" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Apply Clang Thread Safety Analysis (TSA) annotations to ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/38068" target="_blank" rel="noopener noreferrer">#38068</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Adapt universal installation script for FreeBSD. <a href="https://github.com/ClickHouse/ClickHouse/pull/39302" target="_blank" rel="noopener noreferrer">#39302</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Preparation for building on <code>s390x</code> platform. <a href="https://github.com/ClickHouse/ClickHouse/pull/39193" target="_blank" rel="noopener noreferrer">#39193</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>Fix a bug in <code>jemalloc</code> library <a href="https://github.com/ClickHouse/ClickHouse/pull/38757" target="_blank" rel="noopener noreferrer">#38757</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Hardware benchmark now has support for automatic results uploading. <a href="https://github.com/ClickHouse/ClickHouse/pull/38427" target="_blank" rel="noopener noreferrer">#38427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>System table &quot;system.licenses&quot; is now correctly populated on Mac (Darwin). <a href="https://github.com/ClickHouse/ClickHouse/pull/38294" target="_blank" rel="noopener noreferrer">#38294</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Change <code>all|noarch</code> packages to architecture-dependent - Fix some documentation for it - Push aarch64|arm64 packages to artifactory and release assets - Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36443" target="_blank" rel="noopener noreferrer">#36443</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38580" target="_blank" rel="noopener noreferrer">#38580</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-3">Bug Fix (user-visible misbehavior in official stable or prestable release)<a href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-3" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)">​</a></h4><ul><li>Fix rounding for <code>Decimal128/Decimal256</code> with more than 19-digits long scale. <a href="https://github.com/ClickHouse/ClickHouse/pull/38027" target="_blank" rel="noopener noreferrer">#38027</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Fixed crash caused by data race in storage <code>Hive</code> (integration table engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/38887" target="_blank" rel="noopener noreferrer">#38887</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Fix crash when executing GRANT ALL ON <em>.</em> with ON CLUSTER. It was broken in <a href="https://github.com/ClickHouse/ClickHouse/pull/35767" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35767</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38618" target="_blank" rel="noopener noreferrer">#38618</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38674" target="_blank" rel="noopener noreferrer">#38674</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Correct glob expansion in case of <code>{0..10}</code> forms. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38498" target="_blank" rel="noopener noreferrer">#38498</a> Current Implementation is similar to what shell does mentiond by @rschu1ze <a href="https://github.com/ClickHouse/ClickHouse/pull/38502#issuecomment-1169057723" target="_blank" rel="noopener noreferrer">here</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38502" target="_blank" rel="noopener noreferrer">#38502</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>).</li><li>Fix crash for <code>mapUpdate</code>, <code>mapFilter</code> functions when using with constant map argument. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38547" target="_blank" rel="noopener noreferrer">#38547</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38553" target="_blank" rel="noopener noreferrer">#38553</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix <code>toHour</code> monotonicity information for query optimization which can lead to incorrect query result (incorrect index analysis). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38333" target="_blank" rel="noopener noreferrer">#38333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38675" target="_blank" rel="noopener noreferrer">#38675</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix checking whether s3 storage support parallel writes. It resulted in s3 parallel writes not working. <a href="https://github.com/ClickHouse/ClickHouse/pull/38792" target="_blank" rel="noopener noreferrer">#38792</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">chen</a>).</li><li>Fix s3 seekable reads with parallel read buffer. (Affected memory usage during query). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38258" target="_blank" rel="noopener noreferrer">#38258</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38802" target="_blank" rel="noopener noreferrer">#38802</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Update <code>simdjson</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38621" target="_blank" rel="noopener noreferrer">#38621</a> - a buffer overflow on machines with the latest Intel CPUs with AVX-512 VBMI. <a href="https://github.com/ClickHouse/ClickHouse/pull/38838" target="_blank" rel="noopener noreferrer">#38838</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix possible logical error for Vertical merges. <a href="https://github.com/ClickHouse/ClickHouse/pull/38859" target="_blank" rel="noopener noreferrer">#38859</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix settings profile with seconds unit. <a href="https://github.com/ClickHouse/ClickHouse/pull/38896" target="_blank" rel="noopener noreferrer">#38896</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix incorrect partition pruning when there is a nullable partition key. Note: most likely you don&#x27;t use nullable partition keys - this is an obscure feature you should not use. Nullable keys are a nonsense and this feature is only needed for some crazy use-cases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38941" target="_blank" rel="noopener noreferrer">#38941</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38946" target="_blank" rel="noopener noreferrer">#38946</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improve <code>fsync_part_directory</code> for fetches. <a href="https://github.com/ClickHouse/ClickHouse/pull/38993" target="_blank" rel="noopener noreferrer">#38993</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible dealock inside <code>OvercommitTracker</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37794" target="_blank" rel="noopener noreferrer">#37794</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39030" target="_blank" rel="noopener noreferrer">#39030</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix bug in filesystem cache that could happen in some corner case which coincided with cache capacity hitting the limit. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/39066" target="_blank" rel="noopener noreferrer">#39066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39070" target="_blank" rel="noopener noreferrer">#39070</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix some corner cases of interpretation of the arguments of window expressions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38538" target="_blank" rel="noopener noreferrer">#38538</a> Allow using of higher-order functions in window expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/39112" target="_blank" rel="noopener noreferrer">#39112</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Keep <code>LowCardinality</code> type in <code>tuple</code> function. Previously <code>LowCardinality</code> type was dropped and elements of created tuple had underlying type of <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39113" target="_blank" rel="noopener noreferrer">#39113</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error <code>Block structure mismatch</code> which could happen for INSERT into table with attached MATERIALIZED VIEW and enabled setting <code>extremes = 1</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29759" target="_blank" rel="noopener noreferrer">#29759</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/38729" target="_blank" rel="noopener noreferrer">#38729</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39125" target="_blank" rel="noopener noreferrer">#39125</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix unexpected query result when both <code>optimize_trivial_count_query</code> and <code>empty_result_for_aggregation_by_empty_set</code> are set to true. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/39140" target="_blank" rel="noopener noreferrer">#39140</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39155" target="_blank" rel="noopener noreferrer">#39155</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed error <code>Not found column Type in block</code> in selects with <code>PREWHERE</code> and read-in-order optimizations. <a href="https://github.com/ClickHouse/ClickHouse/pull/39157" target="_blank" rel="noopener noreferrer">#39157</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Fix extremely rare race condition in during hardlinks for remote filesystem. The only way to reproduce it is concurrent run of backups. <a href="https://github.com/ClickHouse/ClickHouse/pull/39190" target="_blank" rel="noopener noreferrer">#39190</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>(zero-copy replication is an experimental feature that should not be used in production) Fix fetch of in-memory part with <code>allow_remote_fs_zero_copy_replication</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39214" target="_blank" rel="noopener noreferrer">#39214</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>(MaterializedPostgreSQL - experimental feature). Fix segmentation fault in MaterializedPostgreSQL database engine, which could happen if some exception occurred at replication initialisation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36939" target="_blank" rel="noopener noreferrer">#36939</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39272" target="_blank" rel="noopener noreferrer">#39272</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix incorrect fetch of table metadata from PostgreSQL database engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33502" target="_blank" rel="noopener noreferrer">#33502</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/39283" target="_blank" rel="noopener noreferrer">#39283</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix projection exception when aggregation keys are wrapped inside other functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37151" target="_blank" rel="noopener noreferrer">#37151</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37155" target="_blank" rel="noopener noreferrer">#37155</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible logical error <code>... with argument with type Nothing and default implementation for Nothing is expected to return result with type Nothing, got ...</code> in some functions. Closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/37610" target="_blank" rel="noopener noreferrer">#37610</a> Closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/37741" target="_blank" rel="noopener noreferrer">#37741</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37759" target="_blank" rel="noopener noreferrer">#37759</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix incorrect columns order in subqueries of UNION (in case of duplicated columns in subselects may produce incorrect result). <a href="https://github.com/ClickHouse/ClickHouse/pull/37887" target="_blank" rel="noopener noreferrer">#37887</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect work of MODIFY ALTER Column with column names that contain dots. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37907" target="_blank" rel="noopener noreferrer">#37907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37971" target="_blank" rel="noopener noreferrer">#37971</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix reading of sparse columns from <code>MergeTree</code> tables that store their data in S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/37978" target="_blank" rel="noopener noreferrer">#37978</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible crash in <code>Distributed</code> async insert in case of removing a replica from config. <a href="https://github.com/ClickHouse/ClickHouse/pull/38029" target="_blank" rel="noopener noreferrer">#38029</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix &quot;Missing columns&quot; for GLOBAL JOIN with CTE without alias. <a href="https://github.com/ClickHouse/ClickHouse/pull/38056" target="_blank" rel="noopener noreferrer">#38056</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Rewrite tuple functions as literals in backwards-compatibility mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/38096" target="_blank" rel="noopener noreferrer">#38096</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Fix redundant memory reservation for output block during <code>ORDER BY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38127" target="_blank" rel="noopener noreferrer">#38127</a> (<a href="https://github.com/iyupeng" target="_blank" rel="noopener noreferrer">iyupeng</a>).</li><li>Fix possible logical error <code>Bad cast from type DB::IColumn* to DB::ColumnNullable*</code> in array mapped functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38006" target="_blank" rel="noopener noreferrer">#38006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38132" target="_blank" rel="noopener noreferrer">#38132</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix temporary name clash in partial merge join, close <a href="https://github.com/ClickHouse/ClickHouse/issues/37928" target="_blank" rel="noopener noreferrer">#37928</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38135" target="_blank" rel="noopener noreferrer">#38135</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Some minr issue with queries like <code>CREATE TABLE nested_name_tuples (</code>a<code> Tuple(x String, y Tuple(i Int32, j String))) ENGINE = Memory;</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/38136" target="_blank" rel="noopener noreferrer">#38136</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Fix bug with nested short-circuit functions that led to execution of arguments even if condition is false. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38040" target="_blank" rel="noopener noreferrer">#38040</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38173" target="_blank" rel="noopener noreferrer">#38173</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>(Window View is a experimental feature) Fix LOGICAL_ERROR for WINDOW VIEW with incorrect structure. <a href="https://github.com/ClickHouse/ClickHouse/pull/38205" target="_blank" rel="noopener noreferrer">#38205</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Update librdkafka submodule to fix crash when an OAUTHBEARER refresh callback is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/38225" target="_blank" rel="noopener noreferrer">#38225</a> (<a href="https://github.com/racevedoo" target="_blank" rel="noopener noreferrer">Rafael Acevedo</a>).</li><li>Fix INSERT into Distributed hung due to ProfileEvents. <a href="https://github.com/ClickHouse/ClickHouse/pull/38307" target="_blank" rel="noopener noreferrer">#38307</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix retries in PostgreSQL engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/38310" target="_blank" rel="noopener noreferrer">#38310</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix optimization in PartialSortingTransform (SIGSEGV and possible incorrect result). <a href="https://github.com/ClickHouse/ClickHouse/pull/38324" target="_blank" rel="noopener noreferrer">#38324</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix RabbitMQ with formats based on PeekableReadBuffer. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38061" target="_blank" rel="noopener noreferrer">#38061</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38356" target="_blank" rel="noopener noreferrer">#38356</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>MaterializedPostgreSQL - experimentail feature. Fix possible <code>Invalid number of rows in Chunk</code> in MaterializedPostgreSQL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37323" target="_blank" rel="noopener noreferrer">#37323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38360" target="_blank" rel="noopener noreferrer">#38360</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix RabbitMQ configuration with connection string setting. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36531" target="_blank" rel="noopener noreferrer">#36531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38365" target="_blank" rel="noopener noreferrer">#38365</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix PostgreSQL engine not using PostgreSQL schema when retrieving array dimension size. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36755" target="_blank" rel="noopener noreferrer">#36755</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36772" target="_blank" rel="noopener noreferrer">#36772</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38366" target="_blank" rel="noopener noreferrer">#38366</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possibly incorrect result of distributed queries with <code>DISTINCT</code> and <code>LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/38282" target="_blank" rel="noopener noreferrer">#38282</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38371" target="_blank" rel="noopener noreferrer">#38371</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong results of countSubstrings() &amp; position() on patterns with 0-bytes. <a href="https://github.com/ClickHouse/ClickHouse/pull/38589" target="_blank" rel="noopener noreferrer">#38589</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Now it&#x27;s possible to start a clickhouse-server and attach/detach tables even for tables with the incorrect values of IPv4/IPv6 representation. Proper fix for issue <a href="https://github.com/ClickHouse/ClickHouse/issues/35156" target="_blank" rel="noopener noreferrer">#35156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38590" target="_blank" rel="noopener noreferrer">#38590</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li><code>rankCorr</code> function will work correctly if some arguments are NaNs. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38396" target="_blank" rel="noopener noreferrer">#38396</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38722" target="_blank" rel="noopener noreferrer">#38722</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix <code>parallel_view_processing=1</code> with <code>optimize_trivial_insert_select=1</code>. Fix <code>max_insert_threads</code> while pushing to views. <a href="https://github.com/ClickHouse/ClickHouse/pull/38731" target="_blank" rel="noopener noreferrer">#38731</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix use-after-free for aggregate functions with <code>Map</code> combinator that leads to incorrect result. <a href="https://github.com/ClickHouse/ClickHouse/pull/38748" target="_blank" rel="noopener noreferrer">#38748</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-226-2022-06-16"><a id="226"></a> ClickHouse release 22.6, 2022-06-16<a href="#-clickhouse-release-226-2022-06-16" class="hash-link" aria-label="Direct link to -clickhouse-release-226-2022-06-16" title="Direct link to -clickhouse-release-226-2022-06-16">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-4">Backward Incompatible Change<a href="#backward-incompatible-change-4" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Remove support for octal number literals in SQL. In previous versions they were parsed as Float64. <a href="https://github.com/ClickHouse/ClickHouse/pull/37765" target="_blank" rel="noopener noreferrer">#37765</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Changes how settings using <code>seconds</code> as type are parsed to support floating point values (for example: <code>max_execution_time=0.5</code>). Infinity or NaN values will throw an exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/37187" target="_blank" rel="noopener noreferrer">#37187</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Changed format of binary serialization of columns of experimental type <code>Object</code>. New format is more convenient to implement by third-party clients. <a href="https://github.com/ClickHouse/ClickHouse/pull/37482" target="_blank" rel="noopener noreferrer">#37482</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Turn on setting <code>output_format_json_named_tuples_as_objects</code> by default. It allows to serialize named tuples as JSON objects in JSON formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/37756" target="_blank" rel="noopener noreferrer">#37756</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>LIKE patterns with trailing escape symbol (&#x27;<!-- -->\<!-- -->&#x27;) are now disallowed (as mandated by the SQL standard). <a href="https://github.com/ClickHouse/ClickHouse/pull/37764" target="_blank" rel="noopener noreferrer">#37764</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>If you run different ClickHouse versions on a cluster with AArch64 CPU or mix AArch64 and amd64 on a cluster, and use distributed queries with GROUP BY multiple keys of fixed-size type that fit in 256 bits but don&#x27;t fit in 64 bits, and the size of the result is huge, the data will not be fully aggregated in the result of these queries during upgrade. Workaround: upgrade with downtime instead of a rolling upgrade.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-6">New Feature<a href="#new-feature-6" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Add <code>GROUPING</code> function. It allows to disambiguate the records in the queries with <code>ROLLUP</code>, <code>CUBE</code> or <code>GROUPING SETS</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19426" target="_blank" rel="noopener noreferrer">#19426</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37163" target="_blank" rel="noopener noreferrer">#37163</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>A new codec <a href="https://userweb.cs.txstate.edu/~burtscher/papers/dcc07a.pdf" target="_blank" rel="noopener noreferrer">FPC</a> algorithm for floating point data compression. <a href="https://github.com/ClickHouse/ClickHouse/pull/37553" target="_blank" rel="noopener noreferrer">#37553</a> (<a href="https://github.com/koloshmet" target="_blank" rel="noopener noreferrer">Mikhail Guzov</a>).</li><li>Add new columnar JSON formats: <code>JSONColumns</code>, <code>JSONCompactColumns</code>, <code>JSONColumnsWithMetadata</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36338" target="_blank" rel="noopener noreferrer">#36338</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34509" target="_blank" rel="noopener noreferrer">#34509</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36975" target="_blank" rel="noopener noreferrer">#36975</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Added open telemetry traces visualizing tool based on d3js. <a href="https://github.com/ClickHouse/ClickHouse/pull/37810" target="_blank" rel="noopener noreferrer">#37810</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Support INSERTs into <code>system.zookeeper</code> table. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22130" target="_blank" rel="noopener noreferrer">#22130</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37596" target="_blank" rel="noopener noreferrer">#37596</a> (<a href="https://github.com/hanfei1991" target="_blank" rel="noopener noreferrer">Han Fei</a>).</li><li>Support non-constant pattern argument for <code>LIKE</code>, <code>ILIKE</code> and <code>match</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37251" target="_blank" rel="noopener noreferrer">#37251</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Executable user defined functions now support parameters. Example: <code>SELECT test_function(parameters)(arguments)</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37578" target="_blank" rel="noopener noreferrer">#37578</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37720" target="_blank" rel="noopener noreferrer">#37720</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>merge_reason</code> column to system.part_log table. <a href="https://github.com/ClickHouse/ClickHouse/pull/36912" target="_blank" rel="noopener noreferrer">#36912</a> (<a href="https://github.com/CheSema" target="_blank" rel="noopener noreferrer">Sema Checherinda</a>).</li><li>Add support for Maps and Records in Avro format. Add new setting <code>input_format_avro_null_as_default </code> that allow to insert null as default in Avro format. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18925" target="_blank" rel="noopener noreferrer">#18925</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37378" target="_blank" rel="noopener noreferrer">#37378</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32899" target="_blank" rel="noopener noreferrer">#32899</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37525" target="_blank" rel="noopener noreferrer">#37525</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add <code>clickhouse-disks</code> tool to introspect and operate on virtual filesystems configured for ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/36060" target="_blank" rel="noopener noreferrer">#36060</a> (<a href="https://github.com/Varinara" target="_blank" rel="noopener noreferrer">Artyom Yurkov</a>).</li><li>Adds H3 unidirectional edge functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/36843" target="_blank" rel="noopener noreferrer">#36843</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add support for calculating <a href="https://hashids.org/" target="_blank" rel="noopener noreferrer">hashids</a> from unsigned integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/37013" target="_blank" rel="noopener noreferrer">#37013</a> (<a href="https://github.com/mnutt" target="_blank" rel="noopener noreferrer">Michael Nutt</a>).</li><li>Explicit <code>SALT</code> specification is allowed for <code>CREATE USER &lt;user&gt; IDENTIFIED WITH sha256_hash</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37377" target="_blank" rel="noopener noreferrer">#37377</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Add two new settings <code>input_format_csv_skip_first_lines/input_format_tsv_skip_first_lines</code> to allow skipping specified number of lines in the beginning of the file in CSV/TSV formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/37537" target="_blank" rel="noopener noreferrer">#37537</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>showCertificate</code> function shows current server&#x27;s SSL certificate. <a href="https://github.com/ClickHouse/ClickHouse/pull/37540" target="_blank" rel="noopener noreferrer">#37540</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>HTTP source for Data Dictionaries in Named Collections is supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/37581" target="_blank" rel="noopener noreferrer">#37581</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Added a new window function <code>nonNegativeDerivative(metric_column, timestamp_column[, INTERVAL x SECOND])</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37628" target="_blank" rel="noopener noreferrer">#37628</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Implemented changing the comment for <code>ReplicatedMergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/37416" target="_blank" rel="noopener noreferrer">#37416</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Added <code>SYSTEM UNFREEZE</code> query that deletes the whole backup regardless if the corresponding table is deleted or not. <a href="https://github.com/ClickHouse/ClickHouse/pull/36424" target="_blank" rel="noopener noreferrer">#36424</a> (<a href="https://github.com/PolyProgrammist" target="_blank" rel="noopener noreferrer">Vadim Volodin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-5">Experimental Feature<a href="#experimental-feature-5" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Enables <code>POPULATE</code> for <code>WINDOW VIEW</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36945" target="_blank" rel="noopener noreferrer">#36945</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li><code>ALTER TABLE ... MODIFY QUERY</code> support for <code>WINDOW VIEW</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37188" target="_blank" rel="noopener noreferrer">#37188</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>This PR changes the behavior of the <code>ENGINE</code> syntax in <code>WINDOW VIEW</code>, to make it like in <code>MATERIALIZED VIEW</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37214" target="_blank" rel="noopener noreferrer">#37214</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-6">Performance Improvement<a href="#performance-improvement-6" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Added numerous optimizations for ARM NEON <a href="https://github.com/ClickHouse/ClickHouse/pull/38093" target="_blank" rel="noopener noreferrer">#38093</a>(<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Daniel Kutenin</a>), (<a href="https://github.com/chalice19" target="_blank" rel="noopener noreferrer">Alexandra Pilipyuk</a>) Note: if you run different ClickHouse versions on a cluster with ARM CPU and use distributed queries with GROUP BY multiple keys of fixed-size type that fit in 256 bits but don&#x27;t fit in 64 bits, the result of the aggregation query will be wrong during upgrade. Workaround: upgrade with downtime instead of a rolling upgrade.</li><li>Improve performance and memory usage for select of subset of columns for formats Native, Protobuf, CapnProto, JSONEachRow, TSKV, all formats with suffixes WithNames/WithNamesAndTypes. Previously while selecting only subset of columns from files in these formats all columns were read and stored in memory. Now only required columns are read. This PR enables setting <code>input_format_skip_unknown_fields</code> by default, because otherwise in case of select of subset of columns exception will be thrown. <a href="https://github.com/ClickHouse/ClickHouse/pull/37192" target="_blank" rel="noopener noreferrer">#37192</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now more filters can be pushed down for join. <a href="https://github.com/ClickHouse/ClickHouse/pull/37472" target="_blank" rel="noopener noreferrer">#37472</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Load marks for only necessary columns when reading wide parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/36879" target="_blank" rel="noopener noreferrer">#36879</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Improved performance of aggregation in case, when sparse columns (can be enabled by experimental setting <code>ratio_of_defaults_for_sparse_serialization</code> in <code>MergeTree</code> tables) are used as arguments in aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37617" target="_blank" rel="noopener noreferrer">#37617</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Optimize function <code>COALESCE</code> with two arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/37666" target="_blank" rel="noopener noreferrer">#37666</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Replace <code>multiIf</code> to <code>if</code> in case when <code>multiIf</code> has only one condition, because function <code>if</code> is more performant. <a href="https://github.com/ClickHouse/ClickHouse/pull/37695" target="_blank" rel="noopener noreferrer">#37695</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Improve performance of <code>dictGetDescendants</code>, <code>dictGetChildren</code> functions, create temporary parent to children hierarchical index per query, not per function call during query. Allow to specify <code>BIDIRECTIONAL</code> for <code>HIERARHICAL</code> attributes, dictionary will maintain parent to children index in memory, that way functions <code>dictGetDescendants</code>, <code>dictGetChildren</code> will not create temporary index per query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32481" target="_blank" rel="noopener noreferrer">#32481</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37148" target="_blank" rel="noopener noreferrer">#37148</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Aggregates state destruction now may be posted on a thread pool. For queries with LIMIT and big state it provides significant speedup, e.g. <code>select uniq(number) from numbers_mt(1e7) group by number limit 100</code> became around 2.5x faster. <a href="https://github.com/ClickHouse/ClickHouse/pull/37855" target="_blank" rel="noopener noreferrer">#37855</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Improve sort performance by single column. <a href="https://github.com/ClickHouse/ClickHouse/pull/37195" target="_blank" rel="noopener noreferrer">#37195</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of single column sorting using sorting queue specializations. <a href="https://github.com/ClickHouse/ClickHouse/pull/37990" target="_blank" rel="noopener noreferrer">#37990</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improved performance on array norm and distance functions 2x-4x times. <a href="https://github.com/ClickHouse/ClickHouse/pull/37394" target="_blank" rel="noopener noreferrer">#37394</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Improve performance of number comparison functions using dynamic dispatch. <a href="https://github.com/ClickHouse/ClickHouse/pull/37399" target="_blank" rel="noopener noreferrer">#37399</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of ORDER BY with LIMIT. <a href="https://github.com/ClickHouse/ClickHouse/pull/37481" target="_blank" rel="noopener noreferrer">#37481</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>hasAll</code> function using dynamic dispatch infrastructure. <a href="https://github.com/ClickHouse/ClickHouse/pull/37484" target="_blank" rel="noopener noreferrer">#37484</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>greatCircleAngle</code>, <code>greatCircleDistance</code>, <code>geoDistance</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37524" target="_blank" rel="noopener noreferrer">#37524</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of insert into MergeTree if there are multiple columns in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/35762" target="_blank" rel="noopener noreferrer">#35762</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix excessive CPU usage in background when there are a lot of tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/38028" target="_blank" rel="noopener noreferrer">#38028</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>not</code> function using dynamic dispatch. <a href="https://github.com/ClickHouse/ClickHouse/pull/38058" target="_blank" rel="noopener noreferrer">#38058</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Optimized the internal caching of re2 patterns which occur e.g. in LIKE and MATCH functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37544" target="_blank" rel="noopener noreferrer">#37544</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Improve filter bitmask generator function all in one with AVX-512 instructions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37588" target="_blank" rel="noopener noreferrer">#37588</a> (<a href="https://github.com/yaqi-zhao" target="_blank" rel="noopener noreferrer">yaqi-zhao</a>).</li><li>Apply read method <code>threadpool</code> for Hive integration engine. This will significantly speed up reading. <a href="https://github.com/ClickHouse/ClickHouse/pull/36328" target="_blank" rel="noopener noreferrer">#36328</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>When all the columns to read are partition keys, construct columns by the file&#x27;s row number without real reading the Hive file. <a href="https://github.com/ClickHouse/ClickHouse/pull/37103" target="_blank" rel="noopener noreferrer">#37103</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Support multi disks for caching hive files. <a href="https://github.com/ClickHouse/ClickHouse/pull/37279" target="_blank" rel="noopener noreferrer">#37279</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Limiting the maximum cache usage per query can effectively prevent cache pool contamination. <a href="https://github.com/ClickHouse/ClickHouse/issues/28961" target="_blank" rel="noopener noreferrer">Related Issues</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37859" target="_blank" rel="noopener noreferrer">#37859</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Currently clickhouse directly downloads all remote files to the local cache (even if they are only read once), which will frequently cause IO of the local hard disk. In some scenarios, these IOs may not be necessary and may easily cause negative optimization. As shown in the figure below, when we run SSB Q1-Q4, the performance of the cache has caused negative optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/37516" target="_blank" rel="noopener noreferrer">#37516</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Allow to prune the list of files via virtual columns such as <code>_file</code> and <code>_path</code> when reading from S3. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/37174" target="_blank" rel="noopener noreferrer">#37174</a> , <a href="https://github.com/ClickHouse/ClickHouse/issues/23494" target="_blank" rel="noopener noreferrer">#23494</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37356" target="_blank" rel="noopener noreferrer">#37356</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>In function: CompressedWriteBuffer::nextImpl(), there is an unnecessary write-copy step that would happen frequently during inserting data. Below shows the differentiation with this patch: - Before: 1. Compress &quot;working_buffer&quot; into &quot;compressed_buffer&quot; 2. write-copy into &quot;out&quot; - After: Directly Compress &quot;working_buffer&quot; into &quot;out&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/37242" target="_blank" rel="noopener noreferrer">#37242</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-6">Improvement<a href="#improvement-6" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Support types with non-standard defaults in ROLLUP, CUBE, GROUPING SETS. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37360" target="_blank" rel="noopener noreferrer">#37360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37667" target="_blank" rel="noopener noreferrer">#37667</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix stack traces collection on ARM. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37044" target="_blank" rel="noopener noreferrer">#37044</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15638" target="_blank" rel="noopener noreferrer">#15638</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37797" target="_blank" rel="noopener noreferrer">#37797</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Client will try every IP address returned by DNS resolution until successful connection. <a href="https://github.com/ClickHouse/ClickHouse/pull/37273" target="_blank" rel="noopener noreferrer">#37273</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Allow to use String type instead of Binary in Arrow/Parquet/ORC formats. This PR introduces 3 new settings for it: <code>output_format_arrow_string_as_string</code>, <code>output_format_parquet_string_as_string</code>, <code>output_format_orc_string_as_string</code>. Default value for all settings is <code>false</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37327" target="_blank" rel="noopener noreferrer">#37327</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Apply setting <code>input_format_max_rows_to_read_for_schema_inference</code> for all read rows in total from all files in globs. Previously setting <code>input_format_max_rows_to_read_for_schema_inference</code> was applied for each file in glob separately and in case of huge number of nulls we could read first <code>input_format_max_rows_to_read_for_schema_inference</code> rows from each file and get nothing. Also increase default value for this setting to 25000. <a href="https://github.com/ClickHouse/ClickHouse/pull/37332" target="_blank" rel="noopener noreferrer">#37332</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add separate <code>CLUSTER</code> grant (and <code>access_control_improvements.on_cluster_queries_require_cluster_grant</code> configuration directive, for backward compatibility, default to <code>false</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/35767" target="_blank" rel="noopener noreferrer">#35767</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added support for schema inference for <code>hdfsCluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35812" target="_blank" rel="noopener noreferrer">#35812</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Implement <code>least_used</code> load balancing algorithm for disks inside volume (multi disk configuration). <a href="https://github.com/ClickHouse/ClickHouse/pull/36686" target="_blank" rel="noopener noreferrer">#36686</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Modify the HTTP Endpoint to return the full stats under the <code>X-ClickHouse-Summary</code> header when <code>send_progress_in_http_headers=0</code> (before it would return all zeros). - Modify the HTTP Endpoint to return <code>X-ClickHouse-Exception-Code</code> header when progress has been sent before (<code>send_progress_in_http_headers=1</code>) - Modify the HTTP Endpoint to return <code>HTTP_REQUEST_TIMEOUT</code> (408) instead of <code>HTTP_INTERNAL_SERVER_ERROR</code> (500) on <code>TIMEOUT_EXCEEDED</code> errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/36884" target="_blank" rel="noopener noreferrer">#36884</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Allow a user to inspect grants from granted roles. <a href="https://github.com/ClickHouse/ClickHouse/pull/36941" target="_blank" rel="noopener noreferrer">#36941</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Do not calculate an integral numerically but use CDF functions instead. This will speed up execution and will increase the precision. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36714" target="_blank" rel="noopener noreferrer">#36714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36953" target="_blank" rel="noopener noreferrer">#36953</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add default implementation for Nothing in functions. Now most of the functions will return column with type Nothing in case one of it&#x27;s arguments is Nothing. It also solves problem with functions like arrayMap/arrayFilter and similar when they have empty array as an argument. Previously queries like <code>select arrayMap(x -&gt; 2 * x, []);</code> failed because function inside lambda cannot work with type <code>Nothing</code>, now such queries return empty array with type <code>Array(Nothing)</code>. Also add support for arrays of nullable types in functions like arrayFilter/arrayFill. Previously, queries like <code>select arrayFilter(x -&gt; x % 2, [1, NULL])</code> failed, now they work (if the result of lambda is NULL, then this value won&#x27;t be included in the result). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37000" target="_blank" rel="noopener noreferrer">#37000</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37048" target="_blank" rel="noopener noreferrer">#37048</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now if a shard has local replica we create a local plan and a plan to read from all remote replicas. They have shared initiator which coordinates reading. <a href="https://github.com/ClickHouse/ClickHouse/pull/37204" target="_blank" rel="noopener noreferrer">#37204</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Do no longer abort server startup if configuration option &quot;mark_cache_size&quot; is not explicitly set. <a href="https://github.com/ClickHouse/ClickHouse/pull/37326" target="_blank" rel="noopener noreferrer">#37326</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Allows providing <code>NULL</code>/<code>NOT NULL</code> right after type in column declaration. <a href="https://github.com/ClickHouse/ClickHouse/pull/37337" target="_blank" rel="noopener noreferrer">#37337</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>optimize file segment PARTIALLY_DOWNLOADED get read buffer. <a href="https://github.com/ClickHouse/ClickHouse/pull/37338" target="_blank" rel="noopener noreferrer">#37338</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">xiedeyantu</a>).</li><li>Try to improve short circuit functions processing to fix problems with stress tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/37384" target="_blank" rel="noopener noreferrer">#37384</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37395" target="_blank" rel="noopener noreferrer">#37395</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37415" target="_blank" rel="noopener noreferrer">#37415</a> (<a href="https://github.com/Joeywzr" target="_blank" rel="noopener noreferrer">Memo</a>).</li><li>Fix extremely rare deadlock during part fetch in zero-copy replication. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37423" target="_blank" rel="noopener noreferrer">#37423</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37424" target="_blank" rel="noopener noreferrer">#37424</a> (<a href="https://github.com/metahys" target="_blank" rel="noopener noreferrer">metahys</a>).</li><li>Don&#x27;t allow to create storage with unknown data format. <a href="https://github.com/ClickHouse/ClickHouse/pull/37450" target="_blank" rel="noopener noreferrer">#37450</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Set <code>global_memory_usage_overcommit_max_wait_microseconds</code> default value to 5 seconds. Add info about <code>OvercommitTracker</code> to OOM exception message. Add <code>MemoryOvercommitWaitTimeMicroseconds</code> profile event. <a href="https://github.com/ClickHouse/ClickHouse/pull/37460" target="_blank" rel="noopener noreferrer">#37460</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Do not display <code>-0.0</code> CPU time in clickhouse-client. It can appear due to rounding errors. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38003" target="_blank" rel="noopener noreferrer">#38003</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/38038" target="_blank" rel="noopener noreferrer">#38038</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38064" target="_blank" rel="noopener noreferrer">#38064</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Play UI: Keep controls in place when the page is scrolled horizontally. This makes edits comfortable even if the table is wide and it was scrolled far to the right. The feature proposed by Maksym Tereshchenko from CaspianDB. <a href="https://github.com/ClickHouse/ClickHouse/pull/37470" target="_blank" rel="noopener noreferrer">#37470</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Modify query div in play.html to be extendable beyond 20% height. In case of very long queries it is helpful to extend the textarea element, only today, since the div is fixed height, the extended textarea hides the data div underneath. With this fix, extending the textarea element will push the data div down/up such the extended textarea won&#x27;t hide it. Also, keeps query box width 100% even when the user adjusting the size of the query textarea. <a href="https://github.com/ClickHouse/ClickHouse/pull/37488" target="_blank" rel="noopener noreferrer">#37488</a> (<a href="https://github.com/guyco87" target="_blank" rel="noopener noreferrer">guyco87</a>).</li><li>Added <code>ProfileEvents</code> for introspection of type of written (inserted or merged) parts (<code>Inserted{Wide/Compact/InMemory}Parts</code>, <code>MergedInto{Wide/Compact/InMemory}Parts</code>. Added column <code>part_type</code> to <code>system.part_log</code>. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/37495" target="_blank" rel="noopener noreferrer">#37495</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37536" target="_blank" rel="noopener noreferrer">#37536</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>clickhouse-keeper improvement: move broken logs to a timestamped folder. <a href="https://github.com/ClickHouse/ClickHouse/pull/37565" target="_blank" rel="noopener noreferrer">#37565</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Do not write expired columns by TTL after subsequent merges (before only first merge/optimize of the part will not write expired by TTL columns, all other will do). <a href="https://github.com/ClickHouse/ClickHouse/pull/37570" target="_blank" rel="noopener noreferrer">#37570</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>More precise result of the <code>dumpColumnStructure</code> miscellaneous function in presence of LowCardinality or Sparse columns. In previous versions, these functions were converting the argument to a full column before returning the result. This is needed to provide an answer in <a href="https://github.com/ClickHouse/ClickHouse/issues/6935" target="_blank" rel="noopener noreferrer">#6935</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37633" target="_blank" rel="noopener noreferrer">#37633</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>clickhouse-keeper: store only unique session IDs for watches. <a href="https://github.com/ClickHouse/ClickHouse/pull/37641" target="_blank" rel="noopener noreferrer">#37641</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible &quot;Cannot write to finalized buffer&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/37645" target="_blank" rel="noopener noreferrer">#37645</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add setting <code>support_batch_delete</code> for <code>DiskS3</code> to disable multiobject delete calls, which Google Cloud Storage doesn&#x27;t support. <a href="https://github.com/ClickHouse/ClickHouse/pull/37659" target="_blank" rel="noopener noreferrer">#37659</a> (<a href="https://github.com/frew" target="_blank" rel="noopener noreferrer">Fred Wulff</a>).</li><li>Add an option to disable connection pooling in ODBC bridge. <a href="https://github.com/ClickHouse/ClickHouse/pull/37705" target="_blank" rel="noopener noreferrer">#37705</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Functions <code>dictGetHierarchy</code>, <code>dictIsIn</code>, <code>dictGetChildren</code>, <code>dictGetDescendants</code> added support nullable <code>HIERARCHICAL</code> attribute in dictionaries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35521" target="_blank" rel="noopener noreferrer">#35521</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37805" target="_blank" rel="noopener noreferrer">#37805</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Expose BoringSSL version related info in the <code>system.build_options</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/37850" target="_blank" rel="noopener noreferrer">#37850</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Now clickhouse-server removes <code>delete_tmp</code> directories on server start. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26503" target="_blank" rel="noopener noreferrer">#26503</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37906" target="_blank" rel="noopener noreferrer">#37906</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Clean up broken detached parts after timeout. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25195" target="_blank" rel="noopener noreferrer">#25195</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37975" target="_blank" rel="noopener noreferrer">#37975</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Now in MergeTree table engines family failed-to-move parts will be removed instantly. <a href="https://github.com/ClickHouse/ClickHouse/pull/37994" target="_blank" rel="noopener noreferrer">#37994</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now if setting <code>always_fetch_merged_part</code> is enabled for ReplicatedMergeTree merges will try to find parts on other replicas rarely with smaller load for <!-- -->[Zoo]<!-- -->Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/37995" target="_blank" rel="noopener noreferrer">#37995</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add implicit grants with grant option too. For example <code>GRANT CREATE TABLE ON test.* TO A WITH GRANT OPTION</code> now allows <code>A</code> to execute <code>GRANT CREATE VIEW ON test.* TO B</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/38017" target="_blank" rel="noopener noreferrer">#38017</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-6">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-6" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Use <code>clang-14</code> and LLVM infrastructure version 14 for builds. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34681" target="_blank" rel="noopener noreferrer">#34681</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34754" target="_blank" rel="noopener noreferrer">#34754</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>). Note: <code>clang-14</code> has <a href="https://github.com/google/sanitizers/issues/1540" target="_blank" rel="noopener noreferrer">a bug</a> in ThreadSanitizer that makes our CI work worse.</li><li>Allow to drop privileges at startup. This simplifies Docker images. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36293" target="_blank" rel="noopener noreferrer">#36293</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36341" target="_blank" rel="noopener noreferrer">#36341</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add docs spellcheck to CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/37790" target="_blank" rel="noopener noreferrer">#37790</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix overly aggressive stripping which removed the embedded hash required for checking the consistency of the executable. <a href="https://github.com/ClickHouse/ClickHouse/pull/37993" target="_blank" rel="noopener noreferrer">#37993</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-2">Bug Fix<a href="#bug-fix-2" class="hash-link" aria-label="Direct link to Bug Fix" title="Direct link to Bug Fix">​</a></h4><ul><li>Fix <code>SELECT ... INTERSECT</code> and <code>EXCEPT SELECT</code> statements with constant string types. <a href="https://github.com/ClickHouse/ClickHouse/pull/37738" target="_blank" rel="noopener noreferrer">#37738</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix <code>GROUP BY</code> <code>AggregateFunction</code> (i.e. you <code>GROUP BY</code> by the column that has <code>AggregateFunction</code> type). <a href="https://github.com/ClickHouse/ClickHouse/pull/37093" target="_blank" rel="noopener noreferrer">#37093</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>(experimental WINDOW VIEW) Fix <code>addDependency</code> in WindowView. This bug can be reproduced like <a href="https://github.com/ClickHouse/ClickHouse/issues/37237" target="_blank" rel="noopener noreferrer">#37237</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37224" target="_blank" rel="noopener noreferrer">#37224</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix inconsistency in ORDER BY ... WITH FILL feature. Query, containing ORDER BY ... WITH FILL, can generate extra rows when multiple WITH FILL columns are present. <a href="https://github.com/ClickHouse/ClickHouse/pull/38074" target="_blank" rel="noopener noreferrer">#38074</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>This PR moving <code>addDependency</code> from constructor to <code>startup()</code> to avoid adding dependency to a <em>dropped</em> table, fix <a href="https://github.com/ClickHouse/ClickHouse/issues/37237" target="_blank" rel="noopener noreferrer">#37237</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37243" target="_blank" rel="noopener noreferrer">#37243</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix inserting defaults for missing values in columnar formats. Previously missing columns were filled with defaults for types, not for columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/37253" target="_blank" rel="noopener noreferrer">#37253</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>(experimental Object type) Fix some cases of insertion nested arrays to columns of type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37305" target="_blank" rel="noopener noreferrer">#37305</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix unexpected errors with a clash of constant strings in aggregate function, prewhere and join. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/36891" target="_blank" rel="noopener noreferrer">#36891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37336" target="_blank" rel="noopener noreferrer">#37336</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix projections with GROUP/ORDER BY in query and optimize_aggregation_in_order (before the result was incorrect since only finish sorting was performed). <a href="https://github.com/ClickHouse/ClickHouse/pull/37342" target="_blank" rel="noopener noreferrer">#37342</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed error with symbols in key name in S3. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33009" target="_blank" rel="noopener noreferrer">#33009</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37344" target="_blank" rel="noopener noreferrer">#37344</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Throw an exception when GROUPING SETS used with ROLLUP or CUBE. <a href="https://github.com/ClickHouse/ClickHouse/pull/37367" target="_blank" rel="noopener noreferrer">#37367</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix LOGICAL_ERROR in getMaxSourcePartsSizeForMerge during merges (in case of non standard, greater, values of <code>background_pool_size</code>/<code>background_merges_mutations_concurrency_ratio</code> has been specified in <code>config.xml</code> (new way) not in <code>users.xml</code> (deprecated way)). <a href="https://github.com/ClickHouse/ClickHouse/pull/37413" target="_blank" rel="noopener noreferrer">#37413</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Stop removing UTF-8 BOM in RowBinary format. <a href="https://github.com/ClickHouse/ClickHouse/pull/37428" target="_blank" rel="noopener noreferrer">#37428</a> (<a href="https://github.com/loyd" target="_blank" rel="noopener noreferrer">Paul Loyd</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/37428" target="_blank" rel="noopener noreferrer">#37428</a> (<a href="https://github.com/loyd" target="_blank" rel="noopener noreferrer">Paul Loyd</a>).</li><li>clickhouse-keeper bugfix: fix force recovery for single node cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/37440" target="_blank" rel="noopener noreferrer">#37440</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix logical error in normalizeUTF8 functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37298" target="_blank" rel="noopener noreferrer">#37298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37443" target="_blank" rel="noopener noreferrer">#37443</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix cast lowcard of nullable in JoinSwitcher, close <a href="https://github.com/ClickHouse/ClickHouse/issues/37385" target="_blank" rel="noopener noreferrer">#37385</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37453" target="_blank" rel="noopener noreferrer">#37453</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix named tuples output in ORC/Arrow/Parquet formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/37458" target="_blank" rel="noopener noreferrer">#37458</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix optimization of monotonous functions in ORDER BY clause in presence of GROUPING SETS. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37401" target="_blank" rel="noopener noreferrer">#37401</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37493" target="_blank" rel="noopener noreferrer">#37493</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix error on joining with dictionary on some conditions. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/37386" target="_blank" rel="noopener noreferrer">#37386</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37530" target="_blank" rel="noopener noreferrer">#37530</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Prohibit <code>optimize_aggregation_in_order</code> with <code>GROUPING SETS</code> (fixes <code>LOGICAL_ERROR</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/37542" target="_blank" rel="noopener noreferrer">#37542</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong dump information of ActionsDAG. <a href="https://github.com/ClickHouse/ClickHouse/pull/37587" target="_blank" rel="noopener noreferrer">#37587</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Fix converting types for UNION queries (may produce LOGICAL_ERROR). <a href="https://github.com/ClickHouse/ClickHouse/pull/37593" target="_blank" rel="noopener noreferrer">#37593</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>WITH FILL</code> modifier with negative intervals in <code>STEP</code> clause. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37514" target="_blank" rel="noopener noreferrer">#37514</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37600" target="_blank" rel="noopener noreferrer">#37600</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix illegal joinGet array usage when <code> join_use_nulls = 1</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37562" target="_blank" rel="noopener noreferrer">#37562</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/37650" target="_blank" rel="noopener noreferrer">#37650</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix columns number mismatch in cross join, close <a href="https://github.com/ClickHouse/ClickHouse/issues/37561" target="_blank" rel="noopener noreferrer">#37561</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37653" target="_blank" rel="noopener noreferrer">#37653</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix segmentation fault in <code>show create table</code> from mysql database when it is configured with named collections. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37683" target="_blank" rel="noopener noreferrer">#37683</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37690" target="_blank" rel="noopener noreferrer">#37690</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix RabbitMQ Storage not being able to startup on server restart if storage was create without SETTINGS clause. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37463" target="_blank" rel="noopener noreferrer">#37463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37691" target="_blank" rel="noopener noreferrer">#37691</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>SQL user defined functions disable CREATE/DROP in readonly mode. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37280" target="_blank" rel="noopener noreferrer">#37280</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37699" target="_blank" rel="noopener noreferrer">#37699</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix formatting of Nullable arguments for executable user defined functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35897" target="_blank" rel="noopener noreferrer">#35897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37711" target="_blank" rel="noopener noreferrer">#37711</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix optimization enabled by setting <code>optimize_monotonous_functions_in_order_by</code> in distributed queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36037" target="_blank" rel="noopener noreferrer">#36037</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37724" target="_blank" rel="noopener noreferrer">#37724</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible logical error: <code>Invalid Field get from type UInt64 to type Float64</code> in <code>values</code> table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37602" target="_blank" rel="noopener noreferrer">#37602</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37754" target="_blank" rel="noopener noreferrer">#37754</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible segfault in schema inference in case of exception in SchemaReader constructor. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37680" target="_blank" rel="noopener noreferrer">#37680</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37760" target="_blank" rel="noopener noreferrer">#37760</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix setting cast_ipv4_ipv6_default_on_conversion_error for internal cast function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35156" target="_blank" rel="noopener noreferrer">#35156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37761" target="_blank" rel="noopener noreferrer">#37761</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix toString error on DatatypeDate32. <a href="https://github.com/ClickHouse/ClickHouse/pull/37775" target="_blank" rel="noopener noreferrer">#37775</a> (<a href="https://github.com/liuneng1994" target="_blank" rel="noopener noreferrer">LiuNeng</a>).</li><li>The clickhouse-keeper setting <code>dead_session_check_period_ms</code> was transformed into microseconds (multiplied by 1000), which lead to dead sessions only being cleaned up after several minutes (instead of 500ms). <a href="https://github.com/ClickHouse/ClickHouse/pull/37824" target="_blank" rel="noopener noreferrer">#37824</a> (<a href="https://github.com/mlex" target="_blank" rel="noopener noreferrer">Michael Lex</a>).</li><li>Fix possible &quot;No more packets are available&quot; for distributed queries (in case of <code>async_socket_for_remote</code>/<code>use_hedged_requests</code> is disabled). <a href="https://github.com/ClickHouse/ClickHouse/pull/37826" target="_blank" rel="noopener noreferrer">#37826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>(experimental WINDOW VIEW) Do not drop the inner target table when executing <code>ALTER TABLE … MODIFY QUERY</code> in WindowView. <a href="https://github.com/ClickHouse/ClickHouse/pull/37879" target="_blank" rel="noopener noreferrer">#37879</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix directory ownership of coordination dir in clickhouse-keeper Docker image. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37914" target="_blank" rel="noopener noreferrer">#37914</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37915" target="_blank" rel="noopener noreferrer">#37915</a> (<a href="https://github.com/jamesmaidment" target="_blank" rel="noopener noreferrer">James Maidment</a>).</li><li>Dictionaries fix custom query with update field and <code>{condition}</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33746" target="_blank" rel="noopener noreferrer">#33746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37947" target="_blank" rel="noopener noreferrer">#37947</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible incorrect result of <code>SELECT ... WITH FILL</code> in the case when <code>ORDER BY</code> should be applied after <code>WITH FILL</code> result (e.g. for outer query). Incorrect result was caused by optimization for <code>ORDER BY</code> expressions (<a href="https://github.com/ClickHouse/ClickHouse/issues/35623" target="_blank" rel="noopener noreferrer">#35623</a>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37904" target="_blank" rel="noopener noreferrer">#37904</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37959" target="_blank" rel="noopener noreferrer">#37959</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>(experimental WINDOW VIEW) Add missing default columns when pushing to the target table in WindowView, fix <a href="https://github.com/ClickHouse/ClickHouse/issues/37815" target="_blank" rel="noopener noreferrer">#37815</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37965" target="_blank" rel="noopener noreferrer">#37965</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fixed too large stack frame that would cause compilation to fail. <a href="https://github.com/ClickHouse/ClickHouse/pull/37996" target="_blank" rel="noopener noreferrer">#37996</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>When open enable_filesystem_query_cache_limit, throw Reserved cache size exceeds the remaining cache size. <a href="https://github.com/ClickHouse/ClickHouse/pull/38004" target="_blank" rel="noopener noreferrer">#38004</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">xiedeyantu</a>).</li><li>Fix converting types for UNION queries (may produce LOGICAL_ERROR). <a href="https://github.com/ClickHouse/ClickHouse/pull/34775" target="_blank" rel="noopener noreferrer">#34775</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>TTL merge may not be scheduled again if BackgroundExecutor is busy. --merges_with_ttl_counter is increased in selectPartsToMerge() --merge task will be ignored if BackgroundExecutor is busy --merges_with_ttl_counter will not be decrease. <a href="https://github.com/ClickHouse/ClickHouse/pull/36387" target="_blank" rel="noopener noreferrer">#36387</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Fix overridden settings value of <code>normalize_function_names</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36937" target="_blank" rel="noopener noreferrer">#36937</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Fix for exponential time decaying window functions. Now respecting boundaries of the window. <a href="https://github.com/ClickHouse/ClickHouse/pull/36944" target="_blank" rel="noopener noreferrer">#36944</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix possible heap-use-after-free error when reading system.projection_parts and system.projection_parts_columns . This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37184" target="_blank" rel="noopener noreferrer">#37184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37185" target="_blank" rel="noopener noreferrer">#37185</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>DateTime64</code> fractional seconds behavior prior to Unix epoch. <a href="https://github.com/ClickHouse/ClickHouse/pull/37697" target="_blank" rel="noopener noreferrer">#37697</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/37039" target="_blank" rel="noopener noreferrer">#37039</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-225-2022-05-19"><a id="225"></a> ClickHouse release 22.5, 2022-05-19<a href="#-clickhouse-release-225-2022-05-19" class="hash-link" aria-label="Direct link to -clickhouse-release-225-2022-05-19" title="Direct link to -clickhouse-release-225-2022-05-19">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes-2">Upgrade Notes<a href="#upgrade-notes-2" class="hash-link" aria-label="Direct link to Upgrade Notes" title="Direct link to Upgrade Notes">​</a></h4><ul><li>Now, background merges, mutations and <code>OPTIMIZE</code> will not increment <code>SelectedRows</code> and <code>SelectedBytes</code> metrics. They (still) will increment <code>MergedRows</code> and <code>MergedUncompressedBytes</code> as it was before. This only affects the metric values, and makes them better. This change does not introduce any incompatibility, but you may wonder about the changes of metrics, so we put in this category. <a href="https://github.com/ClickHouse/ClickHouse/pull/37040" target="_blank" rel="noopener noreferrer">#37040</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Updated the BoringSSL module to the official FIPS compliant version. This makes ClickHouse FIPS compliant. <a href="https://github.com/ClickHouse/ClickHouse/pull/35914" target="_blank" rel="noopener noreferrer">#35914</a> (<a href="https://github.com/Meena-Renganathan" target="_blank" rel="noopener noreferrer">Meena-Renganathan</a>). The ciphers <code>aes-192-cfb128</code> and <code>aes-256-cfb128</code> were removed, because they are not included in the FIPS certified version of BoringSSL.</li><li><code>max_memory_usage</code> setting is removed from the default user profile in <code>users.xml</code>. This enables flexible memory limits for queries instead of the old rigid limit of 10 GB.</li><li>Disable <code>log_query_threads</code> setting by default. It controls the logging of statistics about every thread participating in query execution. After supporting asynchronous reads, the total number of distinct thread ids became too large, and logging into the <code>query_thread_log</code> has become too heavy. <a href="https://github.com/ClickHouse/ClickHouse/pull/37077" target="_blank" rel="noopener noreferrer">#37077</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Remove function <code>groupArraySorted</code> which has a bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/36822" target="_blank" rel="noopener noreferrer">#36822</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-7">New Feature<a href="#new-feature-7" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Enable memory overcommit by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/35921" target="_blank" rel="noopener noreferrer">#35921</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add support of GROUPING SETS in GROUP BY clause. This implementation supports a parallel processing of grouping sets. <a href="https://github.com/ClickHouse/ClickHouse/pull/33631" target="_blank" rel="noopener noreferrer">#33631</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Added <code>system.certificates</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/37142" target="_blank" rel="noopener noreferrer">#37142</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Adds <code>h3Line</code>, <code>h3Distance</code> and <code>h3HexRing</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37030" target="_blank" rel="noopener noreferrer">#37030</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>New single binary based diagnostics tool (clickhouse-diagnostics). <a href="https://github.com/ClickHouse/ClickHouse/pull/36705" target="_blank" rel="noopener noreferrer">#36705</a> (<a href="https://github.com/gingerwizard" target="_blank" rel="noopener noreferrer">Dale McDiarmid</a>).</li><li>Add output format <code>Prometheus</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/36051" target="_blank" rel="noopener noreferrer">#36051</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36206" target="_blank" rel="noopener noreferrer">#36206</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add <code>MySQLDump</code> input format. It reads all data from INSERT queries belonging to one table in dump. If there are more than one table, by default it reads data from the first one. <a href="https://github.com/ClickHouse/ClickHouse/pull/36667" target="_blank" rel="noopener noreferrer">#36667</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Show the <code>total_rows</code> and <code>total_bytes</code> fields in <code>system.tables</code> for temporary tables. <a href="https://github.com/ClickHouse/ClickHouse/issues/36401" target="_blank" rel="noopener noreferrer">#36401</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36439" target="_blank" rel="noopener noreferrer">#36439</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">xiedeyantu</a>).</li><li>Allow to override <code>parts_to_delay_insert</code> and <code>parts_to_throw_insert</code> with query-level settings. If they are defined, they will override table-level settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/36371" target="_blank" rel="noopener noreferrer">#36371</a> (<a href="https://github.com/Joeywzr" target="_blank" rel="noopener noreferrer">Memo</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-6">Experimental Feature<a href="#experimental-feature-6" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Implemented L1, L2, Linf, Cosine distance functions for arrays and L1, L2, Linf norm functions for arrays.
<a href="https://github.com/ClickHouse/ClickHouse/pull/37033" target="_blank" rel="noopener noreferrer">#37033</a> (<a href="https://github.com/qieqieplus" target="_blank" rel="noopener noreferrer">qieqieplus</a>). Caveat: the functions will be renamed.</li><li>Improve the <code>WATCH</code> query in WindowView: 1. Reduce the latency of providing query results by calling the <code>fire_condition</code> signal. 2. Makes the cancel query operation(ctrl-c) faster, by checking <code>isCancelled()</code> more frequently. <a href="https://github.com/ClickHouse/ClickHouse/pull/37226" target="_blank" rel="noopener noreferrer">#37226</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Introspection for remove filesystem cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/36802" target="_blank" rel="noopener noreferrer">#36802</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Added new hash function <code>wyHash64</code> for SQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/36467" target="_blank" rel="noopener noreferrer">#36467</a> (<a href="https://github.com/olevino" target="_blank" rel="noopener noreferrer">olevino</a>).</li><li>Improvement for replicated databases: Added <code>SYSTEM SYNC DATABASE REPLICA</code> query which allows to sync tables metadata inside Replicated database, because currently synchronisation is asynchronous. <a href="https://github.com/ClickHouse/ClickHouse/pull/35944" target="_blank" rel="noopener noreferrer">#35944</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Improvement for remote filesystem cache: Better read from cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/37054" target="_blank" rel="noopener noreferrer">#37054</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Improve <code>SYSTEM DROP FILESYSTEM CACHE</code> query: <code>&lt;path&gt;</code> option and <code>FORCE</code> option. <a href="https://github.com/ClickHouse/ClickHouse/pull/36639" target="_blank" rel="noopener noreferrer">#36639</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Improvement for semistructured data: Allow to cast columns of type <code>Object(...)</code> to <code>Object(Nullable(...))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36564" target="_blank" rel="noopener noreferrer">#36564</a> (<a href="https://github.com/awakeljw" target="_blank" rel="noopener noreferrer">awakeljw</a>).</li><li>Improvement for parallel replicas: We create a local interpreter if we want to execute query on localhost replica. But for when executing query on multiple replicas we rely on the fact that a connection exists so replicas can talk to coordinator. It is now improved and localhost replica can talk to coordinator directly in the same process. <a href="https://github.com/ClickHouse/ClickHouse/pull/36281" target="_blank" rel="noopener noreferrer">#36281</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-7">Performance Improvement<a href="#performance-improvement-7" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Improve performance of <code>avg</code>, <code>sum</code> aggregate functions if used without GROUP BY expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/37257" target="_blank" rel="noopener noreferrer">#37257</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of unary arithmetic functions (<code>bitCount</code>, <code>bitNot</code>, <code>abs</code>, <code>intExp2</code>, <code>intExp10</code>, <code>negate</code>, <code>roundAge</code>, <code>roundDuration</code>, <code>roundToExp2</code>, <code>sign</code>) using dynamic dispatch. <a href="https://github.com/ClickHouse/ClickHouse/pull/37289" target="_blank" rel="noopener noreferrer">#37289</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of ORDER BY, MergeJoin, insertion into MergeTree using JIT compilation of sort columns comparator. <a href="https://github.com/ClickHouse/ClickHouse/pull/34469" target="_blank" rel="noopener noreferrer">#34469</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Change structure of <code>system.asynchronous_metric_log</code>. It will take about 10 times less space. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36357" target="_blank" rel="noopener noreferrer">#36357</a>. The field <code>event_time_microseconds</code> was removed, because it is useless. <a href="https://github.com/ClickHouse/ClickHouse/pull/36360" target="_blank" rel="noopener noreferrer">#36360</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Load marks for only necessary columns when reading wide parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/36879" target="_blank" rel="noopener noreferrer">#36879</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Improves performance of file descriptor cache by narrowing mutex scopes. <a href="https://github.com/ClickHouse/ClickHouse/pull/36682" target="_blank" rel="noopener noreferrer">#36682</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Improve performance of reading from storage <code>File</code> and table functions <code>file</code> in case when path has globs and matched directory contains large number of files. <a href="https://github.com/ClickHouse/ClickHouse/pull/36647" target="_blank" rel="noopener noreferrer">#36647</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Apply parallel parsing for input format <code>HiveText</code>, which can speed up HiveText parsing by 2x when reading local file. <a href="https://github.com/ClickHouse/ClickHouse/pull/36650" target="_blank" rel="noopener noreferrer">#36650</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>The default <code>HashJoin</code> is not thread safe for inserting right table&#x27;s rows and run it in a single thread. When the right table is large, the join process is too slow with low cpu utilization. <a href="https://github.com/ClickHouse/ClickHouse/pull/36415" target="_blank" rel="noopener noreferrer">#36415</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Allow to rewrite <code>select countDistinct(a) from t</code> to <code>select count(1) from (select a from t groupBy a)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35993" target="_blank" rel="noopener noreferrer">#35993</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Transform OR LIKE chain to multiMatchAny. Will enable once we have more confidence it works. <a href="https://github.com/ClickHouse/ClickHouse/pull/34932" target="_blank" rel="noopener noreferrer">#34932</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Daniel Kutenin</a>).</li><li>Improve performance of some functions with inlining. <a href="https://github.com/ClickHouse/ClickHouse/pull/34544" target="_blank" rel="noopener noreferrer">#34544</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Daniel Kutenin</a>).</li><li>Add a branch to avoid unnecessary memcpy in readBig. It improves performance somewhat. <a href="https://github.com/ClickHouse/ClickHouse/pull/36095" target="_blank" rel="noopener noreferrer">#36095</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>).</li><li>Implement partial GROUP BY key for optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/35111" target="_blank" rel="noopener noreferrer">#35111</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-7">Improvement<a href="#improvement-7" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Show names of erroneous files in case of parsing errors while executing table functions <code>file</code>, <code>s3</code> and <code>url</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36314" target="_blank" rel="noopener noreferrer">#36314</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allowed to increase the number of threads for executing background operations (merges, mutations, moves and fetches) at runtime if they are specified at top level config. <a href="https://github.com/ClickHouse/ClickHouse/pull/36425" target="_blank" rel="noopener noreferrer">#36425</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Now date time conversion functions that generates time before 1970-01-01 00:00:00 with partial hours/minutes timezones will be saturated to zero instead of overflow. This is the continuation of <a href="https://github.com/ClickHouse/ClickHouse/pull/29953" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/29953</a> which addresses <a href="https://github.com/ClickHouse/ClickHouse/pull/29953#discussion_r800550280" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/29953#discussion_r800550280</a> . Mark as improvement because it&#x27;s implementation defined behavior (and very rare case) and we are allowed to break it. <a href="https://github.com/ClickHouse/ClickHouse/pull/36656" target="_blank" rel="noopener noreferrer">#36656</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add a warning if someone running clickhouse-server with log level &quot;test&quot;. The log level &quot;test&quot; was added recently and cannot be used in production due to inevitable, unavoidable, fatal and life-threatening performance degradation. <a href="https://github.com/ClickHouse/ClickHouse/pull/36824" target="_blank" rel="noopener noreferrer">#36824</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Parse collations in CREATE TABLE, throw exception or ignore. closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35892" target="_blank" rel="noopener noreferrer">#35892</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36271" target="_blank" rel="noopener noreferrer">#36271</a> (<a href="https://github.com/yuuch" target="_blank" rel="noopener noreferrer">yuuch</a>).</li><li>Option <code>compatibility_ignore_auto_increment_in_create_table</code> allows ignoring <code>AUTO_INCREMENT</code> keyword in a column declaration to simplify migration from MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/37178" target="_blank" rel="noopener noreferrer">#37178</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Add aliases <code>JSONLines</code> and <code>NDJSON</code> for <code>JSONEachRow</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36303" target="_blank" rel="noopener noreferrer">#36303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36327" target="_blank" rel="noopener noreferrer">#36327</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Limit the max partitions could be queried for each hive table. Avoid resource overruns. <a href="https://github.com/ClickHouse/ClickHouse/pull/37281" target="_blank" rel="noopener noreferrer">#37281</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Added implicit cast for <code>h3kRing</code> function second argument to improve usability. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35432" target="_blank" rel="noopener noreferrer">#35432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37189" target="_blank" rel="noopener noreferrer">#37189</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix progress indication for <code>INSERT SELECT</code> in <code>clickhouse-local</code> for any query and for file progress in client, more correct file progress. <a href="https://github.com/ClickHouse/ClickHouse/pull/37075" target="_blank" rel="noopener noreferrer">#37075</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bug which can lead to forgotten outdated parts in MergeTree table engines family in case of filesystem failures during parts removal. Before fix they will be removed only after first server restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/37014" target="_blank" rel="noopener noreferrer">#37014</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Implemented a new mode of handling row policies which can be enabled in the main configuration which enables users without permissive row policies to read rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/36997" target="_blank" rel="noopener noreferrer">#36997</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Play UI: Nullable numbers will be aligned to the right in table cells. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36982" target="_blank" rel="noopener noreferrer">#36982</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36988" target="_blank" rel="noopener noreferrer">#36988</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Play UI: If there is one row in result and more than a few columns, display the result vertically. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/36811" target="_blank" rel="noopener noreferrer">#36811</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36842" target="_blank" rel="noopener noreferrer">#36842</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Cleanup CSS in Play UI. The pixels are more evenly placed. Better usability for long content in table cells. <a href="https://github.com/ClickHouse/ClickHouse/pull/36569" target="_blank" rel="noopener noreferrer">#36569</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Finalize write buffers in case of exception to avoid doing it in destructors. Hope it fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/36907" target="_blank" rel="noopener noreferrer">#36907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36979" target="_blank" rel="noopener noreferrer">#36979</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>After <a href="https://github.com/ClickHouse/ClickHouse/issues/36425" target="_blank" rel="noopener noreferrer">#36425</a> settings like <code>background_fetches_pool_size</code> became obsolete and can appear in top level config, but clickhouse throws and exception like <code>Error updating configuration from &#x27;/etc/clickhouse-server/config.xml&#x27; config.: Code: 137. DB::Exception: A setting &#x27;background_fetches_pool_size&#x27; appeared at top level in config /etc/clickhouse-server/config.xml.</code> This is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/36917" target="_blank" rel="noopener noreferrer">#36917</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add extra diagnostic info (if applicable) when sending exception to other server. <a href="https://github.com/ClickHouse/ClickHouse/pull/36872" target="_blank" rel="noopener noreferrer">#36872</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Allow to execute hash functions with arguments of type <code>Array(Tuple(..))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36812" target="_blank" rel="noopener noreferrer">#36812</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added <code>user_defined_path</code> config setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/36753" target="_blank" rel="noopener noreferrer">#36753</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow cluster macro in <code>s3Cluster</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/36726" target="_blank" rel="noopener noreferrer">#36726</a> (<a href="https://github.com/PolyProgrammist" target="_blank" rel="noopener noreferrer">Vadim Volodin</a>).</li><li>Properly cancel INSERT queries in <code>clickhouse-client</code>/<code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36710" target="_blank" rel="noopener noreferrer">#36710</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow to cancel a query while still keeping a decent query id in <code>MySQLHandler</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36699" target="_blank" rel="noopener noreferrer">#36699</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>is_all_data_sent</code> column into <code>system.processes</code>, and improve internal testing hardening check based on it. <a href="https://github.com/ClickHouse/ClickHouse/pull/36649" target="_blank" rel="noopener noreferrer">#36649</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The metrics about time spent reading from s3 now calculated correctly. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/35483" target="_blank" rel="noopener noreferrer">#35483</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36572" target="_blank" rel="noopener noreferrer">#36572</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Allow file descriptors in table function file if it is run in clickhouse-local. <a href="https://github.com/ClickHouse/ClickHouse/pull/36562" target="_blank" rel="noopener noreferrer">#36562</a> (<a href="https://github.com/wuxiaobai24" target="_blank" rel="noopener noreferrer">wuxiaobai24</a>).</li><li>Allow names of tuple elements that start from digits. <a href="https://github.com/ClickHouse/ClickHouse/pull/36544" target="_blank" rel="noopener noreferrer">#36544</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Now clickhouse-benchmark can read authentication info from environment variables. <a href="https://github.com/ClickHouse/ClickHouse/pull/36497" target="_blank" rel="noopener noreferrer">#36497</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li><code>clickhouse-keeper</code> improvement: add support for force recovery which allows you to reconfigure cluster without quorum. <a href="https://github.com/ClickHouse/ClickHouse/pull/36258" target="_blank" rel="noopener noreferrer">#36258</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Improve schema inference for JSON objects. <a href="https://github.com/ClickHouse/ClickHouse/pull/36207" target="_blank" rel="noopener noreferrer">#36207</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Refactor code around schema inference with globs. Try next file from glob only if it makes sense (previously we tried next file in case of any error). Also it fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36317" target="_blank" rel="noopener noreferrer">#36317</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36205" target="_blank" rel="noopener noreferrer">#36205</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add a separate <code>CLUSTER</code> grant (and <code>access_control_improvements.on_cluster_queries_require_cluster_grant</code> configuration directive, for backward compatibility, default to <code>false</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/35767" target="_blank" rel="noopener noreferrer">#35767</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>If the required amount of memory is available before the selected query stopped, all waiting queries continue execution. Now we don&#x27;t stop any query if memory is freed before the moment when the selected query knows about the cancellation. <a href="https://github.com/ClickHouse/ClickHouse/pull/35637" target="_blank" rel="noopener noreferrer">#35637</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Nullables detection in protobuf. In proto3, default values are not sent on the wire. This makes it non-trivial to distinguish between null and default values for Nullable columns. A standard way to deal with this problem is to use Google wrappers to nest the target value within an inner message (see <a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/wrappers.proto" target="_blank" rel="noopener noreferrer">https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/wrappers.proto</a>). In this case, a missing field is interpreted as null value, a field with missing value if interpreted as default value, and a field with regular value is interpreted as regular value. However, ClickHouse interprets Google wrappers as nested columns. We propose to introduce special behaviour to detect Google wrappers and interpret them like in the description above. For example, to serialize values for a Nullable column <code>test</code>, we would use <code>google.protobuf.StringValue test</code> in our .proto schema. Note that these types are so called &quot;well-known types&quot; in Protobuf, implemented in the library itself. <a href="https://github.com/ClickHouse/ClickHouse/pull/35149" target="_blank" rel="noopener noreferrer">#35149</a> (<a href="https://github.com/jkuklis" target="_blank" rel="noopener noreferrer">Jakub Kuklis</a>).</li><li>Added support for specifying <code>content_type</code> in predefined and static HTTP handler config. <a href="https://github.com/ClickHouse/ClickHouse/pull/34916" target="_blank" rel="noopener noreferrer">#34916</a> (<a href="https://github.com/nic11" target="_blank" rel="noopener noreferrer">Roman Nikonov</a>).</li><li>Warn properly if use clickhouse-client --file without preceeding --external. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34747" target="_blank" rel="noopener noreferrer">#34747</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34765" target="_blank" rel="noopener noreferrer">#34765</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improve MySQL database engine to compatible with binary(0) dataType. <a href="https://github.com/ClickHouse/ClickHouse/pull/37232" target="_blank" rel="noopener noreferrer">#37232</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Improve JSON report of clickhouse-benchmark. <a href="https://github.com/ClickHouse/ClickHouse/pull/36473" target="_blank" rel="noopener noreferrer">#36473</a> (<a href="https://github.com/xinhuitian" target="_blank" rel="noopener noreferrer">Tian Xinhui</a>).</li><li>Server might refuse to start if it cannot resolve hostname of external ClickHouse dictionary. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36451" target="_blank" rel="noopener noreferrer">#36451</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36463" target="_blank" rel="noopener noreferrer">#36463</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-7">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-7" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Now <code>clickhouse-keeper</code> for the <code>x86_64</code> architecture is statically linked with <a href="https://musl.libc.org/" target="_blank" rel="noopener noreferrer">musl</a> and doesn&#x27;t depend on any system libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/31833" target="_blank" rel="noopener noreferrer">#31833</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>ClickHouse builds for <code>PowerPC64LE</code> architecture are now available in universal installation script <code>curl https://clickhouse.com/ | sh</code> and by direct link <code>https://builds.clickhouse.com/master/powerpc64le/clickhouse</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37095" target="_blank" rel="noopener noreferrer">#37095</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Limit PowerPC code generation to Power8 for better compatibility. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36025" target="_blank" rel="noopener noreferrer">#36025</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36529" target="_blank" rel="noopener noreferrer">#36529</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Simplify performance test. This will give a chance for us to use it. <a href="https://github.com/ClickHouse/ClickHouse/pull/36769" target="_blank" rel="noopener noreferrer">#36769</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fail performance comparison on errors in the report. <a href="https://github.com/ClickHouse/ClickHouse/pull/34797" target="_blank" rel="noopener noreferrer">#34797</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add ZSTD support for Arrow. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35283" target="_blank" rel="noopener noreferrer">#35283</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35486" target="_blank" rel="noopener noreferrer">#35486</a> (<a href="https://github.com/seanlaff" target="_blank" rel="noopener noreferrer">Sean Lafferty</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-3">Bug Fix<a href="#bug-fix-3" class="hash-link" aria-label="Direct link to Bug Fix" title="Direct link to Bug Fix">​</a></h4><ul><li>Extracts Version ID if present from the URI and adds a request to the AWS HTTP URI. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31221" target="_blank" rel="noopener noreferrer">#31221</a>. - <!-- -->[x]<!-- --> Extract <code>Version ID</code> from URI if present and reassemble without it. - <!-- -->[x]<!-- --> Configure <code>AWS HTTP URI</code> object with request. - <!-- -->[x]<!-- --> Unit Tests: <a href="https://github.com/ClickHouse/ClickHouse/blob/2340a6c6849ebc05a8efbf97ba8de3ff9dc0eff4/src/IO/tests/gtest_s3_uri.cpp" target="_blank" rel="noopener noreferrer"><code>gtest_s3_uri</code></a> - <!-- -->[x]<!-- --> Drop instrumentation commit. <a href="https://github.com/ClickHouse/ClickHouse/pull/34571" target="_blank" rel="noopener noreferrer">#34571</a> (<a href="https://github.com/surahman" target="_blank" rel="noopener noreferrer">Saad Ur Rahman</a>).</li><li>Fix system.opentelemetry_span_log attribute.values alias to values instead of keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/37275" target="_blank" rel="noopener noreferrer">#37275</a> (<a href="https://github.com/ernado" target="_blank" rel="noopener noreferrer">Aleksandr Razumov</a>).</li><li>Fix Nullable(String) to Nullable(Bool/IPv4/IPv6) conversion Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/37221" target="_blank" rel="noopener noreferrer">#37221</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37270" target="_blank" rel="noopener noreferrer">#37270</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Experimental feature: Fix execution of mutations in tables, in which there exist columns of type <code>Object</code>. Using subcolumns of type <code>Object</code> in <code>WHERE</code> expression of <code>UPDATE</code> or <code>DELETE</code> queries is now allowed yet, as well as manipulating (<code>DROP</code>, <code>MODIFY</code>) of separate subcolumns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/37205" target="_blank" rel="noopener noreferrer">#37205</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37266" target="_blank" rel="noopener noreferrer">#37266</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Kafka does not need <code>group.id</code> on producer stage. In console log you can find Warning that describe this issue: <code>2022.05.15 17:59:13.270227 [ 137 ] {} &lt;Warning&gt; StorageKafka (topic-name): [rdk:CONFWARN] [thrd:app]: Configuration property group.id is a consumer property and will be ignored by this producer instance</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37228" target="_blank" rel="noopener noreferrer">#37228</a> (<a href="https://github.com/mrk-andreev" target="_blank" rel="noopener noreferrer">Mark Andreev</a>).</li><li>Experimental feature (WindowView): Update <code>max_fired_watermark </code> after blocks actually fired, in case delete data that hasn&#x27;t been fired yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/37225" target="_blank" rel="noopener noreferrer">#37225</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix &quot;Cannot create column of type Set&quot; for distributed queries with LIMIT BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/37193" target="_blank" rel="noopener noreferrer">#37193</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Experimental feature: Now WindowView <code>WATCH EVENTS</code> query will not be terminated due to the nonempty Chunk created in <code>WindowViewSource.h:58</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37182" target="_blank" rel="noopener noreferrer">#37182</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Enable <code>enable_global_with_statement</code> for subqueries, close <a href="https://github.com/ClickHouse/ClickHouse/issues/37141" target="_blank" rel="noopener noreferrer">#37141</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37166" target="_blank" rel="noopener noreferrer">#37166</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix implicit cast for optimize_skip_unused_shards_rewrite_in. <a href="https://github.com/ClickHouse/ClickHouse/pull/37153" target="_blank" rel="noopener noreferrer">#37153</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The ILIKE function on FixedString columns could have returned wrong results (i.e. match less than it should). <a href="https://github.com/ClickHouse/ClickHouse/pull/37117" target="_blank" rel="noopener noreferrer">#37117</a> (<a href="https://github.com/rschu1ze" target="_blank" rel="noopener noreferrer">Robert Schulze</a>).</li><li>Fix <code>GROUP BY</code> <code>AggregateFunction</code> (i.e. you <code>GROUP BY</code> by the column that has <code>AggregateFunction</code> type). <a href="https://github.com/ClickHouse/ClickHouse/pull/37093" target="_blank" rel="noopener noreferrer">#37093</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Experimental feature: Fix optimize_aggregation_in_order with prefix GROUP BY and *Array aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37050" target="_blank" rel="noopener noreferrer">#37050</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed performance degradation of some INSERT SELECT queries with implicit aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36792" target="_blank" rel="noopener noreferrer">#36792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37047" target="_blank" rel="noopener noreferrer">#37047</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Experimental feature: Fix in-order <code>GROUP BY</code> (<code>optimize_aggregation_in_order=1</code>) with <code>*Array</code> (<code>groupArrayArray</code>/...) aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/37046" target="_blank" rel="noopener noreferrer">#37046</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix LowCardinality-&gt;ArrowDictionary invalid output when type of indexes is not UInt8. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36832" target="_blank" rel="noopener noreferrer">#36832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37043" target="_blank" rel="noopener noreferrer">#37043</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed problem with infs in <code>quantileTDigest</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32107" target="_blank" rel="noopener noreferrer">#32107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/37021" target="_blank" rel="noopener noreferrer">#37021</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix sending external tables data in HedgedConnections with max_parallel_replicas != 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/36981" target="_blank" rel="noopener noreferrer">#36981</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed logical error on <code>TRUNCATE</code> query in <code>Replicated</code> database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33747" target="_blank" rel="noopener noreferrer">#33747</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36976" target="_blank" rel="noopener noreferrer">#36976</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Experimental feature: Fix stuck when dropping source table in WindowView. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35678" target="_blank" rel="noopener noreferrer">#35678</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36967" target="_blank" rel="noopener noreferrer">#36967</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Experimental feature (rocksdb cache): Fix issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/36671" target="_blank" rel="noopener noreferrer">#36671</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36929" target="_blank" rel="noopener noreferrer">#36929</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Experimental feature: Fix bugs when using multiple columns in WindowView by adding converting actions to make it possible to call<code>writeIntoWindowView</code> with a slightly different schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/36928" target="_blank" rel="noopener noreferrer">#36928</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix bug in clickhouse-keeper which can lead to corrupted compressed log files in case of small load and restarts. <a href="https://github.com/ClickHouse/ClickHouse/pull/36910" target="_blank" rel="noopener noreferrer">#36910</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix incorrect query result when doing constant aggregation. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36728" target="_blank" rel="noopener noreferrer">#36728</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/36888" target="_blank" rel="noopener noreferrer">#36888</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Experimental feature: Fix <code>current_size</code> count in cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/36887" target="_blank" rel="noopener noreferrer">#36887</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Experimental feature: Fix fire in window view with hop window <a href="https://github.com/ClickHouse/ClickHouse/issues/34044" target="_blank" rel="noopener noreferrer">#34044</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36861" target="_blank" rel="noopener noreferrer">#36861</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Experimental feature: Fix incorrect cast in cached buffer from remote fs. <a href="https://github.com/ClickHouse/ClickHouse/pull/36809" target="_blank" rel="noopener noreferrer">#36809</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix creation of tables with <code>flatten_nested = 0</code>. Previously unflattened <code>Nested</code> columns could be flattened after server restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/36803" target="_blank" rel="noopener noreferrer">#36803</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix some issues with async reads from remote filesystem which happened when reading low cardinality. <a href="https://github.com/ClickHouse/ClickHouse/pull/36763" target="_blank" rel="noopener noreferrer">#36763</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Experimental feature: Fix insertion to columns of type <code>Object</code> from multiple files, e.g. via table function <code>file</code> with globs. <a href="https://github.com/ClickHouse/ClickHouse/pull/36762" target="_blank" rel="noopener noreferrer">#36762</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix timeouts in Hedged requests. Connection hang right after sending remote query could lead to eternal waiting. <a href="https://github.com/ClickHouse/ClickHouse/pull/36749" target="_blank" rel="noopener noreferrer">#36749</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Experimental feature: Fix a bug of <code>groupBitmapAndState</code>/<code>groupBitmapOrState</code>/<code>groupBitmapXorState</code> on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/36739" target="_blank" rel="noopener noreferrer">#36739</a> (<a href="https://github.com/zhangyifan27" target="_blank" rel="noopener noreferrer">Zhang Yifan</a>).</li><li>Experimental feature: During the <a href="https://s3.amazonaws.com/clickhouse-test-reports/36376/1cb1c7275cb53769ab826772db9b71361bb3e413/stress_test__thread__actions_/clickhouse-server.clean.log" target="_blank" rel="noopener noreferrer">test</a> in <a href="https://github.com/ClickHouse/ClickHouse/pull/36376" target="_blank" rel="noopener noreferrer">PR</a>, I found that the one cache class was initialized twice, it throws a exception. Although the cause of this problem is not clear, there should be code logic of repeatedly loading disk in ClickHouse, so we need to make special judgment for this situation. <a href="https://github.com/ClickHouse/ClickHouse/pull/36737" target="_blank" rel="noopener noreferrer">#36737</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Fix vertical merges in wide parts. Previously an exception <code>There is no column</code> can be thrown during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/36707" target="_blank" rel="noopener noreferrer">#36707</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix server reload on port change (do not wait for current connections from query context). <a href="https://github.com/ClickHouse/ClickHouse/pull/36700" target="_blank" rel="noopener noreferrer">#36700</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Experimental feature: In the previous <a href="https://github.com/ClickHouse/ClickHouse/pull/36376" target="_blank" rel="noopener noreferrer">PR</a>, I found that testing (stateless tests, flaky check (address, actions)) is timeout. Moreover, testing locally can also trigger unstable system deadlocks. This problem still exists when using the latest source code of master. <a href="https://github.com/ClickHouse/ClickHouse/pull/36697" target="_blank" rel="noopener noreferrer">#36697</a> (<a href="https://github.com/KinderRiven" target="_blank" rel="noopener noreferrer">Han Shukai</a>).</li><li>Experimental feature: Fix server restart if cache configuration changed. <a href="https://github.com/ClickHouse/ClickHouse/pull/36685" target="_blank" rel="noopener noreferrer">#36685</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible heap-use-after-free in schema inference. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36661" target="_blank" rel="noopener noreferrer">#36661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36679" target="_blank" rel="noopener noreferrer">#36679</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed parsing of query settings in <code>CREATE</code> query when engine is not specified. Fixes <a href="https://github.com/ClickHouse/ClickHouse/pull/34187#issuecomment-1103812419" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/34187#issuecomment-1103812419</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36642" target="_blank" rel="noopener noreferrer">#36642</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Experimental feature: Fix merges of wide parts with type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36637" target="_blank" rel="noopener noreferrer">#36637</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix format crash when default expression follow EPHEMERAL not literal. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36618" target="_blank" rel="noopener noreferrer">#36618</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36633" target="_blank" rel="noopener noreferrer">#36633</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix <code>Missing column</code> exception which could happen while using <code>INTERPOLATE</code> with <code>ENGINE = MergeTree</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/36549" target="_blank" rel="noopener noreferrer">#36549</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Fix potential error with literals in <code>WHERE</code> for join queries. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/36279" target="_blank" rel="noopener noreferrer">#36279</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36542" target="_blank" rel="noopener noreferrer">#36542</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix offset update ReadBufferFromEncryptedFile, which could cause undefined behaviour. <a href="https://github.com/ClickHouse/ClickHouse/pull/36493" target="_blank" rel="noopener noreferrer">#36493</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix hostname sanity checks for Keeper cluster configuration. Add <code>keeper_server.host_checks_enabled</code> config to enable/disable those checks. <a href="https://github.com/ClickHouse/ClickHouse/pull/36492" target="_blank" rel="noopener noreferrer">#36492</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix usage of executable user defined functions in GROUP BY. Before executable user defined functions cannot be used as expressions in GROUP BY. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36448" target="_blank" rel="noopener noreferrer">#36448</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36486" target="_blank" rel="noopener noreferrer">#36486</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible exception with unknown packet from server in client. <a href="https://github.com/ClickHouse/ClickHouse/pull/36481" target="_blank" rel="noopener noreferrer">#36481</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Experimental feature (please never use <code>system.session_log</code>, it is going to be removed): Add missing enum values in system.session_log table. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/36474" target="_blank" rel="noopener noreferrer">#36474</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36480" target="_blank" rel="noopener noreferrer">#36480</a> (<a href="https://github.com/Joeywzr" target="_blank" rel="noopener noreferrer">Memo</a>).</li><li>Fix bug in s3Cluster schema inference that let to the fact that not all data was read in the select from s3Cluster. The bug appeared in <a href="https://github.com/ClickHouse/ClickHouse/pull/35544" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35544</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36434" target="_blank" rel="noopener noreferrer">#36434</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix nullptr dereference in JOIN and COLUMNS matcher. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/36416" target="_blank" rel="noopener noreferrer">#36416</a>. This is for <a href="https://github.com/ClickHouse/ClickHouse/pull/36417" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/36417</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36430" target="_blank" rel="noopener noreferrer">#36430</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix dictionary reload for <code>ClickHouseDictionarySource</code> if it contains scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/36390" target="_blank" rel="noopener noreferrer">#36390</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Fix assertion in JOIN, close <a href="https://github.com/ClickHouse/ClickHouse/issues/36199" target="_blank" rel="noopener noreferrer">#36199</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36201" target="_blank" rel="noopener noreferrer">#36201</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Queries with aliases inside special operators returned parsing error (was broken in 22.1). Example: <code>SELECT substring(&#x27;test&#x27; AS t, 1, 1)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36167" target="_blank" rel="noopener noreferrer">#36167</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Experimental feature: Fix insertion of complex JSONs with nested arrays to columns of type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/36077" target="_blank" rel="noopener noreferrer">#36077</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix ALTER DROP COLUMN of nested column with compact parts (i.e. <code>ALTER TABLE x DROP COLUMN n</code>, when there is column <code>n.d</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/35797" target="_blank" rel="noopener noreferrer">#35797</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix substring function range error length when <code>offset</code> and <code>length</code> is negative constant and <code>s</code> is not constant. <a href="https://github.com/ClickHouse/ClickHouse/pull/33861" target="_blank" rel="noopener noreferrer">#33861</a> (<a href="https://github.com/RogerYK" target="_blank" rel="noopener noreferrer">RogerYK</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-224-2022-04-19"><a id="224"></a> ClickHouse release 22.4, 2022-04-19<a href="#-clickhouse-release-224-2022-04-19" class="hash-link" aria-label="Direct link to -clickhouse-release-224-2022-04-19" title="Direct link to -clickhouse-release-224-2022-04-19">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-5">Backward Incompatible Change<a href="#backward-incompatible-change-5" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Do not allow SETTINGS after FORMAT for INSERT queries (there is compatibility setting <code>parser_settings_after_format_compact</code> to accept such queries, but it is turned OFF by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/35883" target="_blank" rel="noopener noreferrer">#35883</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Function <code>yandexConsistentHash</code> (consistent hashing algorithm by Konstantin &quot;kostik&quot; Oblakov) is renamed to <code>kostikConsistentHash</code>. The old name is left as an alias for compatibility. Although this change is backward compatible, we may remove the alias in subsequent releases, that&#x27;s why it&#x27;s recommended to update the usages of this function in your apps. <a href="https://github.com/ClickHouse/ClickHouse/pull/35553" target="_blank" rel="noopener noreferrer">#35553</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-8">New Feature<a href="#new-feature-8" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Added INTERPOLATE extension to the ORDER BY ... WITH FILL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34903" target="_blank" rel="noopener noreferrer">#34903</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35349" target="_blank" rel="noopener noreferrer">#35349</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Profiling on Processors level (under <code>log_processors_profiles</code> setting, ClickHouse will write time that processor spent during execution/waiting for data to <code>system.processors_profile_log</code> table). <a href="https://github.com/ClickHouse/ClickHouse/pull/34355" target="_blank" rel="noopener noreferrer">#34355</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added functions makeDate(year, month, day), makeDate32(year, month, day). <a href="https://github.com/ClickHouse/ClickHouse/pull/35628" target="_blank" rel="noopener noreferrer">#35628</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>). Implementation of makeDateTime() and makeDateTIme64(). <a href="https://github.com/ClickHouse/ClickHouse/pull/35934" target="_blank" rel="noopener noreferrer">#35934</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Support new type of quota <code>WRITTEN BYTES</code> to limit amount of written bytes during insert queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/35736" target="_blank" rel="noopener noreferrer">#35736</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added function <code>flattenTuple</code>. It receives nested named <code>Tuple</code> as an argument and returns a flatten <code>Tuple</code> which elements are the paths from the original <code>Tuple</code>. E.g.: <code>Tuple(a Int, Tuple(b Int, c Int)) -&gt; Tuple(a Int, b Int, c Int)</code>. <code>flattenTuple</code> can be used to select all paths from type <code>Object</code> as separate columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/35690" target="_blank" rel="noopener noreferrer">#35690</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added functions <code>arrayFirstOrNull</code>, <code>arrayLastOrNull</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35238" target="_blank" rel="noopener noreferrer">#35238</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35414" target="_blank" rel="noopener noreferrer">#35414</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added functions <code>minSampleSizeContinous</code> and <code>minSampleSizeConversion</code>. Author <a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35360" target="_blank" rel="noopener noreferrer">#35360</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>New functions minSampleSizeContinous and minSampleSizeConversion. <a href="https://github.com/ClickHouse/ClickHouse/pull/34354" target="_blank" rel="noopener noreferrer">#34354</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Introduce format <code>ProtobufList</code> (all records as repeated messages in out Protobuf). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16436" target="_blank" rel="noopener noreferrer">#16436</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35152" target="_blank" rel="noopener noreferrer">#35152</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add <code>h3PointDistM</code>, <code>h3PointDistKm</code>, <code>h3PointDistRads</code>, <code>h3GetRes0Indexes</code>, <code>h3GetPentagonIndexes</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/34568" target="_blank" rel="noopener noreferrer">#34568</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>toLastDayOfMonth</code> function which rounds up a date or date with time to the last day of the month. <a href="https://github.com/ClickHouse/ClickHouse/issues/33501" target="_blank" rel="noopener noreferrer">#33501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34394" target="_blank" rel="noopener noreferrer">#34394</a> (<a href="https://github.com/holadepo" target="_blank" rel="noopener noreferrer">Habibullah Oladepo</a>).</li><li>Added load balancing setting for <!-- -->[<!-- -->Zoo<!-- -->]<!-- -->Keeper client. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29617" target="_blank" rel="noopener noreferrer">#29617</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30325" target="_blank" rel="noopener noreferrer">#30325</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Add a new kind of row policies named <code>simple</code>. Before this PR we had two kinds or row policies: <code>permissive</code> and <code>restrictive</code>. A <code>simple</code> row policy adds a new filter on a table without any side-effects like it was for permissive and restrictive policies. <a href="https://github.com/ClickHouse/ClickHouse/pull/35345" target="_blank" rel="noopener noreferrer">#35345</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Added an ability to specify cluster secret in replicated database. <a href="https://github.com/ClickHouse/ClickHouse/pull/35333" target="_blank" rel="noopener noreferrer">#35333</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added sanity checks on server startup (available memory and disk space, max thread count, etc). <a href="https://github.com/ClickHouse/ClickHouse/pull/34566" target="_blank" rel="noopener noreferrer">#34566</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>INTERVAL improvement - can be used with <code>[MILLI|MICRO|NANO]SECOND</code>. Added <code>toStartOf[Milli|Micro|Nano]second()</code> functions. Added <code>[add|subtract][Milli|Micro|Nano]seconds()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34353" target="_blank" rel="noopener noreferrer">#34353</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-7">Experimental Feature<a href="#experimental-feature-7" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Added support for transactions for simple <code>MergeTree</code> tables. This feature is highly experimental and not recommended for production. Part of <a href="https://github.com/ClickHouse/ClickHouse/issues/22086" target="_blank" rel="noopener noreferrer">#22086</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24258" target="_blank" rel="noopener noreferrer">#24258</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Support schema inference for type <code>Object</code> in format <code>JSONEachRow</code>. Allow to convert columns of type <code>Map</code> to columns of type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35629" target="_blank" rel="noopener noreferrer">#35629</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allow to write remote FS cache on all write operations. Add <code>system.remote_filesystem_cache</code> table. Add <code>drop remote filesystem cache</code> query. Add introspection for s3 metadata with <code>system.remote_data_paths</code> table. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34021" target="_blank" rel="noopener noreferrer">#34021</a>. Add cache option for merges by adding mode <code>read_from_filesystem_cache_if_exists_otherwise_bypass_cache</code> (turned on by default for merges and can also be turned on by query setting with the same name). Rename cache related settings (<code>remote_fs_enable_cache -&gt; enable_filesystem_cache</code>, etc). <a href="https://github.com/ClickHouse/ClickHouse/pull/35475" target="_blank" rel="noopener noreferrer">#35475</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>An option to store parts metadata in RocksDB. Speed up parts loading process of MergeTree to accelerate starting up of clickhouse-server. With this improvement, clickhouse-server was able to decrease starting up time from 75 minutes to 20 seconds, with 700k mergetree parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/32928" target="_blank" rel="noopener noreferrer">#32928</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-8">Performance Improvement<a href="#performance-improvement-8" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>A new query plan optimization. Evaluate functions after <code>ORDER BY</code> when possible. As an example, for a query <code>SELECT sipHash64(number) FROM numbers(1e8) ORDER BY number LIMIT 5</code>, function <code>sipHash64</code> would be evaluated after <code>ORDER BY</code> and <code>LIMIT</code>, which gives ~20x speed up. <a href="https://github.com/ClickHouse/ClickHouse/pull/35623" target="_blank" rel="noopener noreferrer">#35623</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Sizes of hash tables used during aggregation now collected and used in later queries to avoid hash tables resizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33439" target="_blank" rel="noopener noreferrer">#33439</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Improvement for hasAll function using SIMD instructions (SSE and AVX2). <a href="https://github.com/ClickHouse/ClickHouse/pull/27653" target="_blank" rel="noopener noreferrer">#27653</a> (<a href="https://github.com/youennL-cs" target="_blank" rel="noopener noreferrer">youennL-cs</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/35723" target="_blank" rel="noopener noreferrer">#35723</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Multiple changes to improve ASOF JOIN performance (1.2 - 1.6x as fast). It also adds support to use big integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/34733" target="_blank" rel="noopener noreferrer">#34733</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improve performance of ASOF JOIN if key is native integer. <a href="https://github.com/ClickHouse/ClickHouse/pull/35525" target="_blank" rel="noopener noreferrer">#35525</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Parallelization of multipart upload into S3 storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/35343" target="_blank" rel="noopener noreferrer">#35343</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>URL storage engine now downloads multiple chunks in parallel if the endpoint supports HTTP Range. Two additional settings were added, <code>max_download_threads</code> and <code>max_download_buffer_size</code>, which control maximum number of threads a single query can use to download the file and the maximum number of bytes each thread can process. <a href="https://github.com/ClickHouse/ClickHouse/pull/35150" target="_blank" rel="noopener noreferrer">#35150</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Use multiple threads to download objects from S3. Downloading is controllable using <code>max_download_threads</code> and <code>max_download_buffer_size</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/35571" target="_blank" rel="noopener noreferrer">#35571</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Narrow mutex scope when interacting with HDFS. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/35292" target="_blank" rel="noopener noreferrer">#35292</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35646" target="_blank" rel="noopener noreferrer">#35646</a> (<a href="https://github.com/shuchaome" target="_blank" rel="noopener noreferrer">shuchaome</a>).</li><li>Require mutations for per-table TTL only when it had been changed. <a href="https://github.com/ClickHouse/ClickHouse/pull/35953" target="_blank" rel="noopener noreferrer">#35953</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-8">Improvement<a href="#improvement-8" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Multiple improvements for schema inference. Use some tweaks and heuristics to determine numbers, strings, arrays, tuples and maps in CSV, TSV and TSVRaw data formats. Add setting <code>input_format_csv_use_best_effort_in_schema_inference</code> for CSV format that enables/disables using these heuristics, if it&#x27;s disabled, we treat everything as string. Add similar setting <code>input_format_tsv_use_best_effort_in_schema_inference</code> for TSV/TSVRaw format. These settings are enabled by default. - Add Maps support for schema inference in Values format. - Fix possible segfault in schema inference in Values format. - Allow to skip columns with unsupported types in Arrow/ORC/Parquet formats. Add corresponding settings for it: <code>input_format_{parquet|orc|arrow}_skip_columns_with_unsupported_types_in_schema_inference</code>. These settings are disabled by default. - Allow to convert a column with type Null to a Nullable column with all NULL values in Arrow/Parquet formats. - Allow to specify column names in schema inference via setting <code>column_names_for_schema_inference</code> for formats that don&#x27;t contain column names (like CSV, TSV, JSONCompactEachRow, etc) - Fix schema inference in ORC/Arrow/Parquet formats in terms of working with Nullable columns. Previously all inferred types were not Nullable and it blocked reading Nullable columns from data, now it&#x27;s fixed and all inferred types are always Nullable (because we cannot understand that column is Nullable or not by reading the schema). - Fix schema inference in Template format with CSV escaping rules. <a href="https://github.com/ClickHouse/ClickHouse/pull/35582" target="_blank" rel="noopener noreferrer">#35582</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add parallel parsing and schema inference for format <code>JSONAsObject</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35592" target="_blank" rel="noopener noreferrer">#35592</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added a support for automatic schema inference to <code>s3Cluster</code> table function. Synced the signatures of <code>s3 </code> and <code>s3Cluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35544" target="_blank" rel="noopener noreferrer">#35544</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added support for schema inference for <code>hdfsCluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35602" target="_blank" rel="noopener noreferrer">#35602</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add new setting <code>input_format_json_read_bools_as_numbers</code> that allows to infer and parse bools as numbers in JSON input formats. It&#x27;s enabled by default. Suggested by @alexey-milovidov. <a href="https://github.com/ClickHouse/ClickHouse/pull/35735" target="_blank" rel="noopener noreferrer">#35735</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Improve columns ordering in schema inference for formats TSKV and JSONEachRow, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35640" target="_blank" rel="noopener noreferrer">#35640</a>. Don&#x27;t stop schema inference when reading empty row in schema inference for formats TSKV and JSONEachRow. <a href="https://github.com/ClickHouse/ClickHouse/pull/35724" target="_blank" rel="noopener noreferrer">#35724</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add settings <code>input_format_orc_case_insensitive_column_matching</code>, <code>input_format_arrow_case_insensitive_column_matching</code>, and <code>input_format_parquet_case_insensitive_column_matching</code> which allows ClickHouse to use case insensitive matching of columns while reading data from ORC, Arrow or Parquet files. <a href="https://github.com/ClickHouse/ClickHouse/pull/35459" target="_blank" rel="noopener noreferrer">#35459</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Added <code>is_secure</code> column to <code>system.query_log</code> which denotes if the client is using a secure connection over TCP or HTTP. <a href="https://github.com/ClickHouse/ClickHouse/pull/35705" target="_blank" rel="noopener noreferrer">#35705</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Now <code>kafka_num_consumers</code> can be bigger than amount of physical cores in case of low resource machine (less than 16 cores). <a href="https://github.com/ClickHouse/ClickHouse/pull/35926" target="_blank" rel="noopener noreferrer">#35926</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add some basic metrics to monitor engine=Kafka tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/35916" target="_blank" rel="noopener noreferrer">#35916</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Now it&#x27;s not allowed to <code>ALTER TABLE ... RESET SETTING</code> for non-existing settings for MergeTree engines family. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35816" target="_blank" rel="noopener noreferrer">#35816</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35884" target="_blank" rel="noopener noreferrer">#35884</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now some <code>ALTER MODIFY COLUMN</code> queries for <code>Arrays</code> and <code>Nullable</code> types can be done at metadata level without mutations. For example, alter from <code>Array(Enum8(&#x27;Option1&#x27;=1))</code> to <code>Array(Enum8(&#x27;Option1&#x27;=1, &#x27;Option2&#x27;=2))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35882" target="_blank" rel="noopener noreferrer">#35882</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added an animation to the hourglass icon to indicate to the user that a query is running. <a href="https://github.com/ClickHouse/ClickHouse/pull/35860" target="_blank" rel="noopener noreferrer">#35860</a> (<a href="https://github.com/peledni" target="_blank" rel="noopener noreferrer">peledni</a>).</li><li>support ALTER TABLE t DETACH PARTITION (ALL). <a href="https://github.com/ClickHouse/ClickHouse/pull/35794" target="_blank" rel="noopener noreferrer">#35794</a> (<a href="https://github.com/awakeljw" target="_blank" rel="noopener noreferrer">awakeljw</a>).</li><li>Improve projection analysis to optimize trivial queries such as <code>count()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35788" target="_blank" rel="noopener noreferrer">#35788</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support schema inference for insert select with using <code>input</code> table function. Get schema from insertion table instead of inferring it from the data in case of insert select from table functions that support schema inference. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35639" target="_blank" rel="noopener noreferrer">#35639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35760" target="_blank" rel="noopener noreferrer">#35760</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Respect <code>remote_url_allow_hosts</code> for Hive tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/35743" target="_blank" rel="noopener noreferrer">#35743</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Implement <code>send_logs_level</code> for clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35653" target="_blank" rel="noopener noreferrer">#35653</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35716" target="_blank" rel="noopener noreferrer">#35716</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35641" target="_blank" rel="noopener noreferrer">#35641</a> Allow <code>EPHEMERAL</code> columns without explicit default expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/35706" target="_blank" rel="noopener noreferrer">#35706</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Add profile event counter <code>AsyncInsertBytes</code> about size of async INSERTs. <a href="https://github.com/ClickHouse/ClickHouse/pull/35644" target="_blank" rel="noopener noreferrer">#35644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Improve the pipeline description for JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/35612" target="_blank" rel="noopener noreferrer">#35612</a> (<a href="https://github.com/helifu" target="_blank" rel="noopener noreferrer">何李夫</a>).</li><li>Deduce absolute hdfs config path. <a href="https://github.com/ClickHouse/ClickHouse/pull/35572" target="_blank" rel="noopener noreferrer">#35572</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improve pasting performance and compatibility of clickhouse-client. This helps <a href="https://github.com/ClickHouse/ClickHouse/issues/35501" target="_blank" rel="noopener noreferrer">#35501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35541" target="_blank" rel="noopener noreferrer">#35541</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>It was possible to get stack overflow in distributed queries if one of the settings <code>async_socket_for_remote</code> and <code>use_hedged_requests</code> is enabled while parsing very deeply nested data type (at least in debug build). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35509" target="_blank" rel="noopener noreferrer">#35509</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35524" target="_blank" rel="noopener noreferrer">#35524</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add sizes of subcolumns to <code>system.parts_columns</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/35488" target="_blank" rel="noopener noreferrer">#35488</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add explicit table info to the scan node of query plan and pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/35460" target="_blank" rel="noopener noreferrer">#35460</a> (<a href="https://github.com/helifu" target="_blank" rel="noopener noreferrer">何李夫</a>).</li><li>Allow server to bind to low-numbered ports (e.g. 443). ClickHouse installation script will set <code>cap_net_bind_service</code> to the binary file. <a href="https://github.com/ClickHouse/ClickHouse/pull/35451" target="_blank" rel="noopener noreferrer">#35451</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix INSERT INTO table FROM INFILE: it did not display the progress bar. <a href="https://github.com/ClickHouse/ClickHouse/pull/35429" target="_blank" rel="noopener noreferrer">#35429</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">xiedeyantu</a>).</li><li>Add arguments <code>--user</code>, <code>--password</code>, <code>--host</code>, <code>--port</code> for <code>clickhouse-diagnostics</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/35422" target="_blank" rel="noopener noreferrer">#35422</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Support uuid for Postgres engines. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35384" target="_blank" rel="noopener noreferrer">#35384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35403" target="_blank" rel="noopener noreferrer">#35403</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>For table function <code>s3cluster</code> or <code>HDFSCluster</code> or <code>hive</code>, we can&#x27;t get right <code>AccessType</code> by <code>StorageFactory::instance().getSourceAccessType(getStorageTypeName())</code>. This pr fix it. <a href="https://github.com/ClickHouse/ClickHouse/pull/35365" target="_blank" rel="noopener noreferrer">#35365</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Remove <code>--testmode</code> option for clickhouse-client, enable it unconditionally. <a href="https://github.com/ClickHouse/ClickHouse/pull/35354" target="_blank" rel="noopener noreferrer">#35354</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Don&#x27;t allow <code>wchc</code> operation (four letter command) for clickhouse-keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/35320" target="_blank" rel="noopener noreferrer">#35320</a> (<a href="https://github.com/zhangyuli1" target="_blank" rel="noopener noreferrer">zhangyuli1</a>).</li><li>Add function <code>getTypeSerializationStreams</code>. For a specified type (which is detected from column), it returns an array with all the serialization substream paths. This function is useful mainly for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/35290" target="_blank" rel="noopener noreferrer">#35290</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>If <code>port</code> is not specified in cluster configuration, default server port will be used. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34769" target="_blank" rel="noopener noreferrer">#34769</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34772" target="_blank" rel="noopener noreferrer">#34772</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Use <code>minmax</code> index for orc/parquet file in Hive Engine. Related PR: <a href="https://github.com/ClickHouse/arrow/pull/10" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/arrow/pull/10</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34631" target="_blank" rel="noopener noreferrer">#34631</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>System log tables now allow to specify COMMENT in ENGINE declaration. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33768" target="_blank" rel="noopener noreferrer">#33768</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34536" target="_blank" rel="noopener noreferrer">#34536</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Proper support of setting <code>max_rows_to_read</code> in case of reading in order of sorting key and specified limit. Previously the exception <code>Limit for rows or bytes to read exceeded</code> could be thrown even if query actually requires to read less amount of rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/33230" target="_blank" rel="noopener noreferrer">#33230</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Respect only quota &amp; period from cgroups, ignore shares (which are not really limit the number of the cores which can be used). <a href="https://github.com/ClickHouse/ClickHouse/pull/35815" target="_blank" rel="noopener noreferrer">#35815</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-8">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-8" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Add next batch of randomization settings in functional tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">#35047</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add backward compatibility check in stress test. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25088" target="_blank" rel="noopener noreferrer">#25088</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27928" target="_blank" rel="noopener noreferrer">#27928</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Migrate package building to <code>nfpm</code> - Deprecate <code>release</code> script in favor of <code>packages/build</code> - Build everything in clickhouse/binary-builder image (cleanup: clickhouse/deb-builder) - Add symbol stripping to cmake (todo: use <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>x</mi><mi mathvariant="normal">/</mi><mi>l</mi><mi>i</mi><mi>b</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">prefix/lib/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">ib</span><span class="mord">/</span></span></span></span></span>bin_dir/clickhouse/$binary.debug) - Fix issue with DWARF symbols - Add Alpine APK packages - Rename <code>alien</code> to <code>additional_pkgs</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33664" target="_blank" rel="noopener noreferrer">#33664</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add a night scan and upload for Coverity. <a href="https://github.com/ClickHouse/ClickHouse/pull/34895" target="_blank" rel="noopener noreferrer">#34895</a> (<a href="https://github.com/bkuschel" target="_blank" rel="noopener noreferrer">Boris Kuschel</a>).</li><li>A dedicated small package for <code>clickhouse-keeper</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35308" target="_blank" rel="noopener noreferrer">#35308</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Running with podman was failing: it complains about specifying the same volume twice. <a href="https://github.com/ClickHouse/ClickHouse/pull/35978" target="_blank" rel="noopener noreferrer">#35978</a> (<a href="https://github.com/nic11" target="_blank" rel="noopener noreferrer">Roman Nikonov</a>).</li><li>Minor improvement in contrib/krb5 build configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/35832" target="_blank" rel="noopener noreferrer">#35832</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Add a label to recognize a building task for every image. <a href="https://github.com/ClickHouse/ClickHouse/pull/35583" target="_blank" rel="noopener noreferrer">#35583</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Apply <code>black</code> formatter to python code and add a per-commit check. <a href="https://github.com/ClickHouse/ClickHouse/pull/35466" target="_blank" rel="noopener noreferrer">#35466</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Redo alpine image to use clean Dockerfile. Create a script in tests/ci to build both ubuntu and alpine images. Add clickhouse-keeper image (cc @nikitamikhaylov). Add build check to PullRequestCI. Add a job to a ReleaseCI. Add a job to MasterCI to build and push <code>clickhouse/clickhouse-server:head</code> and <code>clickhouse/clickhouse-keeper:head</code> images for each merged PR. <a href="https://github.com/ClickHouse/ClickHouse/pull/35211" target="_blank" rel="noopener noreferrer">#35211</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Fix stress-test report in CI, now we upload the runlog with information about started stress tests only once. <a href="https://github.com/ClickHouse/ClickHouse/pull/35093" target="_blank" rel="noopener noreferrer">#35093</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Switch to libcxx / libcxxabi from LLVM 14. <a href="https://github.com/ClickHouse/ClickHouse/pull/34906" target="_blank" rel="noopener noreferrer">#34906</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Update unixodbc to mitigate CVE-2018-7485. Note: this CVE is not relevant for ClickHouse as it implements its own isolation layer for ODBC. <a href="https://github.com/ClickHouse/ClickHouse/pull/35943" target="_blank" rel="noopener noreferrer">#35943</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-4">Bug Fix<a href="#bug-fix-4" class="hash-link" aria-label="Direct link to Bug Fix" title="Direct link to Bug Fix">​</a></h4><ul><li>Added settings <code>input_format_ipv4_default_on_conversion_error</code>, <code>input_format_ipv6_default_on_conversion_error</code> to allow insert of invalid ip address values as default into tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35726" target="_blank" rel="noopener noreferrer">#35726</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35733" target="_blank" rel="noopener noreferrer">#35733</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Avoid erasing columns from a block if it doesn&#x27;t exist while reading data from Hive. <a href="https://github.com/ClickHouse/ClickHouse/pull/35393" target="_blank" rel="noopener noreferrer">#35393</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Add type checking when creating materialized view. Close: <a href="https://github.com/ClickHouse/ClickHouse/issues/23684" target="_blank" rel="noopener noreferrer">#23684</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24896" target="_blank" rel="noopener noreferrer">#24896</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix formatting of INSERT INFILE queries (missing quotes). <a href="https://github.com/ClickHouse/ClickHouse/pull/35886" target="_blank" rel="noopener noreferrer">#35886</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disable <code>session_log</code> because memory safety issue has been found by fuzzing. See <a href="https://github.com/ClickHouse/ClickHouse/issues/35714" target="_blank" rel="noopener noreferrer">#35714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35873" target="_blank" rel="noopener noreferrer">#35873</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Avoid processing per-column TTL multiple times. <a href="https://github.com/ClickHouse/ClickHouse/pull/35820" target="_blank" rel="noopener noreferrer">#35820</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix inserts to columns of type <code>Object</code> in case when there is data related to several partitions in insert query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35806" target="_blank" rel="noopener noreferrer">#35806</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug in indexes of not presented columns in -WithNames formats that led to error <code>INCORRECT_NUMBER_OF_COLUMNS </code> when the number of columns is more than 256. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35793" target="_blank" rel="noopener noreferrer">#35793</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35803" target="_blank" rel="noopener noreferrer">#35803</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35751" target="_blank" rel="noopener noreferrer">#35751</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35799" target="_blank" rel="noopener noreferrer">#35799</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix for reading from HDFS in Snappy format. <a href="https://github.com/ClickHouse/ClickHouse/pull/35771" target="_blank" rel="noopener noreferrer">#35771</a> (<a href="https://github.com/shuchaome" target="_blank" rel="noopener noreferrer">shuchaome</a>).</li><li>Fix bug in conversion from custom types to string that could lead to segfault or unexpected error messages. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35752" target="_blank" rel="noopener noreferrer">#35752</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35755" target="_blank" rel="noopener noreferrer">#35755</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix any/all (subquery) implementation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35489" target="_blank" rel="noopener noreferrer">#35489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35727" target="_blank" rel="noopener noreferrer">#35727</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix dropping non-empty database in clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35692" target="_blank" rel="noopener noreferrer">#35692</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35711" target="_blank" rel="noopener noreferrer">#35711</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bug in creating materialized view with subquery after server restart. Materialized view was not getting updated after inserts into underlying table after server restart. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35511" target="_blank" rel="noopener noreferrer">#35511</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35691" target="_blank" rel="noopener noreferrer">#35691</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible <code>Can&#x27;t adjust last granule</code> exception while reading subcolumns of experimental type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35687" target="_blank" rel="noopener noreferrer">#35687</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Enable build with JIT compilation by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/35683" target="_blank" rel="noopener noreferrer">#35683</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible loss of subcolumns in experimental type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35682" target="_blank" rel="noopener noreferrer">#35682</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix check ASOF JOIN key nullability, close <a href="https://github.com/ClickHouse/ClickHouse/issues/35565" target="_blank" rel="noopener noreferrer">#35565</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35674" target="_blank" rel="noopener noreferrer">#35674</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix part checking logic for parts with projections. Error happened when projection and main part had different types. This is similar to <a href="https://github.com/ClickHouse/ClickHouse/pull/33774" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/33774</a> . The bug is addressed by @caoyang10. <a href="https://github.com/ClickHouse/ClickHouse/pull/35667" target="_blank" rel="noopener noreferrer">#35667</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix server crash when large number of arguments are passed into <code>format</code> function. Please refer to the test file and see how to reproduce the crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/35651" target="_blank" rel="noopener noreferrer">#35651</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix usage of quotas with asynchronous inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/35645" target="_blank" rel="noopener noreferrer">#35645</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix positional arguments with aliases. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35600" target="_blank" rel="noopener noreferrer">#35600</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35620" target="_blank" rel="noopener noreferrer">#35620</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Check <code>remote_url_allow_hosts</code> before schema inference in URL engine Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35064" target="_blank" rel="noopener noreferrer">#35064</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35619" target="_blank" rel="noopener noreferrer">#35619</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>HashJoin</code> when columns with <code>LowCardinality</code> type are used. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35548" target="_blank" rel="noopener noreferrer">#35548</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35616" target="_blank" rel="noopener noreferrer">#35616</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix possible segfault in MaterializedPostgreSQL which happened if exception occurred when data, collected in memory, was synced into underlying tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35611" target="_blank" rel="noopener noreferrer">#35611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35614" target="_blank" rel="noopener noreferrer">#35614</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Setting <code>database_atomic_wait_for_drop_and_detach_synchronously</code> worked incorrectly for <code>ATTACH TABLE</code> query when previously detached table is still in use, It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/35594" target="_blank" rel="noopener noreferrer">#35594</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix HTTP headers with named collections, add compression_method. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35273" target="_blank" rel="noopener noreferrer">#35273</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35269" target="_blank" rel="noopener noreferrer">#35269</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35593" target="_blank" rel="noopener noreferrer">#35593</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix s3 engine getting virtual columns. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35411" target="_blank" rel="noopener noreferrer">#35411</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35586" target="_blank" rel="noopener noreferrer">#35586</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed return type deduction for <code>caseWithExpression</code>. The type of the ELSE branch is now correctly taken into account. <a href="https://github.com/ClickHouse/ClickHouse/pull/35576" target="_blank" rel="noopener noreferrer">#35576</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix parsing of IPv6 addresses longer than 39 characters. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34022" target="_blank" rel="noopener noreferrer">#34022</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35539" target="_blank" rel="noopener noreferrer">#35539</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix cast into IPv4, IPv6 address in IN section. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35528" target="_blank" rel="noopener noreferrer">#35528</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35534" target="_blank" rel="noopener noreferrer">#35534</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash during short circuit function evaluation when one of arguments is nullable constant. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35497" target="_blank" rel="noopener noreferrer">#35497</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35496" target="_blank" rel="noopener noreferrer">#35496</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35502" target="_blank" rel="noopener noreferrer">#35502</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash for function <code>throwIf</code> with constant arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/35500" target="_blank" rel="noopener noreferrer">#35500</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix bug in Keeper which can lead to unstable client connections. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/35031" target="_blank" rel="noopener noreferrer">#35031</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35498" target="_blank" rel="noopener noreferrer">#35498</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug in function <code>if</code> when resulting column type differs with resulting data type that led to logical errors like <code>Logical error: &#x27;Bad cast from type DB::ColumnVector&lt;int&gt; to DB::ColumnVector&lt;long&gt;&#x27;.</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35367" target="_blank" rel="noopener noreferrer">#35367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35476" target="_blank" rel="noopener noreferrer">#35476</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix excessive logging when using S3 as backend for MergeTree or as separate table engine/function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30559" target="_blank" rel="noopener noreferrer">#30559</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35434" target="_blank" rel="noopener noreferrer">#35434</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now merges executed with zero copy replication (experimental) will not spam logs with message <code>Found parts with the same min block and with the same max block as the missing part _ on replica _. Hoping that it will eventually appear as a result of a merge.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35430" target="_blank" rel="noopener noreferrer">#35430</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Skip possible exception if empty chunks appear in GroupingAggregatedTransform. <a href="https://github.com/ClickHouse/ClickHouse/pull/35417" target="_blank" rel="noopener noreferrer">#35417</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix working with columns that are not needed in query in Arrow/Parquet/ORC formats, it prevents possible errors like <code>Unsupported &lt;format&gt; type &lt;type&gt; of an input column &lt;column_name&gt;</code> when file contains column with unsupported type and we don&#x27;t use it in query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35406" target="_blank" rel="noopener noreferrer">#35406</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix for local cache for remote filesystem (experimental feature) for high concurrency on corner cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/35381" target="_blank" rel="noopener noreferrer">#35381</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix possible deadlock in cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/35378" target="_blank" rel="noopener noreferrer">#35378</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partition pruning in case of comparison with constant in <code>WHERE</code>. If column and constant had different types, overflow was possible. Query could return an incorrect empty result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35304" target="_blank" rel="noopener noreferrer">#35304</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35334" target="_blank" rel="noopener noreferrer">#35334</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix schema inference for TSKV format while using small max_read_buffer_size. <a href="https://github.com/ClickHouse/ClickHouse/pull/35332" target="_blank" rel="noopener noreferrer">#35332</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix mutations in tables with enabled sparse columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/35284" target="_blank" rel="noopener noreferrer">#35284</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Do not delay final part writing by default (fixes possible <code>Memory limit exceeded</code> during <code>INSERT</code> by adding <code>max_insert_delayed_streams_for_parallel_write</code> with default to 1000 for writes to s3 and disabled as before otherwise). <a href="https://github.com/ClickHouse/ClickHouse/pull/34780" target="_blank" rel="noopener noreferrer">#34780</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-v223-lts-2022-03-17"><a id="223"></a> ClickHouse release v22.3-lts, 2022-03-17<a href="#-clickhouse-release-v223-lts-2022-03-17" class="hash-link" aria-label="Direct link to -clickhouse-release-v223-lts-2022-03-17" title="Direct link to -clickhouse-release-v223-lts-2022-03-17">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backward-incompatible-change-6">Backward Incompatible Change<a href="#backward-incompatible-change-6" class="hash-link" aria-label="Direct link to Backward Incompatible Change" title="Direct link to Backward Incompatible Change">​</a></h4><ul><li>Make <code>arrayCompact</code> function behave as other higher-order functions: perform compaction not of lambda function results but on the original array. If you&#x27;re using nontrivial lambda functions in arrayCompact you may restore old behaviour by wrapping <code>arrayCompact</code> arguments into <code>arrayMap</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34010" target="_blank" rel="noopener noreferrer">#34010</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/18535" target="_blank" rel="noopener noreferrer">#18535</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/14778" target="_blank" rel="noopener noreferrer">#14778</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34795" target="_blank" rel="noopener noreferrer">#34795</a> (<a href="https://github.com/snar" target="_blank" rel="noopener noreferrer">Alexandre Snarskii</a>).</li><li>Change implementation specific behavior on overflow of function <code>toDatetime</code>. It will be saturated to the nearest min/max supported instant of datetime instead of wraparound. This change is highlighted as &quot;backward incompatible&quot; because someone may unintentionally rely on the old behavior. <a href="https://github.com/ClickHouse/ClickHouse/pull/32898" target="_blank" rel="noopener noreferrer">#32898</a> (<a href="https://github.com/marising" target="_blank" rel="noopener noreferrer">HaiBo Li</a>).</li><li>Make function <code>cast(value, &#x27;IPv4&#x27;)</code>, <code>cast(value, &#x27;IPv6&#x27;)</code> behave same as <code>toIPv4</code>, <code>toIPv6</code> functions. Changed behavior of incorrect IP address passed into functions <code>toIPv4</code>,<code> toIPv6</code>,  now if invalid IP address passes into this functions exception will be raised, before this function return default value. Added functions <code>IPv4StringToNumOrDefault</code>, <code>IPv4StringToNumOrNull</code>, <code>IPv6StringToNumOrDefault</code>, <code>IPv6StringOrNull</code> <code>toIPv4OrDefault</code>, <code>toIPv4OrNull</code>, <code>toIPv6OrDefault</code>, <code>toIPv6OrNull</code>. Functions <code>IPv4StringToNumOrDefault </code>, <code>toIPv4OrDefault </code>, <code>toIPv6OrDefault </code> should be used if previous logic relied on <code>IPv4StringToNum</code>, <code>toIPv4</code>, <code>toIPv6</code> returning default value for invalid address. Added setting <code>cast_ipv4_ipv6_default_on_conversion_error</code>, if this setting enabled, then IP address conversion functions will behave as before. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22825" target="_blank" rel="noopener noreferrer">#22825</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5799" target="_blank" rel="noopener noreferrer">#5799</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35156" target="_blank" rel="noopener noreferrer">#35156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35240" target="_blank" rel="noopener noreferrer">#35240</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-9">New Feature<a href="#new-feature-9" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Support for caching data locally for remote filesystems. It can be enabled for <code>s3</code> disks. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28961" target="_blank" rel="noopener noreferrer">#28961</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33717" target="_blank" rel="noopener noreferrer">#33717</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). In the meantime, we enabled the test suite on s3 filesystem and no more known issues exist, so it is started to be production ready.</li><li>Add new table function <code>hive</code>. It can be used as follows <code>hive(&#x27;&lt;hive metastore url&gt;&#x27;, &#x27;&lt;hive database&gt;&#x27;, &#x27;&lt;hive table name&gt;&#x27;, &#x27;&lt;columns definition&gt;&#x27;, &#x27;&lt;partition columns&gt;&#x27;)</code> for example <code>SELECT * FROM hive(&#x27;thrift://hivetest:9083&#x27;, &#x27;test&#x27;, &#x27;demo&#x27;, &#x27;id Nullable(String), score Nullable(Int32), day Nullable(String)&#x27;, &#x27;day&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34946" target="_blank" rel="noopener noreferrer">#34946</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Support authentication of users connected via SSL by their X.509 certificate. <a href="https://github.com/ClickHouse/ClickHouse/pull/31484" target="_blank" rel="noopener noreferrer">#31484</a> (<a href="https://github.com/eungenue" target="_blank" rel="noopener noreferrer">eungenue</a>).</li><li>Support schema inference for inserting into table functions <code>file</code>/<code>hdfs</code>/<code>s3</code>/<code>url</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34732" target="_blank" rel="noopener noreferrer">#34732</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now you can read <code>system.zookeeper</code> table without restrictions on path or using <code>like</code> expression. This reads can generate quite heavy load for zookeeper so to enable this ability you have to enable setting <code>allow_unrestricted_reads_from_keeper</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34609" target="_blank" rel="noopener noreferrer">#34609</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Display CPU and memory metrics in clickhouse-local. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34545" target="_blank" rel="noopener noreferrer">#34545</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34605" target="_blank" rel="noopener noreferrer">#34605</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Implement <code>startsWith</code> and <code>endsWith</code> function for arrays, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33982" target="_blank" rel="noopener noreferrer">#33982</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34368" target="_blank" rel="noopener noreferrer">#34368</a> (<a href="https://github.com/usurai" target="_blank" rel="noopener noreferrer">usurai</a>).</li><li>Add three functions for Map data type: 1. <code>mapReplace(map1, map2)</code> - replaces values for keys in map1 with the values of the corresponding keys in map2; adds keys from map2 that don&#x27;t exist in map1. 2. <code>mapFilter</code> 3. <code>mapMap</code>. mapFilter and mapMap are higher order functions, accepting two arguments, the first argument is a lambda function with k, v pair as arguments, the second argument is a column of type Map. <a href="https://github.com/ClickHouse/ClickHouse/pull/33698" target="_blank" rel="noopener noreferrer">#33698</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Allow getting default user and password for clickhouse-client from the <code>CLICKHOUSE_USER</code> and <code>CLICKHOUSE_PASSWORD</code> environment variables. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34538" target="_blank" rel="noopener noreferrer">#34538</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34947" target="_blank" rel="noopener noreferrer">#34947</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-8">Experimental Feature<a href="#experimental-feature-8" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>New data type <code>Object(&lt;schema_format&gt;)</code>, which supports storing of semi-structured data (for now JSON only). Data is written to such types as string. Then all paths are extracted according to format of semi-structured data and written as separate columns in most optimal types, that can store all their values. Those columns can be queried by names that match paths in source data. E.g <code>data.key1.key2</code> or with cast operator <code>data.key1.key2::Int64</code>.</li><li>Add <code>database_replicated_allow_only_replicated_engine</code> setting. When enabled, it only allowed to only create <code>Replicated</code> tables or tables with stateless engines in <code>Replicated</code> databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/35214" target="_blank" rel="noopener noreferrer">#35214</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>). Note that <code>Replicated</code> database is still an experimental feature.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-9">Performance Improvement<a href="#performance-improvement-9" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Improve performance of insertion into <code>MergeTree</code> tables by optimizing sorting. Up to 2x improvement is observed on realistic benchmarks. <a href="https://github.com/ClickHouse/ClickHouse/pull/34750" target="_blank" rel="noopener noreferrer">#34750</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Columns pruning when reading Parquet, ORC and Arrow files from URL and S3. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34163" target="_blank" rel="noopener noreferrer">#34163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34849" target="_blank" rel="noopener noreferrer">#34849</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Columns pruning when reading Parquet, ORC and Arrow files from Hive. <a href="https://github.com/ClickHouse/ClickHouse/pull/34954" target="_blank" rel="noopener noreferrer">#34954</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>A bunch of performance optimizations from a performance superhero. Improve performance of processing queries with large <code>IN</code> section. Improve performance of <code>direct</code> dictionary if its source is <code>ClickHouse</code>. Improve performance of <code>detectCharset </code>, <code>detectLanguageUnknown </code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/34888" target="_blank" rel="noopener noreferrer">#34888</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>any</code> aggregate function by using more batching. <a href="https://github.com/ClickHouse/ClickHouse/pull/34760" target="_blank" rel="noopener noreferrer">#34760</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Multiple improvements for performance of <code>clickhouse-keeper</code>: less locking <a href="https://github.com/ClickHouse/ClickHouse/pull/35010" target="_blank" rel="noopener noreferrer">#35010</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), lower memory usage by streaming reading and writing of snapshot instead of full copy. <a href="https://github.com/ClickHouse/ClickHouse/pull/34584" target="_blank" rel="noopener noreferrer">#34584</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), optimizing compaction of log store in the RAFT implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/34534" target="_blank" rel="noopener noreferrer">#34534</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), versioning of the internal data structure <a href="https://github.com/ClickHouse/ClickHouse/pull/34486" target="_blank" rel="noopener noreferrer">#34486</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-9">Improvement<a href="#improvement-9" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Allow asynchronous inserts to table functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34864" target="_blank" rel="noopener noreferrer">#34864</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34866" target="_blank" rel="noopener noreferrer">#34866</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Implicit type casting of the key argument for functions <code>dictGetHierarchy</code>, <code>dictIsIn</code>, <code>dictGetChildren</code>, <code>dictGetDescendants</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34970" target="_blank" rel="noopener noreferrer">#34970</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35027" target="_blank" rel="noopener noreferrer">#35027</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>EXPLAIN AST</code> query can output AST in form of a graph in Graphviz format: <code>EXPLAIN AST graph = 1 SELECT * FROM system.parts</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35173" target="_blank" rel="noopener noreferrer">#35173</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>When large files were written with <code>s3</code> table function or table engine, the content type on the files was mistakenly set to <code>application/xml</code> due to a bug in the AWS SDK. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33964" target="_blank" rel="noopener noreferrer">#33964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34433" target="_blank" rel="noopener noreferrer">#34433</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Change restrictive row policies a bit to make them an easier alternative to permissive policies in easy cases. If for a particular table only restrictive policies exist (without permissive policies) users will be able to see some rows. Also <code>SHOW CREATE ROW POLICY</code> will always show <code>AS permissive</code> or <code>AS restrictive</code> in row policy&#x27;s definition. <a href="https://github.com/ClickHouse/ClickHouse/pull/34596" target="_blank" rel="noopener noreferrer">#34596</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Improve schema inference with globs in File/S3/HDFS/URL engines. Try to use the next path for schema inference in case of error. <a href="https://github.com/ClickHouse/ClickHouse/pull/34465" target="_blank" rel="noopener noreferrer">#34465</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Play UI now correctly detects the preferred light/dark theme from the OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/35068" target="_blank" rel="noopener noreferrer">#35068</a> (<a href="https://github.com/peledni" target="_blank" rel="noopener noreferrer">peledni</a>).</li><li>Added <code>date_time_input_format = &#x27;best_effort_us&#x27;</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34799" target="_blank" rel="noopener noreferrer">#34799</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34982" target="_blank" rel="noopener noreferrer">#34982</a> (<a href="https://github.com/Cai-Yao" target="_blank" rel="noopener noreferrer">WenYao</a>).</li><li>A new settings called <code>allow_plaintext_password</code> and <code>allow_no_password</code> are added in server configuration which turn on/off authentication types that can be potentially insecure in some environments. They are allowed by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/34738" target="_blank" rel="noopener noreferrer">#34738</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>).</li><li>Support for <code>DateTime64</code> data type in <code>Arrow</code> format, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8280" target="_blank" rel="noopener noreferrer">#8280</a> and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28574" target="_blank" rel="noopener noreferrer">#28574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34561" target="_blank" rel="noopener noreferrer">#34561</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Reload <code>remote_url_allow_hosts</code> (filtering of outgoing connections) on config update. <a href="https://github.com/ClickHouse/ClickHouse/pull/35294" target="_blank" rel="noopener noreferrer">#35294</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Support <code>--testmode</code> parameter for <code>clickhouse-local</code>. This parameter enables interpretation of test hints that we use in functional tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/35264" target="_blank" rel="noopener noreferrer">#35264</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>distributed_depth</code> to query log. It is like a more detailed variant of <code>is_initial_query</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/35207" target="_blank" rel="noopener noreferrer">#35207</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Respect <code>remote_url_allow_hosts</code> for <code>MySQL</code> and <code>PostgreSQL</code> table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/35191" target="_blank" rel="noopener noreferrer">#35191</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>).</li><li>Added <code>disk_name</code> field to <code>system.part_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35178" target="_blank" rel="noopener noreferrer">#35178</a> (<a href="https://github.com/Varinara" target="_blank" rel="noopener noreferrer">Artyom Yurkov</a>).</li><li>Do not retry non-rertiable errors when querying remote URLs. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35161" target="_blank" rel="noopener noreferrer">#35161</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35172" target="_blank" rel="noopener noreferrer">#35172</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support distributed INSERT SELECT queries (the setting <code>parallel_distributed_insert_select</code>) table function <code>view()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35132" target="_blank" rel="noopener noreferrer">#35132</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>More precise memory tracking during <code>INSERT</code> into <code>Buffer</code> with <code>AggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35072" target="_blank" rel="noopener noreferrer">#35072</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avoid division by zero in Query Profiler if Linux kernel has a bug. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34787" target="_blank" rel="noopener noreferrer">#34787</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35032" target="_blank" rel="noopener noreferrer">#35032</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add more sanity checks for keeper configuration: now mixing of localhost and non-local servers is not allowed, also add checks for same value of internal raft port and keeper client port. <a href="https://github.com/ClickHouse/ClickHouse/pull/35004" target="_blank" rel="noopener noreferrer">#35004</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Currently, if the user changes the settings of the system tables there will be tons of logs and ClickHouse will rename the tables every minute. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34929" target="_blank" rel="noopener noreferrer">#34929</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34949" target="_blank" rel="noopener noreferrer">#34949</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Use connection pool for Hive metastore client. <a href="https://github.com/ClickHouse/ClickHouse/pull/34940" target="_blank" rel="noopener noreferrer">#34940</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Ignore per-column <code>TTL</code> in <code>CREATE TABLE AS</code> if new table engine does not support it (i.e. if the engine is not of <code>MergeTree</code> family). <a href="https://github.com/ClickHouse/ClickHouse/pull/34938" target="_blank" rel="noopener noreferrer">#34938</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow <code>LowCardinality</code> strings for <code>ngrambf_v1</code>/<code>tokenbf_v1</code> indexes. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21865" target="_blank" rel="noopener noreferrer">#21865</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34911" target="_blank" rel="noopener noreferrer">#34911</a> (<a href="https://github.com/larspars" target="_blank" rel="noopener noreferrer">Lars Hiller Eidnes</a>).</li><li>Allow opening empty sqlite db if the file doesn&#x27;t exist. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33367" target="_blank" rel="noopener noreferrer">#33367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34907" target="_blank" rel="noopener noreferrer">#34907</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Implement memory statistics for FreeBSD - this is required for <code>max_server_memory_usage</code> to work correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/34902" target="_blank" rel="noopener noreferrer">#34902</a> (<a href="https://github.com/snar" target="_blank" rel="noopener noreferrer">Alexandre Snarskii</a>).</li><li>In previous versions the progress bar in clickhouse-client can jump forward near 50% for no reason. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34324" target="_blank" rel="noopener noreferrer">#34324</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34801" target="_blank" rel="noopener noreferrer">#34801</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Now <code>ALTER TABLE DROP COLUMN columnX</code> queries for <code>MergeTree</code> table engines will work instantly when <code>columnX</code> is an <code>ALIAS</code> column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34660" target="_blank" rel="noopener noreferrer">#34660</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34786" target="_blank" rel="noopener noreferrer">#34786</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Show hints when user mistyped the name of a data skipping index. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29698" target="_blank" rel="noopener noreferrer">#29698</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34764" target="_blank" rel="noopener noreferrer">#34764</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support <code>remote()</code>/<code>cluster()</code> table functions for <code>parallel_distributed_insert_select</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34728" target="_blank" rel="noopener noreferrer">#34728</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not reset logging that configured via <code>--log-file</code>/<code>--errorlog-file</code> command line options in case of empty configuration in the config file. <a href="https://github.com/ClickHouse/ClickHouse/pull/34718" target="_blank" rel="noopener noreferrer">#34718</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Extract schema only once on table creation and prevent reading from local files/external sources to extract schema on each server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/34684" target="_blank" rel="noopener noreferrer">#34684</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow specifying argument names for executable UDFs. This is necessary for formats where argument name is part of serialization, like <code>Native</code>, <code>JSONEachRow</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34604" target="_blank" rel="noopener noreferrer">#34604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34653" target="_blank" rel="noopener noreferrer">#34653</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>MaterializedMySQL</code> (experimental feature) now supports <code>materialized_mysql_tables_list</code> (a comma-separated list of MySQL database tables, which will be replicated by the MaterializedMySQL database engine. Default value: empty list — means all the tables will be replicated), mentioned at <a href="https://github.com/ClickHouse/ClickHouse/issues/32977" target="_blank" rel="noopener noreferrer">#32977</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34487" target="_blank" rel="noopener noreferrer">#34487</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Improve OpenTelemetry span logs for INSERT operation on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/34480" target="_blank" rel="noopener noreferrer">#34480</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Make the znode <code>ctime</code> and <code>mtime</code> consistent between servers in ClickHouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/33441" target="_blank" rel="noopener noreferrer">#33441</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-9">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-9" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Package repository is migrated to JFrog Artifactory (<strong>Mikhail f. Shiryaev</strong>).</li><li>Randomize some settings in functional tests, so more possible combinations of settings will be tested. This is yet another fuzzing method to ensure better test coverage. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32268" target="_blank" rel="noopener noreferrer">#32268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34092" target="_blank" rel="noopener noreferrer">#34092</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Drop PVS-Studio from our CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/34680" target="_blank" rel="noopener noreferrer">#34680</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add an ability to build stripped binaries with CMake. In previous versions it was performed by dh-tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/35196" target="_blank" rel="noopener noreferrer">#35196</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Smaller &quot;fat-free&quot; <code>clickhouse-keeper</code> build. <a href="https://github.com/ClickHouse/ClickHouse/pull/35031" target="_blank" rel="noopener noreferrer">#35031</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Use @robot-clickhouse as an author and committer for PRs like <a href="https://github.com/ClickHouse/ClickHouse/pull/34685" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/34685</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34793" target="_blank" rel="noopener noreferrer">#34793</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Limit DWARF version for debug info by 4 max, because our internal stack symbolizer cannot parse DWARF version 5. This makes sense if you compile ClickHouse with clang-15. <a href="https://github.com/ClickHouse/ClickHouse/pull/34777" target="_blank" rel="noopener noreferrer">#34777</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Remove <code>clickhouse-test</code> debian package as unneeded complication. CI use tests from repository and standalone testing via deb package is no longer supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/34606" target="_blank" rel="noopener noreferrer">#34606</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release">Bug Fix (user-visible misbehaviour in official stable or prestable release)<a href="#bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehaviour in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehaviour in official stable or prestable release)">​</a></h4><ul><li>A fix for HDFS integration: When the inner buffer size is too small, NEED_MORE_INPUT in <code>HadoopSnappyDecoder</code> will run multi times (&gt;=3) for one compressed block. This makes the input data be copied into the wrong place in <code>HadoopSnappyDecoder::buffer</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35116" target="_blank" rel="noopener noreferrer">#35116</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Ignore obsolete grants in ATTACH GRANT statements. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34815" target="_blank" rel="noopener noreferrer">#34815</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34855" target="_blank" rel="noopener noreferrer">#34855</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix segfault in Postgres database when getting create table query if database was created using named collections. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35312" target="_blank" rel="noopener noreferrer">#35312</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35313" target="_blank" rel="noopener noreferrer">#35313</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partial merge join duplicate rows bug, close <a href="https://github.com/ClickHouse/ClickHouse/issues/31009" target="_blank" rel="noopener noreferrer">#31009</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35311" target="_blank" rel="noopener noreferrer">#35311</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible <code>Assertion &#x27;position() != working_buffer.end()&#x27; failed</code> while using bzip2 compression with small <code>max_read_buffer_size</code> setting value. The bug was found in <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35047</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35300" target="_blank" rel="noopener noreferrer">#35300</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using lz4 compression with a small max_read_buffer_size setting value. <a href="https://github.com/ClickHouse/ClickHouse/pull/35296" target="_blank" rel="noopener noreferrer">#35296</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using lzma compression with small <code>max_read_buffer_size</code> setting value. <a href="https://github.com/ClickHouse/ClickHouse/pull/35295" target="_blank" rel="noopener noreferrer">#35295</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using <code>brotli</code> compression with a small <code>max_read_buffer_size</code> setting value. The bug was found in <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35047</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35281" target="_blank" rel="noopener noreferrer">#35281</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible segfault in <code>JSONEachRow</code> schema inference. <a href="https://github.com/ClickHouse/ClickHouse/pull/35291" target="_blank" rel="noopener noreferrer">#35291</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>CHECK TABLE</code> query in case when sparse columns are enabled in table. <a href="https://github.com/ClickHouse/ClickHouse/pull/35274" target="_blank" rel="noopener noreferrer">#35274</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Avoid std::terminate in case of exception in reading from remote VFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/35257" target="_blank" rel="noopener noreferrer">#35257</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix reading port from config, close <a href="https://github.com/ClickHouse/ClickHouse/issues/34776" target="_blank" rel="noopener noreferrer">#34776</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35193" target="_blank" rel="noopener noreferrer">#35193</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix error in query with <code>WITH TOTALS</code> in case if <code>HAVING</code> returned empty result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33711" target="_blank" rel="noopener noreferrer">#33711</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35186" target="_blank" rel="noopener noreferrer">#35186</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix a corner case of <code>replaceRegexpAll</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/35117" target="_blank" rel="noopener noreferrer">#35117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35182" target="_blank" rel="noopener noreferrer">#35182</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Schema inference didn&#x27;t work properly on case of <code>INSERT INTO FUNCTION s3(...) FROM ...</code>, it tried to read schema from s3 file instead of from select query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35176" target="_blank" rel="noopener noreferrer">#35176</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix MaterializedPostgreSQL (experimental feature) <code>table overrides</code> for partition by, etc. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35048" target="_blank" rel="noopener noreferrer">#35048</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35162" target="_blank" rel="noopener noreferrer">#35162</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix MaterializedPostgreSQL (experimental feature) adding new table to replication (ATTACH TABLE) after manually removing (DETACH TABLE). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33800" target="_blank" rel="noopener noreferrer">#33800</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34922" target="_blank" rel="noopener noreferrer">#34922</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34315" target="_blank" rel="noopener noreferrer">#34315</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35158" target="_blank" rel="noopener noreferrer">#35158</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partition pruning error when non-monotonic function is used with IN operator. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35136" target="_blank" rel="noopener noreferrer">#35136</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35146" target="_blank" rel="noopener noreferrer">#35146</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed slightly incorrect translation of YAML configs to XML. <a href="https://github.com/ClickHouse/ClickHouse/pull/35135" target="_blank" rel="noopener noreferrer">#35135</a> (<a href="https://github.com/mdonkers" target="_blank" rel="noopener noreferrer">Miel Donkers</a>).</li><li>Fix <code>optimize_skip_unused_shards_rewrite_in</code> for signed columns and negative values. <a href="https://github.com/ClickHouse/ClickHouse/pull/35134" target="_blank" rel="noopener noreferrer">#35134</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The <code>update_lag</code> external dictionary configuration option was unusable showing the error message <code>Unexpected key `update_lag` in dictionary source configuration</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35089" target="_blank" rel="noopener noreferrer">#35089</a> (<a href="https://github.com/1lann" target="_blank" rel="noopener noreferrer">Jason Chu</a>).</li><li>Avoid possible deadlock on server shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/35081" target="_blank" rel="noopener noreferrer">#35081</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix missing alias after function is optimized to a subcolumn when setting <code>optimize_functions_to_subcolumns</code> is enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33798" target="_blank" rel="noopener noreferrer">#33798</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35079" target="_blank" rel="noopener noreferrer">#35079</a> (<a href="https://github.com/qieqieplus" target="_blank" rel="noopener noreferrer">qieqieplus</a>).</li><li>Fix reading from <code>system.asynchronous_inserts</code> table if there exists asynchronous insert into table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/35050" target="_blank" rel="noopener noreferrer">#35050</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible exception <code>Reading for MergeTree family tables must be done with last position boundary</code> (relevant to operation on remote VFS). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34979" target="_blank" rel="noopener noreferrer">#34979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35001" target="_blank" rel="noopener noreferrer">#35001</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix unexpected result when use -State type aggregate function in window frame. <a href="https://github.com/ClickHouse/ClickHouse/pull/34999" target="_blank" rel="noopener noreferrer">#34999</a> (<a href="https://github.com/metahys" target="_blank" rel="noopener noreferrer">metahys</a>).</li><li>Fix possible segfault in FileLog (experimental feature). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30749" target="_blank" rel="noopener noreferrer">#30749</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34996" target="_blank" rel="noopener noreferrer">#34996</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible rare error <code>Cannot push block to port which already has data</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34993" target="_blank" rel="noopener noreferrer">#34993</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong schema inference for unquoted dates in CSV. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34768" target="_blank" rel="noopener noreferrer">#34768</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34961" target="_blank" rel="noopener noreferrer">#34961</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Integration with Hive: Fix unexpected result when use <code>in</code> in <code>where</code> in hive query. <a href="https://github.com/ClickHouse/ClickHouse/pull/34945" target="_blank" rel="noopener noreferrer">#34945</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Avoid busy polling in ClickHouse Keeper while searching for changelog files to delete. <a href="https://github.com/ClickHouse/ClickHouse/pull/34931" target="_blank" rel="noopener noreferrer">#34931</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix DateTime64 conversion from PostgreSQL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33364" target="_blank" rel="noopener noreferrer">#33364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34910" target="_blank" rel="noopener noreferrer">#34910</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible &quot;Part directory doesn&#x27;t exist&quot; during <code>INSERT</code> into MergeTree table backed by VFS over s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/34876" target="_blank" rel="noopener noreferrer">#34876</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support DDLs like CREATE USER to be executed on cross replicated cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/34860" target="_blank" rel="noopener noreferrer">#34860</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix bugs for multiple columns group by in <code>WindowView</code> (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/34859" target="_blank" rel="noopener noreferrer">#34859</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix possible failures in S2 functions when queries contain const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/34745" target="_blank" rel="noopener noreferrer">#34745</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix bug for H3 funcs containing const columns which cause queries to fail. <a href="https://github.com/ClickHouse/ClickHouse/pull/34743" target="_blank" rel="noopener noreferrer">#34743</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix <code>No such file or directory</code> with enabled <code>fsync_part_directory</code> and vertical merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/34739" target="_blank" rel="noopener noreferrer">#34739</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix serialization/printing for system queries <code>RELOAD MODEL</code>, <code>RELOAD FUNCTION</code>, <code>RESTART DISK</code> when used <code>ON CLUSTER</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34514" target="_blank" rel="noopener noreferrer">#34514</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34696" target="_blank" rel="noopener noreferrer">#34696</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix <code>allow_experimental_projection_optimization</code> with <code>enable_global_with_statement</code> (before it may lead to <code>Stack size too large</code> error in case of multiple expressions in <code>WITH</code> clause, and also it executes scalar subqueries again and again, so not it will be more optimal). <a href="https://github.com/ClickHouse/ClickHouse/pull/34650" target="_blank" rel="noopener noreferrer">#34650</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Stop to select part for mutate when the other replica has already updated the transaction log for <code>ReplatedMergeTree</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/34633" target="_blank" rel="noopener noreferrer">#34633</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix incorrect result of trivial count query when part movement feature is used <a href="https://github.com/ClickHouse/ClickHouse/issues/34089" target="_blank" rel="noopener noreferrer">#34089</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34385" target="_blank" rel="noopener noreferrer">#34385</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix inconsistency of <code>max_query_size</code> limitation in distributed subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/34078" target="_blank" rel="noopener noreferrer">#34078</a> (<a href="https://github.com/godliness" target="_blank" rel="noopener noreferrer">Chao Ma</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-v222-2022-02-17"><a id="222"></a> ClickHouse release v22.2, 2022-02-17<a href="#-clickhouse-release-v222-2022-02-17" class="hash-link" aria-label="Direct link to -clickhouse-release-v222-2022-02-17" title="Direct link to -clickhouse-release-v222-2022-02-17">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes-3">Upgrade Notes<a href="#upgrade-notes-3" class="hash-link" aria-label="Direct link to Upgrade Notes" title="Direct link to Upgrade Notes">​</a></h4><ul><li>Applying data skipping indexes for queries with FINAL may produce incorrect result. In this release we disabled data skipping indexes by default for queries with FINAL (a new setting <code>use_skip_indexes_if_final</code> is introduced and disabled by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/34243" target="_blank" rel="noopener noreferrer">#34243</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-10">New Feature<a href="#new-feature-10" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Projections are production ready. Set <code>allow_experimental_projection_optimization</code> by default and deprecate this setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/34456" target="_blank" rel="noopener noreferrer">#34456</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>An option to create a new files on insert for <code>File</code>/<code>S3</code>/<code>HDFS</code> engines. Allow to overwrite a file in <code>HDFS</code>. Throw an exception in attempt to overwrite a file in <code>S3</code> by default. Throw an exception in attempt to append data to file in formats that have a suffix (and thus don&#x27;t support appends, like <code>Parquet</code>, <code>ORC</code>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31640" target="_blank" rel="noopener noreferrer">#31640</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31622" target="_blank" rel="noopener noreferrer">#31622</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23862" target="_blank" rel="noopener noreferrer">#23862</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15022" target="_blank" rel="noopener noreferrer">#15022</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16674" target="_blank" rel="noopener noreferrer">#16674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33302" target="_blank" rel="noopener noreferrer">#33302</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add a setting that allows a user to provide own deduplication semantic in <code>MergeTree</code>/<code>ReplicatedMergeTree</code> If provided, it&#x27;s used instead of data digest to generate block ID. So, for example, by providing a unique value for the setting in each INSERT statement, the user can avoid the same inserted data being deduplicated. This closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/7461" target="_blank" rel="noopener noreferrer">#7461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32304" target="_blank" rel="noopener noreferrer">#32304</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Add support of <code>DEFAULT</code> keyword for INSERT statements. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6331" target="_blank" rel="noopener noreferrer">#6331</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33141" target="_blank" rel="noopener noreferrer">#33141</a> (<a href="https://github.com/1over" target="_blank" rel="noopener noreferrer">Andrii Buriachevskyi</a>).</li><li><code>EPHEMERAL</code> column specifier is added to <code>CREATE TABLE</code> query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9436" target="_blank" rel="noopener noreferrer">#9436</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34424" target="_blank" rel="noopener noreferrer">#34424</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">yakov-olkhovskiy</a>).</li><li>Support <code>IF EXISTS</code> clause for <code>TTL expr TO [DISK|VOLUME] [IF EXISTS] &#x27;xxx&#x27;</code> feature. Parts will be moved to disk or volume only if it exists on replica, so <code>MOVE TTL</code> rules will be able to behave differently on replicas according to the existing storage policies. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/34455" target="_blank" rel="noopener noreferrer">#34455</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34504" target="_blank" rel="noopener noreferrer">#34504</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allow set default table engine and to create tables without specifying ENGINE. <a href="https://github.com/ClickHouse/ClickHouse/pull/34187" target="_blank" rel="noopener noreferrer">#34187</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Add table function <code>format(format_name, data)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34125" target="_blank" rel="noopener noreferrer">#34125</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Detect format in <code>clickhouse-local</code> by file name even in the case when it is passed to stdin. <a href="https://github.com/ClickHouse/ClickHouse/pull/33829" target="_blank" rel="noopener noreferrer">#33829</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add schema inference for <code>values</code> table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33811" target="_blank" rel="noopener noreferrer">#33811</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34017" target="_blank" rel="noopener noreferrer">#34017</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Dynamic reload of server TLS certificates on config reload. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15764" target="_blank" rel="noopener noreferrer">#15764</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15765" target="_blank" rel="noopener noreferrer">#15765</a> (<a href="https://github.com/johnskopis" target="_blank" rel="noopener noreferrer">johnskopis</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/31257" target="_blank" rel="noopener noreferrer">#31257</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Now ReplicatedMergeTree can recover data when some of its disks are broken. <a href="https://github.com/ClickHouse/ClickHouse/pull/13544" target="_blank" rel="noopener noreferrer">#13544</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fault-tolerant connections in clickhouse-client: <code>clickhouse-client ... --host host1 --host host2 --port port2 --host host3 --port port --host host4</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34490" target="_blank" rel="noopener noreferrer">#34490</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33824" target="_blank" rel="noopener noreferrer">#33824</a> (<a href="https://github.com/DF5HSE" target="_blank" rel="noopener noreferrer">Filippov Denis</a>).</li><li>Add <code>DEGREES</code> and <code>RADIANS</code> functions for MySQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/33769" target="_blank" rel="noopener noreferrer">#33769</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>h3ToCenterChild</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33313" target="_blank" rel="noopener noreferrer">#33313</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>). Add new h3 miscellaneous functions: <code>edgeLengthKm</code>,<code>exactEdgeLengthKm</code>,<code>exactEdgeLengthM</code>,<code>exactEdgeLengthRads</code>,<code>numHexagons</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33621" target="_blank" rel="noopener noreferrer">#33621</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add function <code>bitSlice</code> to extract bit subsequences from String/FixedString. <a href="https://github.com/ClickHouse/ClickHouse/pull/33360" target="_blank" rel="noopener noreferrer">#33360</a> (<a href="https://github.com/RogerYK" target="_blank" rel="noopener noreferrer">RogerYK</a>).</li><li>Implemented <code>meanZTest</code> aggregate function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33354" target="_blank" rel="noopener noreferrer">#33354</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Add confidence intervals to T-tests aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/33260" target="_blank" rel="noopener noreferrer">#33260</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Add function <code>addressToLineWithInlines</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/26211" target="_blank" rel="noopener noreferrer">#26211</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33467" target="_blank" rel="noopener noreferrer">#33467</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Added <code>#!</code> and <code># </code> as a recognised start of a single line comment. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34138" target="_blank" rel="noopener noreferrer">#34138</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34230" target="_blank" rel="noopener noreferrer">#34230</a> (<a href="https://github.com/aaronstephenkatz" target="_blank" rel="noopener noreferrer">Aaron Katz</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-9">Experimental Feature<a href="#experimental-feature-9" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Functions for text classification: language and charset detection. See <a href="https://github.com/ClickHouse/ClickHouse/issues/23271" target="_blank" rel="noopener noreferrer">#23271</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33314" target="_blank" rel="noopener noreferrer">#33314</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Add memory overcommit to <code>MemoryTracker</code>. Added <code>guaranteed</code> settings for memory limits which represent soft memory limits. In case when hard memory limit is reached, <code>MemoryTracker</code> tries to cancel the most overcommited query. New setting <code>memory_usage_overcommit_max_wait_microseconds</code> specifies how long queries may wait another query to stop. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28375" target="_blank" rel="noopener noreferrer">#28375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31182" target="_blank" rel="noopener noreferrer">#31182</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Enable stream to table join in WindowView. <a href="https://github.com/ClickHouse/ClickHouse/pull/33729" target="_blank" rel="noopener noreferrer">#33729</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Support <code>SET</code>, <code>YEAR</code>, <code>TIME</code> and <code>GEOMETRY</code> data types in <code>MaterializedMySQL</code> (experimental feature). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18091" target="_blank" rel="noopener noreferrer">#18091</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/21536" target="_blank" rel="noopener noreferrer">#21536</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/26361" target="_blank" rel="noopener noreferrer">#26361</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33429" target="_blank" rel="noopener noreferrer">#33429</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Fix various issues when projection is enabled by default. Each issue is described in separate commit. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/33678" target="_blank" rel="noopener noreferrer">#33678</a> . This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34273" target="_blank" rel="noopener noreferrer">#34273</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34305" target="_blank" rel="noopener noreferrer">#34305</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-10">Performance Improvement<a href="#performance-improvement-10" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Support <code>optimize_read_in_order</code> if prefix of sorting key is already sorted. E.g. if we have sorting key <code>ORDER BY (a, b)</code> in table and query with <code>WHERE a = const ORDER BY b</code> clauses, now it will be applied reading in order of sorting key instead of full sort. <a href="https://github.com/ClickHouse/ClickHouse/pull/32748" target="_blank" rel="noopener noreferrer">#32748</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Improve performance of partitioned insert into table functions <code>URL</code>, <code>S3</code>, <code>File</code>, <code>HDFS</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34348" target="_blank" rel="noopener noreferrer">#34348</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34510" target="_blank" rel="noopener noreferrer">#34510</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Multiple performance improvements of clickhouse-keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/34484" target="_blank" rel="noopener noreferrer">#34484</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/34587" target="_blank" rel="noopener noreferrer">#34587</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li><code>FlatDictionary</code> improve performance of dictionary data load. <a href="https://github.com/ClickHouse/ClickHouse/pull/33871" target="_blank" rel="noopener noreferrer">#33871</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>mapPopulateSeries</code> function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33944" target="_blank" rel="noopener noreferrer">#33944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34318" target="_blank" rel="noopener noreferrer">#34318</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>_file</code> and <code>_path</code> virtual columns (in file-like table engines) are made <code>LowCardinality</code> - it will make queries for multiple files faster. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34300" target="_blank" rel="noopener noreferrer">#34300</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34317" target="_blank" rel="noopener noreferrer">#34317</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Speed up loading of data parts. It was not parallelized before: the setting <code>part_loading_threads</code> did not have effect. See <a href="https://github.com/ClickHouse/ClickHouse/issues/4699" target="_blank" rel="noopener noreferrer">#4699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34310" target="_blank" rel="noopener noreferrer">#34310</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of <code>LineAsString</code> format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34303" target="_blank" rel="noopener noreferrer">#34303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34306" target="_blank" rel="noopener noreferrer">#34306</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimize <code>quantilesExact{Low,High}</code> to use <code>nth_element</code> instead of <code>sort</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34287" target="_blank" rel="noopener noreferrer">#34287</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Slightly improve performance of <code>Regexp</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34202" target="_blank" rel="noopener noreferrer">#34202</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Minor improvement for analysis of scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/34128" target="_blank" rel="noopener noreferrer">#34128</a> (<a href="https://github.com/fedrod" target="_blank" rel="noopener noreferrer">Federico Rodriguez</a>).</li><li>Make ORDER BY tuple almost as fast as ORDER BY columns. We have special optimizations for multiple column ORDER BY: <a href="https://github.com/ClickHouse/ClickHouse/pull/10831" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/10831</a> . It&#x27;s beneficial to also apply to tuple columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/34060" target="_blank" rel="noopener noreferrer">#34060</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Rework and reintroduce the scalar subqueries cache to Materialized Views execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/33958" target="_blank" rel="noopener noreferrer">#33958</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Slightly improve performance of <code>ORDER BY</code> by adding x86-64 AVX-512 support for <code>memcmpSmall</code> functions to accelerate memory comparison. It works only if you compile ClickHouse by yourself. <a href="https://github.com/ClickHouse/ClickHouse/pull/33706" target="_blank" rel="noopener noreferrer">#33706</a> (<a href="https://github.com/hanqf-git" target="_blank" rel="noopener noreferrer">hanqf-git</a>).</li><li>Improve <code>range_hashed</code> dictionary performance if for key there are a lot of intervals. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23821" target="_blank" rel="noopener noreferrer">#23821</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33516" target="_blank" rel="noopener noreferrer">#33516</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>For inserts and merges into S3, write files in parallel whenever possible (TODO: check if it&#x27;s merged). <a href="https://github.com/ClickHouse/ClickHouse/pull/33291" target="_blank" rel="noopener noreferrer">#33291</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Improve <code>clickhouse-keeper</code> performance and fix several memory leaks in NuRaft library. <a href="https://github.com/ClickHouse/ClickHouse/pull/33329" target="_blank" rel="noopener noreferrer">#33329</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-10">Improvement<a href="#improvement-10" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Support asynchronous inserts in <code>clickhouse-client</code> for queries with inlined data. <a href="https://github.com/ClickHouse/ClickHouse/pull/34267" target="_blank" rel="noopener noreferrer">#34267</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Functions <code>dictGet</code>, <code>dictHas</code> implicitly cast key argument to dictionary key structure, if they are different. <a href="https://github.com/ClickHouse/ClickHouse/pull/33672" target="_blank" rel="noopener noreferrer">#33672</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improvements for <code>range_hashed</code> dictionaries. Improve performance of load time if there are multiple attributes. Allow to create a dictionary without attributes. Added option to specify strategy when intervals <code>start</code> and <code>end</code> have <code>Nullable</code> type <code>convert_null_range_bound_to_open</code> by default is <code>true</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29791" target="_blank" rel="noopener noreferrer">#29791</a>. Allow to specify <code>Float</code>, <code>Decimal</code>, <code>DateTime64</code>, <code>Int128</code>, <code>Int256</code>, <code>UInt128</code>, <code>UInt256</code> as range types. <code>RangeHashedDictionary</code> added support for range values that extend <code>Int64</code> type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28322" target="_blank" rel="noopener noreferrer">#28322</a>. Added option <code>range_lookup_strategy</code> to specify range lookup type <code>min</code>, <code>max</code> by default is <code>min</code> . Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21647" target="_blank" rel="noopener noreferrer">#21647</a>. Fixed allocated bytes calculations. Fixed type name in <code>system.dictionaries</code> in case of <code>ComplexKeyHashedDictionary</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33927" target="_blank" rel="noopener noreferrer">#33927</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>flat</code>, <code>hashed</code>, <code>hashed_array</code> dictionaries now support creating with empty attributes, with support of reading the keys and using <code>dictHas</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33820" target="_blank" rel="noopener noreferrer">#33820</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33918" target="_blank" rel="noopener noreferrer">#33918</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added support for <code>DateTime64</code> data type in dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/33914" target="_blank" rel="noopener noreferrer">#33914</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow to write <code>s3(url, access_key_id, secret_access_key)</code> (autodetect of data format and table structure, but with explicit credentials). <a href="https://github.com/ClickHouse/ClickHouse/pull/34503" target="_blank" rel="noopener noreferrer">#34503</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Added sending of the output format back to client like it&#x27;s done in HTTP protocol as suggested in <a href="https://github.com/ClickHouse/ClickHouse/issues/34362" target="_blank" rel="noopener noreferrer">#34362</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34362" target="_blank" rel="noopener noreferrer">#34362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34499" target="_blank" rel="noopener noreferrer">#34499</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Send ProfileEvents statistics in case of INSERT SELECT query (to display query metrics in <code>clickhouse-client</code> for this type of queries). <a href="https://github.com/ClickHouse/ClickHouse/pull/34498" target="_blank" rel="noopener noreferrer">#34498</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Recognize <code>.jsonl</code> extension for JSONEachRow format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34496" target="_blank" rel="noopener noreferrer">#34496</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Improve schema inference in clickhouse-local. Allow to write just <code>clickhouse-local -q &quot;select * from table&quot; &lt; data.format</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34495" target="_blank" rel="noopener noreferrer">#34495</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Privileges CREATE/ALTER/DROP ROW POLICY now can be granted on a table or on <code>database.*</code> as well as globally <code>*.*</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34489" target="_blank" rel="noopener noreferrer">#34489</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow to export arbitrary large files to <code>s3</code>. Add two new settings: <code>s3_upload_part_size_multiply_factor</code> and <code>s3_upload_part_size_multiply_parts_count_threshold</code>. Now each time <code>s3_upload_part_size_multiply_parts_count_threshold</code> uploaded to S3 from a single query <code>s3_min_upload_part_size</code> multiplied by <code>s3_upload_part_size_multiply_factor</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34244" target="_blank" rel="noopener noreferrer">#34244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34422" target="_blank" rel="noopener noreferrer">#34422</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow to skip not found (404) URLs for globs when using URL storage / table function. Also closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34359" target="_blank" rel="noopener noreferrer">#34359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34392" target="_blank" rel="noopener noreferrer">#34392</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Default input and output formats for <code>clickhouse-local</code> that can be overriden by --input-format and --output-format. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30631" target="_blank" rel="noopener noreferrer">#30631</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34352" target="_blank" rel="noopener noreferrer">#34352</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Add options for <code>clickhouse-format</code>. Which close <a href="https://github.com/ClickHouse/ClickHouse/issues/30528" target="_blank" rel="noopener noreferrer">#30528</a> - <code>max_query_size</code> - <code>max_parser_depth</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34349" target="_blank" rel="noopener noreferrer">#34349</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Better handling of pre-inputs before client start. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/34308" target="_blank" rel="noopener noreferrer">#34308</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34336" target="_blank" rel="noopener noreferrer">#34336</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li><code>REGEXP_MATCHES</code> and <code>REGEXP_REPLACE</code> function aliases for compatibility with PostgreSQL. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30885" target="_blank" rel="noopener noreferrer">#30885</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34334" target="_blank" rel="noopener noreferrer">#34334</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Some servers expect a User-Agent header in their HTTP requests. A <code>User-Agent</code> header entry has been added to HTTP requests of the form: User-Agent: ClickHouse/VERSION_STRING. <a href="https://github.com/ClickHouse/ClickHouse/pull/34330" target="_blank" rel="noopener noreferrer">#34330</a> (<a href="https://github.com/surahman" target="_blank" rel="noopener noreferrer">Saad Ur Rahman</a>).</li><li>Cancel merges before acquiring table lock for <code>TRUNCATE</code> query to avoid <code>DEADLOCK_AVOIDED</code> error in some cases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34302" target="_blank" rel="noopener noreferrer">#34302</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34304" target="_blank" rel="noopener noreferrer">#34304</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Change severity of the &quot;Cancelled merging parts&quot; message in logs, because it&#x27;s not an error. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34148" target="_blank" rel="noopener noreferrer">#34148</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34232" target="_blank" rel="noopener noreferrer">#34232</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add ability to compose PostgreSQL-style cast operator <code>::</code> with expressions using <code>[]</code> and <code>.</code> operators (array and tuple indexing). <a href="https://github.com/ClickHouse/ClickHouse/pull/34229" target="_blank" rel="noopener noreferrer">#34229</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Recognize <code>YYYYMMDD-hhmmss</code> format in <code>parseDateTimeBestEffort</code> function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34206" target="_blank" rel="noopener noreferrer">#34206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34208" target="_blank" rel="noopener noreferrer">#34208</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow carriage return in the middle of the line while parsing by <code>Regexp</code> format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34200" target="_blank" rel="noopener noreferrer">#34200</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34205" target="_blank" rel="noopener noreferrer">#34205</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to parse dictionary&#x27;s <code>PRIMARY KEY</code> as <code>PRIMARY KEY (id, value)</code>; previously supported only <code>PRIMARY KEY id, value</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34135" target="_blank" rel="noopener noreferrer">#34135</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34141" target="_blank" rel="noopener noreferrer">#34141</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>An optional argument for <code>splitByChar</code> to limit the number of resulting elements. close <a href="https://github.com/ClickHouse/ClickHouse/issues/34081" target="_blank" rel="noopener noreferrer">#34081</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34140" target="_blank" rel="noopener noreferrer">#34140</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improving the experience of multiple line editing for clickhouse-client. This is a follow-up of <a href="https://github.com/ClickHouse/ClickHouse/pull/31123" target="_blank" rel="noopener noreferrer">#31123</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34114" target="_blank" rel="noopener noreferrer">#34114</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>UUID</code> suport in <code>MsgPack</code> input/output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34065" target="_blank" rel="noopener noreferrer">#34065</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Tracing context (for OpenTelemetry) is now propagated from GRPC client metadata (this change is relevant for GRPC client-server protocol). <a href="https://github.com/ClickHouse/ClickHouse/pull/34064" target="_blank" rel="noopener noreferrer">#34064</a> (<a href="https://github.com/andremarianiello" target="_blank" rel="noopener noreferrer">andremarianiello</a>).</li><li>Supports all types of <code>SYSTEM</code> queries with <code>ON CLUSTER</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/34005" target="_blank" rel="noopener noreferrer">#34005</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Improve memory accounting for queries that are using less than <code>max_untracker_memory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34001" target="_blank" rel="noopener noreferrer">#34001</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed UTF-8 string case-insensitive search when lowercase and uppercase characters are represented by different number of bytes. Example is <code>ẞ</code> and <code>ß</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7334" target="_blank" rel="noopener noreferrer">#7334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33992" target="_blank" rel="noopener noreferrer">#33992</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>Detect format and schema from stdin in <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33960" target="_blank" rel="noopener noreferrer">#33960</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Correctly handle the case of misconfiguration when multiple disks are using the same path on the filesystem. <a href="https://github.com/ClickHouse/ClickHouse/issues/29072" target="_blank" rel="noopener noreferrer">#29072</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33905" target="_blank" rel="noopener noreferrer">#33905</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>Try every resolved IP address while getting S3 proxy. S3 proxies are rarely used, mostly in Yandex Cloud. <a href="https://github.com/ClickHouse/ClickHouse/pull/33862" target="_blank" rel="noopener noreferrer">#33862</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Support EXPLAIN AST CREATE FUNCTION query <code>EXPLAIN AST CREATE FUNCTION mycast AS (n) -&gt; cast(n as String)</code> will return <code>EXPLAIN AST CREATE FUNCTION mycast AS n -&gt; CAST(n, &#x27;String&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33819" target="_blank" rel="noopener noreferrer">#33819</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Added support for cast from <code>Map(Key, Value)</code> to <code>Array(Tuple(Key, Value))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33794" target="_blank" rel="noopener noreferrer">#33794</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add some improvements and fixes for <code>Bool</code> data type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33244" target="_blank" rel="noopener noreferrer">#33244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33737" target="_blank" rel="noopener noreferrer">#33737</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Parse and store OpenTelemetry trace-id in big-endian order. <a href="https://github.com/ClickHouse/ClickHouse/pull/33723" target="_blank" rel="noopener noreferrer">#33723</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Improvement for <code>fromUnixTimestamp64</code> family functions.. They now accept any integer value that can be converted to <code>Int64</code>. This closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/14648" target="_blank" rel="noopener noreferrer">#14648</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33505" target="_blank" rel="noopener noreferrer">#33505</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Reimplement <code>_shard_num</code> from constants (see <a href="https://github.com/ClickHouse/ClickHouse/issues/7624" target="_blank" rel="noopener noreferrer">#7624</a>) with <code>shardNum()</code> function (seee <a href="https://github.com/ClickHouse/ClickHouse/issues/27020" target="_blank" rel="noopener noreferrer">#27020</a>), to avoid possible issues (like those that had been found in <a href="https://github.com/ClickHouse/ClickHouse/issues/16947" target="_blank" rel="noopener noreferrer">#16947</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33392" target="_blank" rel="noopener noreferrer">#33392</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Enable binary arithmetic (plus, minus, multiply, division, least, greatest) between Decimal and Float. <a href="https://github.com/ClickHouse/ClickHouse/pull/33355" target="_blank" rel="noopener noreferrer">#33355</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Respect cgroups limits in max_threads autodetection. <a href="https://github.com/ClickHouse/ClickHouse/pull/33342" target="_blank" rel="noopener noreferrer">#33342</a> (<a href="https://github.com/JaySon-Huang" target="_blank" rel="noopener noreferrer">JaySon</a>).</li><li>Add new clickhouse-keeper setting <code>min_session_timeout_ms</code>. Now clickhouse-keeper will determine client session timeout according to <code>min_session_timeout_ms</code> and <code>session_timeout_ms</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/33288" target="_blank" rel="noopener noreferrer">#33288</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Added <code>UUID</code> data type support for functions <code>hex</code> and <code>bin</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32170" target="_blank" rel="noopener noreferrer">#32170</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix reading of subcolumns with dots in their names. In particular fixed reading of <code>Nested</code> columns, if their element names contain dots (e.g <code>Nested(`keys.name` String, `keys.id` UInt64, values UInt64)</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/34228" target="_blank" rel="noopener noreferrer">#34228</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixes <code>parallel_view_processing = 0</code> not working when inserting into a table using <code>VALUES</code>. - Fixes <code>view_duration_ms</code> in the <code>query_views_log</code> not being set correctly for materialized views. <a href="https://github.com/ClickHouse/ClickHouse/pull/34067" target="_blank" rel="noopener noreferrer">#34067</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix parsing tables structure from ZooKeeper: now metadata from ZooKeeper compared with local metadata in canonical form. It helps when canonical function names can change between ClickHouse versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/33933" target="_blank" rel="noopener noreferrer">#33933</a> (<a href="https://github.com/sunny19930321" target="_blank" rel="noopener noreferrer">sunny</a>).</li><li>Properly escape some characters for interaction with LDAP. <a href="https://github.com/ClickHouse/ClickHouse/pull/33401" target="_blank" rel="noopener noreferrer">#33401</a> (<a href="https://github.com/IlyaTsoi" target="_blank" rel="noopener noreferrer">IlyaTsoi</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-10">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-10" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Remove unbundled build support. <a href="https://github.com/ClickHouse/ClickHouse/pull/33690" target="_blank" rel="noopener noreferrer">#33690</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Ensure that tests don&#x27;t depend on the result of non-stable sorting of equal elements. Added equal items ranges randomization in debug after sort to prevent issues when we rely on equal items sort order. <a href="https://github.com/ClickHouse/ClickHouse/pull/34393" target="_blank" rel="noopener noreferrer">#34393</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add verbosity to a style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/34289" target="_blank" rel="noopener noreferrer">#34289</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Remove <code>clickhouse-test</code> debian package because it&#x27;s obsolete. <a href="https://github.com/ClickHouse/ClickHouse/pull/33948" target="_blank" rel="noopener noreferrer">#33948</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Multiple improvements for build system to remove the possibility of occasionally using packages from the OS and to enforce hermetic builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/33695" target="_blank" rel="noopener noreferrer">#33695</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release-1">Bug Fix (user-visible misbehaviour in official stable or prestable release)<a href="#bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release-1" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehaviour in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehaviour in official stable or prestable release)">​</a></h4><ul><li>Fixed the assertion in case of using <code>allow_experimental_parallel_reading_from_replicas</code> with <code>max_parallel_replicas</code> equals to 1. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34525" target="_blank" rel="noopener noreferrer">#34525</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34613" target="_blank" rel="noopener noreferrer">#34613</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix rare bug while reading of empty arrays, which could lead to <code>Data compressed with different methods</code> error. It can reproduce if you have mostly empty arrays, but not always. And reading is performed in backward direction with ORDER BY ... DESC. This error is extremely unlikely to happen. <a href="https://github.com/ClickHouse/ClickHouse/pull/34327" target="_blank" rel="noopener noreferrer">#34327</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong result of <code>round</code>/<code>roundBankers</code> if integer values of small types are rounded. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33267" target="_blank" rel="noopener noreferrer">#33267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34562" target="_blank" rel="noopener noreferrer">#34562</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Sometimes query cancellation did not work immediately when we were reading multiple files from s3 or HDFS. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34301" target="_blank" rel="noopener noreferrer">#34301</a> Relates to <a href="https://github.com/ClickHouse/ClickHouse/issues/34397" target="_blank" rel="noopener noreferrer">#34397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34539" target="_blank" rel="noopener noreferrer">#34539</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix exception <code>Chunk should have AggregatedChunkInfo in MergingAggregatedTransform</code> (in case of <code>optimize_aggregation_in_order = 1</code> and <code>distributed_aggregation_memory_efficient = 0</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34526" target="_blank" rel="noopener noreferrer">#34526</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34532" target="_blank" rel="noopener noreferrer">#34532</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix comparison between integers and floats in index analysis. Previously it could lead to skipping some granules for reading by mistake. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34493" target="_blank" rel="noopener noreferrer">#34493</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34528" target="_blank" rel="noopener noreferrer">#34528</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix compression support in URL engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/34524" target="_blank" rel="noopener noreferrer">#34524</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix possible error &#x27;file_size: Operation not supported&#x27; in files&#x27; schema autodetection. <a href="https://github.com/ClickHouse/ClickHouse/pull/34479" target="_blank" rel="noopener noreferrer">#34479</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixes possible race with table deletion. <a href="https://github.com/ClickHouse/ClickHouse/pull/34416" target="_blank" rel="noopener noreferrer">#34416</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible error <code>Cannot convert column Function to mask</code> in short circuit function evaluation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34171" target="_blank" rel="noopener noreferrer">#34171</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34415" target="_blank" rel="noopener noreferrer">#34415</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix potential crash when doing schema inference from url source. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34147" target="_blank" rel="noopener noreferrer">#34147</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34405" target="_blank" rel="noopener noreferrer">#34405</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>For UDFs access permissions were checked for database level instead of global level as it should be. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34281" target="_blank" rel="noopener noreferrer">#34281</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34404" target="_blank" rel="noopener noreferrer">#34404</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix wrong engine syntax in result of <code>SHOW CREATE DATABASE</code> query for databases with engine <code>Memory</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34335" target="_blank" rel="noopener noreferrer">#34335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34345" target="_blank" rel="noopener noreferrer">#34345</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed a couple of extremely rare race conditions that might lead to broken state of replication queue and &quot;intersecting parts&quot; error. <a href="https://github.com/ClickHouse/ClickHouse/pull/34297" target="_blank" rel="noopener noreferrer">#34297</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix progress bar width. It was incorrectly rounded to integer number of characters. <a href="https://github.com/ClickHouse/ClickHouse/pull/34275" target="_blank" rel="noopener noreferrer">#34275</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix current_user/current_address client information fields for inter-server communication (before this patch current_user/current_address will be preserved from the previous query). <a href="https://github.com/ClickHouse/ClickHouse/pull/34263" target="_blank" rel="noopener noreferrer">#34263</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory leak in case of some Exception during query processing with <code>optimize_aggregation_in_order=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34234" target="_blank" rel="noopener noreferrer">#34234</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix metric <code>Query</code>, which shows the number of executing queries. In last several releases it was always 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/34224" target="_blank" rel="noopener noreferrer">#34224</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix schema inference for table runction <code>s3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34186" target="_blank" rel="noopener noreferrer">#34186</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix rare and benign race condition in <code>HDFS</code>, <code>S3</code> and <code>URL</code> storage engines which can lead to additional connections. <a href="https://github.com/ClickHouse/ClickHouse/pull/34172" target="_blank" rel="noopener noreferrer">#34172</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug which can rarely lead to error &quot;Cannot read all data&quot; while reading LowCardinality columns of MergeTree table engines family which stores data on remote file system like S3 (virtual filesystem over s3 is an experimental feature that is not ready for production). <a href="https://github.com/ClickHouse/ClickHouse/pull/34139" target="_blank" rel="noopener noreferrer">#34139</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix inserts to distributed tables in case of a change of native protocol. The last change was in the version 22.1, so there may be some failures of inserts to distributed tables after upgrade to that version. <a href="https://github.com/ClickHouse/ClickHouse/pull/34132" target="_blank" rel="noopener noreferrer">#34132</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible data race in <code>File</code> table engine that was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/33960" target="_blank" rel="noopener noreferrer">#33960</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34111" target="_blank" rel="noopener noreferrer">#34111</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34113" target="_blank" rel="noopener noreferrer">#34113</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed minor race condition that might cause &quot;intersecting parts&quot; error in extremely rare cases after ZooKeeper connection loss. <a href="https://github.com/ClickHouse/ClickHouse/pull/34096" target="_blank" rel="noopener noreferrer">#34096</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix asynchronous inserts with <code>Native</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34068" target="_blank" rel="noopener noreferrer">#34068</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug which lead to inability for server to start when both replicated access storage and keeper (embedded in clickhouse-server) are used. Introduced two settings for keeper socket timeout instead of settings from default user: <code>keeper_server.socket_receive_timeout_sec</code> and <code>keeper_server.socket_send_timeout_sec</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33973" target="_blank" rel="noopener noreferrer">#33973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33988" target="_blank" rel="noopener noreferrer">#33988</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix segfault while parsing ORC file with corrupted footer. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33797" target="_blank" rel="noopener noreferrer">#33797</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33984" target="_blank" rel="noopener noreferrer">#33984</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix parsing IPv6 from query parameter (prepared statements) and fix IPv6 to string conversion. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33928" target="_blank" rel="noopener noreferrer">#33928</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33971" target="_blank" rel="noopener noreferrer">#33971</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix crash while reading of nested tuples. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33838" target="_blank" rel="noopener noreferrer">#33838</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33956" target="_blank" rel="noopener noreferrer">#33956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix usage of functions <code>array</code> and <code>tuple</code> with literal arguments in distributed queries. Previously it could lead to <code>Not found columns</code> exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/33938" target="_blank" rel="noopener noreferrer">#33938</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Aggregate function combinator <code>-If</code> did not correctly process <code>Nullable</code> filter argument. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27073" target="_blank" rel="noopener noreferrer">#27073</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33920" target="_blank" rel="noopener noreferrer">#33920</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential race condition when doing remote disk read (virtual filesystem over s3 is an experimental feature that is not ready for production). <a href="https://github.com/ClickHouse/ClickHouse/pull/33912" target="_blank" rel="noopener noreferrer">#33912</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix crash if SQL UDF is created with lambda with non identifier arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33866" target="_blank" rel="noopener noreferrer">#33866</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33868" target="_blank" rel="noopener noreferrer">#33868</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix usage of sparse columns (which can be enabled by experimental setting <code>ratio_of_defaults_for_sparse_serialization</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33849" target="_blank" rel="noopener noreferrer">#33849</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed <code>replica is not readonly</code> logical error on <code>SYSTEM RESTORE REPLICA</code> query when replica is actually readonly. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33806" target="_blank" rel="noopener noreferrer">#33806</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33847" target="_blank" rel="noopener noreferrer">#33847</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix memory leak in <code>clickhouse-keeper</code> in case of compression is used (default). <a href="https://github.com/ClickHouse/ClickHouse/pull/33840" target="_blank" rel="noopener noreferrer">#33840</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix index analysis with no common types available. <a href="https://github.com/ClickHouse/ClickHouse/pull/33833" target="_blank" rel="noopener noreferrer">#33833</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix schema inference for <code>JSONEachRow</code> and <code>JSONCompactEachRow</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33830" target="_blank" rel="noopener noreferrer">#33830</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix usage of external dictionaries with <code>redis</code> source and large number of keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/33804" target="_blank" rel="noopener noreferrer">#33804</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug in client that led to &#x27;Connection reset by peer&#x27; in server. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33309" target="_blank" rel="noopener noreferrer">#33309</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33790" target="_blank" rel="noopener noreferrer">#33790</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix parsing query INSERT INTO ... VALUES SETTINGS ... (...), ... <a href="https://github.com/ClickHouse/ClickHouse/pull/33776" target="_blank" rel="noopener noreferrer">#33776</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix bug of check table when creating data part with wide format and projection. <a href="https://github.com/ClickHouse/ClickHouse/pull/33774" target="_blank" rel="noopener noreferrer">#33774</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Fix tiny race between count() and INSERT/merges/... in MergeTree (it is possible to return incorrect number of rows for SELECT with optimize_trivial_count_query). <a href="https://github.com/ClickHouse/ClickHouse/pull/33753" target="_blank" rel="noopener noreferrer">#33753</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Throw exception when directory listing request has failed in storage HDFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/33724" target="_blank" rel="noopener noreferrer">#33724</a> (<a href="https://github.com/liuneng1994" target="_blank" rel="noopener noreferrer">LiuNeng</a>).</li><li>Fix mutation when table contains projections. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33010" target="_blank" rel="noopener noreferrer">#33010</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33275" target="_blank" rel="noopener noreferrer">#33275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33679" target="_blank" rel="noopener noreferrer">#33679</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Correctly determine current database if <code>CREATE TEMPORARY TABLE AS SELECT</code> is queried inside a named HTTP session. This is a very rare use case. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8340" target="_blank" rel="noopener noreferrer">#8340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33676" target="_blank" rel="noopener noreferrer">#33676</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow some queries with sorting, LIMIT BY, ARRAY JOIN and lambda functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7462" target="_blank" rel="noopener noreferrer">#7462</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33675" target="_blank" rel="noopener noreferrer">#33675</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug in &quot;zero copy replication&quot; (a feature that is under development and should not be used in production) which lead to data duplication in case of TTL move. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33643" target="_blank" rel="noopener noreferrer">#33643</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33642" target="_blank" rel="noopener noreferrer">#33642</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>Chunk should have AggregatedChunkInfo in GroupingAggregatedTransform</code> (in case of <code>optimize_aggregation_in_order = 1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33637" target="_blank" rel="noopener noreferrer">#33637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix error <code>Bad cast from type ... to DB::DataTypeArray</code> which may happen when table has <code>Nested</code> column with dots in name, and default value is generated for it (e.g. during insert, when column is not listed). Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/28762" target="_blank" rel="noopener noreferrer">#28762</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33588" target="_blank" rel="noopener noreferrer">#33588</a> (<a href="https://github.com/alexeypavlenko" target="_blank" rel="noopener noreferrer">Alexey Pavlenko</a>).</li><li>Export into <code>lz4</code> files has been fixed. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31421" target="_blank" rel="noopener noreferrer">#31421</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31862" target="_blank" rel="noopener noreferrer">#31862</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix potential crash if <code>group_by_overflow_mode</code> was set to <code>any</code> (approximate GROUP BY) and aggregation was performed by single column of type <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34506" target="_blank" rel="noopener noreferrer">#34506</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li><li>Fix inserting to temporary tables via gRPC client-server protocol. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34347" target="_blank" rel="noopener noreferrer">#34347</a>, issue <code>#2</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34364" target="_blank" rel="noopener noreferrer">#34364</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix issue <a href="https://github.com/ClickHouse/ClickHouse/issues/19429" target="_blank" rel="noopener noreferrer">#19429</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34225" target="_blank" rel="noopener noreferrer">#34225</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix issue <a href="https://github.com/ClickHouse/ClickHouse/issues/18206" target="_blank" rel="noopener noreferrer">#18206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33977" target="_blank" rel="noopener noreferrer">#33977</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>This PR allows using multiple LDAP storages in the same list of user directories. It worked earlier but was broken because LDAP tests are disabled (they are part of the testflows tests). <a href="https://github.com/ClickHouse/ClickHouse/pull/33574" target="_blank" rel="noopener noreferrer">#33574</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-clickhouse-release-v221-2022-01-18"><a id="221"></a> ClickHouse release v22.1, 2022-01-18<a href="#-clickhouse-release-v221-2022-01-18" class="hash-link" aria-label="Direct link to -clickhouse-release-v221-2022-01-18" title="Direct link to -clickhouse-release-v221-2022-01-18">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes-4">Upgrade Notes<a href="#upgrade-notes-4" class="hash-link" aria-label="Direct link to Upgrade Notes" title="Direct link to Upgrade Notes">​</a></h4><ul><li>The functions <code>left</code> and <code>right</code> were previously implemented in parser and now full-featured. Distributed queries with <code>left</code> or <code>right</code> functions without aliases may throw exception if cluster contains different versions of clickhouse-server. If you are upgrading your cluster and encounter this error, you should finish upgrading your cluster to ensure all nodes have the same version. Also you can add aliases (<code>AS something</code>) to the columns in your queries to avoid this issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/33407" target="_blank" rel="noopener noreferrer">#33407</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Resource usage by scalar subqueries is fully accounted since this version. With this change, rows read in scalar subqueries are now reported in the query_log. If the scalar subquery is cached (repeated or called for several rows) the rows read are only counted once. This change allows KILLing queries and reporting progress while they are executing scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/32271" target="_blank" rel="noopener noreferrer">#32271</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-feature-11">New Feature<a href="#new-feature-11" class="hash-link" aria-label="Direct link to New Feature" title="Direct link to New Feature">​</a></h4><ul><li>Implement data schema inference for input formats. Allow to skip structure (or write just <code>auto</code>) in table functions <code>file</code>, <code>url</code>, <code>s3</code>, <code>hdfs</code> and in parameters of <code>clickhouse-local</code> . Allow to skip structure in create query for table engines <code>File</code>, <code>HDFS</code>, <code>S3</code>, <code>URL</code>, <code>Merge</code>, <code>Buffer</code>, <code>Distributed</code> and <code>ReplicatedMergeTree</code> (if we add new replicas). <a href="https://github.com/ClickHouse/ClickHouse/pull/32455" target="_blank" rel="noopener noreferrer">#32455</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Detect format by file extension in <code>file</code>/<code>hdfs</code>/<code>s3</code>/<code>url</code> table functions and <code>HDFS</code>/<code>S3</code>/<code>URL</code> table engines and also for <code>SELECT INTO OUTFILE</code> and <code>INSERT FROM INFILE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/33565" target="_blank" rel="noopener noreferrer">#33565</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30918" target="_blank" rel="noopener noreferrer">#30918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33443" target="_blank" rel="noopener noreferrer">#33443</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>A tool for collecting diagnostics data if you need support. <a href="https://github.com/ClickHouse/ClickHouse/pull/33175" target="_blank" rel="noopener noreferrer">#33175</a> (<a href="https://github.com/Alex-Burmak" target="_blank" rel="noopener noreferrer">Alexander Burmak</a>).</li><li>Automatic cluster discovery via Zoo/Keeper. It allows to add replicas to the cluster without changing configuration on every server. <a href="https://github.com/ClickHouse/ClickHouse/pull/31442" target="_blank" rel="noopener noreferrer">#31442</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Implement hive table engine to access apache hive from clickhouse. This implements: <a href="https://github.com/ClickHouse/ClickHouse/issues/29245" target="_blank" rel="noopener noreferrer">#29245</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31104" target="_blank" rel="noopener noreferrer">#31104</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Add aggregate functions <code>cramersV</code>, <code>cramersVBiasCorrected</code>, <code>theilsU</code> and <code>contingency</code>. These functions calculate dependency (measure of association) between categorical values. All these functions are using cross-tab (histogram on pairs) for implementation. You can imagine it like a correlation coefficient but for any discrete values (not necessary numbers). <a href="https://github.com/ClickHouse/ClickHouse/pull/33366" target="_blank" rel="noopener noreferrer">#33366</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). Initial implementation by <a href="https://github.com/Vanyok-All-is-OK" target="_blank" rel="noopener noreferrer">Vanyok-All-is-OK</a> and <a href="https://github.com/antikvist" target="_blank" rel="noopener noreferrer">antikvist</a>.</li><li>Added table function <code>hdfsCluster</code> which allows processing files from HDFS in parallel from many nodes in a specified cluster, similarly to <code>s3Cluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32400" target="_blank" rel="noopener noreferrer">#32400</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>).</li><li>Adding support for disks backed by Azure Blob Storage, in a similar way it has been done for disks backed by AWS S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/31505" target="_blank" rel="noopener noreferrer">#31505</a> (<a href="https://github.com/jkuklis" target="_blank" rel="noopener noreferrer">Jakub Kuklis</a>).</li><li>Allow <code>COMMENT</code> in <code>CREATE VIEW</code> (for all VIEW kinds). <a href="https://github.com/ClickHouse/ClickHouse/pull/31062" target="_blank" rel="noopener noreferrer">#31062</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Dynamically reinitialize listening ports and protocols when configuration changes. <a href="https://github.com/ClickHouse/ClickHouse/pull/30549" target="_blank" rel="noopener noreferrer">#30549</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Added <code>left</code>, <code>right</code>, <code>leftUTF8</code>, <code>rightUTF8</code> functions. Fix error in implementation of <code>substringUTF8</code> function with negative offset (offset from the end of string). <a href="https://github.com/ClickHouse/ClickHouse/pull/33407" target="_blank" rel="noopener noreferrer">#33407</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add new functions for <code>H3</code> coordinate system: <code>h3HexAreaKm2</code>, <code>h3CellAreaM2</code>, <code>h3CellAreaRads2</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33479" target="_blank" rel="noopener noreferrer">#33479</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>MONTHNAME</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33436" target="_blank" rel="noopener noreferrer">#33436</a> (<a href="https://github.com/usurai" target="_blank" rel="noopener noreferrer">usurai</a>).</li><li>Added function <code>arrayLast</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33390" target="_blank" rel="noopener noreferrer">#33390</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33415" target="_blank" rel="noopener noreferrer">#33415</a> Added function <code>arrayLastIndex</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33465" target="_blank" rel="noopener noreferrer">#33465</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add function <code>decodeURLFormComponent</code> slightly different to <code>decodeURLComponent</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/10298" target="_blank" rel="noopener noreferrer">#10298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33451" target="_blank" rel="noopener noreferrer">#33451</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Allow to split <code>GraphiteMergeTree</code> rollup rules for plain/tagged metrics (optional rule_type field). <a href="https://github.com/ClickHouse/ClickHouse/pull/33494" target="_blank" rel="noopener noreferrer">#33494</a> (<a href="https://github.com/msaf1980" target="_blank" rel="noopener noreferrer">Michail Safronov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvement-11">Performance Improvement<a href="#performance-improvement-11" class="hash-link" aria-label="Direct link to Performance Improvement" title="Direct link to Performance Improvement">​</a></h4><ul><li>Support moving conditions to <code>PREWHERE</code> (setting <code>optimize_move_to_prewhere</code>) for tables of <code>Merge</code> engine if its all underlying tables supports <code>PREWHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33300" target="_blank" rel="noopener noreferrer">#33300</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>More efficient handling of globs for URL storage. Now you can easily query million URLs in parallel with retries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32866" target="_blank" rel="noopener noreferrer">#32866</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32907" target="_blank" rel="noopener noreferrer">#32907</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Avoid exponential backtracking in parser. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20158" target="_blank" rel="noopener noreferrer">#20158</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33481" target="_blank" rel="noopener noreferrer">#33481</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Abuse of <code>untuple</code> function was leading to exponential complexity of query analysis (found by fuzzer). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33297" target="_blank" rel="noopener noreferrer">#33297</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33445" target="_blank" rel="noopener noreferrer">#33445</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Reduce allocated memory for dictionaries with string attributes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33466" target="_blank" rel="noopener noreferrer">#33466</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Slight performance improvement of <code>reinterpret</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/32587" target="_blank" rel="noopener noreferrer">#32587</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Non significant change. In extremely rare cases when data part is lost on every replica, after merging of some data parts, the subsequent queries may skip less amount of partitions during partition pruning. This hardly affects anything. <a href="https://github.com/ClickHouse/ClickHouse/pull/32220" target="_blank" rel="noopener noreferrer">#32220</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve <code>clickhouse-keeper</code> writing performance by optimization the size calculation logic. <a href="https://github.com/ClickHouse/ClickHouse/pull/32366" target="_blank" rel="noopener noreferrer">#32366</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Optimize single part projection materialization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31669" target="_blank" rel="noopener noreferrer">#31669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31885" target="_blank" rel="noopener noreferrer">#31885</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improve query performance of system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/33312" target="_blank" rel="noopener noreferrer">#33312</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Optimize selecting of MergeTree parts that can be moved between volumes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33225" target="_blank" rel="noopener noreferrer">#33225</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Fix <code>sparse_hashed</code> dict performance with sequential keys (wrong hash function). <a href="https://github.com/ClickHouse/ClickHouse/pull/32536" target="_blank" rel="noopener noreferrer">#32536</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="experimental-feature-10">Experimental Feature<a href="#experimental-feature-10" class="hash-link" aria-label="Direct link to Experimental Feature" title="Direct link to Experimental Feature">​</a></h4><ul><li>Parallel reading from multiple replicas within a shard during distributed query without using sample key. To enable this, set <code>allow_experimental_parallel_reading_from_replicas = 1</code> and <code>max_parallel_replicas</code> to any number. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26748" target="_blank" rel="noopener noreferrer">#26748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29279" target="_blank" rel="noopener noreferrer">#29279</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Implemented sparse serialization. It can reduce usage of disk space and improve performance of some queries for columns, which contain a lot of default (zero) values. It can be enabled by setting <code>ratio_for_sparse_serialization</code>. Sparse serialization will be chosen dynamically for column, if it has ratio of number of default values to number of all values above that threshold. Serialization (default or sparse) will be fixed for every column in part, but may varies between parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/22535" target="_blank" rel="noopener noreferrer">#22535</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add &quot;TABLE OVERRIDE&quot; feature for customizing MaterializedMySQL table schemas. <a href="https://github.com/ClickHouse/ClickHouse/pull/32325" target="_blank" rel="noopener noreferrer">#32325</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Add <code>EXPLAIN TABLE OVERRIDE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32836" target="_blank" rel="noopener noreferrer">#32836</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Support TABLE OVERRIDE clause for MaterializedPostgreSQL. RFC: <a href="https://github.com/ClickHouse/ClickHouse/issues/31480" target="_blank" rel="noopener noreferrer">#31480</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32749" target="_blank" rel="noopener noreferrer">#32749</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Change ZooKeeper path for zero-copy marks for shared data. Note that &quot;zero-copy replication&quot; is non-production feature (in early stages of development) that you shouldn&#x27;t use anyway. But in case if you have used it, let you keep in mind this change. <a href="https://github.com/ClickHouse/ClickHouse/pull/32061" target="_blank" rel="noopener noreferrer">#32061</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Events clause support for WINDOW VIEW watch query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32607" target="_blank" rel="noopener noreferrer">#32607</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix ACL with explicit digit hash in <code>clickhouse-keeper</code>: now the behavior consistent with ZooKeeper and generated digest is always accepted. <a href="https://github.com/ClickHouse/ClickHouse/pull/33249" target="_blank" rel="noopener noreferrer">#33249</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33246" target="_blank" rel="noopener noreferrer">#33246</a>.</li><li>Fix unexpected projection removal when detaching parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/32067" target="_blank" rel="noopener noreferrer">#32067</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvement-11">Improvement<a href="#improvement-11" class="hash-link" aria-label="Direct link to Improvement" title="Direct link to Improvement">​</a></h4><ul><li>Now date time conversion functions that generates time before <code>1970-01-01 00:00:00</code> will be saturated to zero instead of overflow. <a href="https://github.com/ClickHouse/ClickHouse/pull/29953" target="_blank" rel="noopener noreferrer">#29953</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>). It also fixes a bug in index analysis if date truncation function would yield result before the Unix epoch.</li><li>Always display resource usage (total CPU usage, total RAM usage and max RAM usage per host) in client. <a href="https://github.com/ClickHouse/ClickHouse/pull/33271" target="_blank" rel="noopener noreferrer">#33271</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve <code>Bool</code> type serialization and deserialization, check the range of values. <a href="https://github.com/ClickHouse/ClickHouse/pull/32984" target="_blank" rel="noopener noreferrer">#32984</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>If an invalid setting is defined using the <code>SET</code> query or using the query parameters in the HTTP request, error message will contain suggestions that are similar to the invalid setting string (if any exists). <a href="https://github.com/ClickHouse/ClickHouse/pull/32946" target="_blank" rel="noopener noreferrer">#32946</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Support hints for mistyped setting names for clickhouse-client and clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32237" target="_blank" rel="noopener noreferrer">#32237</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32841" target="_blank" rel="noopener noreferrer">#32841</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Allow to use virtual columns in Materialized Views. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/11210" target="_blank" rel="noopener noreferrer">#11210</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33482" target="_blank" rel="noopener noreferrer">#33482</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Add config to disable IPv6 in clickhouse-keeper if needed. This close <a href="https://github.com/ClickHouse/ClickHouse/issues/33381" target="_blank" rel="noopener noreferrer">#33381</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33450" target="_blank" rel="noopener noreferrer">#33450</a> (<a href="https://github.com/wuxueyang96" target="_blank" rel="noopener noreferrer">Wu Xueyang</a>).</li><li>Add more info to <code>system.build_options</code> about current git revision. <a href="https://github.com/ClickHouse/ClickHouse/pull/33431" target="_blank" rel="noopener noreferrer">#33431</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li><code>clickhouse-local</code>: track memory under <code>--max_memory_usage_in_client</code> option. <a href="https://github.com/ClickHouse/ClickHouse/pull/33341" target="_blank" rel="noopener noreferrer">#33341</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow negative intervals in function <code>intervalLengthSum</code>. Their length will be added as well. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33323" target="_blank" rel="noopener noreferrer">#33323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33335" target="_blank" rel="noopener noreferrer">#33335</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>LineAsString</code> can be used as output format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30919" target="_blank" rel="noopener noreferrer">#30919</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33331" target="_blank" rel="noopener noreferrer">#33331</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Support <code>&lt;secure/&gt;</code> in cluster configuration, as an alternative form of <code>&lt;secure&gt;1&lt;/secure&gt;</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/33270" target="_blank" rel="noopener noreferrer">#33270</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33330" target="_blank" rel="noopener noreferrer">#33330</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Pressing Ctrl+C twice will terminate <code>clickhouse-benchmark</code> immediately without waiting for in-flight queries. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32586" target="_blank" rel="noopener noreferrer">#32586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33303" target="_blank" rel="noopener noreferrer">#33303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support Unix timestamp with milliseconds in <code>parseDateTimeBestEffort</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33276" target="_blank" rel="noopener noreferrer">#33276</a> (<a href="https://github.com/benbiti" target="_blank" rel="noopener noreferrer">Ben</a>).</li><li>Allow to cancel query while reading data from external table in the formats: <code>Arrow</code> / <code>Parquet</code> / <code>ORC</code> - it failed to be cancelled it case of big files and setting input_format_allow_seeks as false. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29678" target="_blank" rel="noopener noreferrer">#29678</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33238" target="_blank" rel="noopener noreferrer">#33238</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>If table engine supports <code>SETTINGS</code> clause, allow to pass the settings as key-value or via config. Add this support for MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/33231" target="_blank" rel="noopener noreferrer">#33231</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Correctly prevent Nullable primary keys if necessary. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/32780" target="_blank" rel="noopener noreferrer">#32780</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33218" target="_blank" rel="noopener noreferrer">#33218</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add retry for <code>PostgreSQL</code> connections in case nothing has been fetched yet. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33199" target="_blank" rel="noopener noreferrer">#33199</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33209" target="_blank" rel="noopener noreferrer">#33209</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Validate config keys for external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/issues/33095#issuecomment-1000577517" target="_blank" rel="noopener noreferrer">#33095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33130" target="_blank" rel="noopener noreferrer">#33130</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Send profile info inside <code>clickhouse-local</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33093" target="_blank" rel="noopener noreferrer">#33093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33097" target="_blank" rel="noopener noreferrer">#33097</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Short circuit evaluation: support for function <code>throwIf</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32969" target="_blank" rel="noopener noreferrer">#32969</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32973" target="_blank" rel="noopener noreferrer">#32973</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>(This only happens in unofficial builds). Fixed segfault when inserting data into compressed Decimal, String, FixedString and Array columns. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32939" target="_blank" rel="noopener noreferrer">#32939</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32940" target="_blank" rel="noopener noreferrer">#32940</a> (<a href="https://github.com/nkolotov" target="_blank" rel="noopener noreferrer">N. Kolotov</a>).</li><li>Added support for specifying subquery as SQL user defined function. Example: <code>CREATE FUNCTION test AS () -&gt; (SELECT 1)</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30755" target="_blank" rel="noopener noreferrer">#30755</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32758" target="_blank" rel="noopener noreferrer">#32758</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve gRPC compression support for <a href="https://github.com/ClickHouse/ClickHouse/issues/28671" target="_blank" rel="noopener noreferrer">#28671</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32747" target="_blank" rel="noopener noreferrer">#32747</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Flush all In-Memory data parts when WAL is not enabled while shutdown server or detaching table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32742" target="_blank" rel="noopener noreferrer">#32742</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Allow to control connection timeouts for MySQL (previously was supported only for dictionary source). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16669" target="_blank" rel="noopener noreferrer">#16669</a>. Previously default connect_timeout was rather small, now it is configurable. <a href="https://github.com/ClickHouse/ClickHouse/pull/32734" target="_blank" rel="noopener noreferrer">#32734</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support <code>authSource</code> option for storage <code>MongoDB</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32594" target="_blank" rel="noopener noreferrer">#32594</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32702" target="_blank" rel="noopener noreferrer">#32702</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support <code>Date32</code> type in <code>genarateRandom</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/32643" target="_blank" rel="noopener noreferrer">#32643</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Add settings <code>max_concurrent_select_queries</code> and <code>max_concurrent_insert_queries</code> for control concurrent queries by query kind. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/3575" target="_blank" rel="noopener noreferrer">#3575</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32609" target="_blank" rel="noopener noreferrer">#32609</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Improve handling nested structures with missing columns while reading data in <code>Protobuf</code> format. Follow-up to <a href="https://github.com/ClickHouse/ClickHouse/pull/31988" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/31988</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32531" target="_blank" rel="noopener noreferrer">#32531</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow empty credentials for <code>MongoDB</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26267" target="_blank" rel="noopener noreferrer">#26267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32460" target="_blank" rel="noopener noreferrer">#32460</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Disable some optimizations for window functions that may lead to exceptions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31535" target="_blank" rel="noopener noreferrer">#31535</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31620" target="_blank" rel="noopener noreferrer">#31620</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32453" target="_blank" rel="noopener noreferrer">#32453</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allows to connect to MongoDB 5.0. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31483" target="_blank" rel="noopener noreferrer">#31483</a>,. <a href="https://github.com/ClickHouse/ClickHouse/pull/32416" target="_blank" rel="noopener noreferrer">#32416</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Enable comparison between <code>Decimal</code> and <code>Float</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22626" target="_blank" rel="noopener noreferrer">#22626</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31966" target="_blank" rel="noopener noreferrer">#31966</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Added settings <code>command_read_timeout</code>, <code>command_write_timeout</code> for <code>StorageExecutable</code>, <code>StorageExecutablePool</code>, <code>ExecutableDictionary</code>, <code>ExecutablePoolDictionary</code>, <code>ExecutableUserDefinedFunctions</code>. Setting <code>command_read_timeout</code> controls timeout for reading data from command stdout in milliseconds. Setting <code>command_write_timeout</code> timeout for writing data to command stdin in milliseconds. Added settings <code>command_termination_timeout</code> for <code>ExecutableUserDefinedFunction</code>, <code>ExecutableDictionary</code>, <code>StorageExecutable</code>. Added setting <code>execute_direct</code> for <code>ExecutableUserDefinedFunction</code>, by default true. Added setting <code>execute_direct</code> for <code>ExecutableDictionary</code>, <code>ExecutablePoolDictionary</code>, by default false. <a href="https://github.com/ClickHouse/ClickHouse/pull/30957" target="_blank" rel="noopener noreferrer">#30957</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Bitmap aggregate functions will give correct result for out of range argument instead of wraparound. <a href="https://github.com/ClickHouse/ClickHouse/pull/33127" target="_blank" rel="noopener noreferrer">#33127</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li><li>Fix parsing incorrect queries with <code>FROM INFILE</code> statement. <a href="https://github.com/ClickHouse/ClickHouse/pull/33521" target="_blank" rel="noopener noreferrer">#33521</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Don&#x27;t allow to write into <code>S3</code> if path contains globs. <a href="https://github.com/ClickHouse/ClickHouse/pull/33142" target="_blank" rel="noopener noreferrer">#33142</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>--echo</code> option was not used by <code>clickhouse-client</code> in batch mode with single query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32843" target="_blank" rel="noopener noreferrer">#32843</a> (<a href="https://github.com/nkolotov" target="_blank" rel="noopener noreferrer">N. Kolotov</a>).</li><li>Use <code>--database</code> option for clickhouse-local. <a href="https://github.com/ClickHouse/ClickHouse/pull/32797" target="_blank" rel="noopener noreferrer">#32797</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix surprisingly bad code in SQL ordinary function <code>file</code>. Now it supports symlinks. <a href="https://github.com/ClickHouse/ClickHouse/pull/32640" target="_blank" rel="noopener noreferrer">#32640</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Updating <code>modification_time</code> for data part in <code>system.parts</code> after part movement <a href="https://github.com/ClickHouse/ClickHouse/issues/32964" target="_blank" rel="noopener noreferrer">#32964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32965" target="_blank" rel="noopener noreferrer">#32965</a> (<a href="https://github.com/save-my-heart" target="_blank" rel="noopener noreferrer">save-my-heart</a>).</li><li>Potential issue, cannot be exploited: integer overflow may happen in array resize. <a href="https://github.com/ClickHouse/ClickHouse/pull/33024" target="_blank" rel="noopener noreferrer">#33024</a> (<a href="https://github.com/varadarajkumar" target="_blank" rel="noopener noreferrer">varadarajkumar</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildtestingpackaging-improvement-11">Build/Testing/Packaging Improvement<a href="#buildtestingpackaging-improvement-11" class="hash-link" aria-label="Direct link to Build/Testing/Packaging Improvement" title="Direct link to Build/Testing/Packaging Improvement">​</a></h4><ul><li>Add packages, functional tests and Docker builds for AArch64 (ARM) version of ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/32911" target="_blank" rel="noopener noreferrer">#32911</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32415" target="_blank" rel="noopener noreferrer">#32415</a></li><li>Prepare ClickHouse to be built with musl-libc. It is not enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/33134" target="_blank" rel="noopener noreferrer">#33134</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make installation script working on FreeBSD. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33384" target="_blank" rel="noopener noreferrer">#33384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33418" target="_blank" rel="noopener noreferrer">#33418</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>actionlint</code> for GitHub Actions workflows and verify workflow files via <code>act --list</code> to check the correct workflow syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/33612" target="_blank" rel="noopener noreferrer">#33612</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add more tests for the nullable primary key feature. Add more tests with different types and merge tree kinds, plus randomly generated data. <a href="https://github.com/ClickHouse/ClickHouse/pull/33228" target="_blank" rel="noopener noreferrer">#33228</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add a simple tool to visualize flaky tests in web browser. <a href="https://github.com/ClickHouse/ClickHouse/pull/33185" target="_blank" rel="noopener noreferrer">#33185</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable hermetic build for shared builds. This is mainly for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/32968" target="_blank" rel="noopener noreferrer">#32968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Update <code>libc++</code> and <code>libc++abi</code> to the latest. <a href="https://github.com/ClickHouse/ClickHouse/pull/32484" target="_blank" rel="noopener noreferrer">#32484</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Added integration test for external .NET client (<a href="https://github.com/DarkWanderer/ClickHouse.Client" target="_blank" rel="noopener noreferrer">ClickHouse.Client</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/23230" target="_blank" rel="noopener noreferrer">#23230</a> (<a href="https://github.com/DarkWanderer" target="_blank" rel="noopener noreferrer">Oleg V. Kozlyuk</a>).</li><li>Inject git information into clickhouse binary file. So we can get source code revision easily from clickhouse binary file. <a href="https://github.com/ClickHouse/ClickHouse/pull/33124" target="_blank" rel="noopener noreferrer">#33124</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Remove obsolete code from ConfigProcessor. Yandex specific code is not used anymore. The code contained one minor defect. This defect was reported by <a href="https://github.com/SadiHassan" target="_blank" rel="noopener noreferrer">Mallik Hassan</a> in <a href="https://github.com/ClickHouse/ClickHouse/issues/33032" target="_blank" rel="noopener noreferrer">#33032</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33032" target="_blank" rel="noopener noreferrer">#33032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33026" target="_blank" rel="noopener noreferrer">#33026</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-4">Bug Fix (user-visible misbehavior in official stable or prestable release)<a href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release-4" class="hash-link" aria-label="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)" title="Direct link to Bug Fix (user-visible misbehavior in official stable or prestable release)">​</a></h4><ul><li>Several fixes for format parsing. This is relevant if <code>clickhouse-server</code> is open for write access to adversary. Specifically crafted input data for <code>Native</code> format may lead to reading uninitialized memory or crash. This is relevant if <code>clickhouse-server</code> is open for write access to adversary. <a href="https://github.com/ClickHouse/ClickHouse/pull/33050" target="_blank" rel="noopener noreferrer">#33050</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>). Fixed Apache Avro Union type index out of boundary issue in Apache Avro binary format. <a href="https://github.com/ClickHouse/ClickHouse/pull/33022" target="_blank" rel="noopener noreferrer">#33022</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fix null pointer dereference in <code>LowCardinality</code> data when deserializing <code>LowCardinality</code> data in the Native format. <a href="https://github.com/ClickHouse/ClickHouse/pull/33021" target="_blank" rel="noopener noreferrer">#33021</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>ClickHouse Keeper handler will correctly remove operation when response sent. <a href="https://github.com/ClickHouse/ClickHouse/pull/32988" target="_blank" rel="noopener noreferrer">#32988</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Potential off-by-one miscalculation of quotas: quota limit was not reached, but the limit was exceeded. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31174" target="_blank" rel="noopener noreferrer">#31174</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31656" target="_blank" rel="noopener noreferrer">#31656</a> (<a href="https://github.com/sunny19930321" target="_blank" rel="noopener noreferrer">sunny</a>).</li><li>Fixed CASTing from String to IPv4 or IPv6 and back. Fixed error message in case of failed conversion. <a href="https://github.com/ClickHouse/ClickHouse/pull/29224" target="_blank" rel="noopener noreferrer">#29224</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/27914" target="_blank" rel="noopener noreferrer">#27914</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed an exception like <code>Unknown aggregate function nothing</code> during an execution on a remote server. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16689" target="_blank" rel="noopener noreferrer">#16689</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26074" target="_blank" rel="noopener noreferrer">#26074</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix wrong database for JOIN without explicit database in distributed queries (Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10471" target="_blank" rel="noopener noreferrer">#10471</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33611" target="_blank" rel="noopener noreferrer">#33611</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault in Apache <code>Avro</code> format that appears after the second insert into file. <a href="https://github.com/ClickHouse/ClickHouse/pull/33566" target="_blank" rel="noopener noreferrer">#33566</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix segfault in Apache <code>Arrow</code> format if schema contains <code>Dictionary</code> type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33507" target="_blank" rel="noopener noreferrer">#33507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33529" target="_blank" rel="noopener noreferrer">#33529</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Out of band <code>offset</code> and <code>limit</code> settings may be applied incorrectly for views. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/33289" target="_blank" rel="noopener noreferrer">#33289</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/33518" target="_blank" rel="noopener noreferrer">#33518</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix an exception <code>Block structure mismatch</code> which may happen during insertion into table with default nested <code>LowCardinality</code> column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33028" target="_blank" rel="noopener noreferrer">#33028</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33504" target="_blank" rel="noopener noreferrer">#33504</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix dictionary expressions for <code>range_hashed</code> range min and range max attributes when created using DDL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30809" target="_blank" rel="noopener noreferrer">#30809</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33478" target="_blank" rel="noopener noreferrer">#33478</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible use-after-free for INSERT into Materialized View with concurrent DROP (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not try to read pass EOF (to workaround for a bug in the Linux kernel), this bug can be reproduced on kernels (3.14..5.9), and requires <code>index_granularity_bytes=0</code> (i.e. turn off adaptive index granularity). <a href="https://github.com/ClickHouse/ClickHouse/pull/33372" target="_blank" rel="noopener noreferrer">#33372</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The commands <code>SYSTEM SUSPEND</code> and <code>SYSTEM ... THREAD FUZZER</code> missed access control. It is fixed. Author: Kevin Michel. <a href="https://github.com/ClickHouse/ClickHouse/pull/33333" target="_blank" rel="noopener noreferrer">#33333</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix when <code>COMMENT</code> for dictionaries does not appear in <code>system.tables</code>, <code>system.dictionaries</code>. Allow to modify the comment for <code>Dictionary</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33251" target="_blank" rel="noopener noreferrer">#33251</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33261" target="_blank" rel="noopener noreferrer">#33261</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add asynchronous inserts (with enabled setting <code>async_insert</code>) to query log. Previously such queries didn&#x27;t appear in the query log. <a href="https://github.com/ClickHouse/ClickHouse/pull/33239" target="_blank" rel="noopener noreferrer">#33239</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix sending <code>WHERE 1 = 0</code> expressions for external databases query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33152" target="_blank" rel="noopener noreferrer">#33152</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33214" target="_blank" rel="noopener noreferrer">#33214</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix DDL validation for MaterializedPostgreSQL. Fix setting <code>materialized_postgresql_allow_automatic_update</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29535" target="_blank" rel="noopener noreferrer">#29535</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33200" target="_blank" rel="noopener noreferrer">#33200</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Make sure unused replication slots are always removed. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/26952" target="_blank" rel="noopener noreferrer">#26952</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33187" target="_blank" rel="noopener noreferrer">#33187</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix MaterializedPostreSQL detach/attach (removing / adding to replication) tables with non-default schema. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/29535" target="_blank" rel="noopener noreferrer">#29535</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33179" target="_blank" rel="noopener noreferrer">#33179</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix DROP MaterializedPostgreSQL database. <a href="https://github.com/ClickHouse/ClickHouse/pull/33468" target="_blank" rel="noopener noreferrer">#33468</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>The metric <code>StorageBufferBytes</code> sometimes was miscalculated. <a href="https://github.com/ClickHouse/ClickHouse/pull/33159" target="_blank" rel="noopener noreferrer">#33159</a> (<a href="https://github.com/xuyatian" target="_blank" rel="noopener noreferrer">xuyatian</a>).</li><li>Fix error <code>Invalid version for SerializationLowCardinality key column</code> in case of reading from <code>LowCardinality</code> column with <code>local_filesystem_read_prefetch</code> or <code>remote_filesystem_read_prefetch</code> enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/33046" target="_blank" rel="noopener noreferrer">#33046</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>s3</code> table function reading empty file. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33008" target="_blank" rel="noopener noreferrer">#33008</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33037" target="_blank" rel="noopener noreferrer">#33037</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix Context leak in case of cancel_http_readonly_queries_on_client_close (i.e. leaking of external tables that had been uploaded the the server and other resources). <a href="https://github.com/ClickHouse/ClickHouse/pull/32982" target="_blank" rel="noopener noreferrer">#32982</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong tuple output in <code>CSV</code> format in case of custom csv delimiter. <a href="https://github.com/ClickHouse/ClickHouse/pull/32981" target="_blank" rel="noopener noreferrer">#32981</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix HDFS URL check that didn&#x27;t allow using HA namenode address. Bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/31042" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/31042</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32976" target="_blank" rel="noopener noreferrer">#32976</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix throwing exception like positional argument out of bounds for non-positional arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31173" target="_blank" rel="noopener noreferrer">#31173</a>#event-5789668239. <a href="https://github.com/ClickHouse/ClickHouse/pull/32961" target="_blank" rel="noopener noreferrer">#32961</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix UB in case of unexpected EOF during filling a set from HTTP query (i.e. if the client interrupted in the middle, i.e. <code>timeout 0.15s curl -Ss -F &#x27;s=@t.csv;&#x27; &#x27;http://127.0.0.1:8123/?s_structure=key+Int&amp;query=SELECT+dummy+IN+s&#x27;</code> and with large enough <code>t.csv</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32955" target="_blank" rel="noopener noreferrer">#32955</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a regression in <code>replaceRegexpAll</code> function. The function worked incorrectly when matched substring was empty. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32777" target="_blank" rel="noopener noreferrer">#32777</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30245" target="_blank" rel="noopener noreferrer">#30245</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32945" target="_blank" rel="noopener noreferrer">#32945</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>ORC</code> format stripe reading. <a href="https://github.com/ClickHouse/ClickHouse/pull/32929" target="_blank" rel="noopener noreferrer">#32929</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>).</li><li><code>topKWeightedState</code> failed for some input types. <a href="https://github.com/ClickHouse/ClickHouse/issues/32487" target="_blank" rel="noopener noreferrer">#32487</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32914" target="_blank" rel="noopener noreferrer">#32914</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix exception <code>Single chunk is expected from view inner query (LOGICAL_ERROR)</code> in materialized view. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31419" target="_blank" rel="noopener noreferrer">#31419</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32862" target="_blank" rel="noopener noreferrer">#32862</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix optimization with lazy seek for async reads from remote filesystems. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32803" target="_blank" rel="noopener noreferrer">#32803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32835" target="_blank" rel="noopener noreferrer">#32835</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li><code>MergeTree</code> table engine might silently skip some mutations if there are too many running mutations or in case of high memory consumption, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17882" target="_blank" rel="noopener noreferrer">#17882</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32814" target="_blank" rel="noopener noreferrer">#32814</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Avoid reusing the scalar subquery cache when processing MV blocks. This fixes a bug when the scalar query reference the source table but it means that all subscalar queries in the MV definition will be calculated for each block. <a href="https://github.com/ClickHouse/ClickHouse/pull/32811" target="_blank" rel="noopener noreferrer">#32811</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Server might fail to start if database with <code>MySQL</code> engine cannot connect to MySQL server, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14441" target="_blank" rel="noopener noreferrer">#14441</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32802" target="_blank" rel="noopener noreferrer">#32802</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix crash when used <code>fuzzBits</code> function, close <a href="https://github.com/ClickHouse/ClickHouse/issues/32737" target="_blank" rel="noopener noreferrer">#32737</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32755" target="_blank" rel="noopener noreferrer">#32755</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Fix error <code>Column is not under aggregate function</code> in case of MV with <code>GROUP BY (list of columns)</code> (which is pared as <code>GROUP BY tuple(...)</code>) over <code>Kafka</code>/<code>RabbitMQ</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32668" target="_blank" rel="noopener noreferrer">#32668</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/32744" target="_blank" rel="noopener noreferrer">#32744</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32751" target="_blank" rel="noopener noreferrer">#32751</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>ALTER TABLE ... MATERIALIZE TTL</code> query with <code>TTL ... DELETE WHERE ...</code> and <code>TTL ... GROUP BY ...</code> modes. <a href="https://github.com/ClickHouse/ClickHouse/pull/32695" target="_blank" rel="noopener noreferrer">#32695</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix <code>optimize_read_in_order</code> optimization in case when table engine is <code>Distributed</code> or <code>Merge</code> and its underlying <code>MergeTree</code> tables have monotonous function in prefix of sorting key. <a href="https://github.com/ClickHouse/ClickHouse/pull/32670" target="_blank" rel="noopener noreferrer">#32670</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix LOGICAL_ERROR exception when the target of a materialized view is a JOIN or a SET table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32669" target="_blank" rel="noopener noreferrer">#32669</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Inserting into S3 with multipart upload to Google Cloud Storage may trigger abort. <a href="https://github.com/ClickHouse/ClickHouse/issues/32504" target="_blank" rel="noopener noreferrer">#32504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32649" target="_blank" rel="noopener noreferrer">#32649</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix possible exception at <code>RabbitMQ</code> storage startup by delaying channel creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/32584" target="_blank" rel="noopener noreferrer">#32584</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix table lifetime (i.e. possible use-after-free) in case of parallel DROP TABLE and INSERT. <a href="https://github.com/ClickHouse/ClickHouse/pull/32572" target="_blank" rel="noopener noreferrer">#32572</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix async inserts with formats <code>CustomSeparated</code>, <code>Template</code>, <code>Regexp</code>, <code>MsgPack</code> and <code>JSONAsString</code>. Previousely the async inserts with these formats didn&#x27;t read any data. <a href="https://github.com/ClickHouse/ClickHouse/pull/32530" target="_blank" rel="noopener noreferrer">#32530</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>groupBitmapAnd</code> function on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32529" target="_blank" rel="noopener noreferrer">#32529</a> (<a href="https://github.com/dmthuc" target="_blank" rel="noopener noreferrer">minhthucdao</a>).</li><li>Fix crash in JOIN found by fuzzer, close <a href="https://github.com/ClickHouse/ClickHouse/issues/32458" target="_blank" rel="noopener noreferrer">#32458</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32508" target="_blank" rel="noopener noreferrer">#32508</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Proper handling of the case with Apache Arrow column duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/32507" target="_blank" rel="noopener noreferrer">#32507</a> (<a href="https://github.com/DMokhnatkin" target="_blank" rel="noopener noreferrer">Dmitriy Mokhnatkin</a>).</li><li>Fix issue with ambiguous query formatting in distributed queries that led to errors when some table columns were named <code>ALL</code> or <code>DISTINCT</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32391" target="_blank" rel="noopener noreferrer">#32391</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32490" target="_blank" rel="noopener noreferrer">#32490</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix failures in queries that are trying to use skipping indices, which are not materialized yet. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32292" target="_blank" rel="noopener noreferrer">#32292</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/30343" target="_blank" rel="noopener noreferrer">#30343</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32359" target="_blank" rel="noopener noreferrer">#32359</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix broken select query when there are more than 2 row policies on same column, begin at second queries on the same session. <a href="https://github.com/ClickHouse/ClickHouse/issues/31606" target="_blank" rel="noopener noreferrer">#31606</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32291" target="_blank" rel="noopener noreferrer">#32291</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Fix fractional unix timestamp conversion to <code>DateTime64</code>, fractional part was reversed for negative unix timestamps (before 1970-01-01). <a href="https://github.com/ClickHouse/ClickHouse/pull/32240" target="_blank" rel="noopener noreferrer">#32240</a> (<a href="https://github.com/benbiti" target="_blank" rel="noopener noreferrer">Ben</a>).</li><li>Some entries of replication queue might hang for <code>temporary_directories_lifetime</code> (1 day by default) with <code>Directory tmp_merge_&lt;part_name&gt;</code> or <code>Part ... (state Deleting) already exists, but it will be deleted soon</code> or similar error. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29616" target="_blank" rel="noopener noreferrer">#29616</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32201" target="_blank" rel="noopener noreferrer">#32201</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix parsing of <code>APPLY lambda</code> column transformer which could lead to client/server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/32138" target="_blank" rel="noopener noreferrer">#32138</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>base64Encode</code> adding trailing bytes on small strings. <a href="https://github.com/ClickHouse/ClickHouse/pull/31797" target="_blank" rel="noopener noreferrer">#31797</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Fix possible crash (or incorrect result) in case of <code>LowCardinality</code> arguments of window function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31114" target="_blank" rel="noopener noreferrer">#31114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31888" target="_blank" rel="noopener noreferrer">#31888</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix hang up with command <code>DROP TABLE system.query_log sync</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33293" target="_blank" rel="noopener noreferrer">#33293</a> (<a href="https://github.com/zhanghuajieHIT" target="_blank" rel="noopener noreferrer">zhanghuajie</a>).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog-for-2021"><a href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2021">Changelog for 2021</a><a href="#changelog-for-2021" class="hash-link" aria-label="Direct link to changelog-for-2021" title="Direct link to changelog-for-2021">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/whats-new/changelog/2022.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">2023</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/AlgoliaDocsSelfCrawl/en/whats-new/changelog/2021"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2021</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-clickhouse-release-2212-2022-12-15" class="table-of-contents__link toc-highlight"><a id="2212"></a> ClickHouse release 22.12, 2022-12-15</a></li><li><a href="#-clickhouse-release-2211-2022-11-17" class="table-of-contents__link toc-highlight"><a id="2211"></a> ClickHouse release 22.11, 2022-11-17</a></li><li><a href="#-clickhouse-release-2210-2022-10-25" class="table-of-contents__link toc-highlight"><a id="2210"></a> ClickHouse release 22.10, 2022-10-25</a></li><li><a href="#-clickhouse-release-229-2022-09-22" class="table-of-contents__link toc-highlight"><a id="229"></a> ClickHouse release 22.9, 2022-09-22</a></li><li><a href="#-clickhouse-release-228-2022-08-18" class="table-of-contents__link toc-highlight"><a id="228"></a> ClickHouse release 22.8, 2022-08-18</a></li><li><a href="#-clickhouse-release-227-2022-07-21" class="table-of-contents__link toc-highlight"><a id="227"></a> ClickHouse release 22.7, 2022-07-21</a></li><li><a href="#-clickhouse-release-226-2022-06-16" class="table-of-contents__link toc-highlight"><a id="226"></a> ClickHouse release 22.6, 2022-06-16</a></li><li><a href="#-clickhouse-release-225-2022-05-19" class="table-of-contents__link toc-highlight"><a id="225"></a> ClickHouse release 22.5, 2022-05-19</a></li><li><a href="#-clickhouse-release-224-2022-04-19" class="table-of-contents__link toc-highlight"><a id="224"></a> ClickHouse release 22.4, 2022-04-19</a></li><li><a href="#-clickhouse-release-v223-lts-2022-03-17" class="table-of-contents__link toc-highlight"><a id="223"></a> ClickHouse release v22.3-lts, 2022-03-17</a></li><li><a href="#-clickhouse-release-v222-2022-02-17" class="table-of-contents__link toc-highlight"><a id="222"></a> ClickHouse release v22.2, 2022-02-17</a></li><li><a href="#-clickhouse-release-v221-2022-01-18" class="table-of-contents__link toc-highlight"><a id="221"></a> ClickHouse release v22.1, 2022-01-18</a></li><li><a href="#changelog-for-2021" class="table-of-contents__link toc-highlight">Changelog for 2021</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ClickHouse</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://clickhouse.com/cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ClickHouse as a Service</a></li><li class="footer__item"><a href="https://clickhouse.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://clickhouse.com/learn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Learn ClickHouse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ClickHouse/ClickHouse" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://clickhouse.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.meetup.com/pro/clickhouse/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetup<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Policies</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clickhouse.com/legal/trademark-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse Documentation" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse Documentation" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright &copy; 2016&ndash;2023 ClickHouse, Inc. ClickHouse Docs provided under the Creative Commons CC BY-NC-SA 4.0 license. ClickHouse&reg; is a registered trademark of ClickHouse, Inc.</div></div></div></footer></div>
<script src="/AlgoliaDocsSelfCrawl/assets/js/runtime~main.be802059.js"></script>
<script src="/AlgoliaDocsSelfCrawl/assets/js/main.b00bfaaf.js"></script>
</body>
</html>