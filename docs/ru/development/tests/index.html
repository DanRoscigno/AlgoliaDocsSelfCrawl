<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ru/development/tests">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">ClickHouse Testing | ClickHouse Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/img/logo.png"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/ru/development/tests"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ClickHouse Testing | ClickHouse Docs"><link data-rh="true" rel="icon" href="/AlgoliaDocsSelfCrawl/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/ru/development/tests"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/ru/development/tests" hreflang="en"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/AlgoliaDocsSelfCrawl/ru/development/tests" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://62VCH2MD74-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF1LLRTQ5Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KF1LLRTQ5Q",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ClickHouse Docs" href="/AlgoliaDocsSelfCrawl/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/docs/js/analytics.js"></script><link rel="stylesheet" href="/AlgoliaDocsSelfCrawl/assets/css/styles.1fe1f09b.css">
<link rel="preload" href="/AlgoliaDocsSelfCrawl/assets/js/runtime~main.be802059.js" as="script">
<link rel="preload" href="/AlgoliaDocsSelfCrawl/assets/js/main.b00bfaaf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--light_HNdA"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ClickHouse</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Product</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/cloud" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Cloud</a></li><li><a href="https://clickhouse.com/clickhouse" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Open Source</a></li></ul></div><a href="https://clickhouse.com/customer-stories" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Use Cases</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Company</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/blog" target="_blank" rel="noopener noreferrer" class="dropdown__link">Blog</a></li><li><a href="https://clickhouse.com/company/our-story" target="_blank" rel="noopener noreferrer" class="dropdown__link">Our story</a></li><li><a href="https://clickhouse.com/company/careers" target="_blank" rel="noopener noreferrer" class="dropdown__link">Careers</a></li><li><a href="https://clickhouse.com/company/contact" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact us</a></li><li><a href="https://clickhouse.com/company/news-events" target="_blank" rel="noopener noreferrer" class="dropdown__link">News and events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/en/intro">Docs</a></li><li><a href="https://clickhouse.com/learn" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Academy</a></li></ul></div><a href="https://clickhouse.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Pricing</a></div><div class="navbar__items navbar__items--right"><a href="https://clickhouse.cloud/signUp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-signup-button">Try for Free<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Language</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/en/intro">English</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/AlgoliaDocsSelfCrawl/ru">Russian</a></li><li><a class="dropdown__link" href="/AlgoliaDocsSelfCrawl/zh">Chinese</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/AlgoliaDocsSelfCrawl/ru/">Что такое ClickHouse</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/category/введение">Введение</a><button aria-label="Toggle the collapsible sidebar category &#x27;Введение&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/getting-started/">Начало работы</a><button aria-label="Toggle the collapsible sidebar category &#x27;Начало работы&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/interfaces/">Интерфейсы</a><button aria-label="Toggle the collapsible sidebar category &#x27;Интерфейсы&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/category/engines">Engines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Engines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/sql-reference/">Справка по SQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;Справка по SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/AlgoliaDocsSelfCrawl/ru/guides/">Руководства</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/operations/">Эксплуатация</a><button aria-label="Toggle the collapsible sidebar category &#x27;Эксплуатация&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/AlgoliaDocsSelfCrawl/category/инструкция-для-разработчиков">Инструкция для разработчиков</a><button aria-label="Toggle the collapsible sidebar category &#x27;Инструкция для разработчиков&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/developer-instruction">Инструкция для разработчиков</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/architecture">Обзор архитектуры ClickHouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/continuous-integration">Continuous Integration Checks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/adding_test_queries">Adding Test Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/build">Build on Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/build-osx">Сборка на Mac OS X</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/build-cross-arm">Build on Linux for AARCH64 (ARM64)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/build-cross-osx">Build on Linux for Mac OS X</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/build-cross-riscv">Build on Linux for RISC-V 64</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/style">Как писать код на C++</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/contrib">Используемые сторонние библиотеки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/integrating_rust_libraries">Интеграция библиотек на языке Rust в ClickHouse.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/AlgoliaDocsSelfCrawl/ru/development/tests">Testing</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/commercial/">Коммерческие услуги</a><button aria-label="Toggle the collapsible sidebar category &#x27;Коммерческие услуги&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/whats-new/">What&#x27;s New</a><button aria-label="Toggle the collapsible sidebar category &#x27;What&#x27;s New&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/faq/">F.A.Q.</a><button aria-label="Toggle the collapsible sidebar category &#x27;F.A.Q.&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AlgoliaDocsSelfCrawl/ru/about-us/">About Us</a><button aria-label="Toggle the collapsible sidebar category &#x27;About Us&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/AlgoliaDocsSelfCrawl/category/инструкция-для-разработчиков"><span itemprop="name">Инструкция для разработчиков</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Testing</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>ClickHouse Testing</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functional-tests">Functional Tests<a href="#functional-tests" class="hash-link" aria-label="Direct link to Functional Tests" title="Direct link to Functional Tests">​</a></h2><p>Functional tests are the most simple and convenient to use. Most of ClickHouse features can be tested with functional tests and they are mandatory to use for every change in ClickHouse code that can be tested that way.</p><p>Each functional test sends one or multiple queries to the running ClickHouse server and compares the result with reference.</p><p>Tests are located in <code>queries</code> directory. There are two subdirectories: <code>stateless</code> and <code>stateful</code>. Stateless tests run queries without any preloaded test data - they often create small synthetic datasets on the fly, within the test itself. Stateful tests require preloaded test data from ClickHouse and it is available to general public.</p><p>Each test can be one of two types: <code>.sql</code> and <code>.sh</code>. <code>.sql</code> test is the simple SQL script that is piped to <code>clickhouse-client --multiquery</code>. <code>.sh</code> test is a script that is run by itself. SQL tests are generally preferable to <code>.sh</code> tests. You should use <code>.sh</code> tests only when you have to test some feature that cannot be exercised from pure SQL, such as piping some input data into <code>clickhouse-client</code> or testing <code>clickhouse-local</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>A common mistake when testing data types <code>DateTime</code> and <code>DateTime64</code> is assuming that the server uses a specific time zone (e.g. &quot;UTC&quot;). This is not the case, time zones in CI test runs
are deliberately randomized. The easiest workaround is to specify the time zone for test values explicitly, e.g. <code>toDateTime64(val, 3, &#x27;Europe/Amsterdam&#x27;)</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="functional-test-locally">Running a Test Locally<a href="#functional-test-locally" class="hash-link" aria-label="Direct link to Running a Test Locally" title="Direct link to Running a Test Locally">​</a></h3><p>Start the ClickHouse server locally, listening on the default port (9000). To
run, for example, the test <code>01428_hash_set_nan_key</code>, change to the repository
folder and run the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">PATH=$PATH:&lt;path to clickhouse-client&gt; tests/clickhouse-test 01428_hash_set_nan_key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more options, see <code>tests/clickhouse-test --help</code>. You can simply run all tests or run subset of tests filtered by substring in test name: <code>./clickhouse-test substring</code>. There are also options to run tests in parallel or in randomized order.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-new-test">Adding a New Test<a href="#adding-a-new-test" class="hash-link" aria-label="Direct link to Adding a New Test" title="Direct link to Adding a New Test">​</a></h3><p>To add new test, create a <code>.sql</code> or <code>.sh</code> file in <code>queries/0_stateless</code> directory, check it manually and then generate <code>.reference</code> file in the following way: <code>clickhouse-client --multiquery &lt; 00000_test.sql &gt; 00000_test.reference</code> or <code>./00000_test.sh &gt; ./00000_test.reference</code>.</p><p>Tests should use (create, drop, etc) only tables in <code>test</code> database that is assumed to be created beforehand; also tests can use temporary tables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="choosing-the-test-name">Choosing the Test Name<a href="#choosing-the-test-name" class="hash-link" aria-label="Direct link to Choosing the Test Name" title="Direct link to Choosing the Test Name">​</a></h3><p>The name of the test starts with a five-digit prefix followed by a descriptive name, such as <code>00422_hash_function_constexpr.sql</code>. To choose the prefix, find the largest prefix already present in the directory, and increment it by one. In the meantime, some other tests might be added with the same numeric prefix, but this is OK and does not lead to any problems, you don&#x27;t have to change it later.</p><p>Some tests are marked with <code>zookeeper</code>, <code>shard</code> or <code>long</code> in their names. <code>zookeeper</code> is for tests that are using ZooKeeper. <code>shard</code> is for tests that requires server to listen <code>127.0.0.*</code>; <code>distributed</code> or <code>global</code> have the same meaning. <code>long</code> is for tests that run slightly longer that one second. You can disable these groups of tests using <code>--no-zookeeper</code>, <code>--no-shard</code> and <code>--no-long</code> options, respectively. Make sure to add a proper prefix to your test name if it needs ZooKeeper or distributed queries.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checking-for-an-error-that-must-occur">Checking for an Error that Must Occur<a href="#checking-for-an-error-that-must-occur" class="hash-link" aria-label="Direct link to Checking for an Error that Must Occur" title="Direct link to Checking for an Error that Must Occur">​</a></h3><p>Sometimes you want to test that a server error occurs for an incorrect query. We support special annotations for this in SQL tests, in the following form:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">select x; -- { serverError 49 }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This test ensures that the server returns an error with code 49 about unknown column <code>x</code>. If there is no error, or the error is different, the test will fail. If you want to ensure that an error occurs on the client side, use <code>clientError</code> annotation instead.</p><p>Do not check for a particular wording of error message, it may change in the future, and the test will needlessly break. Check only the error code. If the existing error code is not precise enough for your needs, consider adding a new one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-a-distributed-query">Testing a Distributed Query<a href="#testing-a-distributed-query" class="hash-link" aria-label="Direct link to Testing a Distributed Query" title="Direct link to Testing a Distributed Query">​</a></h3><p>If you want to use distributed queries in functional tests, you can leverage <code>remote</code> table function with <code>127.0.0.{1..2}</code> addresses for the server to query itself; or you can use predefined test clusters in server configuration file like <code>test_shard_localhost</code>. Remember to add the words <code>shard</code> or <code>distributed</code> to the test name, so that it is run in CI in correct configurations, where the server is configured to support distributed queries.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="known-bugs">Known Bugs<a href="#known-bugs" class="hash-link" aria-label="Direct link to Known Bugs" title="Direct link to Known Bugs">​</a></h2><p>If we know some bugs that can be easily reproduced by functional tests, we place prepared functional tests in <code>tests/queries/bugs</code> directory. These tests will be moved to <code>tests/queries/0_stateless</code> when bugs are fixed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-tests">Integration Tests<a href="#integration-tests" class="hash-link" aria-label="Direct link to Integration Tests" title="Direct link to Integration Tests">​</a></h2><p>Integration tests allow testing ClickHouse in clustered configuration and ClickHouse interaction with other servers like MySQL, Postgres, MongoDB. They are useful to emulate network splits, packet drops, etc. These tests are run under Docker and create multiple containers with various software.</p><p>See <code>tests/integration/README.md</code> on how to run these tests.</p><p>Note that integration of ClickHouse with third-party drivers is not tested. Also, we currently do not have integration tests with our JDBC and ODBC drivers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unit-tests">Unit Tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit Tests" title="Direct link to Unit Tests">​</a></h2><p>Unit tests are useful when you want to test not the ClickHouse as a whole, but a single isolated library or class. You can enable or disable build of tests with <code>ENABLE_TESTS</code> CMake option. Unit tests (and other test programs) are located in <code>tests</code> subdirectories across the code. To run unit tests, type <code>ninja test</code>. Some tests use <code>gtest</code>, but some are just programs that return non-zero exit code on test failure.</p><p>It’s not necessary to have unit tests if the code is already covered by functional tests (and functional tests are usually much more simple to use).</p><p>You can run individual gtest checks by calling the executable directly, for example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ ./src/unit_tests_dbms --gtest_filter</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">LocalAddress*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tests">Performance Tests<a href="#performance-tests" class="hash-link" aria-label="Direct link to Performance Tests" title="Direct link to Performance Tests">​</a></h2><p>Performance tests allow to measure and compare performance of some isolated part of ClickHouse on synthetic queries. Performance tests are located at <code>tests/performance/</code>. Each test is represented by an <code>.xml</code> file with a description of the test case. Tests are run with <code>docker/test/performance-comparison</code> tool . See the readme file for invocation.</p><p>Each test run one or multiple queries (possibly with combinations of parameters) in a loop.</p><p>If you want to improve performance of ClickHouse in some scenario, and if improvements can be observed on simple queries, it is highly recommended to write a performance test. Also, it is recommended to write performance tests when you add or modify SQL functions which are relatively isolated and not too obscure. It always makes sense to use <code>perf top</code> or other <code>perf</code> tools during your tests.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-tools-and-scripts">Test Tools and Scripts<a href="#test-tools-and-scripts" class="hash-link" aria-label="Direct link to Test Tools and Scripts" title="Direct link to Test Tools and Scripts">​</a></h2><p>Some programs in <code>tests</code> directory are not prepared tests, but are test tools. For example, for <code>Lexer</code> there is a tool <code>src/Parsers/tests/lexer</code> that just do tokenization of stdin and writes colorized result to stdout. You can use these kind of tools as a code examples and for exploration and manual testing.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="miscellaneous-tests">Miscellaneous Tests<a href="#miscellaneous-tests" class="hash-link" aria-label="Direct link to Miscellaneous Tests" title="Direct link to Miscellaneous Tests">​</a></h2><p>There are tests for machine learned models in <code>tests/external_models</code>. These tests are not updated and must be transferred to integration tests.</p><p>There is separate test for quorum inserts. This test run ClickHouse cluster on separate servers and emulate various failure cases: network split, packet drop (between ClickHouse nodes, between ClickHouse and ZooKeeper, between ClickHouse server and client, etc.), <code>kill -9</code>, <code>kill -STOP</code> and <code>kill -CONT</code> , like <a href="https://aphyr.com/tags/Jepsen" target="_blank" rel="noopener noreferrer">Jepsen</a>. Then the test checks that all acknowledged inserts was written and all rejected inserts was not.</p><p>Quorum test was written by separate team before ClickHouse was open-sourced. This team no longer work with ClickHouse. Test was accidentally written in Java. For these reasons, quorum test must be rewritten and moved to integration tests.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-testing">Manual Testing<a href="#manual-testing" class="hash-link" aria-label="Direct link to Manual Testing" title="Direct link to Manual Testing">​</a></h2><p>When you develop a new feature, it is reasonable to also test it manually. You can do it with the following steps:</p><p>Build ClickHouse. Run ClickHouse from the terminal: change directory to <code>programs/clickhouse-server</code> and run it with <code>./clickhouse-server</code>. It will use configuration (<code>config.xml</code>, <code>users.xml</code> and files within <code>config.d</code> and <code>users.d</code> directories) from the current directory by default. To connect to ClickHouse server, run <code>programs/clickhouse-client/clickhouse-client</code>.</p><p>Note that all clickhouse tools (server, client, etc) are just symlinks to a single binary named <code>clickhouse</code>. You can find this binary at <code>programs/clickhouse</code>. All tools can also be invoked as <code>clickhouse tool</code> instead of <code>clickhouse-tool</code>.</p><p>Alternatively you can install ClickHouse package: either stable release from ClickHouse repository or you can build package for yourself with <code>./release</code> in ClickHouse sources root. Then start the server with <code>sudo clickhouse start</code> (or stop to stop the server). Look for logs at <code>/etc/clickhouse-server/clickhouse-server.log</code>.</p><p>When ClickHouse is already installed on your system, you can build a new <code>clickhouse</code> binary and replace the existing binary:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> clickhouse stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./clickhouse /usr/bin/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> clickhouse start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also you can stop system clickhouse-server and run your own with the same configuration but with logging to terminal:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> clickhouse stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> -u clickhouse /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example with gdb:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> -u clickhouse gdb --args /usr/bin/clickhouse server --config-file /etc/clickhouse-server/config.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the system clickhouse-server is already running and you do not want to stop it, you can change port numbers in your <code>config.xml</code> (or override them in a file in <code>config.d</code> directory), provide appropriate data path, and run it.</p><p><code>clickhouse</code> binary has almost no dependencies and works across wide range of Linux distributions. To quick and dirty test your changes on a server, you can simply <code>scp</code> your fresh built <code>clickhouse</code> binary to your server and then run it as in examples above.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-tests">Build Tests<a href="#build-tests" class="hash-link" aria-label="Direct link to Build Tests" title="Direct link to Build Tests">​</a></h2><p>Build tests allow to check that build is not broken on various alternative configurations and on some foreign systems. These tests are automated as well.</p><p>Examples:</p><ul><li>cross-compile for Darwin x86_64 (macOS)</li><li>cross-compile for FreeBSD x86_64</li><li>cross-compile for Linux AArch64</li><li>build on Ubuntu with libraries from system packages (discouraged)</li><li>build with shared linking of libraries (discouraged)</li></ul><p>For example, build with system packages is bad practice, because we cannot guarantee what exact version of packages a system will have. But this is really needed by Debian maintainers. For this reason we at least have to support this variant of build. Another example: shared linking is a common source of trouble, but it is needed for some enthusiasts.</p><p>Though we cannot run all tests on all variant of builds, we want to check at least that various build variants are not broken. For this purpose we use build tests.</p><p>We also test that there are no translation units that are too long to compile or require too much RAM.</p><p>We also test that there are no too large stack frames.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-for-protocol-compatibility">Testing for Protocol Compatibility<a href="#testing-for-protocol-compatibility" class="hash-link" aria-label="Direct link to Testing for Protocol Compatibility" title="Direct link to Testing for Protocol Compatibility">​</a></h2><p>When we extend ClickHouse network protocol, we test manually that old clickhouse-client works with new clickhouse-server and new clickhouse-client works with old clickhouse-server (simply by running binaries from corresponding packages).</p><p>We also test some cases automatically with integrational tests:</p><ul><li>if data written by old version of ClickHouse can be successfully read by the new version;</li><li>do distributed queries work in a cluster with different ClickHouse versions.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="help-from-the-compiler">Help from the Compiler<a href="#help-from-the-compiler" class="hash-link" aria-label="Direct link to Help from the Compiler" title="Direct link to Help from the Compiler">​</a></h2><p>Main ClickHouse code (that is located in <code>dbms</code> directory) is built with <code>-Wall -Wextra -Werror</code> and with some additional enabled warnings. Although these options are not enabled for third-party libraries.</p><p>Clang has even more useful warnings - you can look for them with <code>-Weverything</code> and pick something to default build.</p><p>For production builds, clang is used, but we also test make gcc builds. For development, clang is usually more convenient to use. You can build on your own machine with debug mode (to save battery of your laptop), but please note that compiler is able to generate more warnings with <code>-O3</code> due to better control flow and inter-procedure analysis. When building with clang in debug mode, debug version of <code>libc++</code> is used that allows to catch more errors at runtime.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sanitizers">Sanitizers<a href="#sanitizers" class="hash-link" aria-label="Direct link to Sanitizers" title="Direct link to Sanitizers">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="address-sanitizer">Address sanitizer<a href="#address-sanitizer" class="hash-link" aria-label="Direct link to Address sanitizer" title="Direct link to Address sanitizer">​</a></h3><p>We run functional, integration, stress and unit tests under ASan on per-commit basis.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="thread-sanitizer">Thread sanitizer<a href="#thread-sanitizer" class="hash-link" aria-label="Direct link to Thread sanitizer" title="Direct link to Thread sanitizer">​</a></h3><p>We run functional, integration, stress and unit tests under TSan on per-commit basis.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-sanitizer">Memory sanitizer<a href="#memory-sanitizer" class="hash-link" aria-label="Direct link to Memory sanitizer" title="Direct link to Memory sanitizer">​</a></h3><p>We run functional, integration, stress and unit tests under MSan on per-commit basis.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="undefined-behaviour-sanitizer">Undefined behaviour sanitizer<a href="#undefined-behaviour-sanitizer" class="hash-link" aria-label="Direct link to Undefined behaviour sanitizer" title="Direct link to Undefined behaviour sanitizer">​</a></h3><p>We run functional, integration, stress and unit tests under UBSan on per-commit basis. The code of some third-party libraries is not sanitized for UB.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="valgrind-memcheck">Valgrind (Memcheck)<a href="#valgrind-memcheck" class="hash-link" aria-label="Direct link to Valgrind (Memcheck)" title="Direct link to Valgrind (Memcheck)">​</a></h3><p>We used to run functional tests under Valgrind overnight, but don&#x27;t do it anymore. It takes multiple hours. Currently there is one known false positive in <code>re2</code> library, see <a href="https://research.swtch.com/sparse" target="_blank" rel="noopener noreferrer">this article</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fuzzing">Fuzzing<a href="#fuzzing" class="hash-link" aria-label="Direct link to Fuzzing" title="Direct link to Fuzzing">​</a></h2><p>ClickHouse fuzzing is implemented both using <a href="https://llvm.org/docs/LibFuzzer.html" target="_blank" rel="noopener noreferrer">libFuzzer</a> and random SQL queries.
All the fuzz testing should be performed with sanitizers (Address and Undefined).</p><p>LibFuzzer is used for isolated fuzz testing of library code. Fuzzers are implemented as part of test code and have “_fuzzer” name postfixes.
Fuzzer example can be found at <code>src/Parsers/fuzzers/lexer_fuzzer.cpp</code>. LibFuzzer-specific configs, dictionaries and corpus are stored at <code>tests/fuzz</code>.
We encourage you to write fuzz tests for every functionality that handles user input.</p><p>Fuzzers are not built by default. To build fuzzers both <code>-DENABLE_FUZZING=1</code> and <code>-DENABLE_TESTS=1</code> options should be set.
We recommend to disable Jemalloc while building fuzzers. Configuration used to integrate ClickHouse fuzzing to
Google OSS-Fuzz can be found at <code>docker/fuzz</code>.</p><p>We also use simple fuzz test to generate random SQL queries and to check that the server does not die executing them.
You can find it in <code>00746_sql_fuzzy.pl</code>. This test should be run continuously (overnight and longer).</p><p>We also use sophisticated AST-based query fuzzer that is able to find huge amount of corner cases. It does random permutations and substitutions in queries AST. It remembers AST nodes from previous tests to use them for fuzzing of subsequent tests while processing them in random order. You can learn more about this fuzzer in <a href="https://clickhouse.com/blog/fuzzing-click-house" target="_blank" rel="noopener noreferrer">this blog article</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stress-test">Stress test<a href="#stress-test" class="hash-link" aria-label="Direct link to Stress test" title="Direct link to Stress test">​</a></h2><p>Stress tests are another case of fuzzing. It runs all functional tests in parallel in random order with a single server. Results of the tests are not checked.</p><p>It is checked that:</p><ul><li>server does not crash, no debug or sanitizer traps are triggered;</li><li>there are no deadlocks;</li><li>the database structure is consistent;</li><li>server can successfully stop after the test and start again without exceptions.</li></ul><p>There are five variants (Debug, ASan, TSan, MSan, UBSan).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thread-fuzzer">Thread Fuzzer<a href="#thread-fuzzer" class="hash-link" aria-label="Direct link to Thread Fuzzer" title="Direct link to Thread Fuzzer">​</a></h2><p>Thread Fuzzer (please don&#x27;t mix up with Thread Sanitizer) is another kind of fuzzing that allows to randomize thread order of execution. It helps to find even more special cases.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-audit">Security Audit<a href="#security-audit" class="hash-link" aria-label="Direct link to Security Audit" title="Direct link to Security Audit">​</a></h2><p>Our Security Team did some basic overview of ClickHouse capabilities from the security standpoint.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="static-analyzers">Static Analyzers<a href="#static-analyzers" class="hash-link" aria-label="Direct link to Static Analyzers" title="Direct link to Static Analyzers">​</a></h2><p>We run <code>clang-tidy</code> on per-commit basis. <code>clang-static-analyzer</code> checks are also enabled. <code>clang-tidy</code> is also used for some style checks.</p><p>We have evaluated <code>clang-tidy</code>, <code>Coverity</code>, <code>cppcheck</code>, <code>PVS-Studio</code>, <code>tscancode</code>, <code>CodeQL</code>. You will find instructions for usage in <code>tests/instructions/</code> directory.</p><p>If you use <code>CLion</code> as an IDE, you can leverage some <code>clang-tidy</code> checks out of the box.</p><p>We also use <code>shellcheck</code> for static analysis of shell scripts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hardening">Hardening<a href="#hardening" class="hash-link" aria-label="Direct link to Hardening" title="Direct link to Hardening">​</a></h2><p>In debug build we are using custom allocator that does ASLR of user-level allocations.</p><p>We also manually protect memory regions that are expected to be readonly after allocation.</p><p>In debug build we also involve a customization of libc that ensures that no &quot;harmful&quot; (obsolete, insecure, not thread-safe) functions are called.</p><p>Debug assertions are used extensively.</p><p>In debug build, if exception with &quot;logical error&quot; code (implies a bug) is being thrown, the program is terminated prematurely. It allows to use exceptions in release build but make it an assertion in debug build.</p><p>Debug version of jemalloc is used for debug builds.
Debug version of libc++ is used for debug builds.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-integrity-checks">Runtime Integrity Checks<a href="#runtime-integrity-checks" class="hash-link" aria-label="Direct link to Runtime Integrity Checks" title="Direct link to Runtime Integrity Checks">​</a></h2><p>Data stored on disk is checksummed. Data in MergeTree tables is checksummed in three ways simultaneously* (compressed data blocks, uncompressed data blocks, the total checksum across blocks). Data transferred over network between client and server or between servers is also checksummed. Replication ensures bit-identical data on replicas.</p><p>It is required to protect from faulty hardware (bit rot on storage media, bit flips in RAM on server, bit flips in RAM of network controller, bit flips in RAM of network switch, bit flips in RAM of client, bit flips on the wire). Note that bit flips are common and likely to occur even for ECC RAM and in presence of TCP checksums (if you manage to run thousands of servers processing petabytes of data each day). <a href="https://www.youtube.com/watch?v=ooBAQIe0KlQ" target="_blank" rel="noopener noreferrer">See the video (russian)</a>.</p><p>ClickHouse provides diagnostics that will help ops engineers to find faulty hardware.</p><p>*<!-- --> and it is not slow.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-style">Code Style<a href="#code-style" class="hash-link" aria-label="Direct link to Code Style" title="Direct link to Code Style">​</a></h2><p>Code style rules are described <a href="/AlgoliaDocsSelfCrawl/en/development/style">here</a>.</p><p>To check for some common style violations, you can use <code>utils/check-style</code> script.</p><p>To force proper style of your code, you can use <code>clang-format</code>. File <code>.clang-format</code> is located at the sources root. It mostly corresponding with our actual code style. But it’s not recommended to apply <code>clang-format</code> to existing files because it makes formatting worse. You can use <code>clang-format-diff</code> tool that you can find in clang source repository.</p><p>Alternatively you can try <code>uncrustify</code> tool to reformat your code. Configuration is in <code>uncrustify.cfg</code> in the sources root. It is less tested than <code>clang-format</code>.</p><p><code>CLion</code> has its own code formatter that has to be tuned for our code style.</p><p>We also use <code>codespell</code> to find typos in code. It is automated as well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-coverage">Test Coverage<a href="#test-coverage" class="hash-link" aria-label="Direct link to Test Coverage" title="Direct link to Test Coverage">​</a></h2><p>We also track test coverage but only for functional tests and only for clickhouse-server. It is performed on daily basis.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tests-for-tests">Tests for Tests<a href="#tests-for-tests" class="hash-link" aria-label="Direct link to Tests for Tests" title="Direct link to Tests for Tests">​</a></h2><p>There is automated check for flaky tests. It runs all new tests 100 times (for functional tests) or 10 times (for integration tests). If at least single time the test failed, it is considered flaky.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-automation">Test Automation<a href="#test-automation" class="hash-link" aria-label="Direct link to Test Automation" title="Direct link to Test Automation">​</a></h2><p>We run tests with <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a>.</p><p>Build jobs and tests are run in Sandbox on per commit basis. Resulting packages and test results are published in GitHub and can be downloaded by direct links. Artifacts are stored for several months. When you send a pull request on GitHub, we tag it as “can be tested” and our CI system will build ClickHouse packages (release, debug, with address sanitizer, etc) for you.</p><p>We do not use Travis CI due to the limit on time and computational power.
We do not use Jenkins. It was used before and now we are happy we are not using Jenkins.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ClickHouse/ClickHouse/tree/master/docs/ru/development/tests.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/AlgoliaDocsSelfCrawl/ru/development/integrating_rust_libraries"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Интеграция библиотек на языке Rust в ClickHouse.</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/AlgoliaDocsSelfCrawl/ru/commercial/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Коммерческие услуги</div></a></nav></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ClickHouse</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://clickhouse.com/cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ClickHouse as a Service</a></li><li class="footer__item"><a href="https://clickhouse.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://clickhouse.com/learn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Learn ClickHouse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ClickHouse/ClickHouse" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://clickhouse.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.meetup.com/pro/clickhouse/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetup<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Policies</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clickhouse.com/legal/trademark-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse Documentation" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/AlgoliaDocsSelfCrawl/img/logo_without_text.svg" alt="ClickHouse Documentation" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright &copy; 2016&ndash;2023 ClickHouse, Inc. ClickHouse Docs provided under the Creative Commons CC BY-NC-SA 4.0 license. ClickHouse&reg; is a registered trademark of ClickHouse, Inc.</div></div></div></footer></div>
<script src="/AlgoliaDocsSelfCrawl/assets/js/runtime~main.be802059.js"></script>
<script src="/AlgoliaDocsSelfCrawl/assets/js/main.b00bfaaf.js"></script>
</body>
</html>