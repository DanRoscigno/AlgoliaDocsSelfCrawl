"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[831],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=c(n),h=a,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||s;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[p]="string"==typeof e?e:a,i[1]=o;for(var c=2;c<s;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},64287:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const s={slug:"/en/guides/sre/scaling-clusters",sidebar_label:"Rebalancing Shards",sidebar_position:20,description:"ClickHouse does not support automatic shard rebalancing, so we provide some best practices for how to rebalance shards."},i="Rebalancing Data",o={unversionedId:"en/guides/sre/scaling-clusters",id:"en/guides/sre/scaling-clusters",title:"Rebalancing Data",description:"ClickHouse does not support automatic shard rebalancing, so we provide some best practices for how to rebalance shards.",source:"@site/docs/en/guides/sre/scaling-clusters.md",sourceDirName:"en/guides/sre",slug:"/en/guides/sre/scaling-clusters",permalink:"/docs/en/guides/sre/scaling-clusters",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/guides/sre/scaling-clusters.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{slug:"/en/guides/sre/scaling-clusters",sidebar_label:"Rebalancing Shards",sidebar_position:20,description:"ClickHouse does not support automatic shard rebalancing, so we provide some best practices for how to rebalance shards."},sidebar:"english",previous:{title:"Secured Communication with Zookeeper",permalink:"/docs/en/operations/ssl-zookeeper"},next:{title:"Configuring SSL-TLS",permalink:"/docs/en/guides/sre/configuring-ssl"}},l={},c=[],u={toc:c},p="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"rebalancing-data"},"Rebalancing Data"),(0,a.kt)("p",null,"ClickHouse does not support automatic shard rebalancing. However, there are ways to rebalance shards in order of preference:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Adjust the shard for the ",(0,a.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/special/distributed"},"distributed table"),", allowing writes to be biased to the new shard. This potentially will cause load imbalances and hot spots on the cluster but can be viable in most scenarios where write throughput is not extremely high. It does not require the user to change their write target i.e. It can remain as the distributed table. This does not assist with rebalancing existing data.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"As an alternative to (1), modify the existing cluster and write exclusively to the new shard until the cluster is balanced - manually weighting writes. This has the same limitations as (1).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If you need to rebalance existing data and you have partitioned your data, consider detaching partitions and manually relocating them to another node before reattaching to the new shard. This is more manual than subsequent techniques but may be faster and less resource-intensive. This is a manual operation and thus needs to consider the rebalancing of the data.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create a new cluster with the new topology and copy the data using ",(0,a.kt)("a",{parentName:"p",href:"/docs/en/operations/utilities/clickhouse-copier"},"ClickHouse Copier"),".  Alternatively, create a new database within the existing cluster and migrate the data using ClickHouse Copier. This can be potentially computationally expensive and may impact your production environment. Building a new cluster on separate hardware, and applying this technique, is an option to mitigate this at the expense of cost.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Export the data from the source cluster to the new cluster via an ",(0,a.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/insert-into/#inserting-the-results-of-select"},"INSERT FROM SELECT"),". This will not be performant on very large datasets and will potentially incur significant IO on the source cluster and use considerable network resources. This represents a last resort."))),(0,a.kt)("p",null,"There is an internal effort to reconsider how rebalancing could be implemented. There is some relevant discussion ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/ClickHouse/issues/13574"},"here"),"."))}d.isMDXComponent=!0}}]);