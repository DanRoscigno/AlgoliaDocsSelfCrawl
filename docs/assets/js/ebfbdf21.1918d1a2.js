"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[73035],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>y});var n=t(67294);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=n.createContext({}),c=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},p=function(e){var a=c(e.components);return n.createElement(s.Provider,{value:a},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(t),u=i,y=d["".concat(s,".").concat(u)]||d[u]||m[u]||r;return t?n.createElement(y,o(o({ref:a},p),{},{components:t})):n.createElement(y,o({ref:a},p))}));function y(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=t[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},22504:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=t(87462),i=(t(67294),t(3905));const r={slug:"/en/engines/database-engines/atomic",sidebar_label:"Atomic",sidebar_position:10},o="Atomic",l={unversionedId:"en/engines/database-engines/atomic",id:"en/engines/database-engines/atomic",title:"Atomic",description:"It supports non-blocking DROP TABLE and RENAME TABLE queries and atomic EXCHANGE TABLES queries. Atomic database engine is used by default.",source:"@site/docs/en/engines/database-engines/atomic.md",sourceDirName:"en/engines/database-engines",slug:"/en/engines/database-engines/atomic",permalink:"/AlgoliaDocsSelfCrawl/en/engines/database-engines/atomic",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/engines/database-engines/atomic.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{slug:"/en/engines/database-engines/atomic",sidebar_label:"Atomic",sidebar_position:10},sidebar:"english",previous:{title:"Database Engines",permalink:"/AlgoliaDocsSelfCrawl/en/engines/database-engines/"},next:{title:"Lazy",permalink:"/AlgoliaDocsSelfCrawl/en/engines/database-engines/lazy"}},s={},c=[{value:"Creating a Database",id:"creating-a-database",level:2},{value:"Specifics and recommendations",id:"specifics-and-recommendations",level:2},{value:"Table UUID",id:"table-uuid",level:3},{value:"RENAME TABLE",id:"rename-table",level:3},{value:"DROP/DETACH TABLE",id:"drop-detach-table",level:3},{value:"EXCHANGE TABLES/DICTIONARIES",id:"exchange-tables",level:3},{value:"ReplicatedMergeTree in Atomic Database",id:"replicatedmergetree-in-atomic-database",level:3},{value:"See Also",id:"see-also",level:2}],p={toc:c},d="wrapper";function m(e){let{components:a,...t}=e;return(0,i.kt)(d,(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"atomic"},"Atomic"),(0,i.kt)("p",null,"It supports non-blocking ",(0,i.kt)("a",{parentName:"p",href:"#drop-detach-table"},"DROP TABLE")," and ",(0,i.kt)("a",{parentName:"p",href:"#rename-table"},"RENAME TABLE")," queries and atomic ",(0,i.kt)("a",{parentName:"p",href:"#exchange-tables"},"EXCHANGE TABLES")," queries. ",(0,i.kt)("inlineCode",{parentName:"p"},"Atomic")," database engine is used by default."),(0,i.kt)("h2",{id:"creating-a-database"},"Creating a Database"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE test [ENGINE = Atomic];\n")),(0,i.kt)("h2",{id:"specifics-and-recommendations"},"Specifics and recommendations"),(0,i.kt)("h3",{id:"table-uuid"},"Table UUID"),(0,i.kt)("p",null,"All tables in database ",(0,i.kt)("inlineCode",{parentName:"p"},"Atomic")," have persistent ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/data-types/uuid"},"UUID")," and store data in directory ",(0,i.kt)("inlineCode",{parentName:"p"},"/clickhouse_path/store/xxx/xxxyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/"),", where ",(0,i.kt)("inlineCode",{parentName:"p"},"xxxyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy")," is UUID of the table.\nUsually, the UUID is generated automatically, but the user can also explicitly specify the UUID in the same way when creating the table (this is not recommended). "),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE name UUID '28f1c61c-2970-457a-bffe-454156ddcfef' (n UInt64) ENGINE = ...;\n")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You can use the ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/operations/settings/settings#show_table_uuid_in_table_create_query_if_not_nil"},"show_table_uuid_in_table_create_query_if_not_nil")," setting to display the UUID with the ",(0,i.kt)("inlineCode",{parentName:"p"},"SHOW CREATE")," query. ")),(0,i.kt)("h3",{id:"rename-table"},"RENAME TABLE"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/statements/rename"},"RENAME")," queries are performed without changing the UUID or moving table data. These queries do not wait for the completion of queries using the table and are executed instantly."),(0,i.kt)("h3",{id:"drop-detach-table"},"DROP/DETACH TABLE"),(0,i.kt)("p",null,"On ",(0,i.kt)("inlineCode",{parentName:"p"},"DROP TABLE")," no data is removed, database ",(0,i.kt)("inlineCode",{parentName:"p"},"Atomic")," just marks table as dropped by moving metadata to ",(0,i.kt)("inlineCode",{parentName:"p"},"/clickhouse_path/metadata_dropped/")," and notifies background thread. Delay before final table data deletion is specified by the ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/operations/server-configuration-parameters/settings#database_atomic_delay_before_drop_table_sec"},"database_atomic_delay_before_drop_table_sec")," setting.\nYou can specify synchronous mode using ",(0,i.kt)("inlineCode",{parentName:"p"},"SYNC")," modifier. Use the ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/operations/settings/settings#database_atomic_wait_for_drop_and_detach_synchronously"},"database_atomic_wait_for_drop_and_detach_synchronously")," setting to do this. In this case ",(0,i.kt)("inlineCode",{parentName:"p"},"DROP")," waits for running ",(0,i.kt)("inlineCode",{parentName:"p"},"SELECT"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," and other queries which are using the table to finish. Table will be actually removed when it's not in use."),(0,i.kt)("h3",{id:"exchange-tables"},"EXCHANGE TABLES/DICTIONARIES"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/statements/exchange"},"EXCHANGE")," query swaps tables or dictionaries atomically. For instance, instead of this non-atomic operation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"RENAME TABLE new_table TO tmp, old_table TO new_table, tmp TO old_table;\n")),(0,i.kt)("p",null,"you can use one atomic query:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"EXCHANGE TABLES new_table AND old_table;\n")),(0,i.kt)("h3",{id:"replicatedmergetree-in-atomic-database"},"ReplicatedMergeTree in Atomic Database"),(0,i.kt)("p",null,"For ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/engines/table-engines/mergetree-family/replication#table_engines-replication"},"ReplicatedMergeTree")," tables, it is recommended not to specify engine parameters - path in ZooKeeper and replica name. In this case, configuration parameters ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/operations/server-configuration-parameters/settings#default_replica_path"},"default_replica_path")," and ",(0,i.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/operations/server-configuration-parameters/settings#default_replica_name"},"default_replica_name")," will be used. If you want to specify engine parameters explicitly, it is recommended to use ",(0,i.kt)("inlineCode",{parentName:"p"},"{uuid}")," macros. This is useful so that unique paths are automatically generated for each table in ZooKeeper."),(0,i.kt)("h2",{id:"see-also"},"See Also"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/AlgoliaDocsSelfCrawl/en/operations/system-tables/databases"},"system.databases")," system table")))}m.isMDXComponent=!0}}]);