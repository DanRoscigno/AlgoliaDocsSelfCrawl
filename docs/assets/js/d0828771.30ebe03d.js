"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[99662],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,f=m["".concat(l,".").concat(u)]||m[u]||d[u]||s;return n?a.createElement(f,i(i({ref:t},c),{},{components:n})):a.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},77088:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const s={slug:"/en/sql-reference/statements/alter/",sidebar_position:35,sidebar_label:"ALTER"},i="ALTER",o={unversionedId:"en/sql-reference/statements/alter/index",id:"en/sql-reference/statements/alter/index",title:"ALTER",description:"Most ALTER TABLE queries modify table settings or data:",source:"@site/docs/en/sql-reference/statements/alter/index.md",sourceDirName:"en/sql-reference/statements/alter",slug:"/en/sql-reference/statements/alter/",permalink:"/docs/en/sql-reference/statements/alter/",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/sql-reference/statements/alter/index.md",tags:[],version:"current",sidebarPosition:35,frontMatter:{slug:"/en/sql-reference/statements/alter/",sidebar_position:35,sidebar_label:"ALTER"},sidebar:"english",previous:{title:"SETTINGS PROFILE",permalink:"/docs/en/sql-reference/statements/create/settings-profile"},next:{title:"COLUMN",permalink:"/docs/en/sql-reference/statements/alter/column"}},l={},p=[{value:"Mutations",id:"mutations",level:2},{value:"Synchronicity of ALTER Queries",id:"synchronicity-of-alter-queries",level:2}],c={toc:p},m="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"alter"},"ALTER"),(0,r.kt)("p",null,"Most ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," queries modify table settings or data:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/column"},"COLUMN")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/partition"},"PARTITION")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/delete"},"DELETE")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/update"},"UPDATE")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/order-by"},"ORDER BY")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/skipping-index"},"INDEX")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/constraint"},"CONSTRAINT")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/ttl"},"TTL"))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Most ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," queries are supported only for ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/mergetree-family/"},"*","MergeTree")," tables, as well as ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/special/merge"},"Merge")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/special/distributed"},"Distributed"),".")),(0,r.kt)("p",null,"These ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," statements manipulate views:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/view"},"ALTER TABLE ... MODIFY QUERY")," \u2014 Modifies a ",(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/create/view/#materialized"},"Materialized view")," structure."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/view/#alter-live-view"},"ALTER LIVE VIEW")," \u2014 Refreshes a ",(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/create/view/#live-view"},"Live view"),".")),(0,r.kt)("p",null,"These ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," statements modify entities related to role-based access control:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/user"},"USER")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/role"},"ROLE")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/quota"},"QUOTA")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/row-policy"},"ROW POLICY")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/alter/settings-profile"},"SETTINGS PROFILE"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/alter/comment"},"ALTER TABLE ... MODIFY COMMENT")," statement adds, modifies, or removes comments to the table, regardless if it was set before or not."),(0,r.kt)("h2",{id:"mutations"},"Mutations"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," queries that are intended to manipulate table data are implemented with a mechanism called \u201cmutations\u201d, most notably ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/alter/delete"},"ALTER TABLE \u2026 DELETE")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/alter/update"},"ALTER TABLE \u2026 UPDATE"),". They are asynchronous background processes similar to merges in ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/mergetree-family/"},"MergeTree")," tables that to produce new \u201cmutated\u201d versions of parts."),(0,r.kt)("p",null,"For ",(0,r.kt)("inlineCode",{parentName:"p"},"*MergeTree")," tables mutations execute by ",(0,r.kt)("strong",{parentName:"p"},"rewriting whole data parts"),". There is no atomicity - parts are substituted for mutated parts as soon as they are ready and a ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," query that started executing during a mutation will see data from parts that have already been mutated along with data from parts that have not been mutated yet."),(0,r.kt)("p",null,"Mutations are totally ordered by their creation order and are applied to each part in that order. Mutations are also partially ordered with ",(0,r.kt)("inlineCode",{parentName:"p"},"INSERT INTO")," queries: data that was inserted into the table before the mutation was submitted will be mutated and data that was inserted after that will not be mutated. Note that mutations do not block inserts in any way."),(0,r.kt)("p",null,"A mutation query returns immediately after the mutation entry is added (in case of replicated tables to ZooKeeper, for non-replicated tables - to the filesystem). The mutation itself executes asynchronously using the system profile settings. To track the progress of mutations you can use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/operations/system-tables/mutations/#system_tables-mutations"},(0,r.kt)("inlineCode",{parentName:"a"},"system.mutations"))," table. A mutation that was successfully submitted will continue to execute even if ClickHouse servers are restarted. There is no way to roll back the mutation once it is submitted, but if the mutation is stuck for some reason it can be cancelled with the ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/kill/#kill-mutation"},(0,r.kt)("inlineCode",{parentName:"a"},"KILL MUTATION"))," query."),(0,r.kt)("p",null,"Entries for finished mutations are not deleted right away (the number of preserved entries is determined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"finished_mutations_to_keep")," storage engine parameter). Older mutation entries are deleted."),(0,r.kt)("h2",{id:"synchronicity-of-alter-queries"},"Synchronicity of ALTER Queries"),(0,r.kt)("p",null,"For non-replicated tables, all ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," queries are performed synchronously. For replicated tables, the query just adds instructions for the appropriate actions to ",(0,r.kt)("inlineCode",{parentName:"p"},"ZooKeeper"),", and the actions themselves are performed as soon as possible. However, the query can wait for these actions to be completed on all the replicas."),(0,r.kt)("p",null,"For all ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," queries, you can use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/operations/settings/settings/#alter-sync"},"alter_sync")," setting to set up waiting."),(0,r.kt)("p",null,"You can specify how long (in seconds) to wait for inactive replicas to execute all ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," queries with the ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/operations/settings/settings/#replication-wait-for-inactive-replica-timeout"},"replication_wait_for_inactive_replica_timeout")," setting."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"For all ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER")," queries, if ",(0,r.kt)("inlineCode",{parentName:"p"},"alter_sync = 2")," and some replicas are not active for more than the time, specified in the ",(0,r.kt)("inlineCode",{parentName:"p"},"replication_wait_for_inactive_replica_timeout")," setting, then an exception ",(0,r.kt)("inlineCode",{parentName:"p"},"UNFINISHED")," is thrown.")),(0,r.kt)("p",null,"For ",(0,r.kt)("inlineCode",{parentName:"p"},"ALTER TABLE ... UPDATE|DELETE")," queries the synchronicity is defined by the ",(0,r.kt)("a",{parentName:"p",href:"/docs/en/operations/settings/settings/#mutations_sync"},"mutations_sync")," setting."))}d.isMDXComponent=!0}}]);