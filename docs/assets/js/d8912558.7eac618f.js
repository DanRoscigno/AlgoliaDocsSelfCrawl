"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[45113],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=o,g=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(g,r(r({ref:t},c),{},{components:n})):a.createElement(g,r({ref:t},c))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,r[1]=s;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},81694:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_label:"EMQX Cloud Data Integration",sidebar_position:4,slug:"/en/integrations/emqx/emqx-cloud-data-integration",description:"Introduction to EMQX Cloud Data Integration"},r="Integration EMQX Cloud with ClickHouse Cloud",s={unversionedId:"en/integrations/data-ingestion/emqx/emqx-cloud-data-integration",id:"en/integrations/data-ingestion/emqx/emqx-cloud-data-integration",title:"Integration EMQX Cloud with ClickHouse Cloud",description:"Introduction to EMQX Cloud Data Integration",source:"@site/docs/en/integrations/data-ingestion/emqx/emqx-cloud-data-integration.md",sourceDirName:"en/integrations/data-ingestion/emqx",slug:"/en/integrations/emqx/emqx-cloud-data-integration",permalink:"/docs/en/integrations/emqx/emqx-cloud-data-integration",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/integrations/data-ingestion/emqx/emqx-cloud-data-integration.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"EMQX Cloud Data Integration",sidebar_position:4,slug:"/en/integrations/emqx/emqx-cloud-data-integration",description:"Introduction to EMQX Cloud Data Integration"},sidebar:"english",previous:{title:"Create EMQX Cloud Deployment",permalink:"/docs/en/integrations/emqx/create-emqx-cloud-deployment"},next:{title:"Workflow Samples",permalink:"/docs/en/integrations/emqx/workflow-samples"}},l={},u=[{value:"Create ClickHouse Resource",id:"create-clickhouse-resource",level:2},{value:"Create A New Rule",id:"create-a-new-rule",level:2},{value:"Add a response action",id:"add-a-response-action",level:2},{value:"View Rules Details",id:"view-rules-details",level:2}],c={toc:u},d="wrapper";function p(e){let{components:t,...i}=e;return(0,o.kt)(d,(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"integration-emqx-cloud-with-clickhouse-cloud"},"Integration EMQX Cloud with ClickHouse Cloud"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.emqx.com/en/cloud/latest/rule_engine/introduction.html#general-flow"},"EMQX Cloud Data Integrations"),' is used to configure the rules for handling and responding to EMQX message flows and device events. The Data Integrations not only provides a clear and flexible "configurable" architecture solution, but also simplifies the development process, improves user usability, and reduces the coupling degree between the business system and EMQX Cloud. It also provides a superior infrastructure for customization of EMQX Cloud\'s proprietary capabilities.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"emqx_cloud_data_integration",src:n(17795).Z,width:"1746",height:"812"})),(0,o.kt)("p",null,"EMQX Cloud offers more than 30 native integrations with popular data systems. ClickHouse is one of them."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_clickhouse",src:n(70288).Z,width:"3080",height:"1902"})),(0,o.kt)("h2",{id:"create-clickhouse-resource"},"Create ClickHouse Resource"),(0,o.kt)("p",null,'Click "Data Integrations" on the left menu and click "View All Resouces". You will find the ClickHouse in the Data Persistence section or you can search for ClickHouse.'),(0,o.kt)("p",null,"Click the ClickHouse card to create a new resource."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Note: add a note for this resource."),(0,o.kt)("li",{parentName:"ul"},"Server address: this is the address of your ClickHouse Cloud service, remember don\u2019t forget the port."),(0,o.kt)("li",{parentName:"ul"},"Database name: \u2018emqx\u2019 we created in the above steps."),(0,o.kt)("li",{parentName:"ul"},"User: the username for connecting to your ClickHouse Cloud service."),(0,o.kt)("li",{parentName:"ul"},"Key: the password for the connection.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_resource",src:n(30238).Z,width:"3468",height:"1504"})),(0,o.kt)("h2",{id:"create-a-new-rule"},"Create A New Rule"),(0,o.kt)("p",null,"During the creation of the resource, you will see a popup, and clicking \u2018New\u2019 will leads you to the rule creation page."),(0,o.kt)("p",null,"EMQX provides a powerful ",(0,o.kt)("a",{parentName:"p",href:"https://docs.emqx.com/en/cloud/latest/rule_engine/rules.html"},"rule engine")," that can transform, and enrich the raw MQTT message before sending it to third-party systems."),(0,o.kt)("p",null,"Here\u2019s the rule used in this tutorial:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},'SELECT\n   clientid as client_id,\n   (timestamp div 1000) as timestamp,\n   topic as topic,\n   payload.temp as temp,\n   payload.hum as hum\nFROM\n"temp_hum/emqx"\n')),(0,o.kt)("p",null,"It will read the messages from the \u2018temp_hum/emqx\u2019 topic and enrich the JSON object by adding client_id, topic, and timestamp info."),(0,o.kt)("p",null,"So, the raw JSON you send to the topic:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{"temp": 28.5, "hum": 0.68}\n')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_rule_1",src:n(1281).Z,width:"2356",height:"1568"})),(0,o.kt)("p",null,"You can use the SQL test to test and see the results."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_rule_2",src:n(97326).Z,width:"2344",height:"1718"})),(0,o.kt)("p",null,"Now click on the \u201cNEXT\u201d button. This step is to tell EMQX Cloud how to insert refined data into your ClickHouse database."),(0,o.kt)("h2",{id:"add-a-response-action"},"Add a response action"),(0,o.kt)("p",null,"If you have only one resource, you don\u2019t need to modify the \u2018Resource\u2019 and \u2018Action Type\u2019.\nYou only need to set the SQL template. Here\u2019s the example used for this tutorial:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"INSERT INTO temp_hum (client_id, timestamp, topic, temp, hum) VALUES ('${client_id}', ${timestamp}, '${topic}', ${temp}, ${hum})\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_rule_action",src:n(47740).Z,width:"2310",height:"1586"})),(0,o.kt)("p",null,"This is a template for inserting data into Clickhouse, you can see the variables are used here."),(0,o.kt)("h2",{id:"view-rules-details"},"View Rules Details"),(0,o.kt)("p",null,'Click "Confirm" and "View Details". Now, everything should be well set. You can see the data integration works from rule details page.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"data_integration_details",src:n(6573).Z,width:"2344",height:"1950"})),(0,o.kt)("p",null,'All the MQTT messages sent to the "temp_hum/emqx" topic will be persisted into your ClickHouse Cloud database.'))}p.isMDXComponent=!0},70288:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_clickhouse-af6f3882d90e0220a520028a3f717558.png"},6573:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_details-8d808aa6d793f622886a210974fc264c.png"},30238:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_resource-276cd9b209292c004135b7e5f173a70f.png"},1281:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_rule_1-0e2208a14335aebbfd52fed762ed578b.png"},97326:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_rule_2-d49f9d73fe87939c333413712810f40e.png"},47740:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data_integration_rule_action-f931168bf9890e8afa8477faceef125d.png"},17795:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/emqx_cloud_data_integration-ef508af3e17ec51038ad4e652a64c0f3.png"}}]);