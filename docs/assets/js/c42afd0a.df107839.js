"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[84716],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>k});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var o=n.createContext({}),d=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(o.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=d(a),c=i,k=m["".concat(o,".").concat(c)]||m[c]||u[c]||l;return a?n.createElement(k,r(r({ref:t},p),{},{components:a})):n.createElement(k,r({ref:t},p))}));function k(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=c;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[m]="string"==typeof e?e:i,r[1]=s;for(var d=2;d<l;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},20182:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));const l={slug:"/en/engines/database-engines/materialized-mysql",sidebar_label:"MaterializedMySQL",sidebar_position:70},r="[experimental] MaterializedMySQL",s={unversionedId:"en/engines/database-engines/materialized-mysql",id:"en/engines/database-engines/materialized-mysql",title:"[experimental] MaterializedMySQL",description:"This is an experimental feature that should not be used in production.",source:"@site/docs/en/engines/database-engines/materialized-mysql.md",sourceDirName:"en/engines/database-engines",slug:"/en/engines/database-engines/materialized-mysql",permalink:"/docs/en/engines/database-engines/materialized-mysql",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/engines/database-engines/materialized-mysql.md",tags:[],version:"current",sidebarPosition:70,frontMatter:{slug:"/en/engines/database-engines/materialized-mysql",sidebar_label:"MaterializedMySQL",sidebar_position:70},sidebar:"english",previous:{title:"MaterializedPostgreSQL",permalink:"/docs/en/engines/database-engines/materialized-postgresql"},next:{title:"Table Engines",permalink:"/docs/en/engines/table-engines/"}},o={},d=[{value:"Creating a Database",id:"creating-a-database",level:2},{value:"Engine Settings",id:"engine-settings",level:2},{value:"max_rows_in_buffer",id:"max_rows_in_buffer",level:3},{value:"max_bytes_in_buffer",id:"max_bytes_in_buffer",level:3},{value:"max_flush_data_time",id:"max_flush_data_time",level:3},{value:"max_wait_time_when_mysql_unavailable",id:"max_wait_time_when_mysql_unavailable",level:3},{value:"allows_query_when_mysql_lost",id:"allows_query_when_mysql_lost",level:3},{value:"materialized_mysql_tables_list",id:"materialized_mysql_tables_list",level:3},{value:"Settings on MySQL-server Side",id:"settings-on-mysql-server-side",level:2},{value:"default_authentication_plugin",id:"default_authentication_plugin",level:3},{value:"gtid_mode",id:"gtid_mode",level:3},{value:"Virtual Columns",id:"virtual-columns",level:2},{value:"_version",id:"_version",level:3},{value:"_sign",id:"_sign",level:3},{value:"Data Types Support",id:"data_types-support",level:2},{value:"Specifics and Recommendations",id:"specifics-and-recommendations",level:2},{value:"Compatibility Restrictions",id:"compatibility-restrictions",level:3},{value:"DDL Queries",id:"ddl-queries",level:3},{value:"Data Replication",id:"data-replication",level:3},{value:"Selecting from MaterializedMySQL Tables",id:"select",level:3},{value:"Index Conversion",id:"index-conversion",level:3},{value:"Table Overrides",id:"table-overrides",level:3},{value:"Examples of Use",id:"examples-of-use",level:2}],p={toc:d},m="wrapper";function u(e){let{components:t,...a}=e;return(0,i.kt)(m,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"experimental-materializedmysql"},"[experimental]"," MaterializedMySQL"),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"This is an experimental feature that should not be used in production.")),(0,i.kt)("p",null,"Creates a ClickHouse database with all the tables existing in MySQL, and all the data in those tables. The ClickHouse server works as MySQL replica. It reads ",(0,i.kt)("inlineCode",{parentName:"p"},"binlog")," and performs DDL and DML queries."),(0,i.kt)("h2",{id:"creating-a-database"},"Creating a Database"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE [IF NOT EXISTS] db_name [ON CLUSTER cluster]\nENGINE = MaterializedMySQL('host:port', ['database' | database], 'user', 'password') [SETTINGS ...]\n[TABLE OVERRIDE table1 (...), TABLE OVERRIDE table2 (...)]\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Engine Parameters")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host:port")," \u2014 MySQL server endpoint."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"database")," \u2014 MySQL database name."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"user")," \u2014 MySQL user."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"password")," \u2014 User password.")),(0,i.kt)("h2",{id:"engine-settings"},"Engine Settings"),(0,i.kt)("h3",{id:"max_rows_in_buffer"},"max_rows_in_buffer"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"max_rows_in_buffer")," \u2014 Maximum number of rows that data is allowed to cache in memory (for single table and the cache data unable to query). When this number is exceeded, the data will be materialized. Default: ",(0,i.kt)("inlineCode",{parentName:"p"},"65 505"),"."),(0,i.kt)("h3",{id:"max_bytes_in_buffer"},"max_bytes_in_buffer"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"max_bytes_in_buffer")," \u2014  Maximum number of bytes that data is allowed to cache in memory (for single table and the cache data unable to query). When this number is exceeded, the data will be materialized. Default: ",(0,i.kt)("inlineCode",{parentName:"p"},"1 048 576"),"."),(0,i.kt)("h3",{id:"max_flush_data_time"},"max_flush_data_time"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"max_flush_data_time")," \u2014 Maximum number of milliseconds that data is allowed to cache in memory (for database and the cache data unable to query). When this time is exceeded, the data will be materialized. Default: ",(0,i.kt)("inlineCode",{parentName:"p"},"1000"),"."),(0,i.kt)("h3",{id:"max_wait_time_when_mysql_unavailable"},"max_wait_time_when_mysql_unavailable"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"max_wait_time_when_mysql_unavailable")," \u2014 Retry interval when MySQL is not available (milliseconds). Negative value disables retry. Default: ",(0,i.kt)("inlineCode",{parentName:"p"},"1000"),"."),(0,i.kt)("h3",{id:"allows_query_when_mysql_lost"},"allows_query_when_mysql_lost"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"allows_query_when_mysql_lost")," \u2014 Allows to query a materialized table when MySQL is lost. Default: ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," (",(0,i.kt)("inlineCode",{parentName:"p"},"false"),")."),(0,i.kt)("h3",{id:"materialized_mysql_tables_list"},"materialized_mysql_tables_list"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"materialized_mysql_tables_list")," \u2014 a comma-separated list of mysql database tables, which will be replicated by MaterializedMySQL database engine. Default value: empty list \u2014 means whole tables will be replicated."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE mysql ENGINE = MaterializedMySQL('localhost:3306', 'db', 'user', '***')\n     SETTINGS\n        allows_query_when_mysql_lost=true,\n        max_wait_time_when_mysql_unavailable=10000;\n")),(0,i.kt)("h2",{id:"settings-on-mysql-server-side"},"Settings on MySQL-server Side"),(0,i.kt)("p",null,"For the correct work of ",(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL"),", there are few mandatory ",(0,i.kt)("inlineCode",{parentName:"p"},"MySQL"),"-side configuration settings that must be set:"),(0,i.kt)("h3",{id:"default_authentication_plugin"},"default_authentication_plugin"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"default_authentication_plugin = mysql_native_password")," since ",(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL")," can only authorize with this method."),(0,i.kt)("h3",{id:"gtid_mode"},"gtid_mode"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"gtid_mode = on")," since GTID based logging is a mandatory for providing correct ",(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL")," replication."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"While turning on ",(0,i.kt)("inlineCode",{parentName:"p"},"gtid_mode")," you should also specify ",(0,i.kt)("inlineCode",{parentName:"p"},"enforce_gtid_consistency = on"),".")),(0,i.kt)("h2",{id:"virtual-columns"},"Virtual Columns"),(0,i.kt)("p",null,"When working with the ",(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL")," database engine, ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/engines/table-engines/mergetree-family/replacingmergetree"},"ReplacingMergeTree")," tables are used with virtual ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"_version")," columns."),(0,i.kt)("h3",{id:"_version"},"_","version"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"_version")," \u2014 Transaction counter. Type ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt64"),"."),(0,i.kt)("h3",{id:"_sign"},"_","sign"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"_sign")," \u2014 Deletion mark. Type ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/data-types/int-uint"},"Int8"),". Possible values:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"- `1` \u2014 Row is not deleted,\n- `-1` \u2014 Row is deleted.\n")),(0,i.kt)("h2",{id:"data_types-support"},"Data Types Support"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"MySQL"),(0,i.kt)("th",{parentName:"tr",align:null},"ClickHouse"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"TINY"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"Int8"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SHORT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"Int16"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"INT24"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"Int32"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"LONG"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt32"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"LONGLONG"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt64"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"FLOAT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/float"},"Float32"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DOUBLE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/float"},"Float64"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DECIMAL, NEWDECIMAL"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/decimal"},"Decimal"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DATE, NEWDATE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/date"},"Date"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DATETIME, TIMESTAMP"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/datetime"},"DateTime"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DATETIME2, TIMESTAMP2"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/datetime64"},"DateTime64"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"YEAR"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt16"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"TIME"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"Int64"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ENUM"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/enum"},"Enum"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"STRING"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/string"},"String"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"VARCHAR, VAR_STRING"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/string"},"String"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"BLOB"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/string"},"String"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"GEOMETRY"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/string"},"String"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"BINARY"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/fixedstring"},"FixedString"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"BIT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt64"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SET"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"/docs/en/sql-reference/data-types/int-uint"},"UInt64"))))),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/data-types/nullable"},"Nullable")," is supported."),(0,i.kt)("p",null,"The data of TIME type in MySQL is converted to microseconds in ClickHouse."),(0,i.kt)("p",null,'Other types are not supported. If MySQL table contains a column of such type, ClickHouse throws exception "Unhandled data type" and stops replication.'),(0,i.kt)("h2",{id:"specifics-and-recommendations"},"Specifics and Recommendations"),(0,i.kt)("h3",{id:"compatibility-restrictions"},"Compatibility Restrictions"),(0,i.kt)("p",null,"Apart of the data types limitations there are few restrictions comparing to ",(0,i.kt)("inlineCode",{parentName:"p"},"MySQL")," databases, that should be resolved before replication will be possible:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Each table in ",(0,i.kt)("inlineCode",{parentName:"p"},"MySQL")," should contain ",(0,i.kt)("inlineCode",{parentName:"p"},"PRIMARY KEY"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Replication for tables, those are containing rows with ",(0,i.kt)("inlineCode",{parentName:"p"},"ENUM")," field values out of range (specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"ENUM")," signature) will not work."))),(0,i.kt)("h3",{id:"ddl-queries"},"DDL Queries"),(0,i.kt)("p",null,"MySQL DDL queries are converted into the corresponding ClickHouse DDL queries (",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/alter/"},"ALTER"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/create/"},"CREATE"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/drop"},"DROP"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/rename"},"RENAME"),"). If ClickHouse cannot parse some DDL query, the query is ignored."),(0,i.kt)("h3",{id:"data-replication"},"Data Replication"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL")," does not support direct ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"UPDATE")," queries. However, they are supported in terms of data replication:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"MySQL ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," query is converted into ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign=1"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"MySQL ",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE")," query is converted into ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign=-1"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"MySQL ",(0,i.kt)("inlineCode",{parentName:"p"},"UPDATE")," query is converted into ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign=-1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign=1")," if the primary key has been changed, or\n",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign=1")," if not."))),(0,i.kt)("h3",{id:"select"},"Selecting from MaterializedMySQL Tables"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SELECT")," query from ",(0,i.kt)("inlineCode",{parentName:"p"},"MaterializedMySQL")," tables has some specifics:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If ",(0,i.kt)("inlineCode",{parentName:"p"},"_version")," is not specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"SELECT")," query, the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/select/from/#select-from-final"},"FINAL")," modifier is used, so only rows with\n",(0,i.kt)("inlineCode",{parentName:"p"},"MAX(_version)")," are returned for each primary key value.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If ",(0,i.kt)("inlineCode",{parentName:"p"},"_sign")," is not specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"SELECT")," query, ",(0,i.kt)("inlineCode",{parentName:"p"},"WHERE _sign=1")," is used by default. So the deleted rows are not\nincluded into the result set.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The result includes columns comments in case they exist in MySQL database tables."))),(0,i.kt)("h3",{id:"index-conversion"},"Index Conversion"),(0,i.kt)("p",null,"MySQL ",(0,i.kt)("inlineCode",{parentName:"p"},"PRIMARY KEY")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"INDEX")," clauses are converted into ",(0,i.kt)("inlineCode",{parentName:"p"},"ORDER BY")," tuples in ClickHouse tables."),(0,i.kt)("p",null,"ClickHouse has only one physical order, which is determined by ",(0,i.kt)("inlineCode",{parentName:"p"},"ORDER BY")," clause. To create a new physical order, use\n",(0,i.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/create/view/#materialized"},"materialized views"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Notes")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Rows with ",(0,i.kt)("inlineCode",{parentName:"li"},"_sign=-1")," are not deleted physically from the tables."),(0,i.kt)("li",{parentName:"ul"},"Cascade ",(0,i.kt)("inlineCode",{parentName:"li"},"UPDATE/DELETE")," queries are not supported by the ",(0,i.kt)("inlineCode",{parentName:"li"},"MaterializedMySQL")," engine, as they are not visible in the\nMySQL binlog."),(0,i.kt)("li",{parentName:"ul"},"Replication can be easily broken."),(0,i.kt)("li",{parentName:"ul"},"Manual operations on database and tables are forbidden."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MaterializedMySQL")," is affected by the ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/operations/settings/settings/#optimize-on-insert"},"optimize_on_insert"),"\nsetting. Data is merged in the corresponding table in the ",(0,i.kt)("inlineCode",{parentName:"li"},"MaterializedMySQL")," database when a table in the MySQL\nserver changes.")),(0,i.kt)("h3",{id:"table-overrides"},"Table Overrides"),(0,i.kt)("p",null,"Table overrides can be used to customize the ClickHouse DDL queries, allowing you to make schema optimizations for your\napplication. This is especially useful for controlling partitioning, which is important for the overall performance of\nMaterializedMySQL."),(0,i.kt)("p",null,"These are the schema conversion manipulations you can do with table overrides for MaterializedMySQL:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify column type. Must be compatible with the original type, or replication will fail. For example,\nyou can modify a UInt32 column to UInt64, but you can not modify a String column to Array(String)."),(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-column-ttl"},"column TTL"),"."),(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/create/table/#codecs"},"column compression codec"),"."),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/statements/create/table/#alias"},"ALIAS columns"),"."),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#table_engine-mergetree-data_skipping-indexes"},"skipping indexes")),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#projections"},"projections"),". Note that projection optimizations are\ndisabled when using ",(0,i.kt)("inlineCode",{parentName:"li"},"SELECT ... FINAL")," (which MaterializedMySQL does by default), so their utility is limited here.\n",(0,i.kt)("inlineCode",{parentName:"li"},"INDEX ... TYPE hypothesis")," as ","[described in the v21.12 blog post]","](",(0,i.kt)("a",{parentName:"li",href:"https://clickhouse.com/blog/en/2021/clickhouse-v21.12-released/"},"https://clickhouse.com/blog/en/2021/clickhouse-v21.12-released/"),")\nmay be more useful in this case."),(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/custom-partitioning-key/"},"PARTITION BY")),(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-query-clauses"},"ORDER BY")),(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-query-clauses"},"PRIMARY KEY")),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-query-clauses"},"SAMPLE BY")),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("a",{parentName:"li",href:"/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-query-clauses"},"table TTL"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE db_name ENGINE = MaterializedMySQL(...)\n[SETTINGS ...]\n[TABLE OVERRIDE table_name (\n    [COLUMNS (\n        [col_name [datatype] [ALIAS expr] [CODEC(...)] [TTL expr], ...]\n        [INDEX index_name expr TYPE indextype[(...)] GRANULARITY val, ...]\n        [PROJECTION projection_name (SELECT <COLUMN LIST EXPR> [GROUP BY] [ORDER BY]), ...]\n    )]\n    [ORDER BY expr]\n    [PRIMARY KEY expr]\n    [PARTITION BY expr]\n    [SAMPLE BY expr]\n    [TTL expr]\n), ...]\n")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE db_name ENGINE = MaterializedMySQL(...)\nTABLE OVERRIDE table1 (\n    COLUMNS (\n        userid UUID,\n        category LowCardinality(String),\n        timestamp DateTime CODEC(Delta, Default)\n    )\n    PARTITION BY toYear(timestamp)\n),\nTABLE OVERRIDE table2 (\n    COLUMNS (\n        client_ip String TTL created + INTERVAL 72 HOUR\n    )\n    SAMPLE BY ip_hash\n)\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"COLUMNS")," list is sparse; existing columns are modified as specified, extra ALIAS columns are added. It is not\npossible to add ordinary or MATERIALIZED columns.  Modified columns with a different type must be assignable from the\noriginal type. There is currently no validation of this or similar issues when the ",(0,i.kt)("inlineCode",{parentName:"p"},"CREATE DATABASE")," query executes, so\nextra care needs to be taken."),(0,i.kt)("p",null,"You may specify overrides for tables that do not exist yet."),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"It is easy to break replication with table overrides if not used with care. For example:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"If an ALIAS column is added with a table override, and a column with the same name is later added to the source\nMySQL table, the converted ALTER TABLE query in ClickHouse will fail and replication stops."),(0,i.kt)("li",{parentName:"ul"},"It is currently possible to add overrides that reference nullable columns where not-nullable are required, such as in\n",(0,i.kt)("inlineCode",{parentName:"li"},"ORDER BY")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"PARTITION BY"),". This will cause CREATE TABLE queries that will fail, also causing replication to stop."))),(0,i.kt)("h2",{id:"examples-of-use"},"Examples of Use"),(0,i.kt)("p",null,"Queries in MySQL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> CREATE DATABASE db;\nmysql> CREATE TABLE db.test (a INT PRIMARY KEY, b INT);\nmysql> INSERT INTO db.test VALUES (1, 11), (2, 22);\nmysql> DELETE FROM db.test WHERE a=1;\nmysql> ALTER TABLE db.test ADD COLUMN c VARCHAR(16);\nmysql> UPDATE db.test SET c='Wow!', b=222;\nmysql> SELECT * FROM test;\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500a\u2500\u252c\u2500\u2500\u2500b\u2500\u252c\u2500c\u2500\u2500\u2500\u2500\u2510\n\u2502 2 \u2502 222 \u2502 Wow! \u2502\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("p",null,"Database in ClickHouse, exchanging data with the MySQL server:"),(0,i.kt)("p",null,"The database and the table created:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE mysql ENGINE = MaterializedMySQL('localhost:3306', 'db', 'user', '***');\nSHOW TABLES FROM mysql;\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500name\u2500\u2510\n\u2502 test \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("p",null,"After inserting data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM mysql.test;\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500a\u2500\u252c\u2500\u2500b\u2500\u2510\n\u2502 1 \u2502 11 \u2502\n\u2502 2 \u2502 22 \u2502\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518\n")),(0,i.kt)("p",null,"After deleting data, adding the column and updating:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM mysql.test;\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500a\u2500\u252c\u2500\u2500\u2500b\u2500\u252c\u2500c\u2500\u2500\u2500\u2500\u2510\n\u2502 2 \u2502 222 \u2502 Wow! \u2502\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")))}u.isMDXComponent=!0}}]);