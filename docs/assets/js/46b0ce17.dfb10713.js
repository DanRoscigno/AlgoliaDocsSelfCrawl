"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[45298],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,g=c["".concat(o,".").concat(d)]||c[d]||m[d]||l;return n?a.createElement(g,s(s({ref:t},u),{},{components:n})):a.createElement(g,s({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[c]="string"==typeof e?e:r,s[1]=i;for(var p=2;p<l;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},92947:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const l={slug:"/en/engines/table-engines/integrations/postgresql",sidebar_position:11,sidebar_label:"PostgreSQL"},s="PostgreSQL",i={unversionedId:"en/engines/table-engines/integrations/postgresql",id:"en/engines/table-engines/integrations/postgresql",title:"PostgreSQL",description:"The PostgreSQL engine allows to perform SELECT and INSERT queries on data that is stored on a remote PostgreSQL server.",source:"@site/docs/en/engines/table-engines/integrations/postgresql.md",sourceDirName:"en/engines/table-engines/integrations",slug:"/en/engines/table-engines/integrations/postgresql",permalink:"/AlgoliaDocsSelfCrawl/en/engines/table-engines/integrations/postgresql",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/engines/table-engines/integrations/postgresql.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{slug:"/en/engines/table-engines/integrations/postgresql",sidebar_position:11,sidebar_label:"PostgreSQL"},sidebar:"english",previous:{title:"RabbitMQ",permalink:"/AlgoliaDocsSelfCrawl/en/engines/table-engines/integrations/rabbitmq"},next:{title:"ExternalDistributed",permalink:"/AlgoliaDocsSelfCrawl/en/engines/table-engines/integrations/ExternalDistributed"}},o={},p=[{value:"Creating a Table",id:"creating-a-table",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Related content",id:"related-content",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"postgresql"},"PostgreSQL"),(0,r.kt)("p",null,"The PostgreSQL engine allows to perform ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"INSERT")," queries on data that is stored on a remote PostgreSQL server."),(0,r.kt)("h2",{id:"creating-a-table"},"Creating a Table"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]\n(\n    name1 [type1] [DEFAULT|MATERIALIZED|ALIAS expr1] [TTL expr1],\n    name2 [type2] [DEFAULT|MATERIALIZED|ALIAS expr2] [TTL expr2],\n    ...\n) ENGINE = PostgreSQL('host:port', 'database', 'table', 'user', 'password'[, `schema`]);\n")),(0,r.kt)("p",null,"See a detailed description of the ",(0,r.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/statements/create/table#create-table-query"},"CREATE TABLE")," query."),(0,r.kt)("p",null,"The table structure can differ from the original PostgreSQL table structure:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Column names should be the same as in the original PostgreSQL table, but you can use just some of these columns and in any order."),(0,r.kt)("li",{parentName:"ul"},"Column types may differ from those in the original PostgreSQL table. ClickHouse tries to ",(0,r.kt)("a",{parentName:"li",href:"/AlgoliaDocsSelfCrawl/en/engines/database-engines/postgresql#data_types-support"},"cast")," values to the ClickHouse data types."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("a",{parentName:"li",href:"/AlgoliaDocsSelfCrawl/en/operations/settings/settings#external-table-functions-use-nulls"},"external_table_functions_use_nulls")," setting defines how to handle Nullable columns. Default value: 1. If 0, the table function does not make Nullable columns and inserts default values instead of nulls. This is also applicable for NULL values inside arrays.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Engine Parameters")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"host:port")," \u2014 PostgreSQL server address."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"database")," \u2014 Remote database name."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"table")," \u2014 Remote table name."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"user")," \u2014 PostgreSQL user."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"password")," \u2014 User password."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"schema")," \u2014 Non-default table schema. Optional."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"on conflict ...")," \u2014 example: ",(0,r.kt)("inlineCode",{parentName:"li"},"ON CONFLICT DO NOTHING"),". Optional. Note: adding this option will make insertion less efficient.")),(0,r.kt)("p",null,"or via config (since version 21.11):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<named_collections>\n    <postgres1>\n        <host></host>\n        <port></port>\n        <user></user>\n        <password></password>\n        <table></table>\n    </postgres1>\n    <postgres2>\n        <host></host>\n        <port></port>\n        <user></user>\n        <password></password>\n    </postgres2>\n</named_collections>\n")),(0,r.kt)("p",null,"Some parameters can be overriden by key value arguments:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM postgresql(postgres1, schema='schema1', table='table1');\n")),(0,r.kt)("h2",{id:"implementation-details"},"Implementation Details"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," queries on PostgreSQL side run as ",(0,r.kt)("inlineCode",{parentName:"p"},"COPY (SELECT ...) TO STDOUT")," inside read-only PostgreSQL transaction with commit after each ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," query."),(0,r.kt)("p",null,"Simple ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," clauses such as ",(0,r.kt)("inlineCode",{parentName:"p"},"="),", ",(0,r.kt)("inlineCode",{parentName:"p"},"!="),", ",(0,r.kt)("inlineCode",{parentName:"p"},">"),", ",(0,r.kt)("inlineCode",{parentName:"p"},">="),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<="),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"IN")," are executed on the PostgreSQL server."),(0,r.kt)("p",null,"All joins, aggregations, sorting, ",(0,r.kt)("inlineCode",{parentName:"p"},"IN [ array ]")," conditions and the ",(0,r.kt)("inlineCode",{parentName:"p"},"LIMIT")," sampling constraint are executed in ClickHouse only after the query to PostgreSQL finishes."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"INSERT")," queries on PostgreSQL side run as ",(0,r.kt)("inlineCode",{parentName:"p"},'COPY "table_name" (field1, field2, ... fieldN) FROM STDIN')," inside PostgreSQL transaction with auto-commit after each ",(0,r.kt)("inlineCode",{parentName:"p"},"INSERT")," statement."),(0,r.kt)("p",null,"PostgreSQL ",(0,r.kt)("inlineCode",{parentName:"p"},"Array")," types are converted into ClickHouse arrays."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Be careful - in PostgreSQL an array data, created like a ",(0,r.kt)("inlineCode",{parentName:"p"},"type_name[]"),", may contain multi-dimensional arrays of different dimensions in different table rows in same column. But in ClickHouse it is only allowed to have multidimensional arrays of the same count of dimensions in all table rows in same column.")),(0,r.kt)("p",null,"Supports multiple replicas that must be listed by ",(0,r.kt)("inlineCode",{parentName:"p"},"|"),". For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE test_replicas (id UInt32, name String) ENGINE = PostgreSQL(`postgres{2|3|4}:5432`, 'clickhouse', 'test_replicas', 'postgres', 'mysecretpassword');\n")),(0,r.kt)("p",null,"Replicas priority for PostgreSQL dictionary source is supported. The bigger the number in map, the less the priority. The highest priority is ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),"."),(0,r.kt)("p",null,"In the example below replica ",(0,r.kt)("inlineCode",{parentName:"p"},"example01-1")," has the highest priority:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<postgresql>\n    <port>5432</port>\n    <user>clickhouse</user>\n    <password>qwerty</password>\n    <replica>\n        <host>example01-1</host>\n        <priority>1</priority>\n    </replica>\n    <replica>\n        <host>example01-2</host>\n        <priority>2</priority>\n    </replica>\n    <db>db_name</db>\n    <table>table_name</table>\n    <where>id=10</where>\n    <invalidate_query>SQL_QUERY</invalidate_query>\n</postgresql>\n</source>\n")),(0,r.kt)("h2",{id:"usage-example"},"Usage Example"),(0,r.kt)("p",null,"Table in PostgreSQL:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'postgres=# CREATE TABLE "public"."test" (\n"int_id" SERIAL,\n"int_nullable" INT NULL DEFAULT NULL,\n"float" FLOAT NOT NULL,\n"str" VARCHAR(100) NOT NULL DEFAULT \'\',\n"float_nullable" FLOAT NULL DEFAULT NULL,\nPRIMARY KEY (int_id));\n\nCREATE TABLE\n\npostgres=# INSERT INTO test (int_id, str, "float") VALUES (1,\'test\',2);\nINSERT 0 1\n\npostgresql> SELECT * FROM test;\n  int_id | int_nullable | float | str  | float_nullable\n --------+--------------+-------+------+----------------\n       1 |              |     2 | test |\n (1 row)\n')),(0,r.kt)("p",null,"Table in ClickHouse, retrieving data from the PostgreSQL table created above:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE default.postgresql_table\n(\n    `float_nullable` Nullable(Float32),\n    `str` String,\n    `int_id` Int32\n)\nENGINE = PostgreSQL('localhost:5432', 'public', 'test', 'postges_user', 'postgres_password');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM postgresql_table WHERE str IN ('test');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500float_nullable\u2500\u252c\u2500str\u2500\u2500\u252c\u2500int_id\u2500\u2510\n\u2502           \u1d3a\u1d41\u1d38\u1d38 \u2502 test \u2502      1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("p",null,"Using Non-default Schema:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'postgres=# CREATE SCHEMA "nice.schema";\n\npostgres=# CREATE TABLE "nice.schema"."nice.table" (a integer);\n\npostgres=# INSERT INTO "nice.schema"."nice.table" SELECT i FROM generate_series(0, 99) as t(i)\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE pg_table_schema_with_dots (a UInt32)\n        ENGINE PostgreSQL('localhost:5432', 'clickhouse', 'nice.table', 'postgrsql_user', 'password', 'nice.schema');\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"See Also")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/table-functions/postgresql"},"The ",(0,r.kt)("inlineCode",{parentName:"a"},"postgresql")," table function")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/AlgoliaDocsSelfCrawl/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources#dicts-external_dicts_dict_sources-postgresql"},"Using PostgreSQL as a dictionary source"))),(0,r.kt)("h2",{id:"related-content"},"Related content"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Blog: ",(0,r.kt)("a",{parentName:"li",href:"https://clickhouse.com/blog/migrating-data-between-clickhouse-postgres"},"ClickHouse and PostgreSQL - a match made in data heaven - part 1"))))}m.isMDXComponent=!0}}]);