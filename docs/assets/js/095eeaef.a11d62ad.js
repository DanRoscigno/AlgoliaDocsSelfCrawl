"use strict";(self.webpackChunkclickhouse_docs_2_3_0=self.webpackChunkclickhouse_docs_2_3_0||[]).push([[595],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>k});var t=n(67294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function l(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?l(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=t.createContext({}),p=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},d=function(e){var a=p(e.components);return t.createElement(i.Provider,{value:a},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},c=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=p(n),c=r,k=u["".concat(i,".").concat(c)]||u[c]||m[c]||l;return n?t.createElement(k,s(s({ref:a},d),{},{components:n})):t.createElement(k,s({ref:a},d))}));function k(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=c;var o={};for(var i in a)hasOwnProperty.call(a,i)&&(o[i]=a[i]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<l;p++)s[p]=n[p];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}c.displayName="MDXCreateElement"},92173:(e,a,n)=>{n.d(a,{ZP:()=>o});var t=n(87462),r=(n(67294),n(3905));const l={toc:[{value:"Test admin privileges",id:"test-admin-privileges",level:2},{value:"Non-admin users",id:"non-admin-users",level:2},{value:"Preparation",id:"preparation",level:3},{value:"Creating a sample database, table, and rows",id:"creating-a-sample-database-table-and-rows",level:4},{value:"Creating roles",id:"creating-roles",level:4},{value:"Verification",id:"verification",level:2},{value:"Testing role privileges with column restricted user",id:"testing-role-privileges-with-column-restricted-user",level:3},{value:"Testing role privileges with row restricted user",id:"testing-role-privileges-with-row-restricted-user",level:3},{value:"Modifying Users and Roles",id:"modifying-users-and-roles",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Listing the grants and roles for a user",id:"listing-the-grants-and-roles-for-a-user",level:3},{value:"List roles in ClickHouse",id:"list-roles-in-clickhouse",level:3},{value:"Display the policies",id:"display-the-policies",level:3},{value:"View how a policy was defined and current privileges",id:"view-how-a-policy-was-defined-and-current-privileges",level:3},{value:"Example commands to manage roles, policies, and users",id:"example-commands-to-manage-roles-policies-and-users",level:2},{value:"Remove privilege from a role",id:"remove-privilege-from-a-role",level:3},{value:"Delete a policy",id:"delete-a-policy",level:3},{value:"Unassign a user from a role",id:"unassign-a-user-from-a-role",level:3},{value:"Delete a role",id:"delete-a-role",level:3},{value:"Delete a user",id:"delete-a-user",level:3},{value:"Summary",id:"summary",level:2}]},s="wrapper";function o(e){let{components:a,...n}=e;return(0,r.kt)(s,(0,t.Z)({},l,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"test-admin-privileges"},"Test admin privileges"),(0,r.kt)("p",null,"Log out as the user ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," and log back in as user ",(0,r.kt)("inlineCode",{parentName:"p"},"clickhouse_admin"),"."),(0,r.kt)("p",null,"All of these should succeed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW GRANTS FOR clickhouse_admin;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE db1\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE db1.table1 (id UInt64, column1 String) ENGINE = MergeTree() ORDER BY id;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO db1.table1 (id, column1) VALUES (1, 'abc');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM db1.table1;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP TABLE db1.table1;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP DATABASE db1;\n")),(0,r.kt)("h2",{id:"non-admin-users"},"Non-admin users"),(0,r.kt)("p",null,"Users should have the privileges necessary, and not all be admin users.  The rest of this document provides example scenarios and the roles required."),(0,r.kt)("h3",{id:"preparation"},"Preparation"),(0,r.kt)("p",null,"Create these tables and users to be used in the examples."),(0,r.kt)("h4",{id:"creating-a-sample-database-table-and-rows"},"Creating a sample database, table, and rows"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a test database"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE db1;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a table"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE db1.table1 (\n    id UInt64,\n    column1 String,\n    column2 String\n)\nENGINE MergeTree\nORDER BY id;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Populate the table with sample rows"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO db1.table1\n    (id, column1, column2)\nVALUES\n    (1, 'A', 'abc'),\n    (2, 'A', 'def'),\n    (3, 'B', 'abc'),\n    (4, 'B', 'def');\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify the table:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 475015cc-6f51-4b20-bda2-3c9c41404e49\n\n\u250c\u2500id\u2500\u252c\u2500column1\u2500\u252c\u2500column2\u2500\u2510\n\u2502  1 \u2502 A       \u2502 abc     \u2502\n\u2502  2 \u2502 A       \u2502 def     \u2502\n\u2502  3 \u2502 B       \u2502 abc     \u2502\n\u2502  4 \u2502 B       \u2502 def     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a regular user that will be used to demonstrate restrict access to certain columns:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER column_user IDENTIFIED BY 'password';\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a regular user that will be used to demonstrate restricting access to rows with certain values:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER row_user IDENTIFIED BY 'password';\n")))),(0,r.kt)("h4",{id:"creating-roles"},"Creating roles"),(0,r.kt)("p",null,"With this set of examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"roles for different privileges, such as columns and rows will be created"),(0,r.kt)("li",{parentName:"ul"},"privileges will be granted to the roles"),(0,r.kt)("li",{parentName:"ul"},"users will be assigned to each role")),(0,r.kt)("p",null,"Roles are used to define groups of users for certain privileges instead of managing each user separately."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a role to restrict users of this role to only see ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")," in database ",(0,r.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"table1"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROLE column1_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set privileges to allow view on ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT SELECT(id, column1) ON db1.table1 TO column1_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"column_user")," user to the ",(0,r.kt)("inlineCode",{parentName:"p"},"column1_users")," role"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT column1_users TO column_user;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a role to restrict users of this role to only see selected rows, in this case, only rows containing ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROLE A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"row_user")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"A_rows_users")," role"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT A_rows_users TO row_user;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a policy to allow view on only where ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")," has the values of ",(0,r.kt)("inlineCode",{parentName:"p"},"A")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROW POLICY A_row_filter ON db1.table1 FOR SELECT USING column1 = 'A' TO A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set privileges to the database and table"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT SELECT(id, column1, column2) ON db1.table1 TO A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"grant explicit permissions for other roles to still have access to all rows"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROW POLICY allow_other_users_filter ON db1.table1 FOR SELECT USING 1 TO clickhouse_admin, column1_users;\n")),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"When attaching a policy to a table, the system will apply that policy, and only those users and roles defined will be able to do operations on the table, all others will be denied any operations.\nIn order to not have the restrictive row policy applied to other users, another policy must be defined to allow other users and roles to have regular or other types of access.")))),(0,r.kt)("h2",{id:"verification"},"Verification"),(0,r.kt)("h3",{id:"testing-role-privileges-with-column-restricted-user"},"Testing role privileges with column restricted user"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into the clickhouse client using the ",(0,r.kt)("inlineCode",{parentName:"p"},"clickhouse_admin")," user"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"clickhouse-client --user clickhouse_admin --password password\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify access to database, table and all rows with the admin user."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: f5e906ea-10c6-45b0-b649-36334902d31d\n\n\u250c\u2500id\u2500\u252c\u2500column1\u2500\u252c\u2500column2\u2500\u2510\n\u2502  1 \u2502 A       \u2502 abc     \u2502\n\u2502  2 \u2502 A       \u2502 def     \u2502\n\u2502  3 \u2502 B       \u2502 abc     \u2502\n\u2502  4 \u2502 B       \u2502 def     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into the ClickHouse client using the ",(0,r.kt)("inlineCode",{parentName:"p"},"column_user")," user"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"clickhouse-client --user column_user --password password\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Test ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," using all columns"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 5576f4eb-7450-435c-a2d6-d6b49b7c4a23\n\n0 rows in set. Elapsed: 0.006 sec.\n\nReceived exception from server (version 22.3.2):\nCode: 497. DB::Exception: Received from localhost:9000. DB::Exception: column_user: Not enough privileges. To execute this query it's necessary to have grant SELECT(id, column1, column2) ON db1.table1. (ACCESS_DENIED)\n")),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Access is denied since all columns were specified and the user only has access to ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," query with only columns specified and allowed:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    id,\n    column1\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: cef9a083-d5ce-42ff-9678-f08dc60d4bb9\n\n\u250c\u2500id\u2500\u252c\u2500column1\u2500\u2510\n\u2502  1 \u2502 A       \u2502\n\u2502  2 \u2502 A       \u2502\n\u2502  3 \u2502 B       \u2502\n\u2502  4 \u2502 B       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")))),(0,r.kt)("h3",{id:"testing-role-privileges-with-row-restricted-user"},"Testing role privileges with row restricted user"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into the ClickHouse client using ",(0,r.kt)("inlineCode",{parentName:"p"},"row_user")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"clickhouse-client --user row_user --password password\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"View rows available"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: a79a113c-1eca-4c3f-be6e-d034f9a220fb\n\n\u250c\u2500id\u2500\u252c\u2500column1\u2500\u252c\u2500column2\u2500\u2510\n\u2502  1 \u2502 A       \u2502 abc     \u2502\n\u2502  2 \u2502 A       \u2502 def     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Verify that only the above two rows are returned, rows with the value ",(0,r.kt)("inlineCode",{parentName:"p"},"B")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")," should be excluded.")))),(0,r.kt)("h2",{id:"modifying-users-and-roles"},"Modifying Users and Roles"),(0,r.kt)("p",null,"Users can be assigned multiple roles for a combination of privileges needed. When using multiple roles, the system will combine the roles to determine privileges, the net effect will be that the role permissions will be cumulative."),(0,r.kt)("p",null,"For example, if one ",(0,r.kt)("inlineCode",{parentName:"p"},"role1")," allows for only select on ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"role2")," allows for select on ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"column2")," then the user will have access to both columns."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using the admin account, create new user to restrict by both row and column with default roles"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER row_and_column_user IDENTIFIED BY 'password' DEFAULT ROLE A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Remove prior privileges for ",(0,r.kt)("inlineCode",{parentName:"p"},"A_rows_users")," role"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"REVOKE SELECT(id, column1, column2) ON db1.table1 FROM A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Allow ",(0,r.kt)("inlineCode",{parentName:"p"},"A_row_users")," role to only select from ",(0,r.kt)("inlineCode",{parentName:"p"},"column1")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT SELECT(id, column1) ON db1.table1 TO A_rows_users;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into the ClickHouse client using ",(0,r.kt)("inlineCode",{parentName:"p"},"row_and_column_user")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"clickhouse-client --user row_and_column_user --password password;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Test with all columns:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 8cdf0ff5-e711-4cbe-bd28-3c02e52e8bc4\n\n0 rows in set. Elapsed: 0.005 sec.\n\nReceived exception from server (version 22.3.2):\nCode: 497. DB::Exception: Received from localhost:9000. DB::Exception: row_and_column_user: Not enough privileges. To execute this query it's necessary to have grant SELECT(id, column1, column2) ON db1.table1. (ACCESS_DENIED)\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Test with limited allowed columns:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    id,\n    column1\nFROM db1.table1\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 5e30b490-507a-49e9-9778-8159799a6ed0\n\n\u250c\u2500id\u2500\u252c\u2500column1\u2500\u2510\n\u2502  1 \u2502 A       \u2502\n\u2502  2 \u2502 A       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")))),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"There are occasions when privileges intersect or combine to produce unexpected results, the following commands can be used to narrow the issue using an admin account"),(0,r.kt)("h3",{id:"listing-the-grants-and-roles-for-a-user"},"Listing the grants and roles for a user"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW GRANTS FOR row_and_column_user\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 6a73a3fe-2659-4aca-95c5-d012c138097b\n\n\u250c\u2500GRANTS FOR row_and_column_user\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 GRANT A_rows_users, column1_users TO row_and_column_user \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("h3",{id:"list-roles-in-clickhouse"},"List roles in ClickHouse"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW ROLES\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 1e21440a-18d9-4e75-8f0e-66ec9b36470a\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 A_rows_users    \u2502\n\u2502 column1_users   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("h3",{id:"display-the-policies"},"Display the policies"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW ROW POLICIES\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: f2c636e9-f955-4d79-8e80-af40ea227ebc\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 A_row_filter ON db1.table1             \u2502\n\u2502 allow_other_users_filter ON db1.table1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("h3",{id:"view-how-a-policy-was-defined-and-current-privileges"},"View how a policy was defined and current privileges"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW CREATE ROW POLICY A_row_filter ON db1.table1\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"Query id: 0d3b5846-95c7-4e62-9cdd-91d82b14b80b\n\n\u250c\u2500CREATE ROW POLICY A_row_filter ON db1.table1\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 CREATE ROW POLICY A_row_filter ON db1.table1 FOR SELECT USING column1 = 'A' TO A_rows_users \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("h2",{id:"example-commands-to-manage-roles-policies-and-users"},"Example commands to manage roles, policies, and users"),(0,r.kt)("p",null,"The following commands can be used to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"delete privileges"),(0,r.kt)("li",{parentName:"ul"},"delete policies"),(0,r.kt)("li",{parentName:"ul"},"unassign users from roles"),(0,r.kt)("li",{parentName:"ul"},"delete users and roles",(0,r.kt)("br",null))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Run these commands as an admin user or the ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," user")),(0,r.kt)("h3",{id:"remove-privilege-from-a-role"},"Remove privilege from a role"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"REVOKE SELECT(column1, id) ON db1.table1 FROM A_rows_users;\n")),(0,r.kt)("h3",{id:"delete-a-policy"},"Delete a policy"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP ROW POLICY A_row_filter ON db1.table1;\n")),(0,r.kt)("h3",{id:"unassign-a-user-from-a-role"},"Unassign a user from a role"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"REVOKE A_rows_users FROM row_user;\n")),(0,r.kt)("h3",{id:"delete-a-role"},"Delete a role"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP ROLE A_rows_users;\n")),(0,r.kt)("h3",{id:"delete-a-user"},"Delete a user"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DROP USER row_user;\n")),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"This article demonstrated the basics of creating SQL users and roles and provided steps to set and modify privileges for users and roles.\nFor more detailed information on each please refer to our user guides and reference documentation."))}o.isMDXComponent=!0},45637:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var t=n(87462),r=(n(67294),n(3905)),l=n(92173);const s={sidebar_label:"Defining SQL Users and Roles",sidebar_position:20,slug:"/en/guides/sre/users-and-roles",hide_table_of_contents:!0},o="Defining SQL Users and Roles",i={unversionedId:"en/guides/sre/user-management/users-and-roles",id:"en/guides/sre/user-management/users-and-roles",title:"Defining SQL Users and Roles",description:"If you are working in ClickHouse Cloud please see Cloud users and roles.",source:"@site/docs/en/guides/sre/user-management/users-and-roles.md",sourceDirName:"en/guides/sre/user-management",slug:"/en/guides/sre/users-and-roles",permalink:"/AlgoliaDocsSelfCrawl/en/guides/sre/users-and-roles",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/guides/sre/user-management/users-and-roles.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_label:"Defining SQL Users and Roles",sidebar_position:20,slug:"/en/guides/sre/users-and-roles",hide_table_of_contents:!0}},p={},d=[{value:"Enabling SQL user mode",id:"enabling-sql-user-mode",level:2},{value:"Defining users",id:"defining-users",level:2}],u={toc:d},m="wrapper";function c(e){let{components:a,...n}=e;return(0,r.kt)(m,(0,t.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"defining-sql-users-and-roles"},"Defining SQL Users and Roles"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you are working in ClickHouse Cloud please see ",(0,r.kt)("a",{parentName:"p",href:"/AlgoliaDocsSelfCrawl/en/cloud/users-and-roles"},"Cloud users and roles"),".")),(0,r.kt)("p",null,"This article shows the basics of defining SQL users and roles and applying those privileges and permissions to databases, tables, rows, and columns."),(0,r.kt)("h2",{id:"enabling-sql-user-mode"},"Enabling SQL user mode"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enable SQL user mode in the ",(0,r.kt)("inlineCode",{parentName:"p"},"users.xml")," file under the ",(0,r.kt)("inlineCode",{parentName:"p"},"<default>")," user:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<access_management>1</access_management>\n")),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," user is the only user that gets created with a fresh install and is also the account used for internode communications, by default."),(0,r.kt)("p",{parentName:"admonition"},"In production, it is recommended to disable this user once the inter-node communication has been configured with a SQL admin user and inter-node communications have been set with ",(0,r.kt)("inlineCode",{parentName:"p"},"<secret>"),", cluster credentials, and/or internode HTTP and transport protocol credentials since the ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," account is used for internode communication."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Restart the nodes to apply the changes.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start the ClickHouse client:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhouse-client --user default --password <password>\n")))),(0,r.kt)("h2",{id:"defining-users"},"Defining users"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a SQL administrator account:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER clickhouse_admin IDENTIFIED BY 'password';\n"))),(0,r.kt)("li",{parentName:"ol"},"Grant the new user full administrative rights",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT ALL ON *.* TO clickhouse_admin WITH GRANT OPTION;\n")))),(0,r.kt)(l.ZP,{mdxType:"Content"}))}c.isMDXComponent=!0}}]);